commit cac8bfbc39dd1d065a52850d079d2be434e306e2
Author: flawedworld <flawedworld@flawed.world>
Date:   Wed 2021-10-06 04:08:11+0100

    Set BUILD_BROKEN_ELF_PREBUILT_PRODUCT_COPY_FILES as workaround for APV
    
    Change-Id: I25cff5eec6335f526e27fa7ed08c79b9fbfcfe5a
---
 target/board/BoardConfigPixelCommon.mk | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/target/board/BoardConfigPixelCommon.mk b/target/board/BoardConfigPixelCommon.mk
index a970fec1ecf83bd1d2a55cf2a247fb445dd2b139..67c3a2b62d17c3b2b3f36c05bfe5972e5a88f369 100644
--- a/target/board/BoardConfigPixelCommon.mk
+++ b/target/board/BoardConfigPixelCommon.mk
@@ -9,10 +9,13 @@ BOARD_AVB_SYSTEM_OTHER_ADD_HASHTREE_FOOTER_ARGS += --hash_algorithm sha256
 BOARD_AVB_SYSTEM_EXT_ADD_HASHTREE_FOOTER_ARGS += --hash_algorithm sha256
 BOARD_AVB_PRODUCT_ADD_HASHTREE_FOOTER_ARGS += --hash_algorithm sha256
 
 # vendor and odm.
 BOARD_AVB_VENDOR_ADD_HASHTREE_FOOTER_ARGS += --hash_algorithm sha256
 BOARD_AVB_ODM_ADD_HASHTREE_FOOTER_ARGS += --hash_algorithm sha256
 
 # vendor_dlkm and odm_dlkm.
 BOARD_AVB_VENDOR_DLKM_ADD_HASHTREE_FOOTER_ARGS += --hash_algorithm sha256
 BOARD_AVB_ODM_DLKM_ADD_HASHTREE_FOOTER_ARGS += --hash_algorithm sha256
+
+# temporary hack for APV
+BUILD_BROKEN_ELF_PREBUILT_PRODUCT_COPY_FILES := true

commit 55c32889c9da231d44b949bee9dc6d70f92d16a5
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Wed 2020-09-16 18:05:27-0400

    add factory images scripts to otatools.zip
---
 core/Makefile | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/core/Makefile b/core/Makefile
index 2d56edb9eee5f1591b9597b0fab09f1cf70de4cb..1a72716ae28194fd178de7676252d294835aeb3a 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -4417,20 +4417,25 @@ endif
 ifneq (,$(wildcard external/avb))
 INTERNAL_OTATOOLS_PACKAGE_FILES += \
   $(sort $(shell find external/avb/test/data -type f -name "testkey_*.pem" -o \
       -name "atx_metadata.bin"))
 endif
 ifeq (true,$(PRODUCT_SUPPORTS_VBOOT))
 INTERNAL_OTATOOLS_PACKAGE_FILES += \
   $(sort $(shell find external/vboot_reference/tests/devkeys -type f))
 endif
 
+# Factory images
+INTERNAL_OTATOOLS_PACKAGE_FILES += \
+  device/common/clear-factory-images-variables.sh \
+  device/common/generate-factory-images-common.sh
+
 INTERNAL_OTATOOLS_RELEASETOOLS := \
   $(sort $(shell find build/make/tools/releasetools -name "*.pyc" -prune -o \
       \( -type f -o -type l \) -print))
 
 BUILT_OTATOOLS_PACKAGE := $(PRODUCT_OUT)/otatools.zip
 $(BUILT_OTATOOLS_PACKAGE): PRIVATE_ZIP_ROOT := $(call intermediates-dir-for,PACKAGING,otatools)/otatools
 $(BUILT_OTATOOLS_PACKAGE): PRIVATE_OTATOOLS_PACKAGE_FILES := $(INTERNAL_OTATOOLS_PACKAGE_FILES)
 $(BUILT_OTATOOLS_PACKAGE): PRIVATE_OTATOOLS_RELEASETOOLS := $(INTERNAL_OTATOOLS_RELEASETOOLS)
 $(BUILT_OTATOOLS_PACKAGE): $(INTERNAL_OTATOOLS_PACKAGE_FILES) $(INTERNAL_OTATOOLS_RELEASETOOLS)
 $(BUILT_OTATOOLS_PACKAGE): $(SOONG_ZIP) $(ZIP2ZIP)

commit 9ffb22455a4e0f1d54e6255116b7dda7de8b1332
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2021-10-15 00:58:53-0400

    add GrapheneOS scripts to otatools.zip
---
 core/Makefile | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/core/Makefile b/core/Makefile
index 1a72716ae28194fd178de7676252d294835aeb3a..a7153704c87f9c0280d7be6104f47517ed78bcb5 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -4422,20 +4422,29 @@ endif
 ifeq (true,$(PRODUCT_SUPPORTS_VBOOT))
 INTERNAL_OTATOOLS_PACKAGE_FILES += \
   $(sort $(shell find external/vboot_reference/tests/devkeys -type f))
 endif
 
 # Factory images
 INTERNAL_OTATOOLS_PACKAGE_FILES += \
   device/common/clear-factory-images-variables.sh \
   device/common/generate-factory-images-common.sh
 
+# GrapheneOS scripts
+INTERNAL_OTATOOLS_PACKAGE_FILES += \
+  script/common.sh \
+  script/decrypt_keys.sh \
+  script/encrypt_keys.sh \
+  script/generate_metadata.py \
+  script/release.sh \
+  script/signify_prehash.sh
+
 INTERNAL_OTATOOLS_RELEASETOOLS := \
   $(sort $(shell find build/make/tools/releasetools -name "*.pyc" -prune -o \
       \( -type f -o -type l \) -print))
 
 BUILT_OTATOOLS_PACKAGE := $(PRODUCT_OUT)/otatools.zip
 $(BUILT_OTATOOLS_PACKAGE): PRIVATE_ZIP_ROOT := $(call intermediates-dir-for,PACKAGING,otatools)/otatools
 $(BUILT_OTATOOLS_PACKAGE): PRIVATE_OTATOOLS_PACKAGE_FILES := $(INTERNAL_OTATOOLS_PACKAGE_FILES)
 $(BUILT_OTATOOLS_PACKAGE): PRIVATE_OTATOOLS_RELEASETOOLS := $(INTERNAL_OTATOOLS_RELEASETOOLS)
 $(BUILT_OTATOOLS_PACKAGE): $(INTERNAL_OTATOOLS_PACKAGE_FILES) $(INTERNAL_OTATOOLS_RELEASETOOLS)
 $(BUILT_OTATOOLS_PACKAGE): $(SOONG_ZIP) $(ZIP2ZIP)

commit 977a87ad8fc835a688cacf7ddf6d93db1a50f711
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2018-11-23 04:27:20-0500

    enable ro.control_privapp_permissions=enforce
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 core/main.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/core/main.mk b/core/main.mk
index c10a3cc5412a69c593488fd6196e3c581a17eab5..dd74da5b465e53ef162b35286ca9ee4896dbe70b 100644
--- a/core/main.mk
+++ b/core/main.mk
@@ -367,20 +367,21 @@ endif
 
 ## user/userdebug ##
 
 user_variant := $(filter user userdebug,$(TARGET_BUILD_VARIANT))
 enable_target_debugging := true
 tags_to_install :=
 ifneq (,$(user_variant))
   # Target is secure in user builds.
   ADDITIONAL_SYSTEM_PROPERTIES += ro.secure=1
   ADDITIONAL_SYSTEM_PROPERTIES += security.perf_harden=1
+  ADDITIONAL_SYSTEM_PROPERTIES += ro.control_privapp_permissions=enforce
 
   ifeq ($(user_variant),user)
     ADDITIONAL_SYSTEM_PROPERTIES += ro.adb.secure=1
   endif
 
   ifeq ($(user_variant),userdebug)
     # Pick up some extra useful tools
     tags_to_install += debug
   else
     # Disable debugging in plain user builds.

commit 6db55f1030bfd07e9f0ce35c0422fd328d9cead5
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-06 07:24:59-0400

    include Updater app when OFFICIAL_BUILD=true
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/media_system.mk | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/target/product/media_system.mk b/target/product/media_system.mk
index 30a8621b1565c61fe0154d5486e81103ea77e1f4..52329852398cf298b062f82b2bbea674639963c0 100644
--- a/target/product/media_system.mk
+++ b/target/product/media_system.mk
@@ -30,20 +30,24 @@ PRODUCT_PACKAGES += \
     ethernet-service \
     fsck.f2fs \
     HTMLViewer \
     libfilterpack_imageproc \
     libwebviewchromium_loader \
     libwebviewchromium_plat_support \
     make_f2fs \
     requestsync \
     StatementService \
 
+ifeq ($(OFFICIAL_BUILD),true)
+    PRODUCT_PACKAGES += Updater
+endif
+
 PRODUCT_HOST_PACKAGES += \
     fsck.f2fs \
 
 PRODUCT_COPY_FILES += \
     frameworks/native/data/etc/android.software.webview.xml:system/etc/permissions/android.software.webview.xml
 
 ifneq (REL,$(PLATFORM_VERSION_CODENAME))
 PRODUCT_COPY_FILES += \
     frameworks/native/data/etc/android.software.preview_sdk.xml:system/etc/permissions/android.software.preview_sdk.xml
 endif

commit 87b5df3296891460c9cfdab17b8fcd49e5eb922c
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-06 07:59:56-0400

    include Stk in base telephony support
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/aosp_base_telephony.mk | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/target/product/aosp_base_telephony.mk b/target/product/aosp_base_telephony.mk
index 0d4e3335613d0f1c86a193836fb63d3176ac04d6..4667e38562967cdd5d8223b8b660c8082fc5febf 100644
--- a/target/product/aosp_base_telephony.mk
+++ b/target/product/aosp_base_telephony.mk
@@ -9,11 +9,12 @@
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 $(call inherit-product, $(SRC_TARGET_DIR)/product/full_base_telephony.mk)
 
 PRODUCT_PACKAGES += \
-    messaging
+    messaging \
+    Stk

commit 8706cdab9ff7b9bcf7e494044979bc153de6fd09
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-06 07:28:11-0400

    always use dex preopt
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 core/board_config.mk      |  5 +----
 core/dex_preopt_config.mk | 32 +++++++++++++-------------------
 2 files changed, 14 insertions(+), 23 deletions(-)

diff --git a/core/board_config.mk b/core/board_config.mk
index 1b08f9a0b4059d840cbaf5335e255df143ebecb6..aaca505270af48b4463e16a2e68f6fd6491fe1dc 100644
--- a/core/board_config.mk
+++ b/core/board_config.mk
@@ -140,24 +140,21 @@ _build_broken_var_list := \
 _build_broken_var_list += \
   $(foreach m,$(AVAILABLE_BUILD_MODULE_TYPES) \
               $(DEFAULT_WARNING_BUILD_MODULE_TYPES) \
               $(DEFAULT_ERROR_BUILD_MODULE_TYPES), \
     BUILD_BROKEN_USES_$(m))
 
 _board_true_false_vars := $(_build_broken_var_list)
 _board_strip_readonly_list += $(_build_broken_var_list) \
   BUILD_BROKEN_NINJA_USES_ENV_VARS
 
-# Conditional to building on linux, as dex2oat currently does not work on darwin.
-ifeq ($(HOST_OS),linux)
-  WITH_DEXPREOPT := true
-endif
+WITH_DEXPREOPT := true
 
 # ###############################################################
 # Broken build defaults
 # ###############################################################
 $(foreach v,$(_build_broken_var_list),$(eval $(v) :=))
 BUILD_BROKEN_NINJA_USES_ENV_VARS :=
 
 # Boards may be defined under $(SRC_TARGET_DIR)/board/$(TARGET_DEVICE)
 # or under vendor/*/$(TARGET_DEVICE).  Search in both places, but
 # make sure only one exists.
diff --git a/core/dex_preopt_config.mk b/core/dex_preopt_config.mk
index 51238a36ca10cecc8192b9157d4d792566acae91..9d261453f4cd07cd666202b60281c2726df2c85f 100644
--- a/core/dex_preopt_config.mk
+++ b/core/dex_preopt_config.mk
@@ -11,21 +11,23 @@ else ifneq (true,$(filter true,$(PRODUCT_USES_DEFAULT_ART_CONFIG)))
   # ART config means that some important system properties are not set, which
   # would result in passing bad arguments to dex2oat and failing the build.
   ENABLE_PREOPT :=
   ENABLE_PREOPT_BOOT_IMAGES :=
 else ifeq (true,$(DISABLE_PREOPT))
   # Disable dexpreopt for libraries/apps, but do compile boot images.
   ENABLE_PREOPT :=
 endif
 
 # The default value for LOCAL_DEX_PREOPT
-DEX_PREOPT_DEFAULT ?= $(ENABLE_PREOPT)
+DEX_PREOPT_DEFAULT := true
+
+WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY := false
 
 # Whether to fail immediately if verify_uses_libraries check fails, or to keep
 # going and restrict dexpreopt to not compile any code for the failed module.
 #
 # The intended use case for this flag is to have a smoother migration path for
 # the Java modules that need to add <uses-library> information in their build
 # files. The flag allows to quickly silence build errors. This flag should be
 # used with caution and only as a temporary measure, as it masks real errors
 # and affects performance.
 ifndef RELAX_USES_LIBRARY_CHECK
@@ -43,39 +45,31 @@ SYSTEM_OTHER_ODEX_FILTER ?= \
     app/% \
     priv-app/% \
     system_ext/app/% \
     system_ext/priv-app/% \
     product/app/% \
     product/priv-app/% \
 
 # Global switch to control if updatable boot jars are included in dexpreopt.
 DEX_PREOPT_WITH_UPDATABLE_BCP := true
 
-# Conditional to building on linux, as dex2oat currently does not work on darwin.
-ifeq ($(HOST_OS),linux)
-  ifeq (eng,$(TARGET_BUILD_VARIANT))
-    # For an eng build only pre-opt the boot image and system server. This gives reasonable performance
-    # and still allows a simple workflow: building in frameworks/base and syncing.
-    WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY ?= true
-  endif
-  # Add mini-debug-info to the boot classpath unless explicitly asked not to.
-  ifneq (false,$(WITH_DEXPREOPT_DEBUG_INFO))
-    PRODUCT_DEX_PREOPT_BOOT_FLAGS += --generate-mini-debug-info
-  endif
+# Add mini-debug-info to the boot classpath unless explicitly asked not to.
+ifneq (false,$(WITH_DEXPREOPT_DEBUG_INFO))
+  PRODUCT_DEX_PREOPT_BOOT_FLAGS += --generate-mini-debug-info
+endif
 
-  # Non eng linux builds must have preopt enabled so that system server doesn't run as interpreter
-  # only. b/74209329
-  ifeq (,$(filter eng, $(TARGET_BUILD_VARIANT)))
-    ifneq (true,$(WITH_DEXPREOPT))
-      ifneq (true,$(WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY))
-        $(call pretty-error, DEXPREOPT must be enabled for user and userdebug builds)
-      endif
+# Non eng builds must have preopt enabled so that system server doesn't run as interpreter
+# only. b/74209329
+ifeq (,$(filter eng, $(TARGET_BUILD_VARIANT)))
+  ifneq (true,$(WITH_DEXPREOPT))
+    ifneq (true,$(WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY))
+      $(call pretty-error, DEXPREOPT must be enabled for user and userdebug builds)
     endif
   endif
 endif
 
 # Get value of a property. It is first searched from PRODUCT_VENDOR_PROPERTIES
 # and then falls back to PRODUCT_SYSTEM_PROPERTIES
 # $1: name of the property
 define get-product-default-property
 $(strip \
   $(eval _prop := $(patsubst $(1)=%,%,$(filter $(1)=%,$(PRODUCT_VENDOR_PROPERTIES))))\

commit b5bbc86caf8ed9f99f0ae8256113599ea0d4448d
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2016-08-28 14:14:10-0400

    disable ART JIT and JIT profiling
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/runtime_libart.mk | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/target/product/runtime_libart.mk b/target/product/runtime_libart.mk
index b511aa6b94b940679026e1f51be52b6d54469e53..031e7b827f37a3213cbae3f1a484ce51683f0e5c 100644
--- a/target/product/runtime_libart.mk
+++ b/target/product/runtime_libart.mk
@@ -79,22 +79,22 @@ PRODUCT_PACKAGES += \
 # listed here:
 #
 # https://source.android.com/devices/architecture/hidl/thermal-mitigation#thermal-api
 #
 # If the thermal status of the device reaches or exceeds the value set here
 # background dexopt will be terminated and rescheduled using an exponential
 # backoff polcy.
 #
 # The thermal cutoff value is currently set to THERMAL_STATUS_MODERATE.
 PRODUCT_SYSTEM_PROPERTIES += \
-    dalvik.vm.usejit=true \
-    dalvik.vm.usejitprofiles=true \
+    dalvik.vm.usejit=false \
+    dalvik.vm.usejitprofiles=false \
     dalvik.vm.dexopt.secondary=true \
     dalvik.vm.dexopt.thermal-cutoff=2 \
     dalvik.vm.appimageformat=lz4
 
 PRODUCT_SYSTEM_PROPERTIES += \
     ro.dalvik.vm.native.bridge=0
 
 # Different dexopt types for different package update/install times.
 # On eng builds, make "boot" reasons only extract for faster turnaround.
 ifeq (eng,$(TARGET_BUILD_VARIANT))

commit adff65ecf5706f302f317dd862c8230e603423b0
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Wed 2016-09-07 23:27:07-0400

    disable dexopt profile usage
    
    Profiling is disabled, but make sure that profiles are not used at all.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/runtime_libart.mk | 11 ++++-------
 1 file changed, 4 insertions(+), 7 deletions(-)

diff --git a/target/product/runtime_libart.mk b/target/product/runtime_libart.mk
index 031e7b827f37a3213cbae3f1a484ce51683f0e5c..ec0f89b81eb694c59007d379f8e9619303c49d0e 100644
--- a/target/product/runtime_libart.mk
+++ b/target/product/runtime_libart.mk
@@ -100,36 +100,33 @@ PRODUCT_SYSTEM_PROPERTIES += \
 ifeq (eng,$(TARGET_BUILD_VARIANT))
     PRODUCT_SYSTEM_PROPERTIES += \
         pm.dexopt.first-boot?=extract \
         pm.dexopt.boot-after-ota?=extract
 else
     PRODUCT_SYSTEM_PROPERTIES += \
         pm.dexopt.first-boot?=verify \
         pm.dexopt.boot-after-ota?=verify
 endif
 
-# The install filter is speed-profile in order to enable the use of
-# profiles from the dex metadata files. Note that if a profile is not provided
-# or if it is empty speed-profile is equivalent to (quicken + empty app image).
 # Note that `cmdline` is not strictly needed but it simplifies the management
 # of compilation reason in the platform (as we have a unified, single path,
 # without exceptions).
 PRODUCT_SYSTEM_PROPERTIES += \
     pm.dexopt.post-boot?=extract \
-    pm.dexopt.install?=speed-profile \
+    pm.dexopt.install?=speed \
     pm.dexopt.install-fast?=skip \
-    pm.dexopt.install-bulk?=speed-profile \
+    pm.dexopt.install-bulk?=speed \
     pm.dexopt.install-bulk-secondary?=verify \
     pm.dexopt.install-bulk-downgraded?=verify \
     pm.dexopt.install-bulk-secondary-downgraded?=extract \
-    pm.dexopt.bg-dexopt?=speed-profile \
-    pm.dexopt.ab-ota?=speed-profile \
+    pm.dexopt.bg-dexopt?=speed \
+    pm.dexopt.ab-ota?=speed \
     pm.dexopt.inactive?=verify \
     pm.dexopt.cmdline?=verify \
     pm.dexopt.shared?=speed
 
 # Pass file with the list of updatable boot class path packages to dex2oat.
 PRODUCT_SYSTEM_PROPERTIES += \
     dalvik.vm.dex2oat-updatable-bcp-packages-file=/system/etc/updatable-bcp-packages.txt
 
 # Enable resolution of startup const strings.
 PRODUCT_SYSTEM_PROPERTIES += \

commit 412fddd7c84ea54745098ce866a1aeaf54950956
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Thu 2016-09-29 01:02:28-0400

    always use speed mode ahead-of-time compilation
    
    The interpreter is too slow without the JIT to help it.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/runtime_libart.mk | 38 ++++++++++++++------------------------
 1 file changed, 14 insertions(+), 24 deletions(-)

diff --git a/target/product/runtime_libart.mk b/target/product/runtime_libart.mk
index ec0f89b81eb694c59007d379f8e9619303c49d0e..2916e4b2e7fcbcfb2ee6c2cc8b54b31153a555e2 100644
--- a/target/product/runtime_libart.mk
+++ b/target/product/runtime_libart.mk
@@ -88,48 +88,38 @@ PRODUCT_PACKAGES += \
 PRODUCT_SYSTEM_PROPERTIES += \
     dalvik.vm.usejit=false \
     dalvik.vm.usejitprofiles=false \
     dalvik.vm.dexopt.secondary=true \
     dalvik.vm.dexopt.thermal-cutoff=2 \
     dalvik.vm.appimageformat=lz4
 
 PRODUCT_SYSTEM_PROPERTIES += \
     ro.dalvik.vm.native.bridge=0
 
-# Different dexopt types for different package update/install times.
-# On eng builds, make "boot" reasons only extract for faster turnaround.
-ifeq (eng,$(TARGET_BUILD_VARIANT))
-    PRODUCT_SYSTEM_PROPERTIES += \
-        pm.dexopt.first-boot?=extract \
-        pm.dexopt.boot-after-ota?=extract
-else
-    PRODUCT_SYSTEM_PROPERTIES += \
-        pm.dexopt.first-boot?=verify \
-        pm.dexopt.boot-after-ota?=verify
-endif
-
 # Note that `cmdline` is not strictly needed but it simplifies the management
 # of compilation reason in the platform (as we have a unified, single path,
 # without exceptions).
 PRODUCT_SYSTEM_PROPERTIES += \
-    pm.dexopt.post-boot?=extract \
-    pm.dexopt.install?=speed \
-    pm.dexopt.install-fast?=skip \
-    pm.dexopt.install-bulk?=speed \
-    pm.dexopt.install-bulk-secondary?=verify \
-    pm.dexopt.install-bulk-downgraded?=verify \
-    pm.dexopt.install-bulk-secondary-downgraded?=extract \
-    pm.dexopt.bg-dexopt?=speed \
-    pm.dexopt.ab-ota?=speed \
-    pm.dexopt.inactive?=verify \
-    pm.dexopt.cmdline?=verify \
-    pm.dexopt.shared?=speed
+    pm.dexopt.first-boot=speed \
+    pm.dexopt.boot-after-ota=speed \
+    pm.dexopt.post-boot=speed \
+    pm.dexopt.install=speed \
+    pm.dexopt.install-fast=speed \
+    pm.dexopt.install-bulk=speed \
+    pm.dexopt.install-bulk-secondary=speed \
+    pm.dexopt.install-bulk-downgraded=speed \
+    pm.dexopt.install-bulk-secondary-downgraded=speed \
+    pm.dexopt.bg-dexopt=speed \
+    pm.dexopt.ab-ota=speed \
+    pm.dexopt.inactive=speed \
+    pm.dexopt.cmdline=speed \
+    pm.dexopt.shared=speed
 
 # Pass file with the list of updatable boot class path packages to dex2oat.
 PRODUCT_SYSTEM_PROPERTIES += \
     dalvik.vm.dex2oat-updatable-bcp-packages-file=/system/etc/updatable-bcp-packages.txt
 
 # Enable resolution of startup const strings.
 PRODUCT_SYSTEM_PROPERTIES += \
     dalvik.vm.dex2oat-resolve-startup-strings=true
 
 # Specify default block size of 512K to enable parallel image decompression.

commit 0c4c87212fb894aa32fe1e02f60a24dfe20a8e3d
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-06 07:42:53-0400

    add Auditor app
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/handheld_product.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index 2199c570a01a0cf7face4e111a28ebe18617726e..8b30ce6d33b5edb70b7534bd08e21e274dc77e5d 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -15,20 +15,21 @@
 #
 
 # This makefile contains the product partition contents for
 # a generic phone or tablet device. Only add something here if
 # it definitely doesn't belong on other types of devices (if it
 # does, use base_product.mk).
 $(call inherit-product, $(SRC_TARGET_DIR)/product/media_product.mk)
 
 # /product packages
 PRODUCT_PACKAGES += \
+    Auditor \
     Browser2 \
     Calendar \
     Camera2 \
     Contacts \
     DeskClock \
     Gallery2 \
     LatinIME \
     Music \
     OneTimeInitializer \
     preinstalled-packages-platform-handheld-product.xml \

commit 15a16eafcde6d99402c8dac21460715514b0add5
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-06 07:43:04-0400

    add PdfViewer app
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/handheld_product.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index 8b30ce6d33b5edb70b7534bd08e21e274dc77e5d..72fcc6c3b5a24c11dde7fa41a5404512715f1a99 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -25,17 +25,18 @@ PRODUCT_PACKAGES += \
     Auditor \
     Browser2 \
     Calendar \
     Camera2 \
     Contacts \
     DeskClock \
     Gallery2 \
     LatinIME \
     Music \
     OneTimeInitializer \
+    PdfViewer \
     preinstalled-packages-platform-handheld-product.xml \
     QuickSearchBox \
     SettingsIntelligence \
     frameworks-base-overlays
 
 PRODUCT_PACKAGES_DEBUG += \
     frameworks-base-overlays-debug

commit 61e62953a3b1ab28ff74715985122ab0badb5797
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2016-06-17 07:13:49-0400

    set deny_new_usb feature to dynamic by default
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 core/main.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/core/main.mk b/core/main.mk
index dd74da5b465e53ef162b35286ca9ee4896dbe70b..12e961d25fe17f5ba665e9fb94796f6efa7c2af5 100644
--- a/core/main.mk
+++ b/core/main.mk
@@ -368,20 +368,21 @@ endif
 ## user/userdebug ##
 
 user_variant := $(filter user userdebug,$(TARGET_BUILD_VARIANT))
 enable_target_debugging := true
 tags_to_install :=
 ifneq (,$(user_variant))
   # Target is secure in user builds.
   ADDITIONAL_SYSTEM_PROPERTIES += ro.secure=1
   ADDITIONAL_SYSTEM_PROPERTIES += security.perf_harden=1
   ADDITIONAL_SYSTEM_PROPERTIES += ro.control_privapp_permissions=enforce
+  ADDITIONAL_SYSTEM_PROPERTIES += persist.security.deny_new_usb=dynamic
 
   ifeq ($(user_variant),user)
     ADDITIONAL_SYSTEM_PROPERTIES += ro.adb.secure=1
   endif
 
   ifeq ($(user_variant),userdebug)
     # Pick up some extra useful tools
     tags_to_install += debug
   else
     # Disable debugging in plain user builds.

commit d49252ce74740681d1d109be7c0e138a924dae38
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2016-09-13 22:05:56-0400

    use -fwrapv when signed overflow checking is off
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 core/config_sanitizers.mk | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/core/config_sanitizers.mk b/core/config_sanitizers.mk
index 46f7f2477b620acd5f539c2c140d52e38e539a77..017aa238225c4a30981f68c28c175225d6616291 100644
--- a/core/config_sanitizers.mk
+++ b/core/config_sanitizers.mk
@@ -501,10 +501,16 @@ endif
 
 # http://b/177566116, libc++ may crash with this sanitizer.
 # Disable this check unless it has been explicitly specified.
 ifneq ($(findstring fsanitize,$(my_cflags)),)
   ifneq ($(findstring integer,$(my_cflags)),)
     ifeq ($(findstring sanitize=unsigned-shift-base,$(my_cflags)),)
       my_cflags += -fno-sanitize=unsigned-shift-base
     endif
   endif
 endif
+
+ifeq ($(filter signed-integer-overflow integer undefined,$(my_sanitize)),)
+  ifeq ($(filter -ftrapv,$(my_cflags)),)
+    my_cflags += -fwrapv
+  endif
+endif

commit a1ac41d0bd88baee33705b8c47c2a655602d96ee
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-06 08:18:49-0400

    add ExactCalculator app
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/handheld_product.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index 72fcc6c3b5a24c11dde7fa41a5404512715f1a99..2052cf94a598c60d96419433a62c6b00cb08eb2a 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -21,20 +21,21 @@
 $(call inherit-product, $(SRC_TARGET_DIR)/product/media_product.mk)
 
 # /product packages
 PRODUCT_PACKAGES += \
     Auditor \
     Browser2 \
     Calendar \
     Camera2 \
     Contacts \
     DeskClock \
+    ExactCalculator \
     Gallery2 \
     LatinIME \
     Music \
     OneTimeInitializer \
     PdfViewer \
     preinstalled-packages-platform-handheld-product.xml \
     QuickSearchBox \
     SettingsIntelligence \
     frameworks-base-overlays
 

commit 9f9533ca0f6d7c030c0df655d8ae422ea2d5fb90
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sat 2019-09-21 08:44:23-0400

    mainline: disable updatable apex
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/generic_system.mk | 3 ---
 1 file changed, 3 deletions(-)

diff --git a/target/product/generic_system.mk b/target/product/generic_system.mk
index f13c9db4d1f98a7dee642a52de659a6227d8c7ce..d930957dfb181dad61bfea434e21575720a9a06a 100644
--- a/target/product/generic_system.mk
+++ b/target/product/generic_system.mk
@@ -14,23 +14,20 @@
 # limitations under the License.
 #
 
 # This makefile is the basis of a generic system image for a handheld device.
 $(call inherit-product, $(SRC_TARGET_DIR)/product/handheld_system.mk)
 $(call inherit-product, $(SRC_TARGET_DIR)/product/telephony_system.mk)
 $(call inherit-product, $(SRC_TARGET_DIR)/product/languages_default.mk)
 # Add adb keys to debuggable AOSP builds (if they exist)
 $(call inherit-product-if-exists, vendor/google/security/adb/vendor_key.mk)
 
-# Enable updating of APEXes
-$(call inherit-product, $(SRC_TARGET_DIR)/product/updatable_apex.mk)
-
 # Shared java libs
 PRODUCT_PACKAGES += \
     com.android.nfc_extras \
 
 # Applications
 PRODUCT_PACKAGES += \
     LiveWallpapersPicker \
     PartnerBookmarksProvider \
     Stk \
     Tag \

commit 5a27b3dbab598818e5b3bbd6bfab8483c0851db0
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2020-02-17 04:21:18-0500

    replace Browser2 with TrichromeChrome
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/handheld_product.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index 2052cf94a598c60d96419433a62c6b00cb08eb2a..f504f61874b48910ccbf294e7bfaff402030b08b 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -16,28 +16,28 @@
 
 # This makefile contains the product partition contents for
 # a generic phone or tablet device. Only add something here if
 # it definitely doesn't belong on other types of devices (if it
 # does, use base_product.mk).
 $(call inherit-product, $(SRC_TARGET_DIR)/product/media_product.mk)
 
 # /product packages
 PRODUCT_PACKAGES += \
     Auditor \
-    Browser2 \
     Calendar \
     Camera2 \
     Contacts \
     DeskClock \
     ExactCalculator \
     Gallery2 \
     LatinIME \
     Music \
     OneTimeInitializer \
     PdfViewer \
     preinstalled-packages-platform-handheld-product.xml \
     QuickSearchBox \
     SettingsIntelligence \
+    TrichromeChrome \
     frameworks-base-overlays
 
 PRODUCT_PACKAGES_DEBUG += \
     frameworks-base-overlays-debug

commit cec790fb5b83b0e4298b7410d3ee5137d2d6c858
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2020-02-17 04:23:07-0500

    replace webview with TrichromeWebView
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/media_product.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/target/product/media_product.mk b/target/product/media_product.mk
index 76cb311b603ab46d5021af12f75b0a552bb50efc..74dd1fe011a335cb2cba124f8eb68e49722f9750 100644
--- a/target/product/media_product.mk
+++ b/target/product/media_product.mk
@@ -15,11 +15,11 @@
 #
 
 # This makefile contains the product partition contents for
 # media-capable devices (non-wearables). Only add something here
 # if it definitely doesn't belong on wearables. Otherwise, choose
 # base_product.mk.
 $(call inherit-product, $(SRC_TARGET_DIR)/product/base_product.mk)
 
 # /product packages
 PRODUCT_PACKAGES += \
-    webview \
+    TrichromeWebView \

commit dd5ac1635b0f5e243e1f8f24c7335066e31911f1
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Wed 2020-09-16 00:55:25-0400

    add Seedvault as backup provider
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/media_system.mk | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/target/product/media_system.mk b/target/product/media_system.mk
index 52329852398cf298b062f82b2bbea674639963c0..a835c2c016743d3c790f80b0c253e1c606bf3a14 100644
--- a/target/product/media_system.mk
+++ b/target/product/media_system.mk
@@ -34,20 +34,22 @@ PRODUCT_PACKAGES += \
     libwebviewchromium_loader \
     libwebviewchromium_plat_support \
     make_f2fs \
     requestsync \
     StatementService \
 
 ifeq ($(OFFICIAL_BUILD),true)
     PRODUCT_PACKAGES += Updater
 endif
 
+PRODUCT_PACKAGES += Seedvault
+
 PRODUCT_HOST_PACKAGES += \
     fsck.f2fs \
 
 PRODUCT_COPY_FILES += \
     frameworks/native/data/etc/android.software.webview.xml:system/etc/permissions/android.software.webview.xml
 
 ifneq (REL,$(PLATFORM_VERSION_CODENAME))
 PRODUCT_COPY_FILES += \
     frameworks/native/data/etc/android.software.preview_sdk.xml:system/etc/permissions/android.software.preview_sdk.xml
 endif

commit 88d062b6f842e3a265e465c251ad5866c7e4a11b
Author: Renlord <me@renlord.com>
Date:   Wed 2020-03-11 18:08:31+1100

    add SetupWizard
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/handheld_system_ext.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/handheld_system_ext.mk b/target/product/handheld_system_ext.mk
index d935fbfddfce5d511c3d0e5f20bd73630a553efd..0e2a48fcf5cc9ae9335da7597489b84498b4fbc7 100644
--- a/target/product/handheld_system_ext.mk
+++ b/target/product/handheld_system_ext.mk
@@ -18,13 +18,14 @@
 # a generic phone or tablet device. Only add something here if
 # it definitely doesn't belong on other types of devices (if it
 # does, use base_system_ext.mk).
 $(call inherit-product, $(SRC_TARGET_DIR)/product/media_system_ext.mk)
 
 # /system_ext packages
 PRODUCT_PACKAGES += \
     Launcher3QuickStep \
     Provision \
     Settings \
+    SetupWizard \
     StorageManager \
     SystemUI \
     WallpaperCropper \

commit 203646ce21960e5177ff477160302b796fba1f48
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2020-03-16 18:01:18-0400

    disable BOARD_USES_SYSTEM_OTHER_ODEX for mainline
    
    The system_other image is gone after the first update and the OS ends up
    needing to compile the code for these apps as part of performing each OS
    update. GrapheneOS doesn't use JIT compilation and the AOT compilation
    isn't guided by JIT profiles so this ends up using the same amount of
    space and doing a bunch of unnecessary work on each device. It also
    reduces the scope of verified boot by having the compiled odex code for
    base system apps outside of the verified system partition.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/board/BoardConfigMainlineCommon.mk | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/target/board/BoardConfigMainlineCommon.mk b/target/board/BoardConfigMainlineCommon.mk
index 00f6e5b0ac56d846a4958e845ff3b1225945e533..cac3c22950564a444241fdf439979d4824f227a8 100644
--- a/target/board/BoardConfigMainlineCommon.mk
+++ b/target/board/BoardConfigMainlineCommon.mk
@@ -21,24 +21,20 @@ BOARD_USES_METADATA_PARTITION := true
 
 # Default is current, but allow devices to override vndk version if needed.
 BOARD_VNDK_VERSION ?= current
 
 # Required flag for non-64 bit devices from P.
 TARGET_USES_64_BIT_BINDER := true
 
 # 64 bit mediadrmserver
 TARGET_ENABLE_MEDIADRM_64 := true
 
-# Puts odex files on system_other, as well as causing dex files not to get
-# stripped from APKs.
-BOARD_USES_SYSTEM_OTHER_ODEX := true
-
 # Audio: must using XML format for Treblized devices
 USE_XML_AUDIO_POLICY_CONF := 1
 
 # Bluetooth defines
 # TODO(b/123695868): Remove the need for this
 BOARD_BLUETOOTH_BDROID_BUILDCFG_INCLUDE_DIR := build/make/target/board/mainline_arm64/bluetooth
 
 BOARD_AVB_ENABLE := true
 BOARD_AVB_ROLLBACK_INDEX := $(PLATFORM_SECURITY_PATCH_TIMESTAMP)
 

commit 0b7d4e276c6c63ca68b642dd76e6224cb1a7f438
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2020-05-12 21:02:49-0400

    always use UTC as the time zone for build dates
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 core/main.mk             | 2 +-
 core/version_defaults.mk | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/core/main.mk b/core/main.mk
index 12e961d25fe17f5ba665e9fb94796f6efa7c2af5..d29afefed80d9c64b4195fa7e518590c2171d2f2 100644
--- a/core/main.mk
+++ b/core/main.mk
@@ -46,21 +46,21 @@ $(shell mkdir -p $(SOONG_OUT_DIR) && \
         mv $(SOONG_OUT_DIR)/build_number.tmp $(SOONG_OUT_DIR)/build_number.txt; \
     else \
         rm $(SOONG_OUT_DIR)/build_number.tmp; \
     fi)
 BUILD_NUMBER_FILE := $(SOONG_OUT_DIR)/build_number.txt
 .KATI_READONLY := BUILD_NUMBER_FILE
 $(KATI_obsolete_var BUILD_NUMBER,See https://android.googlesource.com/platform/build/+/master/Changes.md#BUILD_NUMBER)
 $(BUILD_NUMBER_FILE):
 	touch $@
 
-DATE_FROM_FILE := date -d @$(BUILD_DATETIME_FROM_FILE)
+DATE_FROM_FILE := date -ud @$(BUILD_DATETIME_FROM_FILE)
 .KATI_READONLY := DATE_FROM_FILE
 
 # Pick a reasonable string to use to identify files.
 ifeq ($(strip $(HAS_BUILD_NUMBER)),false)
   # BUILD_NUMBER has a timestamp in it, which means that
   # it will change every time.  Pick a stable value.
   FILE_NAME_TAG := eng.$(BUILD_USERNAME)
 else
   FILE_NAME_TAG := $(file <$(BUILD_NUMBER_FILE))
 endif
diff --git a/core/version_defaults.mk b/core/version_defaults.mk
index 4f89a2be786f27a33365ee50e485aef7e46af207..099da9b4273214ec091e39c42284f37b75847fbe 100644
--- a/core/version_defaults.mk
+++ b/core/version_defaults.mk
@@ -268,21 +268,21 @@ ifndef BUILD_ID
   BUILD_ID := UNKNOWN
 endif
 .KATI_READONLY := BUILD_ID
 
 ifndef BUILD_DATETIME
   # Used to reproduce builds by setting the same time. Must be the number
   # of seconds since the Epoch.
   BUILD_DATETIME := $(shell date +%s)
 endif
 
-DATE := date -d @$(BUILD_DATETIME)
+DATE := date -ud @$(BUILD_DATETIME)
 .KATI_READONLY := DATE
 
 # Everything should be using BUILD_DATETIME_FROM_FILE instead.
 # BUILD_DATETIME and DATE can be removed once BUILD_NUMBER moves
 # to soong_ui.
 $(KATI_obsolete_var BUILD_DATETIME,Use BUILD_DATETIME_FROM_FILE)
 
 HAS_BUILD_NUMBER := true
 ifndef BUILD_NUMBER
   # BUILD_NUMBER should be set to the source control value that

commit ee8156ea9a9b8625a4ee06f1fc84f77a3ebcab94
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sat 2020-05-16 19:44:32-0400

    raise minimum supported API level to 28
    
    This matches the minimum API level required by the Play Store for both
    new apps and app updates, so this is not an aggressive requirement:
    
    https://developer.android.com/distribute/best-practices/develop/target-sdk
    
    There were various backwards incompatible improvements to privacy and
    security from API 23 to API 28. In particular, API 28 introduced the
    new SELinux sandbox using a per-app-per-profile security level (MLS) to
    provide a unique security domain for each app instance. Previously, MLS
    was used to isolate profiles by using per-profile security levels. The
    finer-grained security levels prevent apps from directly sharing data
    without going through intents, eliminating many common vulnerabilities
    and giving the OS better control over how apps can communicate.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 core/version_defaults.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/core/version_defaults.mk b/core/version_defaults.mk
index 099da9b4273214ec091e39c42284f37b75847fbe..72bf17b36128715ec42cd42f19cba400544c6633 100644
--- a/core/version_defaults.mk
+++ b/core/version_defaults.mk
@@ -296,13 +296,13 @@ ifndef BUILD_NUMBER
   # anyone trying to parse it as an integer will probably get "0".
   BUILD_NUMBER := eng.$(shell echo $${BUILD_USERNAME:0:6}).$(shell $(DATE) +%Y%m%d.%H%M%S)
   HAS_BUILD_NUMBER := false
 endif
 .KATI_READONLY := BUILD_NUMBER HAS_BUILD_NUMBER
 
 ifndef PLATFORM_MIN_SUPPORTED_TARGET_SDK_VERSION
   # Used to set minimum supported target sdk version. Apps targeting sdk
   # version lower than the set value will result in a warning being shown
   # when any activity from the app is started.
-  PLATFORM_MIN_SUPPORTED_TARGET_SDK_VERSION := 23
+  PLATFORM_MIN_SUPPORTED_TARGET_SDK_VERSION := 28
 endif
 .KATI_READONLY := PLATFORM_MIN_SUPPORTED_TARGET_SDK_VERSION

commit 788ad49674e253923dd61db37766ae47a519e895
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Thu 2020-09-17 10:53:00-0400

    disable enforce RRO for mainline devices
    
    This is currently incompatible with exec-based spawning. This also
    impacts the wrapper spawning model for the stock OS which is available
    by default, making it an upstream bug rather than a missing feature for
    exec-based spawning in GrapheneOS.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/generic_system.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/target/product/generic_system.mk b/target/product/generic_system.mk
index d930957dfb181dad61bfea434e21575720a9a06a..f0a9400b869483eed2a80d7233b495fe68ca8a03 100644
--- a/target/product/generic_system.mk
+++ b/target/product/generic_system.mk
@@ -106,21 +106,21 @@ PRODUCT_PACKAGES += \
 
 # Include all zygote init scripts. "ro.zygote" will select one of them.
 PRODUCT_COPY_FILES += \
     system/core/rootdir/init.zygote32.rc:system/etc/init/hw/init.zygote32.rc \
     system/core/rootdir/init.zygote64.rc:system/etc/init/hw/init.zygote64.rc \
     system/core/rootdir/init.zygote64_32.rc:system/etc/init/hw/init.zygote64_32.rc \
 
 # Enable dynamic partition size
 PRODUCT_USE_DYNAMIC_PARTITION_SIZE := true
 
-PRODUCT_ENFORCE_RRO_TARGETS := *
+#PRODUCT_ENFORCE_RRO_TARGETS := *
 
 PRODUCT_NAME := generic_system
 PRODUCT_BRAND := generic
 
 # Define /system partition-specific product properties to identify that /system
 # partition is generic_system.
 PRODUCT_SYSTEM_NAME := mainline
 PRODUCT_SYSTEM_BRAND := Android
 PRODUCT_SYSTEM_MANUFACTURER := Android
 PRODUCT_SYSTEM_MODEL := mainline

commit cc63134d4f1f9b0e19b54a656246a9840c347fa7
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2021-03-09 23:48:11-0500

    add talkback
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/handheld_system.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/handheld_system.mk b/target/product/handheld_system.mk
index b7a2d0dad0aa52bc47d70b23291ff32782527900..c0e3fa15fd187e60a56031091fd07f966e763895 100644
--- a/target/product/handheld_system.mk
+++ b/target/product/handheld_system.mk
@@ -58,20 +58,21 @@ PRODUCT_PACKAGES += \
     MusicFX \
     NfcNci \
     PacProcessor \
     PrintRecommendationService \
     PrintSpooler \
     ProxyHandler \
     screenrecord \
     SecureElement \
     SharedStorageBackup \
     SimAppDialog \
+    talkback \
     Telecom \
     TelephonyProvider \
     TeleService \
     Traceur \
     UserDictionaryProvider \
     VpnDialogs \
     vr \
 
 
 PRODUCT_SYSTEM_SERVER_APPS += \

commit df43d5a0647fe397b6d420da74f18405f49214d4
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2021-03-16 02:05:40-0400

    ignore tethering provisioning requirement
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 core/main.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/core/main.mk b/core/main.mk
index d29afefed80d9c64b4195fa7e518590c2171d2f2..a8c331b7484eeb8481bd6c2ebfcdcd54f18635f7 100644
--- a/core/main.mk
+++ b/core/main.mk
@@ -369,20 +369,21 @@ endif
 
 user_variant := $(filter user userdebug,$(TARGET_BUILD_VARIANT))
 enable_target_debugging := true
 tags_to_install :=
 ifneq (,$(user_variant))
   # Target is secure in user builds.
   ADDITIONAL_SYSTEM_PROPERTIES += ro.secure=1
   ADDITIONAL_SYSTEM_PROPERTIES += security.perf_harden=1
   ADDITIONAL_SYSTEM_PROPERTIES += ro.control_privapp_permissions=enforce
   ADDITIONAL_SYSTEM_PROPERTIES += persist.security.deny_new_usb=dynamic
+  ADDITIONAL_SYSTEM_PROPERTIES += net.tethering.noprovisioning=true
 
   ifeq ($(user_variant),user)
     ADDITIONAL_SYSTEM_PROPERTIES += ro.adb.secure=1
   endif
 
   ifeq ($(user_variant),userdebug)
     # Pick up some extra useful tools
     tags_to_install += debug
   else
     # Disable debugging in plain user builds.

commit b12e7cd697edc00a1830bcede22864e36a07f827
Author: Danny Lin <danny@kdrag0n.dev>
Date:   Mon 2020-11-02 23:43:06-0800

    build: Don't build legacy WallpaperPicker
    
    We're using WallpaperPicker2 in ThemePicker now.
    
    Change-Id: I9d1d93ec93b06851346c31e0e994debcef14a087
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/aosp_product.mk | 1 -
 1 file changed, 1 deletion(-)

diff --git a/target/product/aosp_product.mk b/target/product/aosp_product.mk
index e396ad11ff2f62edd1262e1400c3ef3243b90366..8e194ca959cd10aa90bdf0a11845a58178c8fc27 100644
--- a/target/product/aosp_product.mk
+++ b/target/product/aosp_product.mk
@@ -25,16 +25,15 @@ $(call inherit-product-if-exists, frameworks/base/data/sounds/AllAudio.mk)
 PRODUCT_PRODUCT_PROPERTIES += \
     ro.config.ringtone?=Ring_Synth_04.ogg \
     ro.config.notification_sound?=pixiedust.ogg \
     ro.com.android.dataroaming?=true \
 
 # More AOSP packages
 PRODUCT_PACKAGES += \
     messaging \
     PhotoTable \
     preinstalled-packages-platform-aosp-product.xml \
-    WallpaperPicker \
 
 # Telephony:
 #   Provide a APN configuration to GSI product
 PRODUCT_COPY_FILES += \
     device/sample/etc/apns-full-conf.xml:$(TARGET_COPY_OUT_PRODUCT)/etc/apns-conf.xml

commit edc06155bdcf3d25de1956ea2f8a9b95c0bcd3b0
Author: flawedworld <38294951+flawedworld@users.noreply.github.com>
Date:   Fri 2021-04-30 18:42:13+0000

    Build in themes
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 target/product/handheld_product.mk | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index f504f61874b48910ccbf294e7bfaff402030b08b..a1796547a83e5b1435ceb2cb7ffb22bcb4ccd791 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -34,10 +34,13 @@ PRODUCT_PACKAGES += \
     OneTimeInitializer \
     PdfViewer \
     preinstalled-packages-platform-handheld-product.xml \
     QuickSearchBox \
     SettingsIntelligence \
     TrichromeChrome \
     frameworks-base-overlays
 
 PRODUCT_PACKAGES_DEBUG += \
     frameworks-base-overlays-debug
+
+# Build in theming functionality
+$(call inherit-product-if-exists, themes/main.mk)

commit ff1d0201eb506da816d4497d70712cc6ac098e16
Author: flawedworld <flawedworld@flawed.world>
Date:   Wed 2021-09-29 04:29:05+0100

    omit AOSP sample APN database by default
---
 target/product/aosp_product.mk        | 5 -----
 target/product/full_base_telephony.mk | 1 -
 2 files changed, 6 deletions(-)

diff --git a/target/product/aosp_product.mk b/target/product/aosp_product.mk
index 8e194ca959cd10aa90bdf0a11845a58178c8fc27..b516f2971af0eb41e3e76749b4a3372741cdf7dc 100644
--- a/target/product/aosp_product.mk
+++ b/target/product/aosp_product.mk
@@ -25,15 +25,10 @@ $(call inherit-product-if-exists, frameworks/base/data/sounds/AllAudio.mk)
 PRODUCT_PRODUCT_PROPERTIES += \
     ro.config.ringtone?=Ring_Synth_04.ogg \
     ro.config.notification_sound?=pixiedust.ogg \
     ro.com.android.dataroaming?=true \
 
 # More AOSP packages
 PRODUCT_PACKAGES += \
     messaging \
     PhotoTable \
     preinstalled-packages-platform-aosp-product.xml \
-
-# Telephony:
-#   Provide a APN configuration to GSI product
-PRODUCT_COPY_FILES += \
-    device/sample/etc/apns-full-conf.xml:$(TARGET_COPY_OUT_PRODUCT)/etc/apns-conf.xml
diff --git a/target/product/full_base_telephony.mk b/target/product/full_base_telephony.mk
index d8a54cd7f3de9348a8960efdae8530c28b99172f..5470ad2be50514fbcb9bf520edf2c54c5a5ff1eb 100644
--- a/target/product/full_base_telephony.mk
+++ b/target/product/full_base_telephony.mk
@@ -17,15 +17,14 @@
 # This is a build configuration for a full-featured build of the
 # Open-Source part of the tree. It's geared toward a US-centric
 # build quite specifically for the emulator, and might not be
 # entirely appropriate to inherit from for on-device configurations.
 
 PRODUCT_VENDOR_PROPERTIES := \
     keyguard.no_require_sim?=true \
     ro.com.android.dataroaming?=true
 
 PRODUCT_COPY_FILES := \
-    device/sample/etc/apns-full-conf.xml:system/etc/apns-conf.xml \
     frameworks/native/data/etc/handheld_core_hardware.xml:$(TARGET_COPY_OUT_VENDOR)/etc/permissions/handheld_core_hardware.xml
 
 $(call inherit-product, $(SRC_TARGET_DIR)/product/aosp_base.mk)
 $(call inherit-product, $(SRC_TARGET_DIR)/product/telephony.mk)

commit 852d745d10e03c066d04f02d3f99b4f45a012f77
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2021-10-12 08:19:39-0400

    add cortex-a76 to ARMv8.2 list
---
 core/combo/TARGET_linux-arm.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/core/combo/TARGET_linux-arm.mk b/core/combo/TARGET_linux-arm.mk
index 11c19444bee868f99d2eb0d48ddff705182dadd3..44cc99a946e13bc9e0cac8071f2ef6855ddeba4c 100644
--- a/core/combo/TARGET_linux-arm.mk
+++ b/core/combo/TARGET_linux-arm.mk
@@ -26,21 +26,21 @@
 # instructions available in a given architecture version.
 #
 # The blocks also define specific arch_variant_cflags, which
 # include defines, and compiler settings for the given architecture
 # version.
 #
 
 KNOWN_ARMv8_CORES := cortex-a53 cortex-a53.a57 cortex-a55 cortex-a73 cortex-a75 cortex-a76
 KNOWN_ARMv8_CORES += kryo kryo385 exynos-m1 exynos-m2
 
-KNOWN_ARMv82a_CORES := cortex-a55 cortex-a75 kryo385
+KNOWN_ARMv82a_CORES := cortex-a55 cortex-a75 cortex-a76 kryo385
 
 ifeq (,$(strip $(TARGET_$(combo_2nd_arch_prefix)CPU_VARIANT)))
   TARGET_$(combo_2nd_arch_prefix)CPU_VARIANT := generic
 endif
 
 # This quickly checks TARGET_2ND_ARCH_VARIANT against the lists above.
 ifneq (,$(filter $(TARGET_$(combo_2nd_arch_prefix)CPU_VARIANT), $(KNOWN_ARMv82a_CORES)))
   ifeq (,$(TARGET_$(combo_2nd_arch_prefix)ARCH_VARIANT))
     TARGET_$(combo_2nd_arch_prefix)ARCH_VARIANT := armv8-2a
   else ifneq (armv8-2a,$(TARGET_$(combo_2nd_arch_prefix)ARCH_VARIANT))

commit 47205faf4b2e3f9aa6ccc1e716434dd1bdbd3ca4
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2021-10-24 23:02:07-0400

    product: Enable gestural navigation overlay to match default nav mode
    
    This fixes an occasional issue where the navbar is in a broken state
    (gesture nav works, but the bar is rendered as if it's 2/3-button nav)
    after wiping data or provisioning new users.
    
    From Danny Lin <danny@kdrag0n.dev> in ProtonAOSP.
---
 target/product/aosp_product.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/aosp_product.mk b/target/product/aosp_product.mk
index b516f2971af0eb41e3e76749b4a3372741cdf7dc..4f66751b559e87a10c8226d57d9de281b7965f25 100644
--- a/target/product/aosp_product.mk
+++ b/target/product/aosp_product.mk
@@ -19,16 +19,17 @@ $(call inherit-product, $(SRC_TARGET_DIR)/product/handheld_product.mk)
 $(call inherit-product, $(SRC_TARGET_DIR)/product/telephony_product.mk)
 
 # Default AOSP sounds
 $(call inherit-product-if-exists, frameworks/base/data/sounds/AllAudio.mk)
 
 # Additional settings used in all AOSP builds
 PRODUCT_PRODUCT_PROPERTIES += \
     ro.config.ringtone?=Ring_Synth_04.ogg \
     ro.config.notification_sound?=pixiedust.ogg \
     ro.com.android.dataroaming?=true \
+    ro.boot.vendor.overlay.theme=com.android.internal.systemui.navbar.gestural
 
 # More AOSP packages
 PRODUCT_PACKAGES += \
     messaging \
     PhotoTable \
     preinstalled-packages-platform-aosp-product.xml \

commit 4d5c131b123650823b882c5c14ec49f0b7c4ac14
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sat 2021-10-30 09:20:51-0400

    use GrapheneOS Camera app
---
 target/product/handheld_product.mk | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index a1796547a83e5b1435ceb2cb7ffb22bcb4ccd791..580e742ea1e58995c2b41a1786215e1ada6c5edf 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -17,21 +17,21 @@
 # This makefile contains the product partition contents for
 # a generic phone or tablet device. Only add something here if
 # it definitely doesn't belong on other types of devices (if it
 # does, use base_product.mk).
 $(call inherit-product, $(SRC_TARGET_DIR)/product/media_product.mk)
 
 # /product packages
 PRODUCT_PACKAGES += \
     Auditor \
     Calendar \
-    Camera2 \
+    Camera \
     Contacts \
     DeskClock \
     ExactCalculator \
     Gallery2 \
     LatinIME \
     Music \
     OneTimeInitializer \
     PdfViewer \
     preinstalled-packages-platform-handheld-product.xml \
     QuickSearchBox \

commit 33da206e441521406a0e8182985bb3d9d7813323
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2022-01-25 15:06:45-0500

    add GrapheneOS app repository client
---
 target/product/handheld_product.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index 580e742ea1e58995c2b41a1786215e1ada6c5edf..2c913e2f104277f6962511ea9da32d06f1dbb7da 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -15,20 +15,21 @@
 #
 
 # This makefile contains the product partition contents for
 # a generic phone or tablet device. Only add something here if
 # it definitely doesn't belong on other types of devices (if it
 # does, use base_product.mk).
 $(call inherit-product, $(SRC_TARGET_DIR)/product/media_product.mk)
 
 # /product packages
 PRODUCT_PACKAGES += \
+    Apps \
     Auditor \
     Calendar \
     Camera \
     Contacts \
     DeskClock \
     ExactCalculator \
     Gallery2 \
     LatinIME \
     Music \
     OneTimeInitializer \

commit f089c3f734d06a06542f7558fa02e6926755fe74
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2022-01-25 19:05:30-0500

    Revert "add GrapheneOS app repository client"
    
    This reverts commit f3a4a695ce0beb8860cde2ba07d51b6c55d4cc23.
---
 target/product/handheld_product.mk | 1 -
 1 file changed, 1 deletion(-)

diff --git a/target/product/handheld_product.mk b/target/product/handheld_product.mk
index 2c913e2f104277f6962511ea9da32d06f1dbb7da..580e742ea1e58995c2b41a1786215e1ada6c5edf 100644
--- a/target/product/handheld_product.mk
+++ b/target/product/handheld_product.mk
@@ -15,21 +15,20 @@
 #
 
 # This makefile contains the product partition contents for
 # a generic phone or tablet device. Only add something here if
 # it definitely doesn't belong on other types of devices (if it
 # does, use base_product.mk).
 $(call inherit-product, $(SRC_TARGET_DIR)/product/media_product.mk)
 
 # /product packages
 PRODUCT_PACKAGES += \
-    Apps \
     Auditor \
     Calendar \
     Camera \
     Contacts \
     DeskClock \
     ExactCalculator \
     Gallery2 \
     LatinIME \
     Music \
     OneTimeInitializer \

commit 77dfb13d7b538f8e9567288a1ea696f222c797e2 (HEAD, tag: SQ1A.220205.002.2022020800, m/master, grapheneos/12)
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2022-01-30 02:17:12-0500

    add GmsCompat app
---
 target/product/handheld_system.mk | 1 +
 1 file changed, 1 insertion(+)

diff --git a/target/product/handheld_system.mk b/target/product/handheld_system.mk
index c0e3fa15fd187e60a56031091fd07f966e763895..9f3a4ed93ecfd426bf67f0631a14cfc4a7ba8ff7 100644
--- a/target/product/handheld_system.mk
+++ b/target/product/handheld_system.mk
@@ -42,20 +42,21 @@ PRODUCT_PACKAGES += \
     cameraserver \
     CameraExtensionsProxy \
     CaptivePortalLogin \
     CertInstaller \
     clatd \
     DocumentsUI \
     DownloadProviderUi \
     EasterEgg \
     ExternalStorageProvider \
     FusedLocation \
+    GmsCompat \
     InputDevices \
     KeyChain \
     librs_jni \
     ManagedProvisioning \
     MmsService \
     MtpService \
     MusicFX \
     NfcNci \
     PacProcessor \
     PrintRecommendationService \
