commit 3b74165dd5c197197b40eca7b5cf96d91f24c2e8 (HEAD, tag: SP1A.211105.002.2021110617, m/master, grapheneos/12)
Author: Danny Lin <danny@kdrag0n.dev>
Date:   Tue 2020-12-15 18:58:04-0800

    WallpaperPicker2: Don't publish placeholder categories
    
    Publishing a placeholder category causes the real category to never
    appear, even after it's done loading.
    
    Change-Id: If14630ed4a98f843f7c310984380e919776d6827
---
 src/com/android/wallpaper/module/DefaultCategoryProvider.java | 6 ------
 1 file changed, 6 deletions(-)

diff --git a/src/com/android/wallpaper/module/DefaultCategoryProvider.java b/src/com/android/wallpaper/module/DefaultCategoryProvider.java
index e82045de7d7af114cac139fd90577d3c9d33c23b..30e5c4dad37ba48cf73c7eff1997b5c1a833d26a 100755
--- a/src/com/android/wallpaper/module/DefaultCategoryProvider.java
+++ b/src/com/android/wallpaper/module/DefaultCategoryProvider.java
@@ -302,43 +302,37 @@ public class DefaultCategoryProvider implements CategoryProvider {
                 while (((type = parser.next()) != XmlPullParser.END_TAG
                         || parser.getDepth() > depth) && type != XmlPullParser.END_DOCUMENT) {
                     if ((type == XmlPullParser.START_TAG)
                             && WallpaperCategory.TAG_NAME.equals(parser.getName())) {
 
                         WallpaperCategory.Builder categoryBuilder =
                                 new WallpaperCategory.Builder(mPartnerProvider.getResources(),
                                         Xml.asAttributeSet(parser));
                         categoryBuilder.setPriorityIfEmpty(PRIORITY_SYSTEM + priorityTracker++);
                         final int categoryDepth = parser.getDepth();
-                        boolean publishedPlaceholder = false;
                         while (((type = parser.next()) != XmlPullParser.END_TAG
                                 || parser.getDepth() > categoryDepth)
                                 && type != XmlPullParser.END_DOCUMENT) {
                             if (type == XmlPullParser.START_TAG) {
                                 WallpaperInfo wallpaper = null;
                                 if (SystemStaticWallpaperInfo.TAG_NAME.equals(parser.getName())) {
                                     wallpaper = SystemStaticWallpaperInfo
                                             .fromAttributeSet(mPartnerProvider.getPackageName(),
                                                     categoryBuilder.getId(),
                                                     Xml.asAttributeSet(parser));
 
                                 } else if (LiveWallpaperInfo.TAG_NAME.equals(parser.getName())) {
                                     wallpaper = LiveWallpaperInfo.fromAttributeSet(mAppContext,
                                             categoryBuilder.getId(), Xml.asAttributeSet(parser));
                                 }
                                 if (wallpaper != null) {
                                     categoryBuilder.addWallpaper(wallpaper);
-                                    // Publish progress only if there's at least one wallpaper
-                                    if (!publishedPlaceholder) {
-                                        publishProgress(categoryBuilder.buildPlaceholder());
-                                        publishedPlaceholder = true;
-                                    }
                                 }
                             }
                         }
                         WallpaperCategory category = categoryBuilder.build();
                         if (!category.getUnmodifiableWallpapers().isEmpty()) {
                             categories.add(category);
                             publishProgress(category);
                         }
                     }
                 }
