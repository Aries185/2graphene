commit 0911fca3386016a506308e0b1e1ecc527153194b
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Thu 2017-07-27 17:26:39-0400

    remove useless no-op privacy policy / terms of use
---
 res/xml/preference_about.xml                       | 12 ----------
 .../preference/AboutPreferenceFragment.java        | 28 ----------------------
 2 files changed, 40 deletions(-)

diff --git a/res/xml/preference_about.xml b/res/xml/preference_about.xml
index a109db68ed657688ffda3cbf1d005e05ff93fa03..6b31d238f0d857a5dc7294900f5ef2e93fb910f5 100644
--- a/res/xml/preference_about.xml
+++ b/res/xml/preference_about.xml
@@ -18,23 +18,11 @@
     <Preference
             android:icon="@null"
             android:key="@string/pref_build_version_key"
             android:title="@string/about_build_version"/>
 
     <Preference
             android:icon="@null"
             android:key="@string/pref_open_source_licenses_key"
             android:title="@string/about_open_source_licenses"
             android:summary="@string/about_open_source_licenses_summary"/>
-
-    <Preference
-            android:icon="@null"
-            android:key="@string/pref_privacy_policy_key"
-            android:title="@string/about_privacy_policy">
-    </Preference>
-
-    <Preference
-            android:icon="@null"
-            android:key="@string/pref_terms_of_service_key"
-            android:title="@string/about_terms_of_service">
-    </Preference>
 </PreferenceScreen>
diff --git a/src/com/android/contacts/preference/AboutPreferenceFragment.java b/src/com/android/contacts/preference/AboutPreferenceFragment.java
index 378948033ac42c95473a48016d3e2f765935a76d..721ab0460a31ba3c22b4a602c02c514028ef7e1a 100644
--- a/src/com/android/contacts/preference/AboutPreferenceFragment.java
+++ b/src/com/android/contacts/preference/AboutPreferenceFragment.java
@@ -27,24 +27,20 @@ import android.preference.Preference;
 import android.preference.PreferenceFragment;
 import android.widget.Toast;
 
 import com.android.contacts.R;
 import com.android.contacts.activities.LicenseActivity;
 
 /**
  * This fragment shows the preferences for "about".
  */
 public class AboutPreferenceFragment extends PreferenceFragment {
-
-    public static final String PRIVACY_POLICY_URL = "http://www.google.com/policies/privacy";
-    public static final String TERMS_OF_SERVICE_URL = "http://www.google.com/policies/terms";
-
     public static AboutPreferenceFragment newInstance() {
         return new AboutPreferenceFragment();
     }
 
     @Override
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
 
         // Load the preferences from an XML resource
         addPreferencesFromResource(R.xml.preference_about);
@@ -56,44 +52,20 @@ public class AboutPreferenceFragment extends PreferenceFragment {
             final Preference versionPreference = findPreference(
                     getString(R.string.pref_build_version_key));
             versionPreference.setSummary(info.versionName);
         } catch (PackageManager.NameNotFoundException e) {
             // Nothing
         }
 
         final Preference licensePreference = findPreference(
                 getString(R.string.pref_open_source_licenses_key));
         licensePreference.setIntent(new Intent(getActivity(), LicenseActivity.class));
-
-        final Preference privacyPolicyPreference = findPreference("pref_privacy_policy");
-        final Preference termsOfServicePreference = findPreference("pref_terms_of_service");
-
-        final Preference.OnPreferenceClickListener listener =
-                new Preference.OnPreferenceClickListener() {
-            @Override
-            public boolean onPreferenceClick(Preference preference) {
-                try {
-                    if (preference == privacyPolicyPreference) {
-                        startActivityForUrl(PRIVACY_POLICY_URL);
-                    } else if (preference == termsOfServicePreference) {
-                        startActivityForUrl(TERMS_OF_SERVICE_URL);
-                    }
-                } catch (ActivityNotFoundException ex) {
-                    Toast.makeText(getContext(), getString(R.string.url_open_error_toast),
-                            Toast.LENGTH_SHORT).show();
-                }
-                return true;
-            }
-        };
-
-        privacyPolicyPreference.setOnPreferenceClickListener(listener);
-        termsOfServicePreference.setOnPreferenceClickListener(listener);
     }
 
     @Override
     public Context getContext() {
         return getActivity();
     }
 
     private void startActivityForUrl(String urlString) {
         final Intent intent = new Intent();
         intent.setAction(Intent.ACTION_VIEW);

commit 2e86c9a6e73bbaa26354ac04340c14643774e662
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2017-08-22 02:51:36-0400

    remove 'to Google' from Contacts backup notice
---
 res/values-en-rAU/strings.xml | 2 +-
 res/values-en-rGB/strings.xml | 2 +-
 res/values-en-rIN/strings.xml | 2 +-
 res/values/strings.xml        | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/res/values-en-rAU/strings.xml b/res/values-en-rAU/strings.xml
index 3baa6d9479dc60585432476e4a04c3e8cf454dc4..06c139f5639b5b2b3311f289d39066222407de82 100644
--- a/res/values-en-rAU/strings.xml
+++ b/res/values-en-rAU/strings.xml
@@ -180,21 +180,21 @@
     <string name="clear_default" msgid="2055883863621491533">"Clear default"</string>
     <string name="toast_text_copied" msgid="845906090076228771">"Text copied"</string>
     <string name="cancel_confirmation_dialog_message" msgid="7486892574762212762">"Discard changes?"</string>
     <string name="cancel_confirmation_dialog_cancel_editing_button" msgid="8280294641821133477">"Discard"</string>
     <string name="cancel_confirmation_dialog_keep_editing_button" msgid="7117943783437253341">"Cancel"</string>
     <string name="leave_customize_confirmation_dialog_message" msgid="5330853530872707231">"Discard customisations?"</string>
     <string name="enter_contact_name" msgid="521859148893732679">"Search contacts"</string>
     <string name="title_edit_group" msgid="4246193439931854759">"Remove contacts"</string>
     <string name="local_profile_title" msgid="1613784248702623410">"My local profile"</string>
     <string name="external_profile_title" msgid="2706282819025406927">"My <xliff:g id="EXTERNAL_SOURCE">%1$s</xliff:g> profile"</string>
-    <string name="contact_editor_prompt_zero_accounts" msgid="4468363031413457746">"Take a moment to add an account that will back up your contacts to Google."</string>
+    <string name="contact_editor_prompt_zero_accounts" msgid="4468363031413457746">"Take a moment to add an account that will back up your contacts."</string>
     <string name="contact_editor_prompt_one_account" msgid="765343809177951169">"New contacts will be saved to <xliff:g id="ACCOUNT_NAME">%1$s</xliff:g>."</string>
     <string name="contact_editor_prompt_multiple_accounts" msgid="1543322760761168351">"Choose a default account for new contacts:"</string>
     <string name="contact_editor_title_new_contact" msgid="7534775011591770343">"Create new contact"</string>
     <string name="contact_editor_title_existing_contact" msgid="3647774955741654029">"Edit contact"</string>
     <string name="contact_editor_title_read_only_contact" msgid="5494810291515292596">"View only"</string>
     <string name="contact_editor_pick_raw_contact_to_edit_dialog_title" msgid="4478782370280424187">"Choose contact to edit"</string>
     <string name="contact_editor_pick_linked_contact_dialog_title" msgid="3332134735168016293">"Linked contacts"</string>
     <string name="contact_editor_add_linked_contact" msgid="2895453741206196138">"Add"</string>
     <string name="contact_editor_unlink_contacts" msgid="8399419729744305687">"Unlink"</string>
     <string name="add_account" msgid="3071396624500839020">"Add account"</string>
diff --git a/res/values-en-rGB/strings.xml b/res/values-en-rGB/strings.xml
index 3baa6d9479dc60585432476e4a04c3e8cf454dc4..06c139f5639b5b2b3311f289d39066222407de82 100644
--- a/res/values-en-rGB/strings.xml
+++ b/res/values-en-rGB/strings.xml
@@ -180,21 +180,21 @@
     <string name="clear_default" msgid="2055883863621491533">"Clear default"</string>
     <string name="toast_text_copied" msgid="845906090076228771">"Text copied"</string>
     <string name="cancel_confirmation_dialog_message" msgid="7486892574762212762">"Discard changes?"</string>
     <string name="cancel_confirmation_dialog_cancel_editing_button" msgid="8280294641821133477">"Discard"</string>
     <string name="cancel_confirmation_dialog_keep_editing_button" msgid="7117943783437253341">"Cancel"</string>
     <string name="leave_customize_confirmation_dialog_message" msgid="5330853530872707231">"Discard customisations?"</string>
     <string name="enter_contact_name" msgid="521859148893732679">"Search contacts"</string>
     <string name="title_edit_group" msgid="4246193439931854759">"Remove contacts"</string>
     <string name="local_profile_title" msgid="1613784248702623410">"My local profile"</string>
     <string name="external_profile_title" msgid="2706282819025406927">"My <xliff:g id="EXTERNAL_SOURCE">%1$s</xliff:g> profile"</string>
-    <string name="contact_editor_prompt_zero_accounts" msgid="4468363031413457746">"Take a moment to add an account that will back up your contacts to Google."</string>
+    <string name="contact_editor_prompt_zero_accounts" msgid="4468363031413457746">"Take a moment to add an account that will back up your contacts."</string>
     <string name="contact_editor_prompt_one_account" msgid="765343809177951169">"New contacts will be saved to <xliff:g id="ACCOUNT_NAME">%1$s</xliff:g>."</string>
     <string name="contact_editor_prompt_multiple_accounts" msgid="1543322760761168351">"Choose a default account for new contacts:"</string>
     <string name="contact_editor_title_new_contact" msgid="7534775011591770343">"Create new contact"</string>
     <string name="contact_editor_title_existing_contact" msgid="3647774955741654029">"Edit contact"</string>
     <string name="contact_editor_title_read_only_contact" msgid="5494810291515292596">"View only"</string>
     <string name="contact_editor_pick_raw_contact_to_edit_dialog_title" msgid="4478782370280424187">"Choose contact to edit"</string>
     <string name="contact_editor_pick_linked_contact_dialog_title" msgid="3332134735168016293">"Linked contacts"</string>
     <string name="contact_editor_add_linked_contact" msgid="2895453741206196138">"Add"</string>
     <string name="contact_editor_unlink_contacts" msgid="8399419729744305687">"Unlink"</string>
     <string name="add_account" msgid="3071396624500839020">"Add account"</string>
diff --git a/res/values-en-rIN/strings.xml b/res/values-en-rIN/strings.xml
index 3baa6d9479dc60585432476e4a04c3e8cf454dc4..06c139f5639b5b2b3311f289d39066222407de82 100644
--- a/res/values-en-rIN/strings.xml
+++ b/res/values-en-rIN/strings.xml
@@ -180,21 +180,21 @@
     <string name="clear_default" msgid="2055883863621491533">"Clear default"</string>
     <string name="toast_text_copied" msgid="845906090076228771">"Text copied"</string>
     <string name="cancel_confirmation_dialog_message" msgid="7486892574762212762">"Discard changes?"</string>
     <string name="cancel_confirmation_dialog_cancel_editing_button" msgid="8280294641821133477">"Discard"</string>
     <string name="cancel_confirmation_dialog_keep_editing_button" msgid="7117943783437253341">"Cancel"</string>
     <string name="leave_customize_confirmation_dialog_message" msgid="5330853530872707231">"Discard customisations?"</string>
     <string name="enter_contact_name" msgid="521859148893732679">"Search contacts"</string>
     <string name="title_edit_group" msgid="4246193439931854759">"Remove contacts"</string>
     <string name="local_profile_title" msgid="1613784248702623410">"My local profile"</string>
     <string name="external_profile_title" msgid="2706282819025406927">"My <xliff:g id="EXTERNAL_SOURCE">%1$s</xliff:g> profile"</string>
-    <string name="contact_editor_prompt_zero_accounts" msgid="4468363031413457746">"Take a moment to add an account that will back up your contacts to Google."</string>
+    <string name="contact_editor_prompt_zero_accounts" msgid="4468363031413457746">"Take a moment to add an account that will back up your contacts."</string>
     <string name="contact_editor_prompt_one_account" msgid="765343809177951169">"New contacts will be saved to <xliff:g id="ACCOUNT_NAME">%1$s</xliff:g>."</string>
     <string name="contact_editor_prompt_multiple_accounts" msgid="1543322760761168351">"Choose a default account for new contacts:"</string>
     <string name="contact_editor_title_new_contact" msgid="7534775011591770343">"Create new contact"</string>
     <string name="contact_editor_title_existing_contact" msgid="3647774955741654029">"Edit contact"</string>
     <string name="contact_editor_title_read_only_contact" msgid="5494810291515292596">"View only"</string>
     <string name="contact_editor_pick_raw_contact_to_edit_dialog_title" msgid="4478782370280424187">"Choose contact to edit"</string>
     <string name="contact_editor_pick_linked_contact_dialog_title" msgid="3332134735168016293">"Linked contacts"</string>
     <string name="contact_editor_add_linked_contact" msgid="2895453741206196138">"Add"</string>
     <string name="contact_editor_unlink_contacts" msgid="8399419729744305687">"Unlink"</string>
     <string name="add_account" msgid="3071396624500839020">"Add account"</string>
diff --git a/res/values/strings.xml b/res/values/strings.xml
index faa1d96e130018c95cb3cb6d6953321155b75595..bc740d06de51d2dab06a986285595986acbf5467 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -539,21 +539,21 @@
     <!-- Title of the edit label view in selection mode when contacts are being selected for removal.[CHAR LIMIT=40] -->
     <string name="title_edit_group">Remove contacts</string>
 
     <!-- Header label in the contact editor for a profile that is local to the device only (and not associated with any account) [CHAR LIMIT=25] -->
     <string name="local_profile_title">My local profile</string>
 
     <!-- Header label in the contact editor for a profile that comes from an external third-party app whose name is given by source [CHAR LIMIT=20] -->
     <string name="external_profile_title">My <xliff:g id="external_source">%1$s</xliff:g> profile</string>
 
     <!-- Message in the contact editor prompt that notifies the user that the newly created contact will not be saved to any account, and prompts addition of an account [CHAR LIMIT=NONE] -->
-    <string name="contact_editor_prompt_zero_accounts">Take a minute to add an account that will back up your contacts to Google.</string>
+    <string name="contact_editor_prompt_zero_accounts">Take a minute to add an account that will back up your contacts.</string>
 
     <!-- Message in the contact editor prompt that asks the user if it's okay to save the newly created contact to the account shown. [CHAR LIMIT=NONE] -->
     <string name="contact_editor_prompt_one_account">New contacts will be saved to <xliff:g id="account_name">%1$s</xliff:g>.</string>
 
     <!-- Message in the contact editor prompt that asks the user which account they want to save the newly created contact to. [CHAR LIMIT=NONE] -->
     <string name="contact_editor_prompt_multiple_accounts">Choose a default account for new contacts:</string>
 
     <!-- Title of the editor activity when creating a new contact. The char
          limit is short and cannot be increased, since this needs to be displayed in a single line
          at a pre-determined text size. [CHAR LIMIT=20] -->

commit 874b6c530b6d956ef446dc98729f6c2b4262c1bb
Author: Joey <joey@lineageos.org>
Date:   Thu 2018-01-25 12:23:13+0100

    Contacts: define app category
    
    Change-Id: I54fd9b2bc0d1beb4885d5dd5cb59c93a34f4bb7d
    Signed-off-by: Joey <joey@lineageos.org>
---
 AndroidManifest.xml | 1 +
 1 file changed, 1 insertion(+)

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index 32d6644a7190c09c551eb093279cf6df1e971bd5..f72a4461009960518c26f758d202eec47667a027 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -57,20 +57,21 @@
 
     <uses-feature
         android:name="android.hardware.telephony"
         android:required="false"/>
 
     <application
         android:name="com.android.contacts.ContactsApplication"
         android:hardwareAccelerated="true"
         android:icon="@mipmap/ic_contacts_launcher"
         android:label="@string/applicationLabel"
+        android:appCategory="social"
         android:supportsRtl="true"
         android:taskAffinity="android.task.contacts"
         android:usesCleartextTraffic="false">
         <!-- The main Contacts activity with the contact list, favorites, and groups. -->
         <activity
             android:name=".activities.PeopleActivity"
             android:alwaysRetainTaskState="true"
             android:launchMode="singleTop"
             android:resizeableActivity="true"
             android:theme="@style/LaunchScreenTheme"

commit 1a7f9a02a4e16c858b3dbfd84e3f077a0ad0e411
Author: flawedworld <flawedworld@flawed.world>
Date:   Fri 2022-02-04 22:12:10+0000

    Raise minSdkVersion to 30
---
 AndroidManifest.xml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index f72a4461009960518c26f758d202eec47667a027..dfccc43ce830f488063f25bb0c523177a2afcfe6 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -13,21 +13,21 @@
      See the License for the specific language governing permissions and
      limitations under the License.
 -->
 
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
           package="com.android.contacts"
           android:versionCode="10733"
           android:versionName="1.7.33">
 
     <uses-sdk
-        android:minSdkVersion="21"
+        android:minSdkVersion="30"
         android:targetSdkVersion="30"/>
 
     <original-package android:name="com.android.contacts"/>
 
     <!-- Contacts permission listed first because order determines
          order that permissions are requested with some OEMs -->
     <uses-permission android:name="android.permission.READ_CONTACTS"/>
     <uses-permission android:name="android.permission.WRITE_CONTACTS"/>
     <uses-permission android:name="android.permission.GET_ACCOUNTS"/>
     <uses-permission android:name="android.permission.GET_ACCOUNTS_PRIVILEGED"/>

commit 2c2c6c6cd2ad6c83bf55c16f06f39f9689bbcb8e
Author: flawedworld <flawedworld@flawed.world>
Date:   Sat 2022-02-05 16:37:24+0000

    Add GrapheneOS icon
---
 AndroidManifest.xml                           |  3 ++-
 res/drawable/ic_launcher_foreground.xml (new) | 27 +++++++++++++++++++++++++++
 res/mipmap-anydpi/ic_launcher.xml (new)       |  5 +++++
 res/mipmap-anydpi/ic_launcher_round.xml (new) |  5 +++++
 res/values/ic_launcher_background.xml (new)   |  4 ++++
 5 files changed, 43 insertions(+), 1 deletion(-)

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index dfccc43ce830f488063f25bb0c523177a2afcfe6..9f1cf50033a4f54576ff7d2ebe5523766e6432b7 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -55,21 +55,22 @@
     <uses-permission android:name="android.permission.FOREGROUND_SERVICE"/>
     <uses-permission android:name="android.permission.HIDE_NON_SYSTEM_OVERLAY_WINDOWS" />
 
     <uses-feature
         android:name="android.hardware.telephony"
         android:required="false"/>
 
     <application
         android:name="com.android.contacts.ContactsApplication"
         android:hardwareAccelerated="true"
-        android:icon="@mipmap/ic_contacts_launcher"
+        android:icon="@mipmap/ic_launcher"
+        android:roundIcon="@mipmap/ic_launcher_round"
         android:label="@string/applicationLabel"
         android:appCategory="social"
         android:supportsRtl="true"
         android:taskAffinity="android.task.contacts"
         android:usesCleartextTraffic="false">
         <!-- The main Contacts activity with the contact list, favorites, and groups. -->
         <activity
             android:name=".activities.PeopleActivity"
             android:alwaysRetainTaskState="true"
             android:launchMode="singleTop"
diff --git a/res/drawable/ic_launcher_foreground.xml b/res/drawable/ic_launcher_foreground.xml
new file mode 100644
index 0000000000000000000000000000000000000000..2d27b83fc7792128838301c62b14ddd3fc4b4993
--- /dev/null
+++ b/res/drawable/ic_launcher_foreground.xml
@@ -0,0 +1,27 @@
+<!--
+  Copyright (C) 2021 Google Inc.
+  Licensed under the Apache License, Version 2.0 (the "License");
+  you may not use this file except in compliance with the License.
+  You may obtain a copy of the License at
+    http://www.apache.org/licenses/LICENSE-2.0
+  Unless required by applicable law or agreed to in writing, software
+  distributed under the License is distributed on an "AS IS" BASIS,
+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  See the License for the specific language governing permissions and
+  limitations under the License.
+  -->
+  <vector xmlns:android="http://schemas.android.com/apk/res/android"
+  android:width="108dp"
+  android:height="108dp"
+  android:viewportWidth="108"
+  android:viewportHeight="108"
+  android:tint="?attr/colorControlNormal">
+<group android:scaleX="2.25"
+    android:scaleY="2.25"
+    android:translateX="27"
+    android:translateY="27">
+  <path
+      android:fillColor="@android:color/black"
+      android:pathData="M20,0H4v2h16V0zM4,24h16v-2H4v2zM22,4H2v16h20V4zM12,6.75c1.24,0 2.25,1.01 2.25,2.25s-1.01,2.25 -2.25,2.25S9.75,10.24 9.75,9 10.76,6.75 12,6.75zM17,17H7v-1.5c0,-1.67 3.33,-2.5 5,-2.5s5,0.83 5,2.5V17z"/>
+</group>
+</vector>
diff --git a/res/mipmap-anydpi/ic_launcher.xml b/res/mipmap-anydpi/ic_launcher.xml
new file mode 100644
index 0000000000000000000000000000000000000000..a8a8fa5518fcdb2db0385028800968b2667af71e
--- /dev/null
+++ b/res/mipmap-anydpi/ic_launcher.xml
@@ -0,0 +1,5 @@
+<?xml version="1.0" encoding="utf-8"?>
+<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
+    <background android:drawable="@color/ic_launcher_background" />
+    <foreground android:drawable="@drawable/ic_launcher_foreground" />
+</adaptive-icon>
diff --git a/res/mipmap-anydpi/ic_launcher_round.xml b/res/mipmap-anydpi/ic_launcher_round.xml
new file mode 100644
index 0000000000000000000000000000000000000000..a8a8fa5518fcdb2db0385028800968b2667af71e
--- /dev/null
+++ b/res/mipmap-anydpi/ic_launcher_round.xml
@@ -0,0 +1,5 @@
+<?xml version="1.0" encoding="utf-8"?>
+<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
+    <background android:drawable="@color/ic_launcher_background" />
+    <foreground android:drawable="@drawable/ic_launcher_foreground" />
+</adaptive-icon>
diff --git a/res/values/ic_launcher_background.xml b/res/values/ic_launcher_background.xml
new file mode 100644
index 0000000000000000000000000000000000000000..f42ada656ee26e30d170aaa67989f0f15c1a300b
--- /dev/null
+++ b/res/values/ic_launcher_background.xml
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>
+    <color name="ic_launcher_background">#FFFFFF</color>
+</resources>

commit 100833ac6457fc303ffb5dd339b8b7c024c42900
Author: smdyv <88971341+smdyv@users.noreply.github.com>
Date:   Wed 2022-02-09 11:29:05+0100

    Replace launcher icon
---
 res/drawable/ic_launcher_foreground.xml | 31 +++++++++++++++++--------------
 1 file changed, 17 insertions(+), 14 deletions(-)

diff --git a/res/drawable/ic_launcher_foreground.xml b/res/drawable/ic_launcher_foreground.xml
index 2d27b83fc7792128838301c62b14ddd3fc4b4993..05c3b3047ca1d0f116c08a55e0833f69ca6e0cf4 100644
--- a/res/drawable/ic_launcher_foreground.xml
+++ b/res/drawable/ic_launcher_foreground.xml
@@ -1,27 +1,30 @@
 <!--
   Copyright (C) 2021 Google Inc.
+
   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at
+
     http://www.apache.org/licenses/LICENSE-2.0
+
   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
   -->
-  <vector xmlns:android="http://schemas.android.com/apk/res/android"
-  android:width="108dp"
-  android:height="108dp"
-  android:viewportWidth="108"
-  android:viewportHeight="108"
-  android:tint="?attr/colorControlNormal">
-<group android:scaleX="2.25"
-    android:scaleY="2.25"
-    android:translateX="27"
-    android:translateY="27">
-  <path
-      android:fillColor="@android:color/black"
-      android:pathData="M20,0H4v2h16V0zM4,24h16v-2H4v2zM22,4H2v16h20V4zM12,6.75c1.24,0 2.25,1.01 2.25,2.25s-1.01,2.25 -2.25,2.25S9.75,10.24 9.75,9 10.76,6.75 12,6.75zM17,17H7v-1.5c0,-1.67 3.33,-2.5 5,-2.5s5,0.83 5,2.5V17z"/>
-</group>
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+    android:width="108dp"
+    android:height="108dp"
+    android:viewportWidth="108"
+    android:viewportHeight="108">
+    <group
+        android:scaleX="2.145"
+        android:scaleY="2.145"
+        android:translateX="28.26"
+        android:translateY="28.26">
+        <path
+            android:fillColor="#000000"
+            android:pathData="M20,4L4,4C2.9,4 2,4.9 2,6v12c0,1.1 0.9,2 2,2h16c1.1,0 2,-0.9 2,-2L22,6C22,4.9 21.1,4 20,4ZM12,6.75c1.24,0 2.25,1.01 2.25,2.25 0,1.24 -1.01,2.25 -2.25,2.25C10.76,11.25 9.75,10.24 9.75,9 9.75,7.76 10.76,6.75 12,6.75ZM17,17L7,17v-1.5c0,-1.67 3.33,-2.5 5,-2.5 1.67,0 5,0.83 5,2.5z" />
+    </group>
 </vector>

commit 705bbf36b0ce11a8179d375e4492331a778f1b6f (HEAD, tag: SP2A.220305.012.2022030801, m/master, grapheneos/12.1)
Author: June <june@eridan.me>
Date:   Sat 2022-02-19 06:53:03+0000

    Add basic support for vCard 4.0
    
    Signed-off-by: June <june@eridan.me>
---
 .../android/contacts/vcard/ImportProcessor.java    | 14 ++++++---
 .../contacts/vcard/ImportVCardActivity.java        | 34 ++++++++++++++++++++--
 .../contacts/vcard/NfcImportVCardActivity.java     | 18 ++++++++++--
 3 files changed, 57 insertions(+), 9 deletions(-)

diff --git a/src/com/android/contacts/vcard/ImportProcessor.java b/src/com/android/contacts/vcard/ImportProcessor.java
index c6fcccb8c2c9f6e63fa3afb6474c57a544774b61..8eff2cc9636fed73ccc4813eebec91401465de54 100644
--- a/src/com/android/contacts/vcard/ImportProcessor.java
+++ b/src/com/android/contacts/vcard/ImportProcessor.java
@@ -23,20 +23,21 @@ import android.util.Log;
 
 import com.android.contactsbind.FeedbackHelper;
 import com.android.vcard.VCardEntry;
 import com.android.vcard.VCardEntryCommitter;
 import com.android.vcard.VCardEntryConstructor;
 import com.android.vcard.VCardEntryHandler;
 import com.android.vcard.VCardInterpreter;
 import com.android.vcard.VCardParser;
 import com.android.vcard.VCardParser_V21;
 import com.android.vcard.VCardParser_V30;
+import com.android.vcard.VCardParser_V40;
 import com.android.vcard.exception.VCardException;
 import com.android.vcard.exception.VCardNotSupportedException;
 import com.android.vcard.exception.VCardVersionException;
 
 import java.io.ByteArrayInputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.util.ArrayList;
 import java.util.List;
 
@@ -128,21 +129,22 @@ public class ImportProcessor extends ProcessorBase implements VCardEntryHandler
             return;
         }
         final int[] possibleVCardVersions;
         if (request.vcardVersion == ImportVCardActivity.VCARD_VERSION_AUTO_DETECT) {
             /**
              * Note: this code assumes that a given Uri is able to be opened more than once,
              * which may not be true in certain conditions.
              */
             possibleVCardVersions = new int[] {
                     ImportVCardActivity.VCARD_VERSION_V21,
-                    ImportVCardActivity.VCARD_VERSION_V30
+                    ImportVCardActivity.VCARD_VERSION_V30,
+                    ImportVCardActivity.VCARD_VERSION_V40
             };
         } else {
             possibleVCardVersions = new int[] {
                     request.vcardVersion
             };
         }
 
         final Uri uri = request.uri;
         final Account account = request.account;
         final int estimatedVCardType = request.estimatedVCardType;
@@ -224,23 +226,27 @@ public class ImportProcessor extends ProcessorBase implements VCardEntryHandler
                 if (i > 0 && (interpreter instanceof VCardEntryConstructor)) {
                     // Let the object clean up internal temporary objects,
                     ((VCardEntryConstructor) interpreter).clear();
                 }
 
                 // We need synchronized block here,
                 // since we need to handle mCanceled and mVCardParser at once.
                 // In the worst case, a user may call cancel() just before creating
                 // mVCardParser.
                 synchronized (this) {
-                    mVCardParser = (vcardVersion == ImportVCardActivity.VCARD_VERSION_V30 ?
-                            new VCardParser_V30(vcardType) :
-                                new VCardParser_V21(vcardType));
+                    if (vcardVersion == ImportVCardActivity.VCARD_VERSION_V30) {
+                        mVCardParser = new VCardParser_V30(vcardType);
+                    } else if (vcardVersion == ImportVCardActivity.VCARD_VERSION_V40) {
+                        mVCardParser = new VCardParser_V40(vcardType);
+                    } else {
+                        mVCardParser = new VCardParser_V21(vcardType);
+                    }
                     if (isCancelled()) {
                         Log.i(LOG_TAG, "ImportProcessor already recieves cancel request, so " +
                                 "send cancel request to vCard parser too.");
                         mVCardParser.cancel();
                     }
                 }
                 mVCardParser.parse(is, interpreter);
 
                 successful = true;
                 break;
diff --git a/src/com/android/contacts/vcard/ImportVCardActivity.java b/src/com/android/contacts/vcard/ImportVCardActivity.java
index 38367c40f9b55a0118c140665cb375931745b2da..71203d4ac12bdc3847e18971388ea1659c9f60cf 100644
--- a/src/com/android/contacts/vcard/ImportVCardActivity.java
+++ b/src/com/android/contacts/vcard/ImportVCardActivity.java
@@ -42,20 +42,21 @@ import android.widget.Toast;
 
 import com.android.contacts.R;
 import com.android.contacts.activities.RequestImportVCardPermissionsActivity;
 import com.android.contacts.model.AccountTypeManager;
 import com.android.contacts.model.account.AccountWithDataSet;
 import com.android.contactsbind.FeedbackHelper;
 import com.android.vcard.VCardEntryCounter;
 import com.android.vcard.VCardParser;
 import com.android.vcard.VCardParser_V21;
 import com.android.vcard.VCardParser_V30;
+import com.android.vcard.VCardParser_V40;
 import com.android.vcard.VCardSourceDetector;
 import com.android.vcard.exception.VCardException;
 import com.android.vcard.exception.VCardNestedException;
 import com.android.vcard.exception.VCardVersionException;
 
 import java.io.ByteArrayInputStream;
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
 import java.nio.ByteBuffer;
@@ -76,20 +77,21 @@ import java.util.List;
  * dialogs stuffs (like how onCreateDialog() is used).
  */
 public class ImportVCardActivity extends Activity implements ImportVCardDialogFragment.Listener {
     private static final String LOG_TAG = "VCardImport";
 
     private static final int SELECT_ACCOUNT = 0;
 
     /* package */ final static int VCARD_VERSION_AUTO_DETECT = 0;
     /* package */ final static int VCARD_VERSION_V21 = 1;
     /* package */ final static int VCARD_VERSION_V30 = 2;
+    /* package */ final static int VCARD_VERSION_V40 = 3;
 
     private static final int REQUEST_OPEN_DOCUMENT = 100;
 
     /**
      * Notification id used when error happened before sending an import request to VCardServer.
      */
     private static final int FAILURE_NOTIFICATION_ID = 1;
 
     private static final String LOCAL_TMP_FILE_NAME_EXTRA =
             "com.android.contacts.vcard.LOCAL_TMP_FILE_NAME";
@@ -314,20 +316,21 @@ public class ImportVCardActivity extends Activity implements ImportVCardDialogFr
          */
         private ImportRequest constructImportRequest(final byte[] data,
                 final Uri localDataUri, final String displayName)
                 throws IOException, VCardException {
             final ContentResolver resolver = ImportVCardActivity.this.getContentResolver();
             VCardEntryCounter counter = null;
             VCardSourceDetector detector = null;
             int vcardVersion = VCARD_VERSION_V21;
             try {
                 boolean shouldUseV30 = false;
+                boolean shouldUseV40 = false;
                 InputStream is;
                 if (data != null) {
                     is = new ByteArrayInputStream(data);
                 } else {
                     is = resolver.openInputStream(localDataUri);
                 }
                 mVCardParser = new VCardParser_V21();
                 try {
                     counter = new VCardEntryCounter();
                     detector = new VCardSourceDetector();
@@ -347,32 +350,59 @@ public class ImportVCardActivity extends Activity implements ImportVCardDialogFr
                         is = resolver.openInputStream(localDataUri);
                     }
                     mVCardParser = new VCardParser_V30();
                     try {
                         counter = new VCardEntryCounter();
                         detector = new VCardSourceDetector();
                         mVCardParser.addInterpreter(counter);
                         mVCardParser.addInterpreter(detector);
                         mVCardParser.parse(is);
                     } catch (VCardVersionException e2) {
-                        throw new VCardException("vCard with unspported version.");
+                        try {
+                            is.close();
+                        } catch (IOException e) {
+                        }
+
+                        shouldUseV30 = false;
+                        shouldUseV40 = true;
+                        if (data != null) {
+                            is = new ByteArrayInputStream(data);
+                        } else {
+                            is = resolver.openInputStream(localDataUri);
+                        }
+                        mVCardParser = new VCardParser_V40();
+                        try {
+                            counter = new VCardEntryCounter();
+                            detector = new VCardSourceDetector();
+                            mVCardParser.addInterpreter(counter);
+                            mVCardParser.addInterpreter(detector);
+                            mVCardParser.parse(is);
+                        } catch (VCardVersionException e3) {
+                            throw new VCardException("vCard with unspported version.");
+                        }
                     }
                 } finally {
                     if (is != null) {
                         try {
                             is.close();
                         } catch (IOException e) {
                         }
                     }
                 }
 
-                vcardVersion = shouldUseV30 ? VCARD_VERSION_V30 : VCARD_VERSION_V21;
+                if (shouldUseV30) {
+                    vcardVersion = VCARD_VERSION_V30;
+                } else if (shouldUseV40) {
+                    vcardVersion = VCARD_VERSION_V40;
+                } else {
+                    vcardVersion = VCARD_VERSION_V21;
+                }
             } catch (VCardNestedException e) {
                 Log.w(LOG_TAG, "Nested Exception is found (it may be false-positive).");
                 // Go through without throwing the Exception, as we may be able to detect the
                 // version before it
             }
             return new ImportRequest(mAccount,
                     data, localDataUri, displayName,
                     detector.getEstimatedType(),
                     detector.getEstimatedCharset(),
                     vcardVersion, counter.getCount());
diff --git a/src/com/android/contacts/vcard/NfcImportVCardActivity.java b/src/com/android/contacts/vcard/NfcImportVCardActivity.java
index 88fa760356800b665cbd4c8f5845bee8dc428f18..f41e564463ea1f1685c72d187a68873c04fd6bde 100644
--- a/src/com/android/contacts/vcard/NfcImportVCardActivity.java
+++ b/src/com/android/contacts/vcard/NfcImportVCardActivity.java
@@ -39,20 +39,21 @@ import com.android.contacts.R;
 import com.android.contacts.activities.RequestPermissionsActivity;
 import com.android.contacts.model.AccountTypeManager;
 import com.android.contacts.model.account.AccountWithDataSet;
 import com.android.contacts.util.ImplicitIntentsUtil;
 import com.android.contactsbind.FeedbackHelper;
 import com.android.vcard.VCardEntry;
 import com.android.vcard.VCardEntryCounter;
 import com.android.vcard.VCardParser;
 import com.android.vcard.VCardParser_V21;
 import com.android.vcard.VCardParser_V30;
+import com.android.vcard.VCardParser_V40;
 import com.android.vcard.VCardSourceDetector;
 import com.android.vcard.exception.VCardException;
 import com.android.vcard.exception.VCardNestedException;
 import com.android.vcard.exception.VCardVersionException;
 
 import java.io.ByteArrayInputStream;
 import java.io.IOException;
 import java.util.ArrayList;
 import java.util.List;
 
@@ -119,23 +120,34 @@ public class NfcImportVCardActivity extends Activity implements ServiceConnectio
                 is.reset();
                 vcardVersion = ImportVCardActivity.VCARD_VERSION_V30;
                 parser = new VCardParser_V30();
                 try {
                     counter = new VCardEntryCounter();
                     detector = new VCardSourceDetector();
                     parser.addInterpreter(counter);
                     parser.addInterpreter(detector);
                     parser.parse(is);
                 } catch (VCardVersionException e2) {
-                    FeedbackHelper.sendFeedback(this, TAG, "vcard with unsupported version", e2);
-                    showFailureNotification(R.string.fail_reason_not_supported);
-                    return null;
+                    is.reset();
+                    vcardVersion = ImportVCardActivity.VCARD_VERSION_V40;
+                    parser = new VCardParser_V40();
+                    try {
+                        counter = new VCardEntryCounter();
+                        detector = new VCardSourceDetector();
+                        parser.addInterpreter(counter);
+                        parser.addInterpreter(detector);
+                        parser.parse(is);
+                    } catch (VCardVersionException e3) {
+                        FeedbackHelper.sendFeedback(this, TAG, "vcard with unsupported version", e2);
+                        showFailureNotification(R.string.fail_reason_not_supported);
+                        return null;
+                    }
                 }
             } finally {
                 try {
                     if (is != null) is.close();
                 } catch (IOException e) {
                 }
             }
         } catch (IOException e) {
             FeedbackHelper.sendFeedback(this, TAG, "Failed to read vcard data", e);
             showFailureNotification(R.string.fail_reason_io_error);
