commit aa4892fcdaa904c8ca23cb25cd01aa28ac7296eb
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2020-09-14 23:59:13-0400

    disable unused gmscore_app domain
---
 prebuilts/api/30.0/private/seapp_contexts | 4 ----
 private/seapp_contexts                    | 4 ----
 2 files changed, 8 deletions(-)

diff --git a/prebuilts/api/30.0/private/seapp_contexts b/prebuilts/api/30.0/private/seapp_contexts
index a8c61be8ffdaa9ae1adc5b3a7c29365fc2872430..25e450d4f091027ba4283638497bd0da5e8637e5 100644
--- a/prebuilts/api/30.0/private/seapp_contexts
+++ b/prebuilts/api/30.0/private/seapp_contexts
@@ -155,21 +155,17 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
-user=_app isPrivApp=true name=com.google.android.gms domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms.* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms:* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gsf domain=gmscore_app type=privapp_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/seapp_contexts b/private/seapp_contexts
index a8c61be8ffdaa9ae1adc5b3a7c29365fc2872430..25e450d4f091027ba4283638497bd0da5e8637e5 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -155,21 +155,17 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
-user=_app isPrivApp=true name=com.google.android.gms domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms.* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms:* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gsf domain=gmscore_app type=privapp_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user

commit 2a2ebd47ad5dd9b80ab2a7de9c7d07803e82c132
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2017-02-17 18:14:24-0500

    expose sys.update. to adb shell
---
 prebuilts/api/30.0/private/property_contexts | 1 +
 private/property_contexts                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/30.0/private/property_contexts b/prebuilts/api/30.0/private/property_contexts
index 7908bb1071a9ae9419ca339a44353d6331f4fb0e..fcad29e2afc0b868574870d1a85b98e5751a67a4 100644
--- a/prebuilts/api/30.0/private/property_contexts
+++ b/prebuilts/api/30.0/private/property_contexts
@@ -42,20 +42,21 @@ llk.                    u:object_r:llkd_prop:s0
 khungtask.              u:object_r:llkd_prop:s0
 ro.llk.                 u:object_r:llkd_prop:s0
 ro.khungtask.           u:object_r:llkd_prop:s0
 lmkd.reinit             u:object_r:lmkd_prop:s0 exact int
 log.                    u:object_r:log_prop:s0
 log.tag                 u:object_r:log_tag_prop:s0
 log.tag.WifiHAL         u:object_r:wifi_log_prop:s0
 security.perf_harden    u:object_r:shell_prop:s0
 service.adb.root        u:object_r:shell_prop:s0
 service.adb.tcp.port    u:object_r:shell_prop:s0
+sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0
diff --git a/private/property_contexts b/private/property_contexts
index 7908bb1071a9ae9419ca339a44353d6331f4fb0e..fcad29e2afc0b868574870d1a85b98e5751a67a4 100644
--- a/private/property_contexts
+++ b/private/property_contexts
@@ -42,20 +42,21 @@ llk.                    u:object_r:llkd_prop:s0
 khungtask.              u:object_r:llkd_prop:s0
 ro.llk.                 u:object_r:llkd_prop:s0
 ro.khungtask.           u:object_r:llkd_prop:s0
 lmkd.reinit             u:object_r:lmkd_prop:s0 exact int
 log.                    u:object_r:log_prop:s0
 log.tag                 u:object_r:log_tag_prop:s0
 log.tag.WifiHAL         u:object_r:wifi_log_prop:s0
 security.perf_harden    u:object_r:shell_prop:s0
 service.adb.root        u:object_r:shell_prop:s0
 service.adb.tcp.port    u:object_r:shell_prop:s0
+sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0

commit f87aa7a7e6e763f7c05de5575062e9e881ca0fef
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2020-09-15 00:08:40-0400

    add SELinux domain for Updater app
---
 prebuilts/api/30.0/private/app_neverallows.te          |  2 +-
 prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil |  1 +
 prebuilts/api/30.0/private/seapp_contexts              |  1 +
 prebuilts/api/30.0/private/updater_app.te (new)        | 17 +++++++++++++++++
 prebuilts/api/30.0/public/update_engine.te             |  1 +
 prebuilts/api/30.0/public/updater_app.te (new)         |  5 +++++
 private/app_neverallows.te                             |  2 +-
 private/compat/29.0/29.0.ignore.cil                    |  1 +
 private/seapp_contexts                                 |  1 +
 private/updater_app.te (new)                           | 17 +++++++++++++++++
 public/update_engine.te                                |  1 +
 public/updater_app.te (new)                            |  5 +++++
 12 files changed, 52 insertions(+), 2 deletions(-)

diff --git a/prebuilts/api/30.0/private/app_neverallows.te b/prebuilts/api/30.0/private/app_neverallows.te
index 11571870070ada8e03dc771ed4366a4bfb550a80..32980b354b0f6b2adf0d25f3b9d21d326eda3b24 100644
--- a/prebuilts/api/30.0/private/app_neverallows.te
+++ b/prebuilts/api/30.0/private/app_neverallows.te
@@ -123,21 +123,21 @@ neverallow {
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
 # application un-installation.
-neverallow { all_untrusted_apps -mediaprovider } {
+neverallow { all_untrusted_apps -mediaprovider -updater_app } {
   fs_type
   -sdcard_type
   file_type
   -app_data_file            # The apps sandbox itself
   -privapp_data_file
   -app_exec_data_file       # stored within the app sandbox directory
   -media_rw_data_file       # Internal storage. Known that apps can
                             # leave artfacts here after uninstall.
   -user_profile_data_file   # Access to profile files
   userdebug_or_eng(`
diff --git a/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil b/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
index fdea691eac39a0b023c61403777e62b10e0878f0..730695e8e4d2323b601d6b13503b0bfcf0585ad8 100644
--- a/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
@@ -106,20 +106,21 @@
     system_group_file
     system_jvmti_agent_prop
     system_passwd_file
     system_unsolzygote_socket
     tethering_service
     traced_perf
     traced_perf_enabled_prop
     traced_perf_socket
     timezonedetector_service
     untrusted_app_29
+    updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
diff --git a/prebuilts/api/30.0/private/seapp_contexts b/prebuilts/api/30.0/private/seapp_contexts
index 25e450d4f091027ba4283638497bd0da5e8637e5..fa9388cc4f394a7bf5d8a77dc078b1a84e321691 100644
--- a/prebuilts/api/30.0/private/seapp_contexts
+++ b/prebuilts/api/30.0/private/seapp_contexts
@@ -155,17 +155,18 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/prebuilts/api/30.0/private/updater_app.te b/prebuilts/api/30.0/private/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..0ce047b97a01f2c1c30e723cd2b9ccb827993892
--- /dev/null
+++ b/prebuilts/api/30.0/private/updater_app.te
@@ -0,0 +1,17 @@
+###
+### Updater app
+###
+
+typeattribute updater_app coredomain;
+
+app_domain(updater_app)
+untrusted_app_domain(updater_app)
+net_domain(updater_app)
+
+# Write to /data/ota_package for OTA packages.
+allow updater_app ota_package_file:dir rw_dir_perms;
+allow updater_app ota_package_file:file create_file_perms;
+
+# Allow Updater to communicate with update_engine for A/B update.
+binder_call(updater_app, update_engine)
+allow updater_app update_engine_service:service_manager find;
diff --git a/prebuilts/api/30.0/public/update_engine.te b/prebuilts/api/30.0/public/update_engine.te
index 8b767bea0400b2c9821108a27ee9dbc93b0520f4..4dd951c9d68e9e3adba15b54dd1d7f842caae681 100644
--- a/prebuilts/api/30.0/public/update_engine.te
+++ b/prebuilts/api/30.0/public/update_engine.te
@@ -39,20 +39,21 @@ add_service(update_engine, update_engine_service)
 # Allow update_engine to call the callback function provided by priv_app/GMS core.
 binder_call(update_engine, priv_app)
 # b/142672293: No other priv-app should need this rule now that GMS core runs in its own domain.
 userdebug_or_eng(`
   auditallow update_engine priv_app:binder { call transfer };
   auditallow priv_app update_engine:binder transfer;
   auditallow update_engine priv_app:fd use;
 ')
 
 binder_call(update_engine, gmscore_app)
+binder_call(update_engine, updater_app)
 
 # Allow update_engine to call the callback function provided by system_server.
 binder_call(update_engine, system_server)
 
 # Read OTA zip file at /data/ota_package/.
 allow update_engine ota_package_file:file r_file_perms;
 allow update_engine ota_package_file:dir r_dir_perms;
 
 # Use Boot Control HAL
 hal_client_domain(update_engine, hal_bootctl)
diff --git a/prebuilts/api/30.0/public/updater_app.te b/prebuilts/api/30.0/public/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..97a850ba19008bf220eb55c09bacf86f11f01e37
--- /dev/null
+++ b/prebuilts/api/30.0/public/updater_app.te
@@ -0,0 +1,5 @@
+###
+### Updater app
+###
+
+type updater_app, domain;
diff --git a/private/app_neverallows.te b/private/app_neverallows.te
index 11571870070ada8e03dc771ed4366a4bfb550a80..32980b354b0f6b2adf0d25f3b9d21d326eda3b24 100644
--- a/private/app_neverallows.te
+++ b/private/app_neverallows.te
@@ -123,21 +123,21 @@ neverallow {
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
 # application un-installation.
-neverallow { all_untrusted_apps -mediaprovider } {
+neverallow { all_untrusted_apps -mediaprovider -updater_app } {
   fs_type
   -sdcard_type
   file_type
   -app_data_file            # The apps sandbox itself
   -privapp_data_file
   -app_exec_data_file       # stored within the app sandbox directory
   -media_rw_data_file       # Internal storage. Known that apps can
                             # leave artfacts here after uninstall.
   -user_profile_data_file   # Access to profile files
   userdebug_or_eng(`
diff --git a/private/compat/29.0/29.0.ignore.cil b/private/compat/29.0/29.0.ignore.cil
index fdea691eac39a0b023c61403777e62b10e0878f0..730695e8e4d2323b601d6b13503b0bfcf0585ad8 100644
--- a/private/compat/29.0/29.0.ignore.cil
+++ b/private/compat/29.0/29.0.ignore.cil
@@ -106,20 +106,21 @@
     system_group_file
     system_jvmti_agent_prop
     system_passwd_file
     system_unsolzygote_socket
     tethering_service
     traced_perf
     traced_perf_enabled_prop
     traced_perf_socket
     timezonedetector_service
     untrusted_app_29
+    updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
diff --git a/private/seapp_contexts b/private/seapp_contexts
index 25e450d4f091027ba4283638497bd0da5e8637e5..fa9388cc4f394a7bf5d8a77dc078b1a84e321691 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -155,17 +155,18 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/updater_app.te b/private/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..0ce047b97a01f2c1c30e723cd2b9ccb827993892
--- /dev/null
+++ b/private/updater_app.te
@@ -0,0 +1,17 @@
+###
+### Updater app
+###
+
+typeattribute updater_app coredomain;
+
+app_domain(updater_app)
+untrusted_app_domain(updater_app)
+net_domain(updater_app)
+
+# Write to /data/ota_package for OTA packages.
+allow updater_app ota_package_file:dir rw_dir_perms;
+allow updater_app ota_package_file:file create_file_perms;
+
+# Allow Updater to communicate with update_engine for A/B update.
+binder_call(updater_app, update_engine)
+allow updater_app update_engine_service:service_manager find;
diff --git a/public/update_engine.te b/public/update_engine.te
index 8b767bea0400b2c9821108a27ee9dbc93b0520f4..4dd951c9d68e9e3adba15b54dd1d7f842caae681 100644
--- a/public/update_engine.te
+++ b/public/update_engine.te
@@ -39,20 +39,21 @@ add_service(update_engine, update_engine_service)
 # Allow update_engine to call the callback function provided by priv_app/GMS core.
 binder_call(update_engine, priv_app)
 # b/142672293: No other priv-app should need this rule now that GMS core runs in its own domain.
 userdebug_or_eng(`
   auditallow update_engine priv_app:binder { call transfer };
   auditallow priv_app update_engine:binder transfer;
   auditallow update_engine priv_app:fd use;
 ')
 
 binder_call(update_engine, gmscore_app)
+binder_call(update_engine, updater_app)
 
 # Allow update_engine to call the callback function provided by system_server.
 binder_call(update_engine, system_server)
 
 # Read OTA zip file at /data/ota_package/.
 allow update_engine ota_package_file:file r_file_perms;
 allow update_engine ota_package_file:dir r_dir_perms;
 
 # Use Boot Control HAL
 hal_client_domain(update_engine, hal_bootctl)
diff --git a/public/updater_app.te b/public/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..97a850ba19008bf220eb55c09bacf86f11f01e37
--- /dev/null
+++ b/public/updater_app.te
@@ -0,0 +1,5 @@
+###
+### Updater app
+###
+
+type updater_app, domain;

commit a4b57d5fd47792c5d5039ce769794fdc1f72051d
Author: aeonsolution@protonmail.com <theaeonsolution@protonmail.com>
Date:   Mon 2020-09-14 23:37:37-0500

    allow platform_app to use nfc_service for NFC tile
    
    This is already permitted for priv_app and even untrusted_app.
---
 prebuilts/api/30.0/private/platform_app.te | 1 +
 private/platform_app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/30.0/private/platform_app.te b/prebuilts/api/30.0/private/platform_app.te
index 3beec38e02742a98dd8f0e8e71ef3093ba8887a6..3d4aa764a6bc089dfb6eeb3f6df5a053cdbe53ef 100644
--- a/prebuilts/api/30.0/private/platform_app.te
+++ b/prebuilts/api/30.0/private/platform_app.te
@@ -52,20 +52,21 @@ userdebug_or_eng(`
   auditallow platform_app proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 allow platform_app audioserver_service:service_manager find;
 allow platform_app cameraserver_service:service_manager find;
 allow platform_app drmserver_service:service_manager find;
 allow platform_app mediaserver_service:service_manager find;
 allow platform_app mediametrics_service:service_manager find;
 allow platform_app mediaextractor_service:service_manager find;
 allow platform_app mediadrmserver_service:service_manager find;
+allow platform_app nfc_service:service_manager find;
 allow platform_app persistent_data_block_service:service_manager find;
 allow platform_app radio_service:service_manager find;
 allow platform_app thermal_service:service_manager find;
 allow platform_app timezone_service:service_manager find;
 allow platform_app app_api_service:service_manager find;
 allow platform_app system_api_service:service_manager find;
 allow platform_app vr_manager_service:service_manager find;
 allow platform_app gpu_service:service_manager find;
 allow platform_app stats_service:service_manager find;
 
diff --git a/private/platform_app.te b/private/platform_app.te
index 3beec38e02742a98dd8f0e8e71ef3093ba8887a6..3d4aa764a6bc089dfb6eeb3f6df5a053cdbe53ef 100644
--- a/private/platform_app.te
+++ b/private/platform_app.te
@@ -52,20 +52,21 @@ userdebug_or_eng(`
   auditallow platform_app proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 allow platform_app audioserver_service:service_manager find;
 allow platform_app cameraserver_service:service_manager find;
 allow platform_app drmserver_service:service_manager find;
 allow platform_app mediaserver_service:service_manager find;
 allow platform_app mediametrics_service:service_manager find;
 allow platform_app mediaextractor_service:service_manager find;
 allow platform_app mediadrmserver_service:service_manager find;
+allow platform_app nfc_service:service_manager find;
 allow platform_app persistent_data_block_service:service_manager find;
 allow platform_app radio_service:service_manager find;
 allow platform_app thermal_service:service_manager find;
 allow platform_app timezone_service:service_manager find;
 allow platform_app app_api_service:service_manager find;
 allow platform_app system_api_service:service_manager find;
 allow platform_app vr_manager_service:service_manager find;
 allow platform_app gpu_service:service_manager find;
 allow platform_app stats_service:service_manager find;
 

commit 86b6aa3b8665c405750c974f05f3dd894272bc59
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2020-09-14 22:12:24-0700

    deny_new_usb sysctl and system property policy
---
 prebuilts/api/28.0/plat_pub_versioned.cil       | 7 +++++--
 prebuilts/api/28.0/vendor_sepolicy.cil          | 2 +-
 prebuilts/api/29.0/plat_pub_versioned.cil       | 2 ++
 prebuilts/api/30.0/private/compat/26.0/26.0.cil | 1 +
 prebuilts/api/30.0/private/compat/27.0/27.0.cil | 1 +
 prebuilts/api/30.0/private/compat/28.0/28.0.cil | 2 ++
 prebuilts/api/30.0/private/compat/29.0/29.0.cil | 2 ++
 prebuilts/api/30.0/private/genfs_contexts       | 1 +
 prebuilts/api/30.0/private/property_contexts    | 2 ++
 prebuilts/api/30.0/public/file.te               | 1 +
 prebuilts/api/30.0/public/init.te               | 1 +
 private/compat/26.0/26.0.cil                    | 1 +
 private/compat/27.0/27.0.cil                    | 1 +
 private/compat/28.0/28.0.cil                    | 2 ++
 private/compat/29.0/29.0.cil                    | 2 ++
 private/genfs_contexts                          | 1 +
 private/property_contexts                       | 2 ++
 public/file.te                                  | 1 +
 public/init.te                                  | 1 +
 19 files changed, 30 insertions(+), 3 deletions(-)

diff --git a/prebuilts/api/28.0/plat_pub_versioned.cil b/prebuilts/api/28.0/plat_pub_versioned.cil
index d98a249a0b044859462db561931b7afd5c9ef82c..50df7caea1ecca9907bf0acfe8a85ba3974d9ac7 100644
--- a/prebuilts/api/28.0/plat_pub_versioned.cil
+++ b/prebuilts/api/28.0/plat_pub_versioned.cil
@@ -1,34 +1,34 @@
 (roletype r domain)
 (typeattribute dev_type)
 (typeattributeset dev_type (device_28_0 alarm_device_28_0 ashmem_device_28_0 audio_device_28_0 audio_timer_device_28_0 audio_seq_device_28_0 binder_device_28_0 hwbinder_device_28_0 vndbinder_device_28_0 block_device_28_0 camera_device_28_0 dm_device_28_0 keychord_device_28_0 loop_control_device_28_0 loop_device_28_0 pmsg_device_28_0 radio_device_28_0 ram_device_28_0 rtc_device_28_0 vold_device_28_0 console_device_28_0 cpuctl_device_28_0 fscklogs_28_0 full_device_28_0 gpu_device_28_0 graphics_device_28_0 hw_random_device_28_0 input_device_28_0 kmem_device_28_0 port_device_28_0 lowpan_device_28_0 mtd_device_28_0 mtp_device_28_0 nfc_device_28_0 ptmx_device_28_0 kmsg_device_28_0 kmsg_debug_device_28_0 null_device_28_0 random_device_28_0 secure_element_device_28_0 sensors_device_28_0 serial_device_28_0 socket_device_28_0 owntty_device_28_0 tty_device_28_0 video_device_28_0 vcs_device_28_0 zero_device_28_0 fuse_device_28_0 iio_device_28_0 ion_device_28_0 qtaguid_device_28_0 watchdog_device_28_0 uhid_device_28_0 uio_device_28_0 tun_device_28_0 usbaccessory_device_28_0 usb_device_28_0 properties_device_28_0 properties_serial_28_0 property_info_28_0 i2c_device_28_0 hci_attach_dev_28_0 rpmsg_device_28_0 root_block_device_28_0 frp_block_device_28_0 system_block_device_28_0 recovery_block_device_28_0 boot_block_device_28_0 userdata_block_device_28_0 cache_block_device_28_0 swap_block_device_28_0 metadata_block_device_28_0 misc_block_device_28_0 ppp_device_28_0 tee_device_28_0))
 (typeattribute domain)
 (typeattributeset domain (adbd_28_0 audioserver_28_0 blkid_28_0 blkid_untrusted_28_0 bluetooth_28_0 bootanim_28_0 bootstat_28_0 bufferhubd_28_0 cameraserver_28_0 charger_28_0 clatd_28_0 cppreopts_28_0 crash_dump_28_0 dex2oat_28_0 dhcp_28_0 dnsmasq_28_0 drmserver_28_0 dumpstate_28_0 e2fs_28_0 ephemeral_app_28_0 fingerprintd_28_0 fsck_28_0 fsck_untrusted_28_0 gatekeeperd_28_0 healthd_28_0 hwservicemanager_28_0 idmap_28_0 incident_28_0 incident_helper_28_0 incidentd_28_0 init_28_0 inputflinger_28_0 install_recovery_28_0 installd_28_0 isolated_app_28_0 kernel_28_0 keystore_28_0 lmkd_28_0 logd_28_0 logpersist_28_0 mdnsd_28_0 mediacodec_28_0 mediadrmserver_28_0 mediaextractor_28_0 mediametrics_28_0 mediaprovider_28_0 mediaserver_28_0 modprobe_28_0 mtp_28_0 netd_28_0 netutils_wrapper_28_0 nfc_28_0 otapreopt_chroot_28_0 otapreopt_slot_28_0 performanced_28_0 perfprofd_28_0 platform_app_28_0 postinstall_28_0 postinstall_dexopt_28_0 ppp_28_0 preopt2cachename_28_0 priv_app_28_0 profman_28_0 racoon_28_0 radio_28_0 recovery_28_0 recovery_persist_28_0 recovery_refresh_28_0 runas_28_0 sdcardd_28_0 secure_element_28_0 servicemanager_28_0 sgdisk_28_0 shared_relro_28_0 shell_28_0 slideshow_28_0 su_28_0 surfaceflinger_28_0 system_app_28_0 system_server_28_0 tee_28_0 thermalserviced_28_0 tombstoned_28_0 toolbox_28_0 traced_probes_28_0 traceur_app_28_0 tzdatacheck_28_0 ueventd_28_0 uncrypt_28_0 untrusted_app_28_0 untrusted_app_27_28_0 untrusted_app_25_28_0 untrusted_v2_app_28_0 update_engine_28_0 update_verifier_28_0 usbd_28_0 vdc_28_0 vendor_init_28_0 vendor_shell_28_0 virtual_touchpad_28_0 vndservicemanager_28_0 vold_28_0 vold_prepare_subdirs_28_0 vr_hwc_28_0 watchdogd_28_0 webview_zygote_28_0 wificond_28_0 wpantund_28_0 zygote_28_0))
 (typeattribute fs_type)
-(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0))
+(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_deny_new_usb_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0))
 (typeattribute contextmount_type)
 (typeattributeset contextmount_type (oemfs_28_0 app_fusefs_28_0))
 (typeattribute file_type)
 (typeattributeset file_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 drmserver_socket_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 unlabeled_28_0 system_file_28_0 vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 metadata_file_28_0 vold_metadata_file_28_0 runtime_event_log_tags_file_28_0 logcat_exec_28_0 coredump_file_28_0 system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 mnt_media_rw_file_28_0 mnt_user_file_28_0 mnt_expand_file_28_0 storage_file_28_0 mnt_media_rw_stub_file_28_0 storage_stub_file_28_0 mnt_vendor_file_28_0 postinstall_mnt_dir_28_0 postinstall_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 efs_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 bluetooth_efs_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 adbd_socket_28_0 bluetooth_socket_28_0 dnsproxyd_socket_28_0 dumpstate_socket_28_0 fwmarkd_socket_28_0 lmkd_socket_28_0 logd_socket_28_0 logdr_socket_28_0 logdw_socket_28_0 mdns_socket_28_0 mdnsd_socket_28_0 misc_logd_file_28_0 mtpd_socket_28_0 netd_socket_28_0 property_socket_28_0 racoon_socket_28_0 rild_socket_28_0 rild_debug_socket_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 tombstoned_crash_socket_28_0 tombstoned_java_trace_socket_28_0 tombstoned_intercept_socket_28_0 traced_producer_socket_28_0 traced_consumer_socket_28_0 uncrypt_socket_28_0 wpa_socket_28_0 zygote_socket_28_0 gps_control_28_0 pdx_display_dir_28_0 pdx_performance_dir_28_0 pdx_bufferhub_dir_28_0 pdx_display_client_endpoint_socket_28_0 pdx_display_manager_endpoint_socket_28_0 pdx_display_screenshot_endpoint_socket_28_0 pdx_display_vsync_endpoint_socket_28_0 pdx_performance_client_endpoint_socket_28_0 pdx_bufferhub_client_endpoint_socket_28_0 file_contexts_file_28_0 mac_perms_file_28_0 property_contexts_file_28_0 seapp_contexts_file_28_0 sepolicy_file_28_0 service_contexts_file_28_0 nonplat_service_contexts_file_28_0 hwservice_contexts_file_28_0 vndservice_contexts_file_28_0 audiohal_data_file_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0))
 (typeattribute exec_type)
 (typeattributeset exec_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 logcat_exec_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0))
 (typeattribute data_file_type)
 (expandtypeattribute (data_file_type) false)
 (typeattributeset data_file_type (system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 bluetooth_socket_28_0 misc_logd_file_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 wpa_socket_28_0 audiohal_data_file_28_0))
 (typeattribute core_data_file_type)
 (expandtypeattribute (core_data_file_type) false)
 (typeattributeset core_data_file_type (system_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 fingerprintd_data_file_28_0 app_fuse_file_28_0 bluetooth_socket_28_0 misc_logd_file_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 wpa_socket_28_0 audiohal_data_file_28_0))
 (typeattribute vendor_file_type)
 (typeattributeset vendor_file_type (vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 mediacodec_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0))
 (typeattribute proc_type)
 (expandtypeattribute (proc_type) false)
-(typeattributeset proc_type (proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0))
+(typeattributeset proc_type (proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_deny_new_usb_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0))
 (typeattribute sysfs_type)
 (typeattributeset sysfs_type (sysfs_usermodehelper_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0))
 (typeattribute debugfs_type)
 (typeattributeset debugfs_type (debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0))
 (typeattribute sdcard_type)
 (typeattributeset sdcard_type (fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0))
 (typeattribute node_type)
 (typeattributeset node_type (node_28_0))
 (typeattribute netif_type)
 (typeattributeset netif_type (netif_28_0))
@@ -849,20 +849,23 @@
 (roletype object_r proc_asound_28_0)
 (type proc_buddyinfo)
 (typeattribute proc_buddyinfo_28_0)
 (roletype object_r proc_buddyinfo_28_0)
 (type proc_cmdline)
 (typeattribute proc_cmdline_28_0)
 (roletype object_r proc_cmdline_28_0)
 (type proc_cpuinfo)
 (typeattribute proc_cpuinfo_28_0)
 (roletype object_r proc_cpuinfo_28_0)
+(type proc_deny_new_usb)
+(typeattribute proc_deny_new_usb_28_0)
+(roletype object_r proc_deny_new_usb_28_0)
 (type proc_dirty)
 (typeattribute proc_dirty_28_0)
 (roletype object_r proc_dirty_28_0)
 (type proc_diskstats)
 (typeattribute proc_diskstats_28_0)
 (roletype object_r proc_diskstats_28_0)
 (type proc_extra_free_kbytes)
 (typeattribute proc_extra_free_kbytes_28_0)
 (roletype object_r proc_extra_free_kbytes_28_0)
 (type proc_filesystems)
diff --git a/prebuilts/api/28.0/vendor_sepolicy.cil b/prebuilts/api/28.0/vendor_sepolicy.cil
index e116208149213f03b9c5b57dc6ab78f43713f9b2..73ca9419e87de6c42d3c0dc3f3fdbc095cb222ab 100644
--- a/prebuilts/api/28.0/vendor_sepolicy.cil
+++ b/prebuilts/api/28.0/vendor_sepolicy.cil
@@ -2,21 +2,21 @@
 (genfscon sysfs /devices/platform/9020000.goldfish_battery/power_supply (u object_r sysfs_batteryinfo ((s0) (s0))))
 (genfscon sysfs /devices/platform/ANDR0001:00/properties/android (u object_r sysfs_dt_firmware_android ((s0) (s0))))
 (genfscon sysfs /devices/pci0000:00/0000:00:08.0/virtio5/net (u object_r sysfs_net ((s0) (s0))))
 (genfscon sysfs /devices/platform/GFSH0001:00/power_supply (u object_r sysfs_batteryinfo ((s0) (s0))))
 (genfscon sysfs /devices/virtual/mac80211_hwsim/hwsim0/net (u object_r sysfs_net ((s0) (s0))))
 (genfscon sysfs /devices/virtual/mac80211_hwsim/hwsim1/net (u object_r sysfs_net ((s0) (s0))))
 (genfscon sysfs /devices/platform/GFSH0007:00/rtc (u object_r sysfs_rtc ((s0) (s0))))
 (genfscon sysfs /devices/pnp0/00:00/rtc (u object_r sysfs_rtc ((s0) (s0))))
 (typeattributeset dev_type (device_28_0 alarm_device_28_0 ashmem_device_28_0 audio_device_28_0 audio_timer_device_28_0 audio_seq_device_28_0 binder_device_28_0 hwbinder_device_28_0 vndbinder_device_28_0 block_device_28_0 camera_device_28_0 dm_device_28_0 keychord_device_28_0 loop_control_device_28_0 loop_device_28_0 pmsg_device_28_0 radio_device_28_0 ram_device_28_0 rtc_device_28_0 vold_device_28_0 console_device_28_0 cpuctl_device_28_0 fscklogs_28_0 full_device_28_0 gpu_device_28_0 graphics_device_28_0 hw_random_device_28_0 input_device_28_0 kmem_device_28_0 port_device_28_0 lowpan_device_28_0 mtd_device_28_0 mtp_device_28_0 nfc_device_28_0 ptmx_device_28_0 kmsg_device_28_0 kmsg_debug_device_28_0 null_device_28_0 random_device_28_0 secure_element_device_28_0 sensors_device_28_0 serial_device_28_0 socket_device_28_0 owntty_device_28_0 tty_device_28_0 video_device_28_0 vcs_device_28_0 zero_device_28_0 fuse_device_28_0 iio_device_28_0 ion_device_28_0 qtaguid_device_28_0 watchdog_device_28_0 uhid_device_28_0 uio_device_28_0 tun_device_28_0 usbaccessory_device_28_0 usb_device_28_0 properties_device_28_0 properties_serial_28_0 property_info_28_0 i2c_device_28_0 hci_attach_dev_28_0 rpmsg_device_28_0 root_block_device_28_0 frp_block_device_28_0 system_block_device_28_0 recovery_block_device_28_0 boot_block_device_28_0 userdata_block_device_28_0 cache_block_device_28_0 swap_block_device_28_0 metadata_block_device_28_0 misc_block_device_28_0 ppp_device_28_0 tee_device_28_0 qemu_device))
 (typeattributeset domain (adbd_28_0 audioserver_28_0 blkid_28_0 blkid_untrusted_28_0 bluetooth_28_0 bootanim_28_0 bootstat_28_0 bufferhubd_28_0 cameraserver_28_0 charger_28_0 clatd_28_0 cppreopts_28_0 crash_dump_28_0 dex2oat_28_0 dhcp_28_0 dnsmasq_28_0 drmserver_28_0 dumpstate_28_0 e2fs_28_0 ephemeral_app_28_0 fingerprintd_28_0 fsck_28_0 fsck_untrusted_28_0 gatekeeperd_28_0 healthd_28_0 hwservicemanager_28_0 idmap_28_0 incident_28_0 incident_helper_28_0 incidentd_28_0 init_28_0 inputflinger_28_0 install_recovery_28_0 installd_28_0 isolated_app_28_0 kernel_28_0 keystore_28_0 lmkd_28_0 logd_28_0 logpersist_28_0 mdnsd_28_0 mediacodec_28_0 mediadrmserver_28_0 mediaextractor_28_0 mediametrics_28_0 mediaprovider_28_0 mediaserver_28_0 modprobe_28_0 mtp_28_0 netd_28_0 netutils_wrapper_28_0 nfc_28_0 otapreopt_chroot_28_0 otapreopt_slot_28_0 performanced_28_0 perfprofd_28_0 platform_app_28_0 postinstall_28_0 postinstall_dexopt_28_0 ppp_28_0 preopt2cachename_28_0 priv_app_28_0 profman_28_0 racoon_28_0 radio_28_0 recovery_28_0 recovery_persist_28_0 recovery_refresh_28_0 runas_28_0 sdcardd_28_0 secure_element_28_0 servicemanager_28_0 sgdisk_28_0 shared_relro_28_0 shell_28_0 slideshow_28_0 su_28_0 surfaceflinger_28_0 system_app_28_0 system_server_28_0 tee_28_0 thermalserviced_28_0 tombstoned_28_0 toolbox_28_0 traced_probes_28_0 traceur_app_28_0 tzdatacheck_28_0 ueventd_28_0 uncrypt_28_0 untrusted_app_28_0 untrusted_app_27_28_0 untrusted_app_25_28_0 untrusted_v2_app_28_0 update_engine_28_0 update_verifier_28_0 usbd_28_0 vdc_28_0 vendor_init_28_0 vendor_shell_28_0 virtual_touchpad_28_0 vndservicemanager_28_0 vold_28_0 vold_prepare_subdirs_28_0 vr_hwc_28_0 watchdogd_28_0 webview_zygote_28_0 wificond_28_0 wpantund_28_0 zygote_28_0 hal_audio_default hal_audiocontrol_default hal_authsecret_default hal_bluetooth_default hal_bootctl_default hal_broadcastradio_default hal_camera_default hal_cas_default hal_configstore_default hal_confirmationui_default hal_contexthub_default hal_drm_default hal_dumpstate_default hal_evs_default hal_fingerprint_default hal_gatekeeper_default hal_gnss_default hal_graphics_allocator_default hal_graphics_composer_default hal_health_default hal_ir_default hal_keymaster_default hal_light_default hal_lowpan_default hal_memtrack_default hal_nfc_default hal_power_default hal_radio_config_default hal_radio_default hal_secure_element_default hal_sensors_default hal_tetheroffload_default hal_thermal_default hal_tv_cec_default hal_tv_input_default hal_usb_default hal_vehicle_default hal_vibrator_default hal_vr_default hal_wifi_default hal_wifi_hostapd_default hal_wifi_offload_default hal_wifi_supplicant_default rild vendor_modprobe createns dhcpclient dhcpserver execns goldfish_setup hal_drm_clearkey hal_drm_widevine hostapd_nohidl ipv6proxy qemu_props))
-(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0 sysfs_writable nsfs firmware_file))
+(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_deny_new_usb_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0 sysfs_writable nsfs firmware_file))
 (typeattributeset contextmount_type (oemfs_28_0 app_fusefs_28_0 firmware_file))
 (typeattributeset file_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 drmserver_socket_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 unlabeled_28_0 system_file_28_0 vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 metadata_file_28_0 vold_metadata_file_28_0 runtime_event_log_tags_file_28_0 logcat_exec_28_0 coredump_file_28_0 system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 mnt_media_rw_file_28_0 mnt_user_file_28_0 mnt_expand_file_28_0 storage_file_28_0 mnt_media_rw_stub_file_28_0 storage_stub_file_28_0 mnt_vendor_file_28_0 postinstall_mnt_dir_28_0 postinstall_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 efs_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 bluetooth_efs_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 adbd_socket_28_0 bluetooth_socket_28_0 dnsproxyd_socket_28_0 dumpstate_socket_28_0 fwmarkd_socket_28_0 lmkd_socket_28_0 logd_socket_28_0 logdr_socket_28_0 logdw_socket_28_0 mdns_socket_28_0 mdnsd_socket_28_0 misc_logd_file_28_0 mtpd_socket_28_0 netd_socket_28_0 property_socket_28_0 racoon_socket_28_0 rild_socket_28_0 rild_debug_socket_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 tombstoned_crash_socket_28_0 tombstoned_java_trace_socket_28_0 tombstoned_intercept_socket_28_0 traced_producer_socket_28_0 traced_consumer_socket_28_0 uncrypt_socket_28_0 wpa_socket_28_0 zygote_socket_28_0 gps_control_28_0 pdx_display_dir_28_0 pdx_performance_dir_28_0 pdx_bufferhub_dir_28_0 pdx_display_client_endpoint_socket_28_0 pdx_display_manager_endpoint_socket_28_0 pdx_display_screenshot_endpoint_socket_28_0 pdx_display_vsync_endpoint_socket_28_0 pdx_performance_client_endpoint_socket_28_0 pdx_bufferhub_client_endpoint_socket_28_0 file_contexts_file_28_0 mac_perms_file_28_0 property_contexts_file_28_0 seapp_contexts_file_28_0 sepolicy_file_28_0 service_contexts_file_28_0 nonplat_service_contexts_file_28_0 hwservice_contexts_file_28_0 vndservice_contexts_file_28_0 audiohal_data_file_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0 hostapd_data_file wpa_data_file hal_audio_default_exec hal_audio_default_tmpfs hal_audiocontrol_default_exec hal_audiocontrol_default_tmpfs hal_authsecret_default_exec hal_authsecret_default_tmpfs hal_bluetooth_default_exec hal_bluetooth_default_tmpfs hal_bootctl_default_exec hal_bootctl_default_tmpfs hal_broadcastradio_default_exec hal_broadcastradio_default_tmpfs hal_camera_default_exec hal_camera_default_tmpfs hal_cas_default_exec hal_cas_default_tmpfs hal_configstore_default_exec hal_configstore_default_tmpfs hal_confirmationui_default_exec hal_confirmationui_default_tmpfs hal_contexthub_default_exec hal_contexthub_default_tmpfs hal_drm_default_exec hal_drm_default_tmpfs hal_dumpstate_default_exec hal_dumpstate_default_tmpfs hal_evs_default_exec hal_evs_default_tmpfs hal_fingerprint_default_exec hal_fingerprint_default_tmpfs hal_gatekeeper_default_exec hal_gatekeeper_default_tmpfs hal_gnss_default_exec hal_gnss_default_tmpfs hal_graphics_allocator_default_exec hal_graphics_allocator_default_tmpfs hal_graphics_composer_default_exec hal_graphics_composer_default_tmpfs hal_health_default_exec hal_health_default_tmpfs hal_ir_default_exec hal_ir_default_tmpfs hal_keymaster_default_exec hal_keymaster_default_tmpfs hal_light_default_exec hal_light_default_tmpfs hal_lowpan_default_exec hal_lowpan_default_tmpfs hal_memtrack_default_exec hal_memtrack_default_tmpfs hal_nfc_default_exec hal_nfc_default_tmpfs mediacodec_tmpfs hal_power_default_exec hal_power_default_tmpfs hal_radio_config_default_exec hal_radio_config_default_tmpfs hal_radio_default_exec hal_radio_default_tmpfs hal_secure_element_default_exec hal_secure_element_default_tmpfs hal_sensors_default_exec hal_sensors_default_tmpfs hal_tetheroffload_default_exec hal_tetheroffload_default_tmpfs hal_thermal_default_exec hal_thermal_default_tmpfs hal_tv_cec_default_exec hal_tv_cec_default_tmpfs hal_tv_input_default_exec hal_tv_input_default_tmpfs hal_usb_default_exec hal_usb_default_tmpfs hal_vehicle_default_exec hal_vehicle_default_tmpfs hal_vibrator_default_exec hal_vibrator_default_tmpfs hal_vr_default_exec hal_vr_default_tmpfs hal_wifi_default_exec hal_wifi_default_tmpfs hal_wifi_hostapd_default_exec hal_wifi_hostapd_default_tmpfs hal_wifi_offload_default_exec hal_wifi_offload_default_tmpfs hal_wifi_supplicant_default_exec hal_wifi_supplicant_default_tmpfs rild_exec rild_tmpfs tee_exec tee_tmpfs vndservicemanager_exec vndservicemanager_tmpfs createns_exec createns_tmpfs dhcpclient_exec dhcpclient_tmpfs dhcpserver_exec dhcpserver_tmpfs execns_exec execns_tmpfs varrun_file mediadrm_vendor_data_file goldfish_setup_exec goldfish_setup_tmpfs hal_drm_clearkey_exec hal_drm_clearkey_tmpfs hal_drm_widevine_exec hal_drm_widevine_tmpfs hostapd_nohidl_exec hostapd_nohidl_tmpfs ipv6proxy_exec ipv6proxy_tmpfs qemu_props_exec qemu_props_tmpfs persist_file))
 (typeattributeset exec_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 logcat_exec_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0 hal_audio_default_exec hal_audiocontrol_default_exec hal_authsecret_default_exec hal_bluetooth_default_exec hal_bootctl_default_exec hal_broadcastradio_default_exec hal_camera_default_exec hal_cas_default_exec hal_configstore_default_exec hal_confirmationui_default_exec hal_contexthub_default_exec hal_drm_default_exec hal_dumpstate_default_exec hal_evs_default_exec hal_fingerprint_default_exec hal_gatekeeper_default_exec hal_gnss_default_exec hal_graphics_allocator_default_exec hal_graphics_composer_default_exec hal_health_default_exec hal_ir_default_exec hal_keymaster_default_exec hal_light_default_exec hal_lowpan_default_exec hal_memtrack_default_exec hal_nfc_default_exec hal_power_default_exec hal_radio_config_default_exec hal_radio_default_exec hal_secure_element_default_exec hal_sensors_default_exec hal_tetheroffload_default_exec hal_thermal_default_exec hal_tv_cec_default_exec hal_tv_input_default_exec hal_usb_default_exec hal_vehicle_default_exec hal_vibrator_default_exec hal_vr_default_exec hal_wifi_default_exec hal_wifi_hostapd_default_exec hal_wifi_offload_default_exec hal_wifi_supplicant_default_exec rild_exec tee_exec vndservicemanager_exec createns_exec dhcpclient_exec dhcpserver_exec execns_exec goldfish_setup_exec hal_drm_clearkey_exec hal_drm_widevine_exec hostapd_nohidl_exec ipv6proxy_exec qemu_props_exec))
 (typeattributeset data_file_type (system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 bluetooth_socket_28_0 misc_logd_file_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 wpa_socket_28_0 audiohal_data_file_28_0 hostapd_data_file wpa_data_file varrun_file mediadrm_vendor_data_file))
 (typeattributeset vendor_file_type (vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 mediacodec_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 hal_audio_default_exec hal_audiocontrol_default_exec hal_authsecret_default_exec hal_bluetooth_default_exec hal_bootctl_default_exec hal_broadcastradio_default_exec hal_camera_default_exec hal_cas_default_exec hal_configstore_default_exec hal_confirmationui_default_exec hal_contexthub_default_exec hal_drm_default_exec hal_dumpstate_default_exec hal_evs_default_exec hal_fingerprint_default_exec hal_gatekeeper_default_exec hal_gnss_default_exec hal_graphics_allocator_default_exec hal_graphics_composer_default_exec hal_health_default_exec hal_ir_default_exec hal_keymaster_default_exec hal_light_default_exec hal_lowpan_default_exec hal_memtrack_default_exec hal_nfc_default_exec hal_power_default_exec hal_radio_config_default_exec hal_radio_default_exec hal_secure_element_default_exec hal_sensors_default_exec hal_tetheroffload_default_exec hal_thermal_default_exec hal_tv_cec_default_exec hal_tv_input_default_exec hal_usb_default_exec hal_vehicle_default_exec hal_vibrator_default_exec hal_vr_default_exec hal_wifi_default_exec hal_wifi_hostapd_default_exec hal_wifi_offload_default_exec hal_wifi_supplicant_default_exec rild_exec tee_exec vndservicemanager_exec createns_exec dhcpclient_exec dhcpserver_exec execns_exec goldfish_setup_exec hal_drm_clearkey_exec hal_drm_widevine_exec hostapd_nohidl_exec ipv6proxy_exec qemu_props_exec))
 (typeattributeset sysfs_type (sysfs_usermodehelper_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 sysfs_writable))
 (typeattributeset property_type (audio_prop_28_0 boottime_prop_28_0 bluetooth_a2dp_offload_prop_28_0 bluetooth_prop_28_0 bootloader_boot_reason_prop_28_0 config_prop_28_0 cppreopt_prop_28_0 ctl_bootanim_prop_28_0 ctl_bugreport_prop_28_0 ctl_console_prop_28_0 ctl_default_prop_28_0 ctl_dumpstate_prop_28_0 ctl_fuse_prop_28_0 ctl_interface_restart_prop_28_0 ctl_interface_start_prop_28_0 ctl_interface_stop_prop_28_0 ctl_mdnsd_prop_28_0 ctl_restart_prop_28_0 ctl_rildaemon_prop_28_0 ctl_sigstop_prop_28_0 ctl_start_prop_28_0 ctl_stop_prop_28_0 dalvik_prop_28_0 debuggerd_prop_28_0 debug_prop_28_0 default_prop_28_0 device_logging_prop_28_0 dhcp_prop_28_0 dumpstate_options_prop_28_0 dumpstate_prop_28_0 exported_secure_prop_28_0 ffs_prop_28_0 fingerprint_prop_28_0 firstboot_prop_28_0 hwservicemanager_prop_28_0 last_boot_reason_prop_28_0 logd_prop_28_0 logpersistd_logging_prop_28_0 log_prop_28_0 log_tag_prop_28_0 lowpan_prop_28_0 mmc_prop_28_0 net_dns_prop_28_0 net_radio_prop_28_0 netd_stable_secret_prop_28_0 nfc_prop_28_0 overlay_prop_28_0 pan_result_prop_28_0 persist_debug_prop_28_0 persistent_properties_ready_prop_28_0 pm_prop_28_0 powerctl_prop_28_0 radio_prop_28_0 restorecon_prop_28_0 safemode_prop_28_0 serialno_prop_28_0 shell_prop_28_0 system_boot_reason_prop_28_0 system_prop_28_0 system_radio_prop_28_0 test_boot_reason_prop_28_0 traced_enabled_prop_28_0 vold_prop_28_0 wifi_log_prop_28_0 wifi_prop_28_0 vendor_security_patch_level_prop_28_0 exported_audio_prop_28_0 exported_bluetooth_prop_28_0 exported_config_prop_28_0 exported_dalvik_prop_28_0 exported_default_prop_28_0 exported_dumpstate_prop_28_0 exported_ffs_prop_28_0 exported_fingerprint_prop_28_0 exported_overlay_prop_28_0 exported_pm_prop_28_0 exported_radio_prop_28_0 exported_system_prop_28_0 exported_system_radio_prop_28_0 exported_vold_prop_28_0 exported_wifi_prop_28_0 exported2_config_prop_28_0 exported2_default_prop_28_0 exported2_radio_prop_28_0 exported2_system_prop_28_0 exported2_vold_prop_28_0 exported3_default_prop_28_0 exported3_radio_prop_28_0 exported3_system_prop_28_0 vendor_default_prop_28_0 qemu_prop qemu_cmdline radio_noril_prop net_eth0_prop net_share_prop))
 (typeattributeset mlstrustedobject (alarm_device_28_0 ashmem_device_28_0 binder_device_28_0 hwbinder_device_28_0 pmsg_device_28_0 gpu_device_28_0 mtp_device_28_0 ptmx_device_28_0 null_device_28_0 random_device_28_0 owntty_device_28_0 zero_device_28_0 fuse_device_28_0 ion_device_28_0 tun_device_28_0 usbaccessory_device_28_0 usb_device_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 selinuxfs_28_0 cgroup_28_0 sysfs_28_0 sysfs_bluetooth_writable_28_0 sysfs_kernel_notes_28_0 sysfs_nfc_power_writable_28_0 inotify_28_0 devpts_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 functionfs_28_0 anr_data_file_28_0 tombstone_data_file_28_0 apk_tmp_file_28_0 apk_private_tmp_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 shell_data_file_28_0 heapdump_data_file_28_0 ringtone_file_28_0 media_rw_data_file_28_0 radio_data_file_28_0 trace_data_file_28_0 perfprofd_data_file_28_0 method_trace_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 asec_apk_file_28_0 backup_data_file_28_0 app_fuse_file_28_0 dnsproxyd_socket_28_0 fwmarkd_socket_28_0 logd_socket_28_0 logdr_socket_28_0 logdw_socket_28_0 mdnsd_socket_28_0 property_socket_28_0 system_ndebug_socket_28_0 tombstoned_crash_socket_28_0 tombstoned_java_trace_socket_28_0 traced_producer_socket_28_0 pdx_display_client_endpoint_socket_28_0 pdx_display_manager_endpoint_socket_28_0 pdx_display_screenshot_endpoint_socket_28_0 pdx_display_vsync_endpoint_socket_28_0 pdx_performance_client_endpoint_socket_28_0 pdx_bufferhub_client_endpoint_socket_28_0 qemu_device sysfs_writable varrun_file))
 (typeattributeset netdomain (clatd_28_0 dhcp_28_0 dnsmasq_28_0 drmserver_28_0 dumpstate_28_0 mediadrmserver_28_0 mediaserver_28_0 mtp_28_0 netd_28_0 ppp_28_0 racoon_28_0 radio_28_0 shell_28_0 su_28_0 update_engine_28_0 wpantund_28_0 hal_wifi_hostapd_default hal_wifi_supplicant_default rild dhcpclient dhcpserver hostapd_nohidl ipv6proxy))
 (typeattributeset data_between_core_and_vendor_violators (hal_fingerprint_default))
diff --git a/prebuilts/api/29.0/plat_pub_versioned.cil b/prebuilts/api/29.0/plat_pub_versioned.cil
index b80abeb36df34f9cae0cd2e23098c97c5d40781a..4e10b6df3d36afe93f480a3cfcedb11bc502e735 100644
--- a/prebuilts/api/29.0/plat_pub_versioned.cil
+++ b/prebuilts/api/29.0/plat_pub_versioned.cil
@@ -580,20 +580,21 @@
 (type print_service)
 (type priv_app)
 (type privapp_data_file)
 (type proc)
 (type proc_abi)
 (type proc_asound)
 (type proc_bluetooth_writable)
 (type proc_buddyinfo)
 (type proc_cmdline)
 (type proc_cpuinfo)
+(type proc_deny_new_usb)
 (type proc_dirty)
 (type proc_diskstats)
 (type proc_drop_caches)
 (type proc_extra_free_kbytes)
 (type proc_filesystems)
 (type proc_fs_verity)
 (type proc_hostname)
 (type proc_hung_task)
 (type proc_interrupts)
 (type proc_iomem)
@@ -1783,20 +1784,21 @@
 (typeattribute print_service_29_0)
 (typeattribute priv_app_29_0)
 (typeattribute privapp_data_file_29_0)
 (typeattribute proc_29_0)
 (typeattribute proc_abi_29_0)
 (typeattribute proc_asound_29_0)
 (typeattribute proc_bluetooth_writable_29_0)
 (typeattribute proc_buddyinfo_29_0)
 (typeattribute proc_cmdline_29_0)
 (typeattribute proc_cpuinfo_29_0)
+(typeattribute proc_deny_new_usb_29_0)
 (typeattribute proc_dirty_29_0)
 (typeattribute proc_diskstats_29_0)
 (typeattribute proc_drop_caches_29_0)
 (typeattribute proc_extra_free_kbytes_29_0)
 (typeattribute proc_filesystems_29_0)
 (typeattribute proc_fs_verity_29_0)
 (typeattribute proc_hostname_29_0)
 (typeattribute proc_hung_task_29_0)
 (typeattribute proc_interrupts_29_0)
 (typeattribute proc_iomem_29_0)
diff --git a/prebuilts/api/30.0/private/compat/26.0/26.0.cil b/prebuilts/api/30.0/private/compat/26.0/26.0.cil
index 498bca5a77136ff26fd77d2ab221c1dc51407ca5..0a2d8eb9ac1d7eb532b4b81a43a19284f1818e67 100644
--- a/prebuilts/api/30.0/private/compat/26.0/26.0.cil
+++ b/prebuilts/api/30.0/private/compat/26.0/26.0.cil
@@ -461,20 +461,21 @@
 (typeattributeset preopt2cachename_26_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_26_0 (preopt2cachename_exec))
 (typeattributeset print_service_26_0 (print_service))
 (typeattributeset priv_app_26_0 (mediaprovider priv_app))
 (typeattributeset proc_26_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/prebuilts/api/30.0/private/compat/27.0/27.0.cil b/prebuilts/api/30.0/private/compat/27.0/27.0.cil
index 0d883c0c74c9d8a8bee052000d270b9d1e45a8cb..c8f209a9b23c9024cd2208ec25e30ba299d8ba03 100644
--- a/prebuilts/api/30.0/private/compat/27.0/27.0.cil
+++ b/prebuilts/api/30.0/private/compat/27.0/27.0.cil
@@ -1175,20 +1175,21 @@
 (typeattributeset preopt2cachename_27_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_27_0 (preopt2cachename_exec))
 (typeattributeset print_service_27_0 (print_service))
 (typeattributeset priv_app_27_0 (priv_app))
 (typeattributeset proc_27_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/prebuilts/api/30.0/private/compat/28.0/28.0.cil b/prebuilts/api/30.0/private/compat/28.0/28.0.cil
index 321e9387ed3817dfc61136de9c807a49fffbd785..ba3263e6b0ed1aef4ea3792a28b2bd9dd33016c8 100644
--- a/prebuilts/api/30.0/private/compat/28.0/28.0.cil
+++ b/prebuilts/api/30.0/private/compat/28.0/28.0.cil
@@ -536,20 +536,21 @@
 (expandtypeattribute (preopt2cachename_exec_28_0) true)
 (expandtypeattribute (print_service_28_0) true)
 (expandtypeattribute (priv_app_28_0) true)
 (expandtypeattribute (proc_28_0) true)
 (expandtypeattribute (proc_abi_28_0) true)
 (expandtypeattribute (proc_asound_28_0) true)
 (expandtypeattribute (proc_bluetooth_writable_28_0) true)
 (expandtypeattribute (proc_buddyinfo_28_0) true)
 (expandtypeattribute (proc_cmdline_28_0) true)
 (expandtypeattribute (proc_cpuinfo_28_0) true)
+(expandtypeattribute (proc_deny_new_usb_28_0) true)
 (expandtypeattribute (proc_dirty_28_0) true)
 (expandtypeattribute (proc_diskstats_28_0) true)
 (expandtypeattribute (proc_drop_caches_28_0) true)
 (expandtypeattribute (processinfo_service_28_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_28_0) true)
 (expandtypeattribute (proc_filesystems_28_0) true)
 (expandtypeattribute (proc_hostname_28_0) true)
 (expandtypeattribute (proc_hung_task_28_0) true)
 (expandtypeattribute (proc_interrupts_28_0) true)
 (expandtypeattribute (proc_iomem_28_0) true)
@@ -1385,20 +1386,21 @@
     proc_pressure_cpu
     proc_pressure_io
     proc_pressure_mem
     proc_slabinfo))
 (typeattributeset proc_abi_28_0 (proc_abi))
 (typeattributeset proc_asound_28_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_28_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_28_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_28_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_28_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_28_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_28_0 (proc_dirty))
 (typeattributeset proc_diskstats_28_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_28_0 (proc_drop_caches))
 (typeattributeset processinfo_service_28_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_28_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_28_0 (proc_filesystems))
 (typeattributeset proc_hostname_28_0 (proc_hostname))
 (typeattributeset proc_hung_task_28_0 (proc_hung_task))
 (typeattributeset proc_interrupts_28_0 (proc_interrupts))
 (typeattributeset proc_iomem_28_0 (proc_iomem))
diff --git a/prebuilts/api/30.0/private/compat/29.0/29.0.cil b/prebuilts/api/30.0/private/compat/29.0/29.0.cil
index 5231498e18aa4735e3342650ca578812b90492a5..03f98bbf9a7f04d042e1b4bd8e9d4132c821df2e 100644
--- a/prebuilts/api/30.0/private/compat/29.0/29.0.cil
+++ b/prebuilts/api/30.0/private/compat/29.0/29.0.cil
@@ -587,20 +587,21 @@
 (expandtypeattribute (print_service_29_0) true)
 (expandtypeattribute (priv_app_29_0) true)
 (expandtypeattribute (privapp_data_file_29_0) true)
 (expandtypeattribute (proc_29_0) true)
 (expandtypeattribute (proc_abi_29_0) true)
 (expandtypeattribute (proc_asound_29_0) true)
 (expandtypeattribute (proc_bluetooth_writable_29_0) true)
 (expandtypeattribute (proc_buddyinfo_29_0) true)
 (expandtypeattribute (proc_cmdline_29_0) true)
 (expandtypeattribute (proc_cpuinfo_29_0) true)
+(expandtypeattribute (proc_deny_new_usb_29_0) true)
 (expandtypeattribute (proc_dirty_29_0) true)
 (expandtypeattribute (proc_diskstats_29_0) true)
 (expandtypeattribute (proc_drop_caches_29_0) true)
 (expandtypeattribute (processinfo_service_29_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_29_0) true)
 (expandtypeattribute (proc_filesystems_29_0) true)
 (expandtypeattribute (proc_fs_verity_29_0) true)
 (expandtypeattribute (proc_hostname_29_0) true)
 (expandtypeattribute (proc_hung_task_29_0) true)
 (expandtypeattribute (proc_interrupts_29_0) true)
@@ -1566,20 +1567,21 @@
 (typeattributeset proc_29_0
   ( proc
     proc_kpageflags
     proc_lowmemorykiller))
 (typeattributeset proc_abi_29_0 (proc_abi))
 (typeattributeset proc_asound_29_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_29_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_29_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_29_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_29_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_29_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_29_0 (proc_dirty))
 (typeattributeset proc_diskstats_29_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_29_0 (proc_drop_caches))
 (typeattributeset processinfo_service_29_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_29_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_29_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_29_0 (proc_fs_verity))
 (typeattributeset proc_hostname_29_0 (proc_hostname))
 (typeattributeset proc_hung_task_29_0 (proc_hung_task))
 (typeattributeset proc_interrupts_29_0 (proc_interrupts))
diff --git a/prebuilts/api/30.0/private/genfs_contexts b/prebuilts/api/30.0/private/genfs_contexts
index 89232bc01ece0b0309abe0bd325a8b56f8eb0aaf..fef5641be817e3788facbcdc520a067d6a009cbc 100644
--- a/prebuilts/api/30.0/private/genfs_contexts
+++ b/prebuilts/api/30.0/private/genfs_contexts
@@ -35,20 +35,21 @@ genfscon proc /swaps u:object_r:proc_swaps:s0
 genfscon proc /sysrq-trigger u:object_r:proc_sysrq:s0
 genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
+genfscon proc /sys/kernel/deny_new_usb u:object_r:proc_deny_new_usb:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/hung_task_ u:object_r:proc_hung_task:s0
 genfscon proc /sys/kernel/kptr_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/modprobe u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/modules_disabled u:object_r:proc_security:s0
 genfscon proc /sys/kernel/panic_on_oops u:object_r:proc_panic:s0
 genfscon proc /sys/kernel/perf_event_max_sample_rate u:object_r:proc_perf:s0
diff --git a/prebuilts/api/30.0/private/property_contexts b/prebuilts/api/30.0/private/property_contexts
index fcad29e2afc0b868574870d1a85b98e5751a67a4..4bce9ecbd97d4f22574aaceccc483359a70ecd8c 100644
--- a/prebuilts/api/30.0/private/property_contexts
+++ b/prebuilts/api/30.0/private/property_contexts
@@ -91,20 +91,22 @@ ro.bt.                  u:object_r:bluetooth_prop:s0
 ro.boot.bootreason      u:object_r:bootloader_boot_reason_prop:s0
 persist.sys.boot.reason u:object_r:last_boot_reason_prop:s0
 sys.boot.reason         u:object_r:system_boot_reason_prop:s0
 sys.boot.reason.last    u:object_r:last_boot_reason_prop:s0
 pm.                     u:object_r:pm_prop:s0
 test.sys.boot.reason    u:object_r:test_boot_reason_prop:s0
 test.userspace_reboot.requested u:object_r:userspace_reboot_test_prop:s0
 sys.lmk.                u:object_r:system_lmk_prop:s0
 sys.trace.              u:object_r:system_trace_prop:s0
 
+security.deny_new_usb   u:object_r:system_prop:s0
+
 # Fastbootd protocol control property
 fastbootd.protocol    u:object_r:fastbootd_protocol_prop:s0 exact enum usb tcp
 
 # Boolean property set by system server upon boot indicating
 # if device is fully owned by organization instead of being
 # a personal device.
 ro.organization_owned   u:object_r:device_logging_prop:s0
 
 # selinux non-persistent properties
 selinux.restorecon_recursive   u:object_r:restorecon_prop:s0
diff --git a/prebuilts/api/30.0/public/file.te b/prebuilts/api/30.0/public/file.te
index 91257e237614f98025a821d9d70799f3a4f7ef9b..5750df1c437568a7e776d853501f02c04de18ecd 100644
--- a/prebuilts/api/30.0/public/file.te
+++ b/prebuilts/api/30.0/public/file.te
@@ -17,20 +17,21 @@ type proc_kpageflags, fs_type, proc_type;
 type usermodehelper, fs_type, proc_type;
 type sysfs_usermodehelper, fs_type, sysfs_type;
 type proc_qtaguid_ctrl, fs_type, mlstrustedobject, proc_type;
 type proc_qtaguid_stat, fs_type, mlstrustedobject, proc_type;
 type proc_bluetooth_writable, fs_type, proc_type;
 type proc_abi, fs_type, proc_type;
 type proc_asound, fs_type, proc_type;
 type proc_buddyinfo, fs_type, proc_type;
 type proc_cmdline, fs_type, proc_type;
 type proc_cpuinfo, fs_type, proc_type;
+type proc_deny_new_usb, fs_type, proc_type;
 type proc_dirty, fs_type, proc_type;
 type proc_diskstats, fs_type, proc_type;
 type proc_extra_free_kbytes, fs_type, proc_type;
 type proc_filesystems, fs_type, proc_type;
 type proc_fs_verity, fs_type, proc_type;
 type proc_hostname, fs_type, proc_type;
 type proc_hung_task, fs_type, proc_type;
 type proc_interrupts, fs_type, proc_type;
 type proc_iomem, fs_type, proc_type;
 type proc_keys, fs_type, proc_type;
diff --git a/prebuilts/api/30.0/public/init.te b/prebuilts/api/30.0/public/init.te
index cc51a2b72d88ef50dda08c4bb72adba6d232308a..97f93ec7a5e5250e486c39b9cda562e3cbd866d5 100644
--- a/prebuilts/api/30.0/public/init.te
+++ b/prebuilts/api/30.0/public/init.te
@@ -344,20 +344,21 @@ allow init {
   proc_diskstats
   proc_kmsg # Open /proc/kmsg for logd service.
   proc_meminfo
   proc_stat # Read /proc/stat for bootchart.
   proc_uptime
   proc_version
 }:file r_file_perms;
 
 allow init {
   proc_abi
+  proc_deny_new_usb
   proc_dirty
   proc_hostname
   proc_hung_task
   proc_extra_free_kbytes
   proc_net_type
   proc_max_map_count
   proc_min_free_order_shift
   proc_overcommit_memory      # /proc/sys/vm/overcommit_memory
   proc_panic
   proc_page_cluster
diff --git a/private/compat/26.0/26.0.cil b/private/compat/26.0/26.0.cil
index 498bca5a77136ff26fd77d2ab221c1dc51407ca5..0a2d8eb9ac1d7eb532b4b81a43a19284f1818e67 100644
--- a/private/compat/26.0/26.0.cil
+++ b/private/compat/26.0/26.0.cil
@@ -461,20 +461,21 @@
 (typeattributeset preopt2cachename_26_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_26_0 (preopt2cachename_exec))
 (typeattributeset print_service_26_0 (print_service))
 (typeattributeset priv_app_26_0 (mediaprovider priv_app))
 (typeattributeset proc_26_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/private/compat/27.0/27.0.cil b/private/compat/27.0/27.0.cil
index 0d883c0c74c9d8a8bee052000d270b9d1e45a8cb..c8f209a9b23c9024cd2208ec25e30ba299d8ba03 100644
--- a/private/compat/27.0/27.0.cil
+++ b/private/compat/27.0/27.0.cil
@@ -1175,20 +1175,21 @@
 (typeattributeset preopt2cachename_27_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_27_0 (preopt2cachename_exec))
 (typeattributeset print_service_27_0 (print_service))
 (typeattributeset priv_app_27_0 (priv_app))
 (typeattributeset proc_27_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/private/compat/28.0/28.0.cil b/private/compat/28.0/28.0.cil
index 321e9387ed3817dfc61136de9c807a49fffbd785..ba3263e6b0ed1aef4ea3792a28b2bd9dd33016c8 100644
--- a/private/compat/28.0/28.0.cil
+++ b/private/compat/28.0/28.0.cil
@@ -536,20 +536,21 @@
 (expandtypeattribute (preopt2cachename_exec_28_0) true)
 (expandtypeattribute (print_service_28_0) true)
 (expandtypeattribute (priv_app_28_0) true)
 (expandtypeattribute (proc_28_0) true)
 (expandtypeattribute (proc_abi_28_0) true)
 (expandtypeattribute (proc_asound_28_0) true)
 (expandtypeattribute (proc_bluetooth_writable_28_0) true)
 (expandtypeattribute (proc_buddyinfo_28_0) true)
 (expandtypeattribute (proc_cmdline_28_0) true)
 (expandtypeattribute (proc_cpuinfo_28_0) true)
+(expandtypeattribute (proc_deny_new_usb_28_0) true)
 (expandtypeattribute (proc_dirty_28_0) true)
 (expandtypeattribute (proc_diskstats_28_0) true)
 (expandtypeattribute (proc_drop_caches_28_0) true)
 (expandtypeattribute (processinfo_service_28_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_28_0) true)
 (expandtypeattribute (proc_filesystems_28_0) true)
 (expandtypeattribute (proc_hostname_28_0) true)
 (expandtypeattribute (proc_hung_task_28_0) true)
 (expandtypeattribute (proc_interrupts_28_0) true)
 (expandtypeattribute (proc_iomem_28_0) true)
@@ -1385,20 +1386,21 @@
     proc_pressure_cpu
     proc_pressure_io
     proc_pressure_mem
     proc_slabinfo))
 (typeattributeset proc_abi_28_0 (proc_abi))
 (typeattributeset proc_asound_28_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_28_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_28_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_28_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_28_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_28_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_28_0 (proc_dirty))
 (typeattributeset proc_diskstats_28_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_28_0 (proc_drop_caches))
 (typeattributeset processinfo_service_28_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_28_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_28_0 (proc_filesystems))
 (typeattributeset proc_hostname_28_0 (proc_hostname))
 (typeattributeset proc_hung_task_28_0 (proc_hung_task))
 (typeattributeset proc_interrupts_28_0 (proc_interrupts))
 (typeattributeset proc_iomem_28_0 (proc_iomem))
diff --git a/private/compat/29.0/29.0.cil b/private/compat/29.0/29.0.cil
index 5231498e18aa4735e3342650ca578812b90492a5..03f98bbf9a7f04d042e1b4bd8e9d4132c821df2e 100644
--- a/private/compat/29.0/29.0.cil
+++ b/private/compat/29.0/29.0.cil
@@ -587,20 +587,21 @@
 (expandtypeattribute (print_service_29_0) true)
 (expandtypeattribute (priv_app_29_0) true)
 (expandtypeattribute (privapp_data_file_29_0) true)
 (expandtypeattribute (proc_29_0) true)
 (expandtypeattribute (proc_abi_29_0) true)
 (expandtypeattribute (proc_asound_29_0) true)
 (expandtypeattribute (proc_bluetooth_writable_29_0) true)
 (expandtypeattribute (proc_buddyinfo_29_0) true)
 (expandtypeattribute (proc_cmdline_29_0) true)
 (expandtypeattribute (proc_cpuinfo_29_0) true)
+(expandtypeattribute (proc_deny_new_usb_29_0) true)
 (expandtypeattribute (proc_dirty_29_0) true)
 (expandtypeattribute (proc_diskstats_29_0) true)
 (expandtypeattribute (proc_drop_caches_29_0) true)
 (expandtypeattribute (processinfo_service_29_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_29_0) true)
 (expandtypeattribute (proc_filesystems_29_0) true)
 (expandtypeattribute (proc_fs_verity_29_0) true)
 (expandtypeattribute (proc_hostname_29_0) true)
 (expandtypeattribute (proc_hung_task_29_0) true)
 (expandtypeattribute (proc_interrupts_29_0) true)
@@ -1566,20 +1567,21 @@
 (typeattributeset proc_29_0
   ( proc
     proc_kpageflags
     proc_lowmemorykiller))
 (typeattributeset proc_abi_29_0 (proc_abi))
 (typeattributeset proc_asound_29_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_29_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_29_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_29_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_29_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_29_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_29_0 (proc_dirty))
 (typeattributeset proc_diskstats_29_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_29_0 (proc_drop_caches))
 (typeattributeset processinfo_service_29_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_29_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_29_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_29_0 (proc_fs_verity))
 (typeattributeset proc_hostname_29_0 (proc_hostname))
 (typeattributeset proc_hung_task_29_0 (proc_hung_task))
 (typeattributeset proc_interrupts_29_0 (proc_interrupts))
diff --git a/private/genfs_contexts b/private/genfs_contexts
index 89232bc01ece0b0309abe0bd325a8b56f8eb0aaf..fef5641be817e3788facbcdc520a067d6a009cbc 100644
--- a/private/genfs_contexts
+++ b/private/genfs_contexts
@@ -35,20 +35,21 @@ genfscon proc /swaps u:object_r:proc_swaps:s0
 genfscon proc /sysrq-trigger u:object_r:proc_sysrq:s0
 genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
+genfscon proc /sys/kernel/deny_new_usb u:object_r:proc_deny_new_usb:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/hung_task_ u:object_r:proc_hung_task:s0
 genfscon proc /sys/kernel/kptr_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/modprobe u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/modules_disabled u:object_r:proc_security:s0
 genfscon proc /sys/kernel/panic_on_oops u:object_r:proc_panic:s0
 genfscon proc /sys/kernel/perf_event_max_sample_rate u:object_r:proc_perf:s0
diff --git a/private/property_contexts b/private/property_contexts
index fcad29e2afc0b868574870d1a85b98e5751a67a4..4bce9ecbd97d4f22574aaceccc483359a70ecd8c 100644
--- a/private/property_contexts
+++ b/private/property_contexts
@@ -91,20 +91,22 @@ ro.bt.                  u:object_r:bluetooth_prop:s0
 ro.boot.bootreason      u:object_r:bootloader_boot_reason_prop:s0
 persist.sys.boot.reason u:object_r:last_boot_reason_prop:s0
 sys.boot.reason         u:object_r:system_boot_reason_prop:s0
 sys.boot.reason.last    u:object_r:last_boot_reason_prop:s0
 pm.                     u:object_r:pm_prop:s0
 test.sys.boot.reason    u:object_r:test_boot_reason_prop:s0
 test.userspace_reboot.requested u:object_r:userspace_reboot_test_prop:s0
 sys.lmk.                u:object_r:system_lmk_prop:s0
 sys.trace.              u:object_r:system_trace_prop:s0
 
+security.deny_new_usb   u:object_r:system_prop:s0
+
 # Fastbootd protocol control property
 fastbootd.protocol    u:object_r:fastbootd_protocol_prop:s0 exact enum usb tcp
 
 # Boolean property set by system server upon boot indicating
 # if device is fully owned by organization instead of being
 # a personal device.
 ro.organization_owned   u:object_r:device_logging_prop:s0
 
 # selinux non-persistent properties
 selinux.restorecon_recursive   u:object_r:restorecon_prop:s0
diff --git a/public/file.te b/public/file.te
index 91257e237614f98025a821d9d70799f3a4f7ef9b..5750df1c437568a7e776d853501f02c04de18ecd 100644
--- a/public/file.te
+++ b/public/file.te
@@ -17,20 +17,21 @@ type proc_kpageflags, fs_type, proc_type;
 type usermodehelper, fs_type, proc_type;
 type sysfs_usermodehelper, fs_type, sysfs_type;
 type proc_qtaguid_ctrl, fs_type, mlstrustedobject, proc_type;
 type proc_qtaguid_stat, fs_type, mlstrustedobject, proc_type;
 type proc_bluetooth_writable, fs_type, proc_type;
 type proc_abi, fs_type, proc_type;
 type proc_asound, fs_type, proc_type;
 type proc_buddyinfo, fs_type, proc_type;
 type proc_cmdline, fs_type, proc_type;
 type proc_cpuinfo, fs_type, proc_type;
+type proc_deny_new_usb, fs_type, proc_type;
 type proc_dirty, fs_type, proc_type;
 type proc_diskstats, fs_type, proc_type;
 type proc_extra_free_kbytes, fs_type, proc_type;
 type proc_filesystems, fs_type, proc_type;
 type proc_fs_verity, fs_type, proc_type;
 type proc_hostname, fs_type, proc_type;
 type proc_hung_task, fs_type, proc_type;
 type proc_interrupts, fs_type, proc_type;
 type proc_iomem, fs_type, proc_type;
 type proc_keys, fs_type, proc_type;
diff --git a/public/init.te b/public/init.te
index cc51a2b72d88ef50dda08c4bb72adba6d232308a..97f93ec7a5e5250e486c39b9cda562e3cbd866d5 100644
--- a/public/init.te
+++ b/public/init.te
@@ -344,20 +344,21 @@ allow init {
   proc_diskstats
   proc_kmsg # Open /proc/kmsg for logd service.
   proc_meminfo
   proc_stat # Read /proc/stat for bootchart.
   proc_uptime
   proc_version
 }:file r_file_perms;
 
 allow init {
   proc_abi
+  proc_deny_new_usb
   proc_dirty
   proc_hostname
   proc_hung_task
   proc_extra_free_kbytes
   proc_net_type
   proc_max_map_count
   proc_min_free_order_shift
   proc_overcommit_memory      # /proc/sys/vm/overcommit_memory
   proc_panic
   proc_page_cluster

commit 246e60786bb691eb9cf691a0f3d2cc2443c6b79b
Author: inthewaves <inthewaves@pm.me>
Date:   Tue 2020-09-15 22:44:40-0700

    allow system to use persist.keyguard.camera
---
 prebuilts/api/30.0/private/property_contexts | 1 +
 private/property_contexts                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/30.0/private/property_contexts b/prebuilts/api/30.0/private/property_contexts
index 4bce9ecbd97d4f22574aaceccc483359a70ecd8c..556b67536481e75f2118454daa24165aa5eb183b 100644
--- a/prebuilts/api/30.0/private/property_contexts
+++ b/prebuilts/api/30.0/private/property_contexts
@@ -51,20 +51,21 @@ service.adb.root        u:object_r:shell_prop:s0
 service.adb.tcp.port    u:object_r:shell_prop:s0
 sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
+persist.keyguard.camera u:object_r:system_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0
 persist.logd.security   u:object_r:device_logging_prop:s0
 persist.logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 persist.log.tag         u:object_r:log_tag_prop:s0
 persist.mmc.            u:object_r:mmc_prop:s0
 persist.netd.stable_secret      u:object_r:netd_stable_secret_prop:s0
 persist.pm.mock-upgrade u:object_r:mock_ota_prop:s0
 persist.sys.            u:object_r:system_prop:s0
diff --git a/private/property_contexts b/private/property_contexts
index 4bce9ecbd97d4f22574aaceccc483359a70ecd8c..556b67536481e75f2118454daa24165aa5eb183b 100644
--- a/private/property_contexts
+++ b/private/property_contexts
@@ -51,20 +51,21 @@ service.adb.root        u:object_r:shell_prop:s0
 service.adb.tcp.port    u:object_r:shell_prop:s0
 sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
+persist.keyguard.camera u:object_r:system_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0
 persist.logd.security   u:object_r:device_logging_prop:s0
 persist.logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 persist.log.tag         u:object_r:log_tag_prop:s0
 persist.mmc.            u:object_r:mmc_prop:s0
 persist.netd.stable_secret      u:object_r:netd_stable_secret_prop:s0
 persist.pm.mock-upgrade u:object_r:mock_ota_prop:s0
 persist.sys.            u:object_r:system_prop:s0

commit cd316a5ae5e5c5eeb883567917bea7bb03d926d8
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Thu 2019-07-18 21:21:40-0400

    label protected_{fifos,regular} as proc_security
    
    This is needed for init to override the default values.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/genfs_contexts | 2 ++
 private/genfs_contexts                    | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/prebuilts/api/30.0/private/genfs_contexts b/prebuilts/api/30.0/private/genfs_contexts
index fef5641be817e3788facbcdc520a067d6a009cbc..5200452fe300820f9d8d921cb5cae9a24f63b76b 100644
--- a/prebuilts/api/30.0/private/genfs_contexts
+++ b/prebuilts/api/30.0/private/genfs_contexts
@@ -29,21 +29,23 @@ genfscon proc /pressure/cpu u:object_r:proc_pressure_cpu:s0
 genfscon proc /pressure/io u:object_r:proc_pressure_io:s0
 genfscon proc /pressure/memory u:object_r:proc_pressure_mem:s0
 genfscon proc /slabinfo u:object_r:proc_slabinfo:s0
 genfscon proc /softirqs u:object_r:proc_timer:s0
 genfscon proc /stat u:object_r:proc_stat:s0
 genfscon proc /swaps u:object_r:proc_swaps:s0
 genfscon proc /sysrq-trigger u:object_r:proc_sysrq:s0
 genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
+genfscon proc /sys/fs/protected_fifos u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
+genfscon proc /sys/fs/protected_regular u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/deny_new_usb u:object_r:proc_deny_new_usb:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0
diff --git a/private/genfs_contexts b/private/genfs_contexts
index fef5641be817e3788facbcdc520a067d6a009cbc..5200452fe300820f9d8d921cb5cae9a24f63b76b 100644
--- a/private/genfs_contexts
+++ b/private/genfs_contexts
@@ -29,21 +29,23 @@ genfscon proc /pressure/cpu u:object_r:proc_pressure_cpu:s0
 genfscon proc /pressure/io u:object_r:proc_pressure_io:s0
 genfscon proc /pressure/memory u:object_r:proc_pressure_mem:s0
 genfscon proc /slabinfo u:object_r:proc_slabinfo:s0
 genfscon proc /softirqs u:object_r:proc_timer:s0
 genfscon proc /stat u:object_r:proc_stat:s0
 genfscon proc /swaps u:object_r:proc_swaps:s0
 genfscon proc /sysrq-trigger u:object_r:proc_sysrq:s0
 genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
+genfscon proc /sys/fs/protected_fifos u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
+genfscon proc /sys/fs/protected_regular u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/deny_new_usb u:object_r:proc_deny_new_usb:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0

commit 33c4aebef32468007d83baaf1d7271f0943613ad
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-13 22:56:27-0400

    drop support for preloads_copy
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/file_contexts           |  1 -
 prebuilts/api/30.0/private/preloads_copy.te (gone) | 18 ------------------
 private/file_contexts                              |  1 -
 private/preloads_copy.te (gone)                    | 18 ------------------
 4 files changed, 38 deletions(-)

diff --git a/prebuilts/api/30.0/private/file_contexts b/prebuilts/api/30.0/private/file_contexts
index 9620b75127e848dc297a8f2eab6d69f1b24ba66f..136f9913fddc4a47e994cc305857bf2a50ea10b3 100644
--- a/prebuilts/api/30.0/private/file_contexts
+++ b/prebuilts/api/30.0/private/file_contexts
@@ -285,21 +285,20 @@
 /system/bin/perfetto        u:object_r:perfetto_exec:s0
 /system/bin/traced        u:object_r:traced_exec:s0
 /system/bin/traced_perf        u:object_r:traced_perf_exec:s0
 /system/bin/traced_probes        u:object_r:traced_probes_exec:s0
 /system/bin/heapprofd        u:object_r:heapprofd_exec:s0
 /system/bin/uncrypt     u:object_r:uncrypt_exec:s0
 /system/bin/update_verifier u:object_r:update_verifier_exec:s0
 /system/bin/logwrapper  u:object_r:system_file:s0
 /system/bin/vdc         u:object_r:vdc_exec:s0
 /system/bin/cppreopts\.sh   u:object_r:cppreopts_exec:s0
-/system/bin/preloads_copy\.sh u:object_r:preloads_copy_exec:s0
 /system/bin/preopt2cachename u:object_r:preopt2cachename_exec:s0
 /system/bin/dex2oat(d)?     u:object_r:dex2oat_exec:s0
 /system/bin/dexoptanalyzer(d)?     u:object_r:dexoptanalyzer_exec:s0
 /system/bin/viewcompiler     u:object_r:viewcompiler_exec:s0
 /system/bin/profman(d)?     u:object_r:profman_exec:s0
 /system/bin/iorapd          u:object_r:iorapd_exec:s0
 /system/bin/iorap\.inode2filename u:object_r:iorap_inode2filename_exec:s0
 /system/bin/iorap\.prefetcherd u:object_r:iorap_prefetcherd_exec:s0
 /system/bin/sgdisk      u:object_r:sgdisk_exec:s0
 /system/bin/blkid       u:object_r:blkid_exec:s0
diff --git a/prebuilts/api/30.0/private/preloads_copy.te b/prebuilts/api/30.0/private/preloads_copy.te
deleted file mode 100644
index ba54b70acad2b89a5cbe4e0610d585ce7154555f..0000000000000000000000000000000000000000
--- a/prebuilts/api/30.0/private/preloads_copy.te
+++ /dev/null
@@ -1,18 +0,0 @@
-type preloads_copy, domain, coredomain;
-type preloads_copy_exec, system_file_type, exec_type, file_type;
-
-init_daemon_domain(preloads_copy)
-
-allow preloads_copy shell_exec:file rx_file_perms;
-allow preloads_copy toolbox_exec:file rx_file_perms;
-allow preloads_copy preloads_data_file:dir create_dir_perms;
-allow preloads_copy preloads_data_file:file create_file_perms;
-allow preloads_copy preloads_media_file:dir create_dir_perms;
-allow preloads_copy preloads_media_file:file create_file_perms;
-
-# Allow to copy from /postinstall
-allow preloads_copy system_file:dir r_dir_perms;
-
-# Silence the denial when /postinstall cannot be mounted, e.g., system_other
-# is wiped, but preloads_copy.sh still runs.
-dontaudit preloads_copy postinstall_mnt_dir:dir search;
diff --git a/private/file_contexts b/private/file_contexts
index 9620b75127e848dc297a8f2eab6d69f1b24ba66f..136f9913fddc4a47e994cc305857bf2a50ea10b3 100644
--- a/private/file_contexts
+++ b/private/file_contexts
@@ -285,21 +285,20 @@
 /system/bin/perfetto        u:object_r:perfetto_exec:s0
 /system/bin/traced        u:object_r:traced_exec:s0
 /system/bin/traced_perf        u:object_r:traced_perf_exec:s0
 /system/bin/traced_probes        u:object_r:traced_probes_exec:s0
 /system/bin/heapprofd        u:object_r:heapprofd_exec:s0
 /system/bin/uncrypt     u:object_r:uncrypt_exec:s0
 /system/bin/update_verifier u:object_r:update_verifier_exec:s0
 /system/bin/logwrapper  u:object_r:system_file:s0
 /system/bin/vdc         u:object_r:vdc_exec:s0
 /system/bin/cppreopts\.sh   u:object_r:cppreopts_exec:s0
-/system/bin/preloads_copy\.sh u:object_r:preloads_copy_exec:s0
 /system/bin/preopt2cachename u:object_r:preopt2cachename_exec:s0
 /system/bin/dex2oat(d)?     u:object_r:dex2oat_exec:s0
 /system/bin/dexoptanalyzer(d)?     u:object_r:dexoptanalyzer_exec:s0
 /system/bin/viewcompiler     u:object_r:viewcompiler_exec:s0
 /system/bin/profman(d)?     u:object_r:profman_exec:s0
 /system/bin/iorapd          u:object_r:iorapd_exec:s0
 /system/bin/iorap\.inode2filename u:object_r:iorap_inode2filename_exec:s0
 /system/bin/iorap\.prefetcherd u:object_r:iorap_prefetcherd_exec:s0
 /system/bin/sgdisk      u:object_r:sgdisk_exec:s0
 /system/bin/blkid       u:object_r:blkid_exec:s0
diff --git a/private/preloads_copy.te b/private/preloads_copy.te
deleted file mode 100644
index ba54b70acad2b89a5cbe4e0610d585ce7154555f..0000000000000000000000000000000000000000
--- a/private/preloads_copy.te
+++ /dev/null
@@ -1,18 +0,0 @@
-type preloads_copy, domain, coredomain;
-type preloads_copy_exec, system_file_type, exec_type, file_type;
-
-init_daemon_domain(preloads_copy)
-
-allow preloads_copy shell_exec:file rx_file_perms;
-allow preloads_copy toolbox_exec:file rx_file_perms;
-allow preloads_copy preloads_data_file:dir create_dir_perms;
-allow preloads_copy preloads_data_file:file create_file_perms;
-allow preloads_copy preloads_media_file:dir create_dir_perms;
-allow preloads_copy preloads_media_file:file create_file_perms;
-
-# Allow to copy from /postinstall
-allow preloads_copy system_file:dir r_dir_perms;
-
-# Silence the denial when /postinstall cannot be mounted, e.g., system_other
-# is wiped, but preloads_copy.sh still runs.
-dontaudit preloads_copy postinstall_mnt_dir:dir search;

commit 335f8308a624400a84f61523f114e0494b1e83fa
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:14:26-0400

    remove priv_app app_data_file execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/priv_app.te | 11 -----------
 private/priv_app.te                    | 11 -----------
 2 files changed, 22 deletions(-)

diff --git a/prebuilts/api/30.0/private/priv_app.te b/prebuilts/api/30.0/private/priv_app.te
index 44c81ee8020c252d242f35d64e47b5ead1f32452..4413852c8e10d01f68e58c9571a8445dad1b92ec 100644
--- a/prebuilts/api/30.0/private/priv_app.te
+++ b/prebuilts/api/30.0/private/priv_app.te
@@ -7,31 +7,20 @@ app_domain(priv_app)
 
 # Access the network.
 net_domain(priv_app)
 # Access bluetooth.
 bluetooth_domain(priv_app)
 
 # Allow the allocation and use of ptys
 # Used by: https://play.privileged.com/store/apps/details?id=jackpal.androidterm
 create_pty(priv_app)
 
-# Allow loading executable code from writable priv-app home
-# directories. This is a W^X violation, however, it needs
-# to be supported for now for the following reasons.
-# * /data/user_*/0/*/code_cache/* POSSIBLE uses (b/117841367)
-#   1) com.android.opengl.shaders_cache
-#   2) com.android.skia.shaders_cache
-#   3) com.android.renderscript.cache
-# * /data/user_de/0/com.google.android.gms/app_chimera
-# TODO: Tighten (b/112357170)
-allow priv_app privapp_data_file:file execute;
-
 allow priv_app privapp_data_file:lnk_file create_file_perms;
 
 # Priv apps can find services that expose both @SystemAPI and normal APIs.
 allow priv_app app_api_service:service_manager find;
 allow priv_app system_api_service:service_manager find;
 
 allow priv_app audioserver_service:service_manager find;
 allow priv_app cameraserver_service:service_manager find;
 allow priv_app drmserver_service:service_manager find;
 allow priv_app mediadrmserver_service:service_manager find;
diff --git a/private/priv_app.te b/private/priv_app.te
index 44c81ee8020c252d242f35d64e47b5ead1f32452..4413852c8e10d01f68e58c9571a8445dad1b92ec 100644
--- a/private/priv_app.te
+++ b/private/priv_app.te
@@ -7,31 +7,20 @@ app_domain(priv_app)
 
 # Access the network.
 net_domain(priv_app)
 # Access bluetooth.
 bluetooth_domain(priv_app)
 
 # Allow the allocation and use of ptys
 # Used by: https://play.privileged.com/store/apps/details?id=jackpal.androidterm
 create_pty(priv_app)
 
-# Allow loading executable code from writable priv-app home
-# directories. This is a W^X violation, however, it needs
-# to be supported for now for the following reasons.
-# * /data/user_*/0/*/code_cache/* POSSIBLE uses (b/117841367)
-#   1) com.android.opengl.shaders_cache
-#   2) com.android.skia.shaders_cache
-#   3) com.android.renderscript.cache
-# * /data/user_de/0/com.google.android.gms/app_chimera
-# TODO: Tighten (b/112357170)
-allow priv_app privapp_data_file:file execute;
-
 allow priv_app privapp_data_file:lnk_file create_file_perms;
 
 # Priv apps can find services that expose both @SystemAPI and normal APIs.
 allow priv_app app_api_service:service_manager find;
 allow priv_app system_api_service:service_manager find;
 
 allow priv_app audioserver_service:service_manager find;
 allow priv_app cameraserver_service:service_manager find;
 allow priv_app drmserver_service:service_manager find;
 allow priv_app mediadrmserver_service:service_manager find;

commit 7264bc3d6913432925ea5973e8cb1284d31c77fa
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:17:31-0400

    remove healthd ashmem execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/public/healthd.te | 1 -
 public/healthd.te                    | 1 -
 2 files changed, 2 deletions(-)

diff --git a/prebuilts/api/30.0/public/healthd.te b/prebuilts/api/30.0/public/healthd.te
index 7ea23e1c3aa0a10f645074caefdd8455c26458d9..96c4e6c510bc8ef3098ccf31fe00dd83100e4dfd 100644
--- a/prebuilts/api/30.0/public/healthd.te
+++ b/prebuilts/api/30.0/public/healthd.te
@@ -38,19 +38,18 @@ r_dir_file(healthd, sysfs_batteryinfo)
 # Don't worry about overly broad permissions for now, as there's
 # only one file in /sys/fs/pstore
 allow healthd pstorefs:dir r_dir_perms;
 allow healthd pstorefs:file r_file_perms;
 
 allow healthd graphics_device:dir r_dir_perms;
 allow healthd graphics_device:chr_file rw_file_perms;
 allow healthd input_device:dir r_dir_perms;
 allow healthd input_device:chr_file r_file_perms;
 allow healthd tty_device:chr_file rw_file_perms;
-allow healthd ashmem_device:chr_file execute;
 allow healthd proc_sysrq:file rw_file_perms;
 
 # Healthd needs to tell init to continue the boot
 # process when running in charger mode.
 set_prop(healthd, system_prop)
 set_prop(healthd, exported_system_prop)
 set_prop(healthd, exported2_system_prop)
 set_prop(healthd, exported3_system_prop)
diff --git a/public/healthd.te b/public/healthd.te
index 7ea23e1c3aa0a10f645074caefdd8455c26458d9..96c4e6c510bc8ef3098ccf31fe00dd83100e4dfd 100644
--- a/public/healthd.te
+++ b/public/healthd.te
@@ -38,19 +38,18 @@ r_dir_file(healthd, sysfs_batteryinfo)
 # Don't worry about overly broad permissions for now, as there's
 # only one file in /sys/fs/pstore
 allow healthd pstorefs:dir r_dir_perms;
 allow healthd pstorefs:file r_file_perms;
 
 allow healthd graphics_device:dir r_dir_perms;
 allow healthd graphics_device:chr_file rw_file_perms;
 allow healthd input_device:dir r_dir_perms;
 allow healthd input_device:chr_file r_file_perms;
 allow healthd tty_device:chr_file rw_file_perms;
-allow healthd ashmem_device:chr_file execute;
 allow healthd proc_sysrq:file rw_file_perms;
 
 # Healthd needs to tell init to continue the boot
 # process when running in charger mode.
 set_prop(healthd, system_prop)
 set_prop(healthd, exported_system_prop)
 set_prop(healthd, exported2_system_prop)
 set_prop(healthd, exported3_system_prop)

commit 47df6d33dc886bcebdaffb4b6718ce5c47be79b9
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:20:43-0400

    auditallow app execmem
    
    Moving back towards an exception system.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/public/app.te | 1 +
 public/app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/30.0/public/app.te b/prebuilts/api/30.0/public/app.te
index e5b9fd670024740fc3d5158d0a7e77c49f751f14..c809b0a8b2ed30752bf82c24adb06e4560333c2f 100644
--- a/prebuilts/api/30.0/public/app.te
+++ b/prebuilts/api/30.0/public/app.te
@@ -3,20 +3,21 @@
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
+auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 
diff --git a/public/app.te b/public/app.te
index e5b9fd670024740fc3d5158d0a7e77c49f751f14..c809b0a8b2ed30752bf82c24adb06e4560333c2f 100644
--- a/public/app.te
+++ b/public/app.te
@@ -3,20 +3,21 @@
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
+auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 

commit 6d4952960ad22ae05d9e83cf269a9d298a24ec38
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:21:01-0400

    auditallow app ashmem execute
    
    Moving back towards an exception system.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/public/app.te | 1 +
 public/app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/30.0/public/app.te b/prebuilts/api/30.0/public/app.te
index c809b0a8b2ed30752bf82c24adb06e4560333c2f..0925233f43753268e11e17aab13f6af5916e3fcb 100644
--- a/prebuilts/api/30.0/public/app.te
+++ b/prebuilts/api/30.0/public/app.te
@@ -6,20 +6,21 @@
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
 auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;
diff --git a/public/app.te b/public/app.te
index c809b0a8b2ed30752bf82c24adb06e4560333c2f..0925233f43753268e11e17aab13f6af5916e3fcb 100644
--- a/public/app.te
+++ b/public/app.te
@@ -6,20 +6,21 @@
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
 auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;

commit 6a6a1a66c276fc2e1e4f9caf1c50f03c962dcab3
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Thu 2020-10-22 23:39:34-0400

    add base system seinfo for shared/release keys
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/mac_permissions.xml | 10 ++++++++++
 prebuilts/api/30.0/private/seapp_contexts      | 16 ++++++++++++++++
 private/mac_permissions.xml                    | 10 ++++++++++
 private/seapp_contexts                         | 16 ++++++++++++++++
 4 files changed, 52 insertions(+)

diff --git a/prebuilts/api/30.0/private/mac_permissions.xml b/prebuilts/api/30.0/private/mac_permissions.xml
index 7fc37c13efd9826040450b0b6bbda69e6bd7374f..6b2d6ad094a96ac80640ed8c631d8c68982c684e 100644
--- a/prebuilts/api/30.0/private/mac_permissions.xml
+++ b/prebuilts/api/30.0/private/mac_permissions.xml
@@ -49,14 +49,24 @@
     <!-- Platform dev key in AOSP -->
     <signer signature="@PLATFORM" >
       <seinfo value="platform" />
     </signer>
 
     <!-- Media key in AOSP -->
     <signer signature="@MEDIA" >
       <seinfo value="media" />
     </signer>
 
+    <!-- Shared dev key in AOSP -->
+    <signer signature="@SHARED" >
+      <seinfo value="base" />
+    </signer>
+
+    <!-- Release dev key in AOSP -->
+    <signer signature="@RELEASE" >
+      <seinfo value="base" />
+    </signer>
+
     <signer signature="@NETWORK_STACK" >
       <seinfo value="network_stack" />
     </signer>
 </policy>
diff --git a/prebuilts/api/30.0/private/seapp_contexts b/prebuilts/api/30.0/private/seapp_contexts
index fa9388cc4f394a7bf5d8a77dc078b1a84e321691..35fed80028bf8b359f36c405c7176d5cb7ba00a0 100644
--- a/prebuilts/api/30.0/private/seapp_contexts
+++ b/prebuilts/api/30.0/private/seapp_contexts
@@ -141,32 +141,48 @@ neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
 isSystemServer=true domain=system_server_startup
 
 user=_app seinfo=platform name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack levelFrom=all type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
+user=shared_relro seinfo=base domain=shared_relro
 user=shared_relro domain=shared_relro
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
+user=_isolated seinfo=base domain=isolated_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
+user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
+user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
+user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/mac_permissions.xml b/private/mac_permissions.xml
index 7fc37c13efd9826040450b0b6bbda69e6bd7374f..6b2d6ad094a96ac80640ed8c631d8c68982c684e 100644
--- a/private/mac_permissions.xml
+++ b/private/mac_permissions.xml
@@ -49,14 +49,24 @@
     <!-- Platform dev key in AOSP -->
     <signer signature="@PLATFORM" >
       <seinfo value="platform" />
     </signer>
 
     <!-- Media key in AOSP -->
     <signer signature="@MEDIA" >
       <seinfo value="media" />
     </signer>
 
+    <!-- Shared dev key in AOSP -->
+    <signer signature="@SHARED" >
+      <seinfo value="base" />
+    </signer>
+
+    <!-- Release dev key in AOSP -->
+    <signer signature="@RELEASE" >
+      <seinfo value="base" />
+    </signer>
+
     <signer signature="@NETWORK_STACK" >
       <seinfo value="network_stack" />
     </signer>
 </policy>
diff --git a/private/seapp_contexts b/private/seapp_contexts
index fa9388cc4f394a7bf5d8a77dc078b1a84e321691..35fed80028bf8b359f36c405c7176d5cb7ba00a0 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -141,32 +141,48 @@ neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
 isSystemServer=true domain=system_server_startup
 
 user=_app seinfo=platform name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack levelFrom=all type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
+user=shared_relro seinfo=base domain=shared_relro
 user=shared_relro domain=shared_relro
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
+user=_isolated seinfo=base domain=isolated_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
+user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
+user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
+user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user

commit 1dc0915821940991c75efee65b12893fa7ae6598
Author: Renlord <me@renlord.com>
Date:   Sat 2020-02-22 02:04:41+1100

    split out untrusted base app domains
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/app_neverallows.te      | 19 +++++++-
 .../api/30.0/private/compat/26.0/26.0.ignore.cil   |  4 ++
 .../api/30.0/private/compat/27.0/27.0.ignore.cil   |  4 ++
 .../api/30.0/private/compat/28.0/28.0.ignore.cil   |  4 ++
 .../api/30.0/private/compat/29.0/29.0.ignore.cil   |  4 ++
 prebuilts/api/30.0/private/seapp_contexts          | 10 ++--
 .../api/30.0/private/untrusted_base_app.te (new)   | 16 +++++++
 .../30.0/private/untrusted_base_app_25.te (new)    | 53 ++++++++++++++++++++++
 .../30.0/private/untrusted_base_app_27.te (new)    | 41 +++++++++++++++++
 .../30.0/private/untrusted_base_app_29.te (new)    | 19 ++++++++
 prebuilts/api/30.0/public/domain.te                |  4 +-
 .../api/30.0/public/untrusted_base_app.te (new)    | 19 ++++++++
 .../api/30.0/public/untrusted_base_app_25.te (new) | 19 ++++++++
 .../api/30.0/public/untrusted_base_app_27.te (new) | 19 ++++++++
 .../api/30.0/public/untrusted_base_app_29.te (new) | 19 ++++++++
 private/app_neverallows.te                         | 19 +++++++-
 private/compat/26.0/26.0.ignore.cil                |  4 ++
 private/compat/27.0/27.0.ignore.cil                |  4 ++
 private/compat/28.0/28.0.ignore.cil                |  4 ++
 private/compat/29.0/29.0.ignore.cil                |  4 ++
 private/seapp_contexts                             | 10 ++--
 private/untrusted_base_app.te (new)                | 16 +++++++
 private/untrusted_base_app_25.te (new)             | 53 ++++++++++++++++++++++
 private/untrusted_base_app_27.te (new)             | 41 +++++++++++++++++
 private/untrusted_base_app_29.te (new)             | 19 ++++++++
 public/domain.te                                   |  4 +-
 public/untrusted_base_app.te (new)                 | 19 ++++++++
 public/untrusted_base_app_25.te (new)              | 19 ++++++++
 public/untrusted_base_app_27.te (new)              | 19 ++++++++
 public/untrusted_base_app_29.te (new)              | 19 ++++++++
 tests/treble_sepolicy_tests.py                     |  2 +
 31 files changed, 496 insertions(+), 14 deletions(-)

diff --git a/prebuilts/api/30.0/private/app_neverallows.te b/prebuilts/api/30.0/private/app_neverallows.te
index 32980b354b0f6b2adf0d25f3b9d21d326eda3b24..6fcc900f0b790bd97d570370e2e2cab2dbce675c 100644
--- a/prebuilts/api/30.0/private/app_neverallows.te
+++ b/prebuilts/api/30.0/private/app_neverallows.te
@@ -5,20 +5,24 @@
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
+  untrusted_base_app
+  untrusted_base_app_25
+  untrusted_base_app_27
+  untrusted_base_app_29
 }')
 # Receive or send uevent messages.
 neverallow all_untrusted_apps domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
 neverallow all_untrusted_apps domain:netlink_socket *;
 
 # Too much leaky information in debugfs. It's a security
 # best practice to ensure these files aren't readable.
 neverallow all_untrusted_apps { debugfs_type -debugfs_kcov }:file read;
@@ -48,31 +52,35 @@ neverallow { all_untrusted_apps } net_dns_prop:file read;
 neverallow all_untrusted_apps app_exec_data_file:file
   { append create link relabelfrom relabelto rename setattr write };
 
 # Block calling execve() on files in an apps home directory.
 # This is a W^X violation (loading executable code from a writable
 # home directory). For compatibility, allow for targetApi <= 28.
 # b/112357170
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -runas_app
 } { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Do not allow untrusted apps to invoke dex2oat. This was historically required
 # by ART for compiling secondary dex files but has been removed in Q.
 # Exempt legacy apps (targetApi<=28) for compatibility.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } dex2oat_exec:file no_x_file_perms;
 
 # Do not allow untrusted apps to be assigned mlstrustedsubject.
 # This would undermine the per-user isolation model being
 # enforced via levelFrom=user in seapp_contexts and the mls
 # constraints.  As there is no direct way to specify a neverallow
 # on attribute assignment, this relies on the fact that fork
 # permission only makes sense within a domain (hence should
 # never be granted to any other domain within mlstrustedsubject)
 # and an untrusted app is allowed fork permission to itself.
@@ -110,22 +118,25 @@ neverallow all_untrusted_apps *:{
   ax25_socket ipx_socket netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket
   atmsvc_socket rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
   bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket ieee802154_socket caif_socket
   alg_socket nfc_socket vsock_socket kcm_socket qipcrtr_socket smc_socket xdp_socket
 } *;
 
 # Disallow sending RTM_GETLINK messages on netlink sockets.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -untrusted_app_29
+  -untrusted_base_app_29
 } domain:netlink_route_socket { bind nlmsg_readpriv };
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
@@ -237,26 +248,32 @@ neverallow all_untrusted_apps {
 }:service_manager find;
 
 # SELinux is not an API for untrusted apps to use
 neverallow all_untrusted_apps selinuxfs:file no_rw_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
-neverallow { all_untrusted_apps -untrusted_app_25 } proc_tty_drivers:file r_file_perms;
+neverallow {
+    all_untrusted_apps
+    -untrusted_app_25
+    -untrusted_base_app_25
+} proc_tty_drivers:file r_file_perms;
 neverallow all_untrusted_apps proc_tty_drivers:file ~r_file_perms;
 
 # Untrusted apps are not allowed to use cgroups.
 neverallow all_untrusted_apps cgroup:file *;
 
 # /mnt/sdcard symlink was supposed to have been removed in Gingerbread. Apps
 # must not use it.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } mnt_sdcard_file:lnk_file *;
 
 # Only privileged apps may find the incident service
 neverallow all_untrusted_apps incident_service:service_manager find;
diff --git a/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil b/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil
index b395855afcae96c8d843332a2735333e218d5bce..020d43395a80eecba2421273074b9a7c9eaa2b53 100644
--- a/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil
@@ -183,20 +183,24 @@
     traceur_app_tmpfs
     traced
     traced_consumer_socket
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     untrusted_app_all_devpts
     update_engine_log_data_file
     vendor_default_prop
     vendor_security_patch_level_prop
     uri_grants_service
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_init
diff --git a/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil b/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil
index cb500c9e0d761e0b234e8aae9ab15fe0cb0f0785..5d940a02156828950d0a00c5e283594972619e92 100644
--- a/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil
@@ -162,20 +162,24 @@
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
     traceur_app
     traceur_app_tmpfs
     untrusted_app_all_devpts
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     update_engine_log_data_file
     uri_grants_service
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_default_prop
     vendor_init
     vendor_security_patch_level_prop
     vendor_shell
diff --git a/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil b/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil
index d24d12d257354ca3cb412574970e8a09623b53d0..4bd643e614bd10128b67638341ed6cfdc3b13a9e 100644
--- a/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil
@@ -138,20 +138,24 @@
     task_profiles_file
     testharness_service
     test_harness_prop
     theme_prop
     time_prop
     timedetector_service
     timezonedetector_service
     traced_lazy_prop
     uri_grants_service
     use_memfd_prop
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_cgroup_desc_file
     vendor_idc_file
     vendor_keychars_file
     vendor_keylayout_file
     vendor_misc_writer
     vendor_misc_writer_exec
     vendor_socket_hook_prop
     vendor_task_profiles_file
     vndk_prop
diff --git a/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil b/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
index 730695e8e4d2323b601d6b13503b0bfcf0585ad8..caf2830723979262eb285dc0bf994ab4113108ee 100644
--- a/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
@@ -114,18 +114,22 @@
     timezonedetector_service
     untrusted_app_29
     updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
     vendor_install_recovery_exec
     vendor_service_contexts_file
     vendor_socket_hook_prop
     vendor_socket_hook_prop
     virtual_ab_prop))
diff --git a/prebuilts/api/30.0/private/seapp_contexts b/prebuilts/api/30.0/private/seapp_contexts
index 35fed80028bf8b359f36c405c7176d5cb7ba00a0..5ecde07c2e0803a18bdf35eb28b50d97b45092f3 100644
--- a/prebuilts/api/30.0/private/seapp_contexts
+++ b/prebuilts/api/30.0/private/seapp_contexts
@@ -165,24 +165,24 @@ user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontrolle
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
-user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_base_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_base_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_base_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_base_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
-user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_base_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/prebuilts/api/30.0/private/untrusted_base_app.te b/prebuilts/api/30.0/private/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..8ee2819f16bd19bb7f418f3281ffbec7d7b71551
--- /dev/null
+++ b/prebuilts/api/30.0/private/untrusted_base_app.te
@@ -0,0 +1,16 @@
+###
+### Untrusted apps.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion >= 30.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app coredomain;
+
+app_domain(untrusted_base_app)
+untrusted_app_domain(untrusted_base_app)
+net_domain(untrusted_base_app)
+bluetooth_domain(untrusted_base_app)
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_25.te b/prebuilts/api/30.0/private/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..4bcaa19eb3432a045ce94b18c6521c894125ee32
--- /dev/null
+++ b/prebuilts/api/30.0/private/untrusted_base_app_25.te
@@ -0,0 +1,53 @@
+###
+### untrusted_base_app_25
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion <= 25.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_25 coredomain;
+
+app_domain(untrusted_base_app_25)
+untrusted_app_domain(untrusted_base_app_25)
+net_domain(untrusted_base_app_25)
+bluetooth_domain(untrusted_base_app_25)
+
+# b/35917228 - /proc/misc access
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_misc:file r_file_perms;
+
+# Access to /proc/tty/drivers, to allow apps to determine if they
+# are running in an emulated environment.
+# b/33214085 b/33814662 b/33791054 b/33211769
+# https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
+# and 28 in untrusted_app_27.te.
+allow untrusted_base_app_25 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_25 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_25 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_27.te b/prebuilts/api/30.0/private/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..4ef4e963cd1b12b546a923d985e0d1c54dc60a74
--- /dev/null
+++ b/prebuilts/api/30.0/private/untrusted_base_app_27.te
@@ -0,0 +1,41 @@
+###
+### Untrusted_27.
+###
+### This file defines the rules for untrusted apps running with
+### 25 < targetSdkVersion <= 28.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_27 coredomain;
+
+app_domain(untrusted_base_app_27)
+untrusted_app_domain(untrusted_base_app_27)
+net_domain(untrusted_base_app_27)
+bluetooth_domain(untrusted_base_app_27)
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi 26, 27, and 28.
+allow untrusted_base_app_27 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_27 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_27 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_29.te b/prebuilts/api/30.0/private/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..a027578017ca22d8789d2b96e1766047e1e6810c
--- /dev/null
+++ b/prebuilts/api/30.0/private/untrusted_base_app_29.te
@@ -0,0 +1,19 @@
+###
+### Untrusted_29.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion = 29.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_29 coredomain;
+
+app_domain(untrusted_base_app_29)
+untrusted_app_domain(untrusted_base_app_29)
+net_domain(untrusted_base_app_29)
+bluetooth_domain(untrusted_base_app_29)
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/30.0/public/domain.te b/prebuilts/api/30.0/public/domain.te
index e1ca737ce071baf62dfdc007a3532d0360d6eb0b..94031e3041324b2a489d04906ee45ccae1102589 100644
--- a/prebuilts/api/30.0/public/domain.te
+++ b/prebuilts/api/30.0/public/domain.te
@@ -1120,21 +1120,21 @@ neverallow * {
   -asec_public_file
 }:file execmod;
 
 # Do not allow making the stack or heap executable.
 # We would also like to minimize execmem but it seems to be
 # required by some device-specific service domains.
 neverallow * self:process { execstack execheap };
 
 # Do not allow the introduction of new execmod rules. Text relocations
 # and modification of executable pages are unsafe.
-neverallow { domain -untrusted_app_25 -untrusted_app_27 } file_type:file execmod;
+neverallow { domain -untrusted_app_25 -untrusted_base_app_25 -untrusted_app_27 -untrusted_base_app_27 } file_type:file execmod;
 
 neverallow { domain -init } proc:{ file dir } mounton;
 
 # Ensure that all types assigned to processes are included
 # in the domain attribute, so that all allow and neverallow rules
 # written on domain are applied to all processes.
 # This is achieved by ensuring that it is impossible to transition
 # from a domain to a non-domain type and vice versa.
 # TODO - rework this: neverallow domain ~domain:process { transition dyntransition };
 neverallow ~domain domain:process { transition dyntransition };
@@ -1413,12 +1413,14 @@ neverallow {
   -hal_codec2_server
   -hal_omx_server
 } hal_codec2_hwservice:hwservice_manager add;
 
 # Only apps targetting < Q are allowed to open /dev/ashmem directly.
 # Apps must use ASharedMemory NDK API. Native code must use libcutils API.
 neverallow {
   domain
   -ephemeral_app # We don't distinguish ephemeral apps based on target API.
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } ashmem_device:chr_file open;
diff --git a/prebuilts/api/30.0/public/untrusted_base_app.te b/prebuilts/api/30.0/public/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..39071d9b9f5dc468d2e063c0ce663f35c9c890d6
--- /dev/null
+++ b/prebuilts/api/30.0/public/untrusted_base_app.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app, domain;
diff --git a/prebuilts/api/30.0/public/untrusted_base_app_25.te b/prebuilts/api/30.0/public/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..45763c533f84f2e46bfebd0e5add6a8261f2d3eb
--- /dev/null
+++ b/prebuilts/api/30.0/public/untrusted_base_app_25.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_25, domain;
diff --git a/prebuilts/api/30.0/public/untrusted_base_app_27.te b/prebuilts/api/30.0/public/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..62a8618a6d9e069d03c6d233bc0458f407fc5f98
--- /dev/null
+++ b/prebuilts/api/30.0/public/untrusted_base_app_27.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_27, domain;
diff --git a/prebuilts/api/30.0/public/untrusted_base_app_29.te b/prebuilts/api/30.0/public/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..f6b7aa8ea60c9172cc4bbf55eefcce307d60a398
--- /dev/null
+++ b/prebuilts/api/30.0/public/untrusted_base_app_29.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_29, domain;
diff --git a/private/app_neverallows.te b/private/app_neverallows.te
index 32980b354b0f6b2adf0d25f3b9d21d326eda3b24..6fcc900f0b790bd97d570370e2e2cab2dbce675c 100644
--- a/private/app_neverallows.te
+++ b/private/app_neverallows.te
@@ -5,20 +5,24 @@
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
+  untrusted_base_app
+  untrusted_base_app_25
+  untrusted_base_app_27
+  untrusted_base_app_29
 }')
 # Receive or send uevent messages.
 neverallow all_untrusted_apps domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
 neverallow all_untrusted_apps domain:netlink_socket *;
 
 # Too much leaky information in debugfs. It's a security
 # best practice to ensure these files aren't readable.
 neverallow all_untrusted_apps { debugfs_type -debugfs_kcov }:file read;
@@ -48,31 +52,35 @@ neverallow { all_untrusted_apps } net_dns_prop:file read;
 neverallow all_untrusted_apps app_exec_data_file:file
   { append create link relabelfrom relabelto rename setattr write };
 
 # Block calling execve() on files in an apps home directory.
 # This is a W^X violation (loading executable code from a writable
 # home directory). For compatibility, allow for targetApi <= 28.
 # b/112357170
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -runas_app
 } { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Do not allow untrusted apps to invoke dex2oat. This was historically required
 # by ART for compiling secondary dex files but has been removed in Q.
 # Exempt legacy apps (targetApi<=28) for compatibility.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } dex2oat_exec:file no_x_file_perms;
 
 # Do not allow untrusted apps to be assigned mlstrustedsubject.
 # This would undermine the per-user isolation model being
 # enforced via levelFrom=user in seapp_contexts and the mls
 # constraints.  As there is no direct way to specify a neverallow
 # on attribute assignment, this relies on the fact that fork
 # permission only makes sense within a domain (hence should
 # never be granted to any other domain within mlstrustedsubject)
 # and an untrusted app is allowed fork permission to itself.
@@ -110,22 +118,25 @@ neverallow all_untrusted_apps *:{
   ax25_socket ipx_socket netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket
   atmsvc_socket rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
   bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket ieee802154_socket caif_socket
   alg_socket nfc_socket vsock_socket kcm_socket qipcrtr_socket smc_socket xdp_socket
 } *;
 
 # Disallow sending RTM_GETLINK messages on netlink sockets.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -untrusted_app_29
+  -untrusted_base_app_29
 } domain:netlink_route_socket { bind nlmsg_readpriv };
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
@@ -237,26 +248,32 @@ neverallow all_untrusted_apps {
 }:service_manager find;
 
 # SELinux is not an API for untrusted apps to use
 neverallow all_untrusted_apps selinuxfs:file no_rw_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
-neverallow { all_untrusted_apps -untrusted_app_25 } proc_tty_drivers:file r_file_perms;
+neverallow {
+    all_untrusted_apps
+    -untrusted_app_25
+    -untrusted_base_app_25
+} proc_tty_drivers:file r_file_perms;
 neverallow all_untrusted_apps proc_tty_drivers:file ~r_file_perms;
 
 # Untrusted apps are not allowed to use cgroups.
 neverallow all_untrusted_apps cgroup:file *;
 
 # /mnt/sdcard symlink was supposed to have been removed in Gingerbread. Apps
 # must not use it.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } mnt_sdcard_file:lnk_file *;
 
 # Only privileged apps may find the incident service
 neverallow all_untrusted_apps incident_service:service_manager find;
diff --git a/private/compat/26.0/26.0.ignore.cil b/private/compat/26.0/26.0.ignore.cil
index b395855afcae96c8d843332a2735333e218d5bce..020d43395a80eecba2421273074b9a7c9eaa2b53 100644
--- a/private/compat/26.0/26.0.ignore.cil
+++ b/private/compat/26.0/26.0.ignore.cil
@@ -183,20 +183,24 @@
     traceur_app_tmpfs
     traced
     traced_consumer_socket
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     untrusted_app_all_devpts
     update_engine_log_data_file
     vendor_default_prop
     vendor_security_patch_level_prop
     uri_grants_service
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_init
diff --git a/private/compat/27.0/27.0.ignore.cil b/private/compat/27.0/27.0.ignore.cil
index cb500c9e0d761e0b234e8aae9ab15fe0cb0f0785..5d940a02156828950d0a00c5e283594972619e92 100644
--- a/private/compat/27.0/27.0.ignore.cil
+++ b/private/compat/27.0/27.0.ignore.cil
@@ -162,20 +162,24 @@
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
     traceur_app
     traceur_app_tmpfs
     untrusted_app_all_devpts
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     update_engine_log_data_file
     uri_grants_service
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_default_prop
     vendor_init
     vendor_security_patch_level_prop
     vendor_shell
diff --git a/private/compat/28.0/28.0.ignore.cil b/private/compat/28.0/28.0.ignore.cil
index d24d12d257354ca3cb412574970e8a09623b53d0..4bd643e614bd10128b67638341ed6cfdc3b13a9e 100644
--- a/private/compat/28.0/28.0.ignore.cil
+++ b/private/compat/28.0/28.0.ignore.cil
@@ -138,20 +138,24 @@
     task_profiles_file
     testharness_service
     test_harness_prop
     theme_prop
     time_prop
     timedetector_service
     timezonedetector_service
     traced_lazy_prop
     uri_grants_service
     use_memfd_prop
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_cgroup_desc_file
     vendor_idc_file
     vendor_keychars_file
     vendor_keylayout_file
     vendor_misc_writer
     vendor_misc_writer_exec
     vendor_socket_hook_prop
     vendor_task_profiles_file
     vndk_prop
diff --git a/private/compat/29.0/29.0.ignore.cil b/private/compat/29.0/29.0.ignore.cil
index 730695e8e4d2323b601d6b13503b0bfcf0585ad8..caf2830723979262eb285dc0bf994ab4113108ee 100644
--- a/private/compat/29.0/29.0.ignore.cil
+++ b/private/compat/29.0/29.0.ignore.cil
@@ -114,18 +114,22 @@
     timezonedetector_service
     untrusted_app_29
     updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
     vendor_install_recovery_exec
     vendor_service_contexts_file
     vendor_socket_hook_prop
     vendor_socket_hook_prop
     virtual_ab_prop))
diff --git a/private/seapp_contexts b/private/seapp_contexts
index 35fed80028bf8b359f36c405c7176d5cb7ba00a0..5ecde07c2e0803a18bdf35eb28b50d97b45092f3 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -165,24 +165,24 @@ user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontrolle
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
-user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_base_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_base_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_base_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_base_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
-user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_base_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/untrusted_base_app.te b/private/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..8ee2819f16bd19bb7f418f3281ffbec7d7b71551
--- /dev/null
+++ b/private/untrusted_base_app.te
@@ -0,0 +1,16 @@
+###
+### Untrusted apps.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion >= 30.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app coredomain;
+
+app_domain(untrusted_base_app)
+untrusted_app_domain(untrusted_base_app)
+net_domain(untrusted_base_app)
+bluetooth_domain(untrusted_base_app)
diff --git a/private/untrusted_base_app_25.te b/private/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..4bcaa19eb3432a045ce94b18c6521c894125ee32
--- /dev/null
+++ b/private/untrusted_base_app_25.te
@@ -0,0 +1,53 @@
+###
+### untrusted_base_app_25
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion <= 25.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_25 coredomain;
+
+app_domain(untrusted_base_app_25)
+untrusted_app_domain(untrusted_base_app_25)
+net_domain(untrusted_base_app_25)
+bluetooth_domain(untrusted_base_app_25)
+
+# b/35917228 - /proc/misc access
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_misc:file r_file_perms;
+
+# Access to /proc/tty/drivers, to allow apps to determine if they
+# are running in an emulated environment.
+# b/33214085 b/33814662 b/33791054 b/33211769
+# https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
+# and 28 in untrusted_app_27.te.
+allow untrusted_base_app_25 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_25 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_25 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/private/untrusted_base_app_27.te b/private/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..4ef4e963cd1b12b546a923d985e0d1c54dc60a74
--- /dev/null
+++ b/private/untrusted_base_app_27.te
@@ -0,0 +1,41 @@
+###
+### Untrusted_27.
+###
+### This file defines the rules for untrusted apps running with
+### 25 < targetSdkVersion <= 28.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_27 coredomain;
+
+app_domain(untrusted_base_app_27)
+untrusted_app_domain(untrusted_base_app_27)
+net_domain(untrusted_base_app_27)
+bluetooth_domain(untrusted_base_app_27)
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi 26, 27, and 28.
+allow untrusted_base_app_27 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_27 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_27 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/private/untrusted_base_app_29.te b/private/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..a027578017ca22d8789d2b96e1766047e1e6810c
--- /dev/null
+++ b/private/untrusted_base_app_29.te
@@ -0,0 +1,19 @@
+###
+### Untrusted_29.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion = 29.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_29 coredomain;
+
+app_domain(untrusted_base_app_29)
+untrusted_app_domain(untrusted_base_app_29)
+net_domain(untrusted_base_app_29)
+bluetooth_domain(untrusted_base_app_29)
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/public/domain.te b/public/domain.te
index e1ca737ce071baf62dfdc007a3532d0360d6eb0b..94031e3041324b2a489d04906ee45ccae1102589 100644
--- a/public/domain.te
+++ b/public/domain.te
@@ -1120,21 +1120,21 @@ neverallow * {
   -asec_public_file
 }:file execmod;
 
 # Do not allow making the stack or heap executable.
 # We would also like to minimize execmem but it seems to be
 # required by some device-specific service domains.
 neverallow * self:process { execstack execheap };
 
 # Do not allow the introduction of new execmod rules. Text relocations
 # and modification of executable pages are unsafe.
-neverallow { domain -untrusted_app_25 -untrusted_app_27 } file_type:file execmod;
+neverallow { domain -untrusted_app_25 -untrusted_base_app_25 -untrusted_app_27 -untrusted_base_app_27 } file_type:file execmod;
 
 neverallow { domain -init } proc:{ file dir } mounton;
 
 # Ensure that all types assigned to processes are included
 # in the domain attribute, so that all allow and neverallow rules
 # written on domain are applied to all processes.
 # This is achieved by ensuring that it is impossible to transition
 # from a domain to a non-domain type and vice versa.
 # TODO - rework this: neverallow domain ~domain:process { transition dyntransition };
 neverallow ~domain domain:process { transition dyntransition };
@@ -1413,12 +1413,14 @@ neverallow {
   -hal_codec2_server
   -hal_omx_server
 } hal_codec2_hwservice:hwservice_manager add;
 
 # Only apps targetting < Q are allowed to open /dev/ashmem directly.
 # Apps must use ASharedMemory NDK API. Native code must use libcutils API.
 neverallow {
   domain
   -ephemeral_app # We don't distinguish ephemeral apps based on target API.
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } ashmem_device:chr_file open;
diff --git a/public/untrusted_base_app.te b/public/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..39071d9b9f5dc468d2e063c0ce663f35c9c890d6
--- /dev/null
+++ b/public/untrusted_base_app.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app, domain;
diff --git a/public/untrusted_base_app_25.te b/public/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..45763c533f84f2e46bfebd0e5add6a8261f2d3eb
--- /dev/null
+++ b/public/untrusted_base_app_25.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_25, domain;
diff --git a/public/untrusted_base_app_27.te b/public/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..62a8618a6d9e069d03c6d233bc0458f407fc5f98
--- /dev/null
+++ b/public/untrusted_base_app_27.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_27, domain;
diff --git a/public/untrusted_base_app_29.te b/public/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..f6b7aa8ea60c9172cc4bbf55eefcce307d60a398
--- /dev/null
+++ b/public/untrusted_base_app_29.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_29, domain;
diff --git a/tests/treble_sepolicy_tests.py b/tests/treble_sepolicy_tests.py
index cf1e85670568e1e1a4852628a7db120237af55c0..9fd8476bf2c5ce867c413065e8c1b0856d2d50d1 100644
--- a/tests/treble_sepolicy_tests.py
+++ b/tests/treble_sepolicy_tests.py
@@ -21,21 +21,23 @@ coreAppdomain = {
         'ephemeral_app',
         'isolated_app',
         'nfc',
         'platform_app',
         'priv_app',
         'radio',
         'shared_relro',
         'shell',
         'system_app',
         'untrusted_app',
+        'untrusted_base_app',
         'untrusted_app_25',
+        'untrusted_base_app_25'
         }
 coredomainWhitelist = {
         'adbd',
         'kernel',
         'postinstall',
         'postinstall_dexopt',
         'recovery',
         'system_server',
         'vendor_init',
         }

commit 193e0b10a3a844903cb61ac00f0ca302df0e0fea
Author: Renlord <me@renlord.com>
Date:   Sun 2020-02-23 22:41:07+1100

    split base isolated app
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/app_neverallows.te      |   1 +
 prebuilts/api/30.0/private/app_zygote.te           |   4 +-
 .../api/30.0/private/compat/26.0/26.0.ignore.cil   |   1 +
 .../api/30.0/private/compat/27.0/27.0.ignore.cil   |   1 +
 .../api/30.0/private/compat/28.0/28.0.ignore.cil   |   1 +
 .../api/30.0/private/compat/29.0/29.0.ignore.cil   |   1 +
 .../api/30.0/private/isolated_base_app.te (new)    | 152 +++++++++++++++++++++
 prebuilts/api/30.0/private/seapp_contexts          |   6 +-
 prebuilts/api/30.0/private/technical_debt.cil      |  30 ++--
 prebuilts/api/30.0/private/webview_zygote.te       |   4 +-
 prebuilts/api/30.0/public/app.te                   |  71 +++++-----
 prebuilts/api/30.0/public/domain.te                |   3 +-
 prebuilts/api/30.0/public/hal_camera.te            |   2 +-
 prebuilts/api/30.0/public/hal_drm.te               |   2 +-
 prebuilts/api/30.0/public/hal_omx.te               |   2 +-
 prebuilts/api/30.0/public/hal_sensors.te           |   2 +-
 .../api/30.0/public/isolated_base_app.te (new)     |   9 ++
 private/app_neverallows.te                         |   1 +
 private/app_zygote.te                              |   4 +-
 private/compat/26.0/26.0.ignore.cil                |   1 +
 private/compat/27.0/27.0.ignore.cil                |   1 +
 private/compat/28.0/28.0.ignore.cil                |   1 +
 private/compat/29.0/29.0.ignore.cil                |   1 +
 private/isolated_base_app.te (new)                 | 152 +++++++++++++++++++++
 private/seapp_contexts                             |   6 +-
 private/technical_debt.cil                         |  30 ++--
 private/webview_zygote.te                          |   4 +-
 public/app.te                                      |  71 +++++-----
 public/domain.te                                   |   3 +-
 public/hal_camera.te                               |   2 +-
 public/hal_drm.te                                  |   2 +-
 public/hal_omx.te                                  |   2 +-
 public/hal_sensors.te                              |   2 +-
 public/isolated_base_app.te (new)                  |   9 ++
 34 files changed, 466 insertions(+), 118 deletions(-)

diff --git a/prebuilts/api/30.0/private/app_neverallows.te b/prebuilts/api/30.0/private/app_neverallows.te
index 6fcc900f0b790bd97d570370e2e2cab2dbce675c..3823d4d110569962ea0697b809d137d17fbb8fa9 100644
--- a/prebuilts/api/30.0/private/app_neverallows.te
+++ b/prebuilts/api/30.0/private/app_neverallows.te
@@ -1,17 +1,18 @@
 ###
 ### neverallow rules for untrusted app domains
 ###
 
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
+  isolated_base_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
   untrusted_base_app
   untrusted_base_app_25
   untrusted_base_app_27
diff --git a/prebuilts/api/30.0/private/app_zygote.te b/prebuilts/api/30.0/private/app_zygote.te
index 9285323221de8fa20b6f97c91d56822a042931c1..a68cb56e107d4b0c8a1fa8b7aa8f31d6adcdff83 100644
--- a/prebuilts/api/30.0/private/app_zygote.te
+++ b/prebuilts/api/30.0/private/app_zygote.te
@@ -9,34 +9,36 @@ typeattribute app_zygote coredomain;
 tmpfs_domain(app_zygote);
 
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
+allow app_zygote isolated_base_app:process dyntransition;
 
 # For JIT
 allow app_zygote self:process execmem;
 
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
+allow app_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 dontaudit app_zygote mnt_expand_file:dir getattr;
 
 # Get seapp_contexts
 allow app_zygote seapp_contexts_file:file r_file_perms;
 # Check validity of SELinux context before use.
 selinux_check_context(app_zygote)
 # Check SELinux permissions.
 selinux_check_access(app_zygote)
@@ -68,21 +70,21 @@ allow app_zygote system_data_file:lnk_file r_file_perms;
 allow app_zygote system_data_file:file { getattr read map };
 
 # Send unsolicited message to system_server
 unix_socket_send(app_zygote, system_unsolzygote, system_server)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow app_zygote { domain -isolated_app }:process dyntransition;
+neverallow app_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow app_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow app_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # app_zygote child.
diff --git a/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil b/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil
index 020d43395a80eecba2421273074b9a7c9eaa2b53..ca409549bd0337b17cef738134286cf4f7ed4a58 100644
--- a/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/26.0/26.0.ignore.cil
@@ -96,20 +96,21 @@
     heapprofd
     heapprofd_exec
     heapprofd_socket
     incident_helper
     incident_helper_exec
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     kmsg_debug_device
     last_boot_reason_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     looper_stats_service
     lowpan_device
     lowpan_prop
     lowpan_service
diff --git a/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil b/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil
index 5d940a02156828950d0a00c5e283594972619e92..005449ebdc1e740fcbd3e4303a6d21afb60b8cb6 100644
--- a/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/27.0/27.0.ignore.cil
@@ -87,20 +87,21 @@
     heapprofd
     heapprofd_exec
     heapprofd_socket
     incident_helper
     incident_helper_exec
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     last_boot_reason_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     looper_stats_service
     lowpan_device
     lowpan_prop
     lowpan_service
     mediaextractor_update_service
diff --git a/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil b/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil
index 4bd643e614bd10128b67638341ed6cfdc3b13a9e..981a296b258817b3eb19092faeb2ae5bd703b805 100644
--- a/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/28.0/28.0.ignore.cil
@@ -88,20 +88,21 @@
     looper_stats_service
     lpdumpd
     lpdumpd_exec
     lpdumpd_prop
     lpdump_service
     iorapd
     iorapd_exec
     iorapd_data_file
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     mediaswcodec
     mediaswcodec_exec
     mediaswcodec_tmpfs
     metadata_bootstat_file
     mnt_product_file
     network_stack
     network_stack_service
     network_stack_tmpfs
     nnapi_ext_deny_product_prop
     overlayfs_file
diff --git a/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil b/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
index caf2830723979262eb285dc0bf994ab4113108ee..d71344739fdf07fb0e75af37a480ec3f650ca221 100644
--- a/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
+++ b/prebuilts/api/30.0/private/compat/29.0/29.0.ignore.cil
@@ -65,20 +65,21 @@
     init_perf_lsm_hooks_prop
     init_svc_debug_prop
     iorap_inode2filename
     iorap_inode2filename_data_file
     iorap_inode2filename_exec
     iorap_inode2filename_tmpfs
     iorap_prefetcherd
     iorap_prefetcherd_data_file
     iorap_prefetcherd_exec
     iorap_prefetcherd_tmpfs
+    isolated_base_app
     mediatranscoding_service
     mediatranscoding
     mediatranscoding_exec
     mediatranscoding_tmpfs
     mirror_data_file
     light_service
     linkerconfig_file
     lmkd_prop
     media_variant_prop
     metadata_bootstat_file
diff --git a/prebuilts/api/30.0/private/isolated_base_app.te b/prebuilts/api/30.0/private/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..67029f10ec821c1d3f511f8b567bfdb3f8f1b0df
--- /dev/null
+++ b/prebuilts/api/30.0/private/isolated_base_app.te
@@ -0,0 +1,152 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+typeattribute isolated_base_app coredomain;
+
+app_domain(isolated_base_app)
+
+# Access already open app data files received over Binder or local socket IPC.
+allow isolated_base_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
+
+# Allow access to network sockets received over IPC. New socket creation is not
+# permitted.
+allow isolated_base_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
+
+allow isolated_base_app activity_service:service_manager find;
+allow isolated_base_app display_service:service_manager find;
+allow isolated_base_app webviewupdate_service:service_manager find;
+
+# Google Breakpad (crash reporter for Chrome) relies on ptrace
+# functionality. Without the ability to ptrace, the crash reporter
+# tool is broken.
+# b/20150694
+# https://code.google.com/p/chromium/issues/detail?id=475270
+allow isolated_base_app self:process ptrace;
+
+# b/32896414: Allow accessing sdcard file descriptors passed to isolated_base_apps
+# by other processes. Open should never be allowed, and is blocked by
+# neverallow rules below.
+# media_rw_data_file is included for sdcardfs, and can be removed if sdcardfs
+# is modified to change the secontext when accessing the lower filesystem.
+allow isolated_base_app { sdcard_type media_rw_data_file }:file { read write append getattr lock map };
+
+# For webviews, isolated_base_app processes can be forked from the webview_zygote
+# in addition to the zygote. Allow access to resources inherited from the
+# webview_zygote process. These rules are specialized copies of the ones in app.te.
+# Inherit FDs from the webview_zygote.
+allow isolated_base_app webview_zygote:fd use;
+# Notify webview_zygote of child death.
+allow isolated_base_app webview_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app webview_zygote:unix_dgram_socket write;
+# Read system properties managed by webview_zygote.
+allow isolated_base_app webview_zygote_tmpfs:file read;
+
+# Inherit FDs from the app_zygote.
+allow isolated_base_app app_zygote:fd use;
+# Notify app_zygote of child death.
+allow isolated_base_app app_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app app_zygote:unix_dgram_socket write;
+
+# TODO (b/63631799) fix this access
+# suppress denials to /data/local/tmp
+dontaudit isolated_base_app shell_data_file:dir search;
+
+# Write app-specific trace data to the Perfetto traced damon. This requires
+# connecting to its producer socket and obtaining a (per-process) tmpfs fd.
+perfetto_producer(isolated_base_app)
+
+# Allow profiling if the main app has been marked as profileable or
+# debuggable.
+can_profile_heap(isolated_base_app)
+can_profile_perf(isolated_base_app)
+
+#####
+##### Neverallow
+#####
+
+# Isolated apps should not directly open app data files themselves.
+neverallow isolated_base_app { app_data_file privapp_data_file }:file open;
+
+# Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
+# TODO: are there situations where isolated_base_apps write to this file?
+# TODO: should we tighten these restrictions further?
+neverallow isolated_base_app anr_data_file:file ~{ open append };
+neverallow isolated_base_app anr_data_file:dir ~search;
+
+# Isolated apps must not be permitted to use HwBinder
+neverallow isolated_base_app hwbinder_device:chr_file *;
+neverallow isolated_base_app *:hwservice_manager *;
+
+# Isolated apps must not be permitted to use VndBinder
+neverallow isolated_base_app vndbinder_device:chr_file *;
+
+# Isolated apps must not be permitted to perform actions on Binder and VndBinder service_manager
+# except the find actions for services whitelisted below.
+neverallow isolated_base_app *:service_manager ~find;
+
+# b/17487348
+# Isolated apps can only access three services,
+# activity_service, display_service, webviewupdate_service.
+neverallow isolated_base_app {
+    service_manager_type
+    -activity_service
+    -display_service
+    -webviewupdate_service
+}:service_manager find;
+
+# Isolated apps shouldn't be able to access the driver directly.
+neverallow isolated_base_app gpu_device:chr_file { rw_file_perms execute };
+
+# Do not allow isolated_base_app access to /cache
+neverallow isolated_base_app cache_file:dir ~{ r_dir_perms };
+neverallow isolated_base_app cache_file:file ~{ read getattr };
+
+# Do not allow isolated_base_app to access external storage, except for files passed
+# via file descriptors (b/32896414).
+neverallow isolated_base_app { storage_file mnt_user_file sdcard_type }:dir ~getattr;
+neverallow isolated_base_app { storage_file mnt_user_file }:file_class_set *;
+neverallow isolated_base_app sdcard_type:{ devfile_class_set lnk_file sock_file fifo_file } *;
+neverallow isolated_base_app sdcard_type:file ~{ read write append getattr lock map };
+
+# Do not allow USB access
+neverallow isolated_base_app { usb_device usbaccessory_device }:chr_file *;
+
+# Restrict the webview_zygote control socket.
+neverallow isolated_base_app webview_zygote:sock_file write;
+
+# Limit the /sys files which isolated_base_app can access. This is important
+# for controlling isolated_base_app attack surface.
+neverallow isolated_base_app {
+  sysfs_type
+  -sysfs_devices_system_cpu
+  -sysfs_transparent_hugepage
+  -sysfs_usb # TODO: check with audio team if needed for isolated_base_app (b/28417852)
+}:file no_rw_file_perms;
+
+# No creation of sockets families other than AF_UNIX sockets.
+# List taken from system/sepolicy/public/global_macros - socket_class_set
+# excluding unix_stream_socket and unix_dgram_socket.
+# Many of these are socket families which have never and will never
+# be compiled into the Android kernel.
+neverallow isolated_base_app { self ephemeral_app priv_app untrusted_app_all }:{
+  socket tcp_socket udp_socket rawip_socket netlink_socket packet_socket
+  key_socket appletalk_socket netlink_route_socket
+  netlink_tcpdiag_socket netlink_nflog_socket netlink_xfrm_socket
+  netlink_selinux_socket netlink_audit_socket netlink_dnrt_socket
+  netlink_kobject_uevent_socket tun_socket netlink_iscsi_socket
+  netlink_fib_lookup_socket netlink_connector_socket netlink_netfilter_socket
+  netlink_generic_socket netlink_scsitransport_socket netlink_rdma_socket
+  netlink_crypto_socket sctp_socket icmp_socket ax25_socket ipx_socket
+  netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket atmsvc_socket
+  rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
+  bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket
+  ieee802154_socket caif_socket alg_socket nfc_socket vsock_socket kcm_socket
+  qipcrtr_socket smc_socket xdp_socket
+} create;
diff --git a/prebuilts/api/30.0/private/seapp_contexts b/prebuilts/api/30.0/private/seapp_contexts
index 5ecde07c2e0803a18bdf35eb28b50d97b45092f3..31db163c0ad5e794a46a61110406d118687a60c0 100644
--- a/prebuilts/api/30.0/private/seapp_contexts
+++ b/prebuilts/api/30.0/private/seapp_contexts
@@ -118,22 +118,22 @@ neverallow user=((?!system).)* type=system_app_data_file
 neverallow user=_app isPrivApp=false name=.* seinfo=""
 neverallow user=_app isPrivApp=false name=.* seinfo=default
 
 # neverallow shared relro to any other domain
 # and neverallow any other uid into shared_relro
 neverallow user=shared_relro domain=((?!shared_relro).)*
 neverallow user=((?!shared_relro).)* domain=shared_relro
 
 # neverallow non-isolated uids into isolated_app domain
 # and vice versa
-neverallow user=_isolated domain=((?!isolated_app).)*
-neverallow user=((?!_isolated).)* domain=isolated_app
+neverallow user=_isolated domain=((?!isolated_(base_)?app).)*
+neverallow user=((?!_isolated).)* domain=isolated_base_app
 
 # uid shell should always be in shell domain, however non-shell
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
@@ -145,21 +145,21 @@ user=_app seinfo=platform name=com.android.traceur domain=traceur_app type=app_d
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack levelFrom=all type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
 user=shared_relro seinfo=base domain=shared_relro
 user=shared_relro domain=shared_relro
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
-user=_isolated seinfo=base domain=isolated_app levelFrom=user
+user=_isolated seinfo=base domain=isolated_base_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
diff --git a/prebuilts/api/30.0/private/technical_debt.cil b/prebuilts/api/30.0/private/technical_debt.cil
index fdcd0a3323147d9585d2aad3fc7c2903caa0a77b..142f25bfd3d644344fdc5a7ceaaa2ae53d1cdaf0 100644
--- a/prebuilts/api/30.0/private/technical_debt.cil
+++ b/prebuilts/api/30.0/private/technical_debt.cil
@@ -1,65 +1,65 @@
 ; THIS IS A WORKAROUND for the current limitations of the module policy language
 ; This should be used sparingly until we figure out a saner way to achieve the
 ; stuff below, for example, by improving typeattribute statement of module
 ; language.
 ;
 ; NOTE: This file has no effect on recovery policy.
 
 ; Apps, except isolated apps, are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_allocator_client;
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_allocator_client;
 ;     typeattribute hal_allocator_client halclientdomain;
-(typeattributeset hal_allocator_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 (typeattributeset halclientdomain (hal_allocator_client))
 
 ; Apps, except isolated apps, are clients of OMX-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_omx_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_omx_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Codec2-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_codec2_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_codec2_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Drm-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_drm_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_drm_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Configstore HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_configstore_client;
-(typeattributeset hal_configstore_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_configstore_client;
+(typeattributeset hal_configstore_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Graphics Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_graphics_allocator_client;
-(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_graphics_allocator_client;
+(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Cas HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_cas_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_cas_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Domains hosting Camera HAL implementations are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute hal_camera hal_allocator_client;
 (typeattributeset hal_allocator_client (hal_camera))
 
 ; Apps, except isolated apps, are clients of Neuralnetworks HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_neuralnetworks_client;
-(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_neuralnetworks_client;
+(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; TODO(b/112056006): move these to mapping files when/if we implement 'versioned' attributes.
 ; Rename untrusted_app_visible_* to untrusted_app_visible_*_violators.
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute untrusted_app_visible_hwservice untrusted_app_visible_hwservice_violators;
 ;     typeattribute untrusted_app_visible_halserver untrusted_app_visible_halserver_violators;
 (typeattribute untrusted_app_visible_hwservice)
 (typeattributeset untrusted_app_visible_hwservice_violators (untrusted_app_visible_hwservice))
 (typeattribute untrusted_app_visible_halserver)
 (typeattributeset untrusted_app_visible_halserver_violators (untrusted_app_visible_halserver))
 
 ; Apps, except isolated apps, are clients of BufferHub HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
diff --git a/prebuilts/api/30.0/private/webview_zygote.te b/prebuilts/api/30.0/private/webview_zygote.te
index 969ab9cc92c054f0e74fe9cbccbbb2ad692f64da..9dbf0e7d5a59db7ba59a8d082eb1d8fcb3c8a59c 100644
--- a/prebuilts/api/30.0/private/webview_zygote.te
+++ b/prebuilts/api/30.0/private/webview_zygote.te
@@ -19,39 +19,41 @@ allow webview_zygote apk_data_file:file { r_file_perms execute };
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
+allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote dalvikcache_data_file:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote dalvikcache_data_file:file { r_file_perms execute };
 
 # Allow webview_zygote to create JIT memory.
 allow webview_zygote self:process execmem;
 
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
+allow webview_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 # Suppress denials to storage. Webview zygote should not be accessing.
 dontaudit webview_zygote mnt_expand_file:dir getattr;
 
 # TODO (b/72957399) remove this when webview_zygote is reparented to
 # app_process zygote
 dontaudit webview_zygote dex2oat_exec:file execute;
 
 # Get seapp_contexts
@@ -78,21 +80,21 @@ allow webview_zygote same_process_hal_file:file { execute read open getattr map
 allow webview_zygote system_data_file:lnk_file r_file_perms;
 
 # Send unsolicited message to system_server
 unix_socket_send(webview_zygote, system_unsolzygote, system_server)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow webview_zygote { domain -isolated_app }:process dyntransition;
+neverallow webview_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow webview_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow webview_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # webview_zygote child.
diff --git a/prebuilts/api/30.0/public/app.te b/prebuilts/api/30.0/public/app.te
index 0925233f43753268e11e17aab13f6af5916e3fcb..290292fa190d090f9ec8a414e680f80efd203458 100644
--- a/prebuilts/api/30.0/public/app.te
+++ b/prebuilts/api/30.0/public/app.te
@@ -23,22 +23,22 @@ allow appdomain zygote:fd use;
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;
 
 # Read /data/dalvik-cache.
 allow appdomain dalvikcache_data_file:dir { search getattr };
 allow appdomain dalvikcache_data_file:file r_file_perms;
 
 # Read the /sdcard and /mnt/sdcard symlinks
-allow { appdomain -isolated_app } rootfs:lnk_file r_file_perms;
-allow { appdomain -isolated_app } tmpfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } rootfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } tmpfs:lnk_file r_file_perms;
 
 # Search /storage/emulated tmpfs mount.
 allow appdomain tmpfs:dir r_dir_perms;
 
 # Notify zygote of the wrapped process PID when using --invoke-with.
 allow appdomain zygote:fifo_file write;
 
 userdebug_or_eng(`
   # Allow apps to create and write method traces in /data/misc/trace.
   allow appdomain method_trace_data_file:dir w_dir_perms;
@@ -61,33 +61,33 @@ allow appdomain system_server:tcp_socket { read write getattr getopt shutdown };
 # For AppFuse.
 allow appdomain vold:fd use;
 
 # Communication with other apps via fifos
 allow appdomain appdomain:fifo_file rw_file_perms;
 
 # Communicate with surfaceflinger.
 allow appdomain surfaceflinger:unix_stream_socket { read write setopt getattr getopt shutdown };
 
 # App sandbox file accesses.
-allow { appdomain -isolated_app } { app_data_file privapp_data_file }:dir create_dir_perms;
-allow { appdomain -isolated_app } { app_data_file privapp_data_file }:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } { app_data_file privapp_data_file }:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app } { app_data_file privapp_data_file }:file create_file_perms;
 
 # Traverse into expanded storage
 allow appdomain mnt_expand_file:dir r_dir_perms;
 
 # Keychain and user-trusted credentials
 r_dir_file(appdomain, keychain_data_file)
 allow appdomain misc_user_data_file:dir r_dir_perms;
 allow appdomain misc_user_data_file:file r_file_perms;
 
 # TextClassifier
-r_dir_file({ appdomain -isolated_app }, textclassifier_data_file)
+r_dir_file({ appdomain -isolated_app -isolated_base_app }, textclassifier_data_file)
 
 # Access to OEM provided data and apps
 allow appdomain oemfs:dir r_dir_perms;
 allow appdomain oemfs:file rx_file_perms;
 
 # Execute the shell or other system executables.
 allow { appdomain -ephemeral_app } shell_exec:file rx_file_perms;
 allow { appdomain -ephemeral_app } toolbox_exec:file rx_file_perms;
 allow appdomain system_file:file x_file_perms;
 not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perms;')
@@ -96,21 +96,21 @@ not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perm
 allow appdomain system_file:dir r_dir_perms;
 allow appdomain system_file:lnk_file { getattr open read };
 # Renderscript specific permissions to open /system/vendor/lib64.
 not_full_treble(`
     allow appdomain vendor_file_type:dir r_dir_perms;
     allow appdomain vendor_file_type:lnk_file { getattr open read };
 ')
 
 full_treble_only(`
     # For looking up Renderscript vendor drivers
-    allow { appdomain -isolated_app } vendor_file:dir { open read };
+    allow { appdomain -isolated_app -isolated_base_app } vendor_file:dir { open read };
 ')
 
 # Allow apps access to /vendor/app except for privileged
 # apps which cannot be in /vendor.
 r_dir_file({ appdomain -ephemeral_app }, vendor_app_file)
 allow { appdomain -ephemeral_app } vendor_app_file:file execute;
 
 # Allow apps access to /vendor/overlay
 r_dir_file(appdomain, vendor_overlay_file)
 
@@ -181,44 +181,46 @@ userdebug_or_eng(`
 ')
 
 # /proc/net access.
 # TODO(b/9496886) Audit access for removal.
 # proc_net access for the negated domains below is granted (or not) in their
 # individual .te files.
 r_dir_file({
   appdomain
   -ephemeral_app
   -isolated_app
+  -isolated_base_app
   -platform_app
   -priv_app
   -shell
   -system_app
   -untrusted_app_all
 }, proc_net_type)
 # audit access for all these non-core app domains.
 userdebug_or_eng(`
   auditallow {
     appdomain
     -ephemeral_app
     -isolated_app
+    -isolated_base_app
     -platform_app
     -priv_app
     -shell
     -su
     -system_app
     -untrusted_app_all
   } proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 # Grant GPU access to all processes started by Zygote.
 # They need that to render the standard UI.
-allow { appdomain -isolated_app } gpu_device:chr_file rw_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } gpu_device:chr_file rw_file_perms;
 
 # Use the Binder.
 binder_use(appdomain)
 # Perform binder IPC to binder services.
 binder_call(appdomain, binderservicedomain)
 # Perform binder IPC to other apps.
 binder_call(appdomain, appdomain)
 # Perform binder IPC to ephemeral apps.
 binder_call(appdomain, ephemeral_app)
 
@@ -234,47 +236,47 @@ allow appdomain appdomain:unix_stream_socket { getopt getattr read write shutdow
 # Backup ability for every app. BMS opens and passes the fd
 # to any app that has backup ability. Hence, no open permissions here.
 allow appdomain backup_data_file:file { read write getattr map };
 allow appdomain cache_backup_file:file { read write getattr map };
 allow appdomain cache_backup_file:dir getattr;
 # Backup ability using 'adb backup'
 allow appdomain system_data_file:lnk_file r_file_perms;
 allow appdomain system_data_file:file { getattr read map };
 
 # Allow read/stat of /data/media files passed by Binder or local socket IPC.
-allow { appdomain -isolated_app } media_rw_data_file:file { read getattr };
+allow { appdomain -isolated_app -isolated_base_app } media_rw_data_file:file { read getattr };
 
 # Read and write /data/data/com.android.providers.telephony files passed over Binder.
-allow { appdomain -isolated_app } radio_data_file:file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app } radio_data_file:file { read write getattr };
 
 # Allow access to external storage; we have several visible mount points under /storage
 # and symlinks to primary storage at places like /storage/sdcard0 and /mnt/user/0/primary
-allow { appdomain -isolated_app -ephemeral_app } storage_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } storage_file:lnk_file r_file_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
 
 # Read/write visible storage
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:file create_file_perms;
 # This should be removed if sdcardfs is modified to alter the secontext for its
 # accesses to the underlying FS.
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:file create_file_perms;
 
 # Allow apps to use the USB Accessory interface.
 # http://developer.android.com/guide/topics/connectivity/usb/accessory.html
 #
 # USB devices are first opened by the system server (USBDeviceManagerService)
 # and the file descriptor is passed to the right Activity via binder.
-allow { appdomain -isolated_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
-allow { appdomain -isolated_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
 
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
@@ -284,70 +286,70 @@ allow appdomain apk_data_file:file rx_file_perms;
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
 
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
 
-use_keystore({ appdomain -isolated_app -ephemeral_app })
+use_keystore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
-use_credstore({ appdomain -isolated_app -ephemeral_app })
+use_credstore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
 allow appdomain console_device:chr_file { read write };
 
 # only allow unprivileged socket ioctl commands
 allowxperm { appdomain -bluetooth } self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
-allow { appdomain -isolated_app } ion_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } ion_device:chr_file r_file_perms;
 
 # Allow AAudio apps to use shared memory file descriptors from the HAL
-allow { appdomain -isolated_app } hal_audio:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_audio:fd use;
 
 # Allow app to access shared memory created by camera HAL1
-allow { appdomain -isolated_app } hal_camera:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_camera:fd use;
 
 # RenderScript always-passthrough HAL
-allow { appdomain -isolated_app } hal_renderscript_hwservice:hwservice_manager find;
+allow { appdomain -isolated_app -isolated_base_app } hal_renderscript_hwservice:hwservice_manager find;
 allow appdomain same_process_hal_file:file { execute read open getattr map };
 
 # TODO: switch to meminfo service
 allow appdomain proc_meminfo:file r_file_perms;
 
 # For app fuse.
 allow appdomain app_fuse_file:file { getattr read append write map };
 
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_client)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_manager)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_vsync)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, performance_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_manager)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_vsync)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, performance_client)
 # Apps do not directly open the IPC socket for bufferhubd.
-pdx_use({ appdomain -isolated_app -ephemeral_app }, bufferhub_client)
+pdx_use({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, bufferhub_client)
 
 ###
 ### CTS-specific rules
 ###
 
 # For cts/tests/tests/permission/src/android/permission/cts/FileSystemPermissionTest.java.
 # testRunAsHasCorrectCapabilities
 allow appdomain runas_exec:file getattr;
 # Others are either allowed elsewhere or not desired.
 
 # Apps receive an open tun fd from the framework for
 # device traffic. Do not allow untrusted app to directly open tun_device
-allow { appdomain -isolated_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
-allowxperm { appdomain -isolated_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
+allowxperm { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
 
 # Connect to adbd and use a socket transferred from it.
 # This is used for e.g. adb backup/restore.
 allow appdomain adbd:unix_stream_socket connectto;
 allow appdomain adbd:fd use;
 allow appdomain adbd:unix_stream_socket { getattr getopt ioctl read write shutdown };
 
 allow appdomain cache_file:dir getattr;
 
 # Allow apps to run with asanwrapper.
@@ -378,21 +380,21 @@ neverallow appdomain dev_type:blk_file { read write };
 neverallow appdomain {
     audio_device
     camera_device
     dm_device
     radio_device
     rpmsg_device
     video_device
 }:chr_file { read write };
 
 # Note: Try expanding list of app domains in the future.
-neverallow { untrusted_app isolated_app shell } graphics_device:chr_file { read write };
+neverallow { untrusted_app isolated_app isolated_base_app shell } graphics_device:chr_file { read write };
 
 neverallow { appdomain -nfc } nfc_device:chr_file
     { read write };
 neverallow { appdomain -bluetooth } hci_attach_dev:chr_file
     { read write };
 neverallow appdomain tee_device:chr_file { read write };
 
 # Privileged netlink socket interfaces.
 neverallow { appdomain -network_stack }
     domain:{
@@ -536,20 +538,21 @@ neverallow appdomain {
   dev_type
   rootfs
   system_file
   tmpfs
 }:lnk_file no_w_file_perms;
 
 # Blacklist app domains not allowed to execute from /data
 neverallow {
   bluetooth
   isolated_app
+  isolated_base_app
   nfc
   radio
   shared_relro
   system_app
 } {
   data_file_type
   -dalvikcache_data_file
   -system_data_file # shared libs in apks
   -apk_data_file
 }:file no_x_file_perms;
diff --git a/prebuilts/api/30.0/public/domain.te b/prebuilts/api/30.0/public/domain.te
index 94031e3041324b2a489d04906ee45ccae1102589..0f78575a24470ba231c8c96174bb1394274b01c4 100644
--- a/prebuilts/api/30.0/public/domain.te
+++ b/prebuilts/api/30.0/public/domain.te
@@ -81,21 +81,21 @@ allow domain ashmem_libcutils_device:chr_file rw_file_perms;
 allow { domain -hwservicemanager -vndservicemanager } binder_device:chr_file rw_file_perms;
 
 # Restrict binder ioctls to an allowlist. Additional ioctl commands may be
 # added to individual domains, but this sets safe defaults for all processes.
 allowxperm domain binder_device:chr_file ioctl unpriv_binder_ioctls;
 
 # /dev/binderfs needs to be accessed by everyone too!
 allow domain binderfs:dir { getattr search };
 allow domain binderfs_logs_proc:dir search;
 
-allow { domain -servicemanager -vndservicemanager -isolated_app } hwbinder_device:chr_file rw_file_perms;
+allow { domain -servicemanager -vndservicemanager -isolated_app -isolated_base_app } hwbinder_device:chr_file rw_file_perms;
 allow domain ptmx_device:chr_file rw_file_perms;
 allow domain random_device:chr_file rw_file_perms;
 allow domain proc_random:dir r_dir_perms;
 allow domain proc_random:file r_file_perms;
 allow domain properties_device:dir { search getattr };
 allow domain properties_serial:file r_file_perms;
 allow domain property_info:file r_file_perms;
 
 # Public readable properties
 get_prop(domain, debug_prop)
@@ -1167,20 +1167,21 @@ neverallow {
   -appdomain # finer-grained rules for appdomain are listed below
   -system_server #populate com.android.providers.settings/databases/settings.db.
   -installd # creation of app sandbox
   -iorap_inode2filename
   -traced_probes # resolve inodes for i/o tracing.
                  # only needs open and read, the rest is neverallow in
                  # traced_probes.te.
 } system_app_data_file:dir_file_class_set { create unlink open };
 neverallow {
   isolated_app
+  isolated_base_app
   untrusted_app_all # finer-grained rules for appdomain are listed below
   ephemeral_app
   priv_app
 } system_app_data_file:dir_file_class_set { create unlink open };
 
 #
 # Only these domains should transition to shell domain. This domain is
 # permissible for the "shell user". If you need a process to exec a shell
 # script with differing privilege, define a domain and set up a transition.
 #
diff --git a/prebuilts/api/30.0/public/hal_camera.te b/prebuilts/api/30.0/public/hal_camera.te
index 77216e4a388d35411ec6197ad51b9c49d2a63bd5..89e86a2794f666ff40fd927b7b9ee92b961c8ae3 100644
--- a/prebuilts/api/30.0/public/hal_camera.te
+++ b/prebuilts/api/30.0/public/hal_camera.te
@@ -6,21 +6,21 @@ hal_attribute_hwservice(hal_camera, hal_camera_hwservice)
 
 allow hal_camera device:dir r_dir_perms;
 allow hal_camera video_device:dir r_dir_perms;
 allow hal_camera video_device:chr_file rw_file_perms;
 allow hal_camera camera_device:chr_file rw_file_perms;
 allow hal_camera ion_device:chr_file rw_file_perms;
 # Both the client and the server need to use the graphics allocator
 allow { hal_camera_client hal_camera_server } hal_graphics_allocator:fd use;
 
 # Allow hal_camera to use fd from app,gralloc,and ashmem HAL
-allow hal_camera { appdomain -isolated_app }:fd use;
+allow hal_camera { appdomain -isolated_app -isolated_base_app }:fd use;
 allow hal_camera surfaceflinger:fd use;
 allow hal_camera hal_allocator_server:fd use;
 
 # Needed to provide debug dump output via dumpsys' pipes.
 allow hal_camera shell:fd use;
 allow hal_camera shell:fifo_file write;
 
 ###
 ### neverallow rules
 ###
diff --git a/prebuilts/api/30.0/public/hal_drm.te b/prebuilts/api/30.0/public/hal_drm.te
index 5987491344de5c4e5c574ab2f5e078676ace1596..ad90aecaaa820bc5ab229406b51719cf700caf21 100644
--- a/prebuilts/api/30.0/public/hal_drm.te
+++ b/prebuilts/api/30.0/public/hal_drm.te
@@ -27,21 +27,21 @@ allow hal_drm hal_graphics_allocator:fd use;
 # Allow access to hidl_memory allocation service
 allow hal_drm hal_allocator_server:fd use;
 
 # Allow access to fds allocated by mediaserver
 allow hal_drm mediaserver:fd use;
 
 allow hal_drm sysfs:file r_file_perms;
 
 allow hal_drm tee_device:chr_file rw_file_perms;
 
-allow hal_drm_server { appdomain -isolated_app }:fd use;
+allow hal_drm_server { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # only allow unprivileged socket ioctl commands
 allowxperm hal_drm self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
 ###
 ### neverallow rules
 ###
 
 # hal_drm should never execute any executable without a
diff --git a/prebuilts/api/30.0/public/hal_omx.te b/prebuilts/api/30.0/public/hal_omx.te
index 8e74383d31b59239c297fb4bbf31c07a93cf4ea3..b4940f30b0daffcd6094d6eb73ac91c0953271c4 100644
--- a/prebuilts/api/30.0/public/hal_omx.te
+++ b/prebuilts/api/30.0/public/hal_omx.te
@@ -1,15 +1,15 @@
 # applies all permissions to hal_omx NOT hal_omx_server
 # since OMX must always be in its own process.
 
 binder_call(hal_omx_server, binderservicedomain)
-binder_call(hal_omx_server, { appdomain -isolated_app })
+binder_call(hal_omx_server, { appdomain -isolated_app -isolated_base_app })
 
 # Allow hal_omx_server access to composer sync fences
 allow hal_omx_server hal_graphics_composer:fd use;
 
 allow hal_omx_server ion_device:chr_file rw_file_perms;
 allow hal_omx_server hal_camera:fd use;
 
 crash_dump_fallback(hal_omx_server)
 
 # Recieve gralloc buffer FDs from bufferhubd. Note that hal_omx_server never
diff --git a/prebuilts/api/30.0/public/hal_sensors.te b/prebuilts/api/30.0/public/hal_sensors.te
index 06e76f1e17e171b969f97e94461944d6c1d09892..0405b6eab322037f70965156f083dfc038c44c8d 100644
--- a/prebuilts/api/30.0/public/hal_sensors.te
+++ b/prebuilts/api/30.0/public/hal_sensors.te
@@ -1,14 +1,14 @@
 # HwBinder IPC from client to server
 binder_call(hal_sensors_client, hal_sensors_server)
 
 hal_attribute_hwservice(hal_sensors, hal_sensors_hwservice)
 
 # Allow sensor hals to access ashmem memory allocated by apps
-allow hal_sensors { appdomain -isolated_app }:fd use;
+allow hal_sensors { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # Allow sensor hals to access ashmem memory allocated by android.hidl.allocator
 # fd is passed in from framework sensorservice HAL.
 allow hal_sensors hal_allocator:fd use;
 
 # allow to run with real-time scheduling policy
 allow hal_sensors self:global_capability_class_set sys_nice;
diff --git a/prebuilts/api/30.0/public/isolated_base_app.te b/prebuilts/api/30.0/public/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..86740d042480b7f0c165b0e6f41cd0f1edce0b0f
--- /dev/null
+++ b/prebuilts/api/30.0/public/isolated_base_app.te
@@ -0,0 +1,9 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+type isolated_base_app, domain;
diff --git a/private/app_neverallows.te b/private/app_neverallows.te
index 6fcc900f0b790bd97d570370e2e2cab2dbce675c..3823d4d110569962ea0697b809d137d17fbb8fa9 100644
--- a/private/app_neverallows.te
+++ b/private/app_neverallows.te
@@ -1,17 +1,18 @@
 ###
 ### neverallow rules for untrusted app domains
 ###
 
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
+  isolated_base_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
   untrusted_base_app
   untrusted_base_app_25
   untrusted_base_app_27
diff --git a/private/app_zygote.te b/private/app_zygote.te
index 9285323221de8fa20b6f97c91d56822a042931c1..a68cb56e107d4b0c8a1fa8b7aa8f31d6adcdff83 100644
--- a/private/app_zygote.te
+++ b/private/app_zygote.te
@@ -9,34 +9,36 @@ typeattribute app_zygote coredomain;
 tmpfs_domain(app_zygote);
 
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
+allow app_zygote isolated_base_app:process dyntransition;
 
 # For JIT
 allow app_zygote self:process execmem;
 
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
+allow app_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 dontaudit app_zygote mnt_expand_file:dir getattr;
 
 # Get seapp_contexts
 allow app_zygote seapp_contexts_file:file r_file_perms;
 # Check validity of SELinux context before use.
 selinux_check_context(app_zygote)
 # Check SELinux permissions.
 selinux_check_access(app_zygote)
@@ -68,21 +70,21 @@ allow app_zygote system_data_file:lnk_file r_file_perms;
 allow app_zygote system_data_file:file { getattr read map };
 
 # Send unsolicited message to system_server
 unix_socket_send(app_zygote, system_unsolzygote, system_server)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow app_zygote { domain -isolated_app }:process dyntransition;
+neverallow app_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow app_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow app_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # app_zygote child.
diff --git a/private/compat/26.0/26.0.ignore.cil b/private/compat/26.0/26.0.ignore.cil
index 020d43395a80eecba2421273074b9a7c9eaa2b53..ca409549bd0337b17cef738134286cf4f7ed4a58 100644
--- a/private/compat/26.0/26.0.ignore.cil
+++ b/private/compat/26.0/26.0.ignore.cil
@@ -96,20 +96,21 @@
     heapprofd
     heapprofd_exec
     heapprofd_socket
     incident_helper
     incident_helper_exec
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     kmsg_debug_device
     last_boot_reason_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     looper_stats_service
     lowpan_device
     lowpan_prop
     lowpan_service
diff --git a/private/compat/27.0/27.0.ignore.cil b/private/compat/27.0/27.0.ignore.cil
index 5d940a02156828950d0a00c5e283594972619e92..005449ebdc1e740fcbd3e4303a6d21afb60b8cb6 100644
--- a/private/compat/27.0/27.0.ignore.cil
+++ b/private/compat/27.0/27.0.ignore.cil
@@ -87,20 +87,21 @@
     heapprofd
     heapprofd_exec
     heapprofd_socket
     incident_helper
     incident_helper_exec
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     last_boot_reason_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     looper_stats_service
     lowpan_device
     lowpan_prop
     lowpan_service
     mediaextractor_update_service
diff --git a/private/compat/28.0/28.0.ignore.cil b/private/compat/28.0/28.0.ignore.cil
index 4bd643e614bd10128b67638341ed6cfdc3b13a9e..981a296b258817b3eb19092faeb2ae5bd703b805 100644
--- a/private/compat/28.0/28.0.ignore.cil
+++ b/private/compat/28.0/28.0.ignore.cil
@@ -88,20 +88,21 @@
     looper_stats_service
     lpdumpd
     lpdumpd_exec
     lpdumpd_prop
     lpdump_service
     iorapd
     iorapd_exec
     iorapd_data_file
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     mediaswcodec
     mediaswcodec_exec
     mediaswcodec_tmpfs
     metadata_bootstat_file
     mnt_product_file
     network_stack
     network_stack_service
     network_stack_tmpfs
     nnapi_ext_deny_product_prop
     overlayfs_file
diff --git a/private/compat/29.0/29.0.ignore.cil b/private/compat/29.0/29.0.ignore.cil
index caf2830723979262eb285dc0bf994ab4113108ee..d71344739fdf07fb0e75af37a480ec3f650ca221 100644
--- a/private/compat/29.0/29.0.ignore.cil
+++ b/private/compat/29.0/29.0.ignore.cil
@@ -65,20 +65,21 @@
     init_perf_lsm_hooks_prop
     init_svc_debug_prop
     iorap_inode2filename
     iorap_inode2filename_data_file
     iorap_inode2filename_exec
     iorap_inode2filename_tmpfs
     iorap_prefetcherd
     iorap_prefetcherd_data_file
     iorap_prefetcherd_exec
     iorap_prefetcherd_tmpfs
+    isolated_base_app
     mediatranscoding_service
     mediatranscoding
     mediatranscoding_exec
     mediatranscoding_tmpfs
     mirror_data_file
     light_service
     linkerconfig_file
     lmkd_prop
     media_variant_prop
     metadata_bootstat_file
diff --git a/private/isolated_base_app.te b/private/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..67029f10ec821c1d3f511f8b567bfdb3f8f1b0df
--- /dev/null
+++ b/private/isolated_base_app.te
@@ -0,0 +1,152 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+typeattribute isolated_base_app coredomain;
+
+app_domain(isolated_base_app)
+
+# Access already open app data files received over Binder or local socket IPC.
+allow isolated_base_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
+
+# Allow access to network sockets received over IPC. New socket creation is not
+# permitted.
+allow isolated_base_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
+
+allow isolated_base_app activity_service:service_manager find;
+allow isolated_base_app display_service:service_manager find;
+allow isolated_base_app webviewupdate_service:service_manager find;
+
+# Google Breakpad (crash reporter for Chrome) relies on ptrace
+# functionality. Without the ability to ptrace, the crash reporter
+# tool is broken.
+# b/20150694
+# https://code.google.com/p/chromium/issues/detail?id=475270
+allow isolated_base_app self:process ptrace;
+
+# b/32896414: Allow accessing sdcard file descriptors passed to isolated_base_apps
+# by other processes. Open should never be allowed, and is blocked by
+# neverallow rules below.
+# media_rw_data_file is included for sdcardfs, and can be removed if sdcardfs
+# is modified to change the secontext when accessing the lower filesystem.
+allow isolated_base_app { sdcard_type media_rw_data_file }:file { read write append getattr lock map };
+
+# For webviews, isolated_base_app processes can be forked from the webview_zygote
+# in addition to the zygote. Allow access to resources inherited from the
+# webview_zygote process. These rules are specialized copies of the ones in app.te.
+# Inherit FDs from the webview_zygote.
+allow isolated_base_app webview_zygote:fd use;
+# Notify webview_zygote of child death.
+allow isolated_base_app webview_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app webview_zygote:unix_dgram_socket write;
+# Read system properties managed by webview_zygote.
+allow isolated_base_app webview_zygote_tmpfs:file read;
+
+# Inherit FDs from the app_zygote.
+allow isolated_base_app app_zygote:fd use;
+# Notify app_zygote of child death.
+allow isolated_base_app app_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app app_zygote:unix_dgram_socket write;
+
+# TODO (b/63631799) fix this access
+# suppress denials to /data/local/tmp
+dontaudit isolated_base_app shell_data_file:dir search;
+
+# Write app-specific trace data to the Perfetto traced damon. This requires
+# connecting to its producer socket and obtaining a (per-process) tmpfs fd.
+perfetto_producer(isolated_base_app)
+
+# Allow profiling if the main app has been marked as profileable or
+# debuggable.
+can_profile_heap(isolated_base_app)
+can_profile_perf(isolated_base_app)
+
+#####
+##### Neverallow
+#####
+
+# Isolated apps should not directly open app data files themselves.
+neverallow isolated_base_app { app_data_file privapp_data_file }:file open;
+
+# Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
+# TODO: are there situations where isolated_base_apps write to this file?
+# TODO: should we tighten these restrictions further?
+neverallow isolated_base_app anr_data_file:file ~{ open append };
+neverallow isolated_base_app anr_data_file:dir ~search;
+
+# Isolated apps must not be permitted to use HwBinder
+neverallow isolated_base_app hwbinder_device:chr_file *;
+neverallow isolated_base_app *:hwservice_manager *;
+
+# Isolated apps must not be permitted to use VndBinder
+neverallow isolated_base_app vndbinder_device:chr_file *;
+
+# Isolated apps must not be permitted to perform actions on Binder and VndBinder service_manager
+# except the find actions for services whitelisted below.
+neverallow isolated_base_app *:service_manager ~find;
+
+# b/17487348
+# Isolated apps can only access three services,
+# activity_service, display_service, webviewupdate_service.
+neverallow isolated_base_app {
+    service_manager_type
+    -activity_service
+    -display_service
+    -webviewupdate_service
+}:service_manager find;
+
+# Isolated apps shouldn't be able to access the driver directly.
+neverallow isolated_base_app gpu_device:chr_file { rw_file_perms execute };
+
+# Do not allow isolated_base_app access to /cache
+neverallow isolated_base_app cache_file:dir ~{ r_dir_perms };
+neverallow isolated_base_app cache_file:file ~{ read getattr };
+
+# Do not allow isolated_base_app to access external storage, except for files passed
+# via file descriptors (b/32896414).
+neverallow isolated_base_app { storage_file mnt_user_file sdcard_type }:dir ~getattr;
+neverallow isolated_base_app { storage_file mnt_user_file }:file_class_set *;
+neverallow isolated_base_app sdcard_type:{ devfile_class_set lnk_file sock_file fifo_file } *;
+neverallow isolated_base_app sdcard_type:file ~{ read write append getattr lock map };
+
+# Do not allow USB access
+neverallow isolated_base_app { usb_device usbaccessory_device }:chr_file *;
+
+# Restrict the webview_zygote control socket.
+neverallow isolated_base_app webview_zygote:sock_file write;
+
+# Limit the /sys files which isolated_base_app can access. This is important
+# for controlling isolated_base_app attack surface.
+neverallow isolated_base_app {
+  sysfs_type
+  -sysfs_devices_system_cpu
+  -sysfs_transparent_hugepage
+  -sysfs_usb # TODO: check with audio team if needed for isolated_base_app (b/28417852)
+}:file no_rw_file_perms;
+
+# No creation of sockets families other than AF_UNIX sockets.
+# List taken from system/sepolicy/public/global_macros - socket_class_set
+# excluding unix_stream_socket and unix_dgram_socket.
+# Many of these are socket families which have never and will never
+# be compiled into the Android kernel.
+neverallow isolated_base_app { self ephemeral_app priv_app untrusted_app_all }:{
+  socket tcp_socket udp_socket rawip_socket netlink_socket packet_socket
+  key_socket appletalk_socket netlink_route_socket
+  netlink_tcpdiag_socket netlink_nflog_socket netlink_xfrm_socket
+  netlink_selinux_socket netlink_audit_socket netlink_dnrt_socket
+  netlink_kobject_uevent_socket tun_socket netlink_iscsi_socket
+  netlink_fib_lookup_socket netlink_connector_socket netlink_netfilter_socket
+  netlink_generic_socket netlink_scsitransport_socket netlink_rdma_socket
+  netlink_crypto_socket sctp_socket icmp_socket ax25_socket ipx_socket
+  netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket atmsvc_socket
+  rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
+  bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket
+  ieee802154_socket caif_socket alg_socket nfc_socket vsock_socket kcm_socket
+  qipcrtr_socket smc_socket xdp_socket
+} create;
diff --git a/private/seapp_contexts b/private/seapp_contexts
index 5ecde07c2e0803a18bdf35eb28b50d97b45092f3..31db163c0ad5e794a46a61110406d118687a60c0 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -118,22 +118,22 @@ neverallow user=((?!system).)* type=system_app_data_file
 neverallow user=_app isPrivApp=false name=.* seinfo=""
 neverallow user=_app isPrivApp=false name=.* seinfo=default
 
 # neverallow shared relro to any other domain
 # and neverallow any other uid into shared_relro
 neverallow user=shared_relro domain=((?!shared_relro).)*
 neverallow user=((?!shared_relro).)* domain=shared_relro
 
 # neverallow non-isolated uids into isolated_app domain
 # and vice versa
-neverallow user=_isolated domain=((?!isolated_app).)*
-neverallow user=((?!_isolated).)* domain=isolated_app
+neverallow user=_isolated domain=((?!isolated_(base_)?app).)*
+neverallow user=((?!_isolated).)* domain=isolated_base_app
 
 # uid shell should always be in shell domain, however non-shell
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
@@ -145,21 +145,21 @@ user=_app seinfo=platform name=com.android.traceur domain=traceur_app type=app_d
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack levelFrom=all type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
 user=shared_relro seinfo=base domain=shared_relro
 user=shared_relro domain=shared_relro
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
-user=_isolated seinfo=base domain=isolated_app levelFrom=user
+user=_isolated seinfo=base domain=isolated_base_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider name=android.process.media type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
diff --git a/private/technical_debt.cil b/private/technical_debt.cil
index fdcd0a3323147d9585d2aad3fc7c2903caa0a77b..142f25bfd3d644344fdc5a7ceaaa2ae53d1cdaf0 100644
--- a/private/technical_debt.cil
+++ b/private/technical_debt.cil
@@ -1,65 +1,65 @@
 ; THIS IS A WORKAROUND for the current limitations of the module policy language
 ; This should be used sparingly until we figure out a saner way to achieve the
 ; stuff below, for example, by improving typeattribute statement of module
 ; language.
 ;
 ; NOTE: This file has no effect on recovery policy.
 
 ; Apps, except isolated apps, are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_allocator_client;
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_allocator_client;
 ;     typeattribute hal_allocator_client halclientdomain;
-(typeattributeset hal_allocator_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 (typeattributeset halclientdomain (hal_allocator_client))
 
 ; Apps, except isolated apps, are clients of OMX-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_omx_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_omx_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Codec2-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_codec2_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_codec2_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Drm-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_drm_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_drm_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Configstore HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_configstore_client;
-(typeattributeset hal_configstore_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_configstore_client;
+(typeattributeset hal_configstore_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Graphics Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_graphics_allocator_client;
-(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_graphics_allocator_client;
+(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Cas HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_cas_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_cas_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Domains hosting Camera HAL implementations are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute hal_camera hal_allocator_client;
 (typeattributeset hal_allocator_client (hal_camera))
 
 ; Apps, except isolated apps, are clients of Neuralnetworks HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_neuralnetworks_client;
-(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_neuralnetworks_client;
+(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; TODO(b/112056006): move these to mapping files when/if we implement 'versioned' attributes.
 ; Rename untrusted_app_visible_* to untrusted_app_visible_*_violators.
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute untrusted_app_visible_hwservice untrusted_app_visible_hwservice_violators;
 ;     typeattribute untrusted_app_visible_halserver untrusted_app_visible_halserver_violators;
 (typeattribute untrusted_app_visible_hwservice)
 (typeattributeset untrusted_app_visible_hwservice_violators (untrusted_app_visible_hwservice))
 (typeattribute untrusted_app_visible_halserver)
 (typeattributeset untrusted_app_visible_halserver_violators (untrusted_app_visible_halserver))
 
 ; Apps, except isolated apps, are clients of BufferHub HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
diff --git a/private/webview_zygote.te b/private/webview_zygote.te
index 969ab9cc92c054f0e74fe9cbccbbb2ad692f64da..9dbf0e7d5a59db7ba59a8d082eb1d8fcb3c8a59c 100644
--- a/private/webview_zygote.te
+++ b/private/webview_zygote.te
@@ -19,39 +19,41 @@ allow webview_zygote apk_data_file:file { r_file_perms execute };
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
+allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote dalvikcache_data_file:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote dalvikcache_data_file:file { r_file_perms execute };
 
 # Allow webview_zygote to create JIT memory.
 allow webview_zygote self:process execmem;
 
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
+allow webview_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 # Suppress denials to storage. Webview zygote should not be accessing.
 dontaudit webview_zygote mnt_expand_file:dir getattr;
 
 # TODO (b/72957399) remove this when webview_zygote is reparented to
 # app_process zygote
 dontaudit webview_zygote dex2oat_exec:file execute;
 
 # Get seapp_contexts
@@ -78,21 +80,21 @@ allow webview_zygote same_process_hal_file:file { execute read open getattr map
 allow webview_zygote system_data_file:lnk_file r_file_perms;
 
 # Send unsolicited message to system_server
 unix_socket_send(webview_zygote, system_unsolzygote, system_server)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow webview_zygote { domain -isolated_app }:process dyntransition;
+neverallow webview_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow webview_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow webview_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # webview_zygote child.
diff --git a/public/app.te b/public/app.te
index 0925233f43753268e11e17aab13f6af5916e3fcb..290292fa190d090f9ec8a414e680f80efd203458 100644
--- a/public/app.te
+++ b/public/app.te
@@ -23,22 +23,22 @@ allow appdomain zygote:fd use;
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;
 
 # Read /data/dalvik-cache.
 allow appdomain dalvikcache_data_file:dir { search getattr };
 allow appdomain dalvikcache_data_file:file r_file_perms;
 
 # Read the /sdcard and /mnt/sdcard symlinks
-allow { appdomain -isolated_app } rootfs:lnk_file r_file_perms;
-allow { appdomain -isolated_app } tmpfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } rootfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } tmpfs:lnk_file r_file_perms;
 
 # Search /storage/emulated tmpfs mount.
 allow appdomain tmpfs:dir r_dir_perms;
 
 # Notify zygote of the wrapped process PID when using --invoke-with.
 allow appdomain zygote:fifo_file write;
 
 userdebug_or_eng(`
   # Allow apps to create and write method traces in /data/misc/trace.
   allow appdomain method_trace_data_file:dir w_dir_perms;
@@ -61,33 +61,33 @@ allow appdomain system_server:tcp_socket { read write getattr getopt shutdown };
 # For AppFuse.
 allow appdomain vold:fd use;
 
 # Communication with other apps via fifos
 allow appdomain appdomain:fifo_file rw_file_perms;
 
 # Communicate with surfaceflinger.
 allow appdomain surfaceflinger:unix_stream_socket { read write setopt getattr getopt shutdown };
 
 # App sandbox file accesses.
-allow { appdomain -isolated_app } { app_data_file privapp_data_file }:dir create_dir_perms;
-allow { appdomain -isolated_app } { app_data_file privapp_data_file }:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } { app_data_file privapp_data_file }:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app } { app_data_file privapp_data_file }:file create_file_perms;
 
 # Traverse into expanded storage
 allow appdomain mnt_expand_file:dir r_dir_perms;
 
 # Keychain and user-trusted credentials
 r_dir_file(appdomain, keychain_data_file)
 allow appdomain misc_user_data_file:dir r_dir_perms;
 allow appdomain misc_user_data_file:file r_file_perms;
 
 # TextClassifier
-r_dir_file({ appdomain -isolated_app }, textclassifier_data_file)
+r_dir_file({ appdomain -isolated_app -isolated_base_app }, textclassifier_data_file)
 
 # Access to OEM provided data and apps
 allow appdomain oemfs:dir r_dir_perms;
 allow appdomain oemfs:file rx_file_perms;
 
 # Execute the shell or other system executables.
 allow { appdomain -ephemeral_app } shell_exec:file rx_file_perms;
 allow { appdomain -ephemeral_app } toolbox_exec:file rx_file_perms;
 allow appdomain system_file:file x_file_perms;
 not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perms;')
@@ -96,21 +96,21 @@ not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perm
 allow appdomain system_file:dir r_dir_perms;
 allow appdomain system_file:lnk_file { getattr open read };
 # Renderscript specific permissions to open /system/vendor/lib64.
 not_full_treble(`
     allow appdomain vendor_file_type:dir r_dir_perms;
     allow appdomain vendor_file_type:lnk_file { getattr open read };
 ')
 
 full_treble_only(`
     # For looking up Renderscript vendor drivers
-    allow { appdomain -isolated_app } vendor_file:dir { open read };
+    allow { appdomain -isolated_app -isolated_base_app } vendor_file:dir { open read };
 ')
 
 # Allow apps access to /vendor/app except for privileged
 # apps which cannot be in /vendor.
 r_dir_file({ appdomain -ephemeral_app }, vendor_app_file)
 allow { appdomain -ephemeral_app } vendor_app_file:file execute;
 
 # Allow apps access to /vendor/overlay
 r_dir_file(appdomain, vendor_overlay_file)
 
@@ -181,44 +181,46 @@ userdebug_or_eng(`
 ')
 
 # /proc/net access.
 # TODO(b/9496886) Audit access for removal.
 # proc_net access for the negated domains below is granted (or not) in their
 # individual .te files.
 r_dir_file({
   appdomain
   -ephemeral_app
   -isolated_app
+  -isolated_base_app
   -platform_app
   -priv_app
   -shell
   -system_app
   -untrusted_app_all
 }, proc_net_type)
 # audit access for all these non-core app domains.
 userdebug_or_eng(`
   auditallow {
     appdomain
     -ephemeral_app
     -isolated_app
+    -isolated_base_app
     -platform_app
     -priv_app
     -shell
     -su
     -system_app
     -untrusted_app_all
   } proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 # Grant GPU access to all processes started by Zygote.
 # They need that to render the standard UI.
-allow { appdomain -isolated_app } gpu_device:chr_file rw_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } gpu_device:chr_file rw_file_perms;
 
 # Use the Binder.
 binder_use(appdomain)
 # Perform binder IPC to binder services.
 binder_call(appdomain, binderservicedomain)
 # Perform binder IPC to other apps.
 binder_call(appdomain, appdomain)
 # Perform binder IPC to ephemeral apps.
 binder_call(appdomain, ephemeral_app)
 
@@ -234,47 +236,47 @@ allow appdomain appdomain:unix_stream_socket { getopt getattr read write shutdow
 # Backup ability for every app. BMS opens and passes the fd
 # to any app that has backup ability. Hence, no open permissions here.
 allow appdomain backup_data_file:file { read write getattr map };
 allow appdomain cache_backup_file:file { read write getattr map };
 allow appdomain cache_backup_file:dir getattr;
 # Backup ability using 'adb backup'
 allow appdomain system_data_file:lnk_file r_file_perms;
 allow appdomain system_data_file:file { getattr read map };
 
 # Allow read/stat of /data/media files passed by Binder or local socket IPC.
-allow { appdomain -isolated_app } media_rw_data_file:file { read getattr };
+allow { appdomain -isolated_app -isolated_base_app } media_rw_data_file:file { read getattr };
 
 # Read and write /data/data/com.android.providers.telephony files passed over Binder.
-allow { appdomain -isolated_app } radio_data_file:file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app } radio_data_file:file { read write getattr };
 
 # Allow access to external storage; we have several visible mount points under /storage
 # and symlinks to primary storage at places like /storage/sdcard0 and /mnt/user/0/primary
-allow { appdomain -isolated_app -ephemeral_app } storage_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } storage_file:lnk_file r_file_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
 
 # Read/write visible storage
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:file create_file_perms;
 # This should be removed if sdcardfs is modified to alter the secontext for its
 # accesses to the underlying FS.
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:file create_file_perms;
 
 # Allow apps to use the USB Accessory interface.
 # http://developer.android.com/guide/topics/connectivity/usb/accessory.html
 #
 # USB devices are first opened by the system server (USBDeviceManagerService)
 # and the file descriptor is passed to the right Activity via binder.
-allow { appdomain -isolated_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
-allow { appdomain -isolated_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
 
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
@@ -284,70 +286,70 @@ allow appdomain apk_data_file:file rx_file_perms;
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
 
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
 
-use_keystore({ appdomain -isolated_app -ephemeral_app })
+use_keystore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
-use_credstore({ appdomain -isolated_app -ephemeral_app })
+use_credstore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
 allow appdomain console_device:chr_file { read write };
 
 # only allow unprivileged socket ioctl commands
 allowxperm { appdomain -bluetooth } self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
-allow { appdomain -isolated_app } ion_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } ion_device:chr_file r_file_perms;
 
 # Allow AAudio apps to use shared memory file descriptors from the HAL
-allow { appdomain -isolated_app } hal_audio:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_audio:fd use;
 
 # Allow app to access shared memory created by camera HAL1
-allow { appdomain -isolated_app } hal_camera:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_camera:fd use;
 
 # RenderScript always-passthrough HAL
-allow { appdomain -isolated_app } hal_renderscript_hwservice:hwservice_manager find;
+allow { appdomain -isolated_app -isolated_base_app } hal_renderscript_hwservice:hwservice_manager find;
 allow appdomain same_process_hal_file:file { execute read open getattr map };
 
 # TODO: switch to meminfo service
 allow appdomain proc_meminfo:file r_file_perms;
 
 # For app fuse.
 allow appdomain app_fuse_file:file { getattr read append write map };
 
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_client)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_manager)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_vsync)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, performance_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_manager)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_vsync)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, performance_client)
 # Apps do not directly open the IPC socket for bufferhubd.
-pdx_use({ appdomain -isolated_app -ephemeral_app }, bufferhub_client)
+pdx_use({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, bufferhub_client)
 
 ###
 ### CTS-specific rules
 ###
 
 # For cts/tests/tests/permission/src/android/permission/cts/FileSystemPermissionTest.java.
 # testRunAsHasCorrectCapabilities
 allow appdomain runas_exec:file getattr;
 # Others are either allowed elsewhere or not desired.
 
 # Apps receive an open tun fd from the framework for
 # device traffic. Do not allow untrusted app to directly open tun_device
-allow { appdomain -isolated_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
-allowxperm { appdomain -isolated_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
+allowxperm { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
 
 # Connect to adbd and use a socket transferred from it.
 # This is used for e.g. adb backup/restore.
 allow appdomain adbd:unix_stream_socket connectto;
 allow appdomain adbd:fd use;
 allow appdomain adbd:unix_stream_socket { getattr getopt ioctl read write shutdown };
 
 allow appdomain cache_file:dir getattr;
 
 # Allow apps to run with asanwrapper.
@@ -378,21 +380,21 @@ neverallow appdomain dev_type:blk_file { read write };
 neverallow appdomain {
     audio_device
     camera_device
     dm_device
     radio_device
     rpmsg_device
     video_device
 }:chr_file { read write };
 
 # Note: Try expanding list of app domains in the future.
-neverallow { untrusted_app isolated_app shell } graphics_device:chr_file { read write };
+neverallow { untrusted_app isolated_app isolated_base_app shell } graphics_device:chr_file { read write };
 
 neverallow { appdomain -nfc } nfc_device:chr_file
     { read write };
 neverallow { appdomain -bluetooth } hci_attach_dev:chr_file
     { read write };
 neverallow appdomain tee_device:chr_file { read write };
 
 # Privileged netlink socket interfaces.
 neverallow { appdomain -network_stack }
     domain:{
@@ -536,20 +538,21 @@ neverallow appdomain {
   dev_type
   rootfs
   system_file
   tmpfs
 }:lnk_file no_w_file_perms;
 
 # Blacklist app domains not allowed to execute from /data
 neverallow {
   bluetooth
   isolated_app
+  isolated_base_app
   nfc
   radio
   shared_relro
   system_app
 } {
   data_file_type
   -dalvikcache_data_file
   -system_data_file # shared libs in apks
   -apk_data_file
 }:file no_x_file_perms;
diff --git a/public/domain.te b/public/domain.te
index 94031e3041324b2a489d04906ee45ccae1102589..0f78575a24470ba231c8c96174bb1394274b01c4 100644
--- a/public/domain.te
+++ b/public/domain.te
@@ -81,21 +81,21 @@ allow domain ashmem_libcutils_device:chr_file rw_file_perms;
 allow { domain -hwservicemanager -vndservicemanager } binder_device:chr_file rw_file_perms;
 
 # Restrict binder ioctls to an allowlist. Additional ioctl commands may be
 # added to individual domains, but this sets safe defaults for all processes.
 allowxperm domain binder_device:chr_file ioctl unpriv_binder_ioctls;
 
 # /dev/binderfs needs to be accessed by everyone too!
 allow domain binderfs:dir { getattr search };
 allow domain binderfs_logs_proc:dir search;
 
-allow { domain -servicemanager -vndservicemanager -isolated_app } hwbinder_device:chr_file rw_file_perms;
+allow { domain -servicemanager -vndservicemanager -isolated_app -isolated_base_app } hwbinder_device:chr_file rw_file_perms;
 allow domain ptmx_device:chr_file rw_file_perms;
 allow domain random_device:chr_file rw_file_perms;
 allow domain proc_random:dir r_dir_perms;
 allow domain proc_random:file r_file_perms;
 allow domain properties_device:dir { search getattr };
 allow domain properties_serial:file r_file_perms;
 allow domain property_info:file r_file_perms;
 
 # Public readable properties
 get_prop(domain, debug_prop)
@@ -1167,20 +1167,21 @@ neverallow {
   -appdomain # finer-grained rules for appdomain are listed below
   -system_server #populate com.android.providers.settings/databases/settings.db.
   -installd # creation of app sandbox
   -iorap_inode2filename
   -traced_probes # resolve inodes for i/o tracing.
                  # only needs open and read, the rest is neverallow in
                  # traced_probes.te.
 } system_app_data_file:dir_file_class_set { create unlink open };
 neverallow {
   isolated_app
+  isolated_base_app
   untrusted_app_all # finer-grained rules for appdomain are listed below
   ephemeral_app
   priv_app
 } system_app_data_file:dir_file_class_set { create unlink open };
 
 #
 # Only these domains should transition to shell domain. This domain is
 # permissible for the "shell user". If you need a process to exec a shell
 # script with differing privilege, define a domain and set up a transition.
 #
diff --git a/public/hal_camera.te b/public/hal_camera.te
index 77216e4a388d35411ec6197ad51b9c49d2a63bd5..89e86a2794f666ff40fd927b7b9ee92b961c8ae3 100644
--- a/public/hal_camera.te
+++ b/public/hal_camera.te
@@ -6,21 +6,21 @@ hal_attribute_hwservice(hal_camera, hal_camera_hwservice)
 
 allow hal_camera device:dir r_dir_perms;
 allow hal_camera video_device:dir r_dir_perms;
 allow hal_camera video_device:chr_file rw_file_perms;
 allow hal_camera camera_device:chr_file rw_file_perms;
 allow hal_camera ion_device:chr_file rw_file_perms;
 # Both the client and the server need to use the graphics allocator
 allow { hal_camera_client hal_camera_server } hal_graphics_allocator:fd use;
 
 # Allow hal_camera to use fd from app,gralloc,and ashmem HAL
-allow hal_camera { appdomain -isolated_app }:fd use;
+allow hal_camera { appdomain -isolated_app -isolated_base_app }:fd use;
 allow hal_camera surfaceflinger:fd use;
 allow hal_camera hal_allocator_server:fd use;
 
 # Needed to provide debug dump output via dumpsys' pipes.
 allow hal_camera shell:fd use;
 allow hal_camera shell:fifo_file write;
 
 ###
 ### neverallow rules
 ###
diff --git a/public/hal_drm.te b/public/hal_drm.te
index 5987491344de5c4e5c574ab2f5e078676ace1596..ad90aecaaa820bc5ab229406b51719cf700caf21 100644
--- a/public/hal_drm.te
+++ b/public/hal_drm.te
@@ -27,21 +27,21 @@ allow hal_drm hal_graphics_allocator:fd use;
 # Allow access to hidl_memory allocation service
 allow hal_drm hal_allocator_server:fd use;
 
 # Allow access to fds allocated by mediaserver
 allow hal_drm mediaserver:fd use;
 
 allow hal_drm sysfs:file r_file_perms;
 
 allow hal_drm tee_device:chr_file rw_file_perms;
 
-allow hal_drm_server { appdomain -isolated_app }:fd use;
+allow hal_drm_server { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # only allow unprivileged socket ioctl commands
 allowxperm hal_drm self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
 ###
 ### neverallow rules
 ###
 
 # hal_drm should never execute any executable without a
diff --git a/public/hal_omx.te b/public/hal_omx.te
index 8e74383d31b59239c297fb4bbf31c07a93cf4ea3..b4940f30b0daffcd6094d6eb73ac91c0953271c4 100644
--- a/public/hal_omx.te
+++ b/public/hal_omx.te
@@ -1,15 +1,15 @@
 # applies all permissions to hal_omx NOT hal_omx_server
 # since OMX must always be in its own process.
 
 binder_call(hal_omx_server, binderservicedomain)
-binder_call(hal_omx_server, { appdomain -isolated_app })
+binder_call(hal_omx_server, { appdomain -isolated_app -isolated_base_app })
 
 # Allow hal_omx_server access to composer sync fences
 allow hal_omx_server hal_graphics_composer:fd use;
 
 allow hal_omx_server ion_device:chr_file rw_file_perms;
 allow hal_omx_server hal_camera:fd use;
 
 crash_dump_fallback(hal_omx_server)
 
 # Recieve gralloc buffer FDs from bufferhubd. Note that hal_omx_server never
diff --git a/public/hal_sensors.te b/public/hal_sensors.te
index 06e76f1e17e171b969f97e94461944d6c1d09892..0405b6eab322037f70965156f083dfc038c44c8d 100644
--- a/public/hal_sensors.te
+++ b/public/hal_sensors.te
@@ -1,14 +1,14 @@
 # HwBinder IPC from client to server
 binder_call(hal_sensors_client, hal_sensors_server)
 
 hal_attribute_hwservice(hal_sensors, hal_sensors_hwservice)
 
 # Allow sensor hals to access ashmem memory allocated by apps
-allow hal_sensors { appdomain -isolated_app }:fd use;
+allow hal_sensors { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # Allow sensor hals to access ashmem memory allocated by android.hidl.allocator
 # fd is passed in from framework sensorservice HAL.
 allow hal_sensors hal_allocator:fd use;
 
 # allow to run with real-time scheduling policy
 allow hal_sensors self:global_capability_class_set sys_nice;
diff --git a/public/isolated_base_app.te b/public/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..86740d042480b7f0c165b0e6f41cd0f1edce0b0f
--- /dev/null
+++ b/public/isolated_base_app.te
@@ -0,0 +1,9 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+type isolated_base_app, domain;

commit 254fbece2c987a130223a13b988a3bd005724e87
Author: Renlord <me@renlord.com>
Date:   Tue 2020-02-25 22:12:12+1100

    remove base system app execmod
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/untrusted_base_app_25.te | 4 ----
 prebuilts/api/30.0/private/untrusted_base_app_27.te | 4 ----
 private/untrusted_base_app_25.te                    | 4 ----
 private/untrusted_base_app_27.te                    | 4 ----
 4 files changed, 16 deletions(-)

diff --git a/prebuilts/api/30.0/private/untrusted_base_app_25.te b/prebuilts/api/30.0/private/untrusted_base_app_25.te
index 4bcaa19eb3432a045ce94b18c6521c894125ee32..3125cca4cf21438fa72bb6df64a729f320eebb7f 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app_25.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app_25.te
@@ -19,24 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_base_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_27.te b/prebuilts/api/30.0/private/untrusted_base_app_27.te
index 4ef4e963cd1b12b546a923d985e0d1c54dc60a74..5d27d18ea288d370a08e8f9a9c54f38d95374875 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app_27.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app_27.te
@@ -8,24 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_base_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
diff --git a/private/untrusted_base_app_25.te b/private/untrusted_base_app_25.te
index 4bcaa19eb3432a045ce94b18c6521c894125ee32..3125cca4cf21438fa72bb6df64a729f320eebb7f 100644
--- a/private/untrusted_base_app_25.te
+++ b/private/untrusted_base_app_25.te
@@ -19,24 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_base_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
diff --git a/private/untrusted_base_app_27.te b/private/untrusted_base_app_27.te
index 4ef4e963cd1b12b546a923d985e0d1c54dc60a74..5d27d18ea288d370a08e8f9a9c54f38d95374875 100644
--- a/private/untrusted_base_app_27.te
+++ b/private/untrusted_base_app_27.te
@@ -8,24 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_base_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 

commit b15c81a9f661acf9e9eb22d0ac066791a3698cd1
Author: Renlord <me@renlord.com>
Date:   Tue 2020-02-25 22:17:45+1100

    remove base system app execmem
    
    GrapheneOS doesn't use the ART JIT compiler.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/ephemeral_app.te    | 3 +++
 prebuilts/api/30.0/private/isolated_app.te     | 3 +++
 prebuilts/api/30.0/private/untrusted_app.te    | 3 +++
 prebuilts/api/30.0/private/untrusted_app_25.te | 3 +++
 prebuilts/api/30.0/private/untrusted_app_27.te | 3 +++
 prebuilts/api/30.0/private/untrusted_app_29.te | 3 +++
 prebuilts/api/30.0/public/app.te               | 4 ----
 private/ephemeral_app.te                       | 3 +++
 private/isolated_app.te                        | 3 +++
 private/untrusted_app.te                       | 3 +++
 private/untrusted_app_25.te                    | 3 +++
 private/untrusted_app_27.te                    | 3 +++
 private/untrusted_app_29.te                    | 3 +++
 public/app.te                                  | 4 ----
 14 files changed, 36 insertions(+), 8 deletions(-)

diff --git a/prebuilts/api/30.0/private/ephemeral_app.te b/prebuilts/api/30.0/private/ephemeral_app.te
index 56d47474be9827fb93aa06736d147bd30bcbb8ab..065dec36098100b0567009879830d262e609aac2 100644
--- a/prebuilts/api/30.0/private/ephemeral_app.te
+++ b/prebuilts/api/30.0/private/ephemeral_app.te
@@ -9,20 +9,23 @@
 ### applications may also opt-in to ephemeral to take advantage of the
 ### additional security features.
 ###
 ### PackageManager flags an app as ephemeral at install time.
 
 typeattribute ephemeral_app coredomain;
 
 net_domain(ephemeral_app)
 app_domain(ephemeral_app)
 
+allow ephemeral_app self:process execmem;
+auditallow ephemeral_app self:process execmem;
+
 # Allow ephemeral apps to read/write files in visible storage if provided fds
 allow ephemeral_app { sdcard_type media_rw_data_file }:file {read write getattr ioctl lock append};
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 allow ephemeral_app privapp_data_file:file { r_file_perms execute };
 allow ephemeral_app app_data_file:file     { r_file_perms execute };
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow ephemeral_app privapp_data_file:lnk_file r_file_perms;
diff --git a/prebuilts/api/30.0/private/isolated_app.te b/prebuilts/api/30.0/private/isolated_app.te
index 4c6c5aad91dfd807d6b626ebf9c1df5bdf50816b..73dad2b03d07a5363ea40a84982b94960d9ea1ff 100644
--- a/prebuilts/api/30.0/private/isolated_app.te
+++ b/prebuilts/api/30.0/private/isolated_app.te
@@ -3,20 +3,23 @@
 ###
 ### This file defines the rules for isolated apps. An "isolated
 ### app" is an APP with UID between AID_ISOLATED_START (99000)
 ### and AID_ISOLATED_END (99999).
 ###
 
 typeattribute isolated_app coredomain;
 
 app_domain(isolated_app)
 
+allow isolated_app self:process execmem;
+auditallow isolated_app self:process execmem;
+
 # Access already open app data files received over Binder or local socket IPC.
 allow isolated_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
 
 # Allow access to network sockets received over IPC. New socket creation is not
 # permitted.
 allow isolated_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
 
 allow isolated_app activity_service:service_manager find;
 allow isolated_app display_service:service_manager find;
 allow isolated_app webviewupdate_service:service_manager find;
diff --git a/prebuilts/api/30.0/private/untrusted_app.te b/prebuilts/api/30.0/private/untrusted_app.te
index 6e7a99cd8c64bfd8bd076a5e5420a16e1bb1bb5b..44e9295df9de755a08b4b8957898878911cbe786 100644
--- a/prebuilts/api/30.0/private/untrusted_app.te
+++ b/prebuilts/api/30.0/private/untrusted_app.te
@@ -7,10 +7,13 @@
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
+
+allow untrusted_app self:process execmem;
+auditallow untrusted_app self:process execmem;
diff --git a/prebuilts/api/30.0/private/untrusted_app_25.te b/prebuilts/api/30.0/private/untrusted_app_25.te
index a1abc416bd80249b194a90a5e3717c96143cb99e..4865ea1e7f81c76eef4f68fe1cf9d0dd03f3d586 100644
--- a/prebuilts/api/30.0/private/untrusted_app_25.te
+++ b/prebuilts/api/30.0/private/untrusted_app_25.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_25 coredomain;
 
 app_domain(untrusted_app_25)
 untrusted_app_domain(untrusted_app_25)
 net_domain(untrusted_app_25)
 bluetooth_domain(untrusted_app_25)
 
+allow untrusted_app_25 self:process execmem;
+auditallow untrusted_app_25 self:process execmem;
+
 # b/35917228 - /proc/misc access
 # This will go away in a future Android release
 allow untrusted_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
diff --git a/prebuilts/api/30.0/private/untrusted_app_27.te b/prebuilts/api/30.0/private/untrusted_app_27.te
index b7b6d7213c40fa3dbada04d66f2c431c70dcaedc..27fcb3cc3fcfb4cef9e974f6238404a2bac4ebf3 100644
--- a/prebuilts/api/30.0/private/untrusted_app_27.te
+++ b/prebuilts/api/30.0/private/untrusted_app_27.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_27 coredomain;
 
 app_domain(untrusted_app_27)
 untrusted_app_domain(untrusted_app_27)
 net_domain(untrusted_app_27)
 bluetooth_domain(untrusted_app_27)
 
+allow untrusted_app_27 self:process execmem;
+auditallow untrusted_app_27 self:process execmem;
+
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
diff --git a/prebuilts/api/30.0/private/untrusted_app_29.te b/prebuilts/api/30.0/private/untrusted_app_29.te
index 344ae89bd357f75f74ec93941abcb42b7b03fda2..9995afbe8f12b84c7957d742c45e09fabdff8740 100644
--- a/prebuilts/api/30.0/private/untrusted_app_29.te
+++ b/prebuilts/api/30.0/private/untrusted_app_29.te
@@ -8,12 +8,15 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
+allow untrusted_app_29 self:process execmem;
+auditallow untrusted_app_29 self:process execmem;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/30.0/public/app.te b/prebuilts/api/30.0/public/app.te
index 290292fa190d090f9ec8a414e680f80efd203458..559368149db0130e6518a980373ebb8df4f1a982 100644
--- a/prebuilts/api/30.0/public/app.te
+++ b/prebuilts/api/30.0/public/app.te
@@ -1,24 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-# WebView and other application-specific JIT compilers
-allow appdomain self:process execmem;
-auditallow appdomain self:process execmem;
-
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 
diff --git a/private/ephemeral_app.te b/private/ephemeral_app.te
index 56d47474be9827fb93aa06736d147bd30bcbb8ab..065dec36098100b0567009879830d262e609aac2 100644
--- a/private/ephemeral_app.te
+++ b/private/ephemeral_app.te
@@ -9,20 +9,23 @@
 ### applications may also opt-in to ephemeral to take advantage of the
 ### additional security features.
 ###
 ### PackageManager flags an app as ephemeral at install time.
 
 typeattribute ephemeral_app coredomain;
 
 net_domain(ephemeral_app)
 app_domain(ephemeral_app)
 
+allow ephemeral_app self:process execmem;
+auditallow ephemeral_app self:process execmem;
+
 # Allow ephemeral apps to read/write files in visible storage if provided fds
 allow ephemeral_app { sdcard_type media_rw_data_file }:file {read write getattr ioctl lock append};
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 allow ephemeral_app privapp_data_file:file { r_file_perms execute };
 allow ephemeral_app app_data_file:file     { r_file_perms execute };
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow ephemeral_app privapp_data_file:lnk_file r_file_perms;
diff --git a/private/isolated_app.te b/private/isolated_app.te
index 4c6c5aad91dfd807d6b626ebf9c1df5bdf50816b..73dad2b03d07a5363ea40a84982b94960d9ea1ff 100644
--- a/private/isolated_app.te
+++ b/private/isolated_app.te
@@ -3,20 +3,23 @@
 ###
 ### This file defines the rules for isolated apps. An "isolated
 ### app" is an APP with UID between AID_ISOLATED_START (99000)
 ### and AID_ISOLATED_END (99999).
 ###
 
 typeattribute isolated_app coredomain;
 
 app_domain(isolated_app)
 
+allow isolated_app self:process execmem;
+auditallow isolated_app self:process execmem;
+
 # Access already open app data files received over Binder or local socket IPC.
 allow isolated_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
 
 # Allow access to network sockets received over IPC. New socket creation is not
 # permitted.
 allow isolated_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
 
 allow isolated_app activity_service:service_manager find;
 allow isolated_app display_service:service_manager find;
 allow isolated_app webviewupdate_service:service_manager find;
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 6e7a99cd8c64bfd8bd076a5e5420a16e1bb1bb5b..44e9295df9de755a08b4b8957898878911cbe786 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -7,10 +7,13 @@
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
+
+allow untrusted_app self:process execmem;
+auditallow untrusted_app self:process execmem;
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index a1abc416bd80249b194a90a5e3717c96143cb99e..4865ea1e7f81c76eef4f68fe1cf9d0dd03f3d586 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_25 coredomain;
 
 app_domain(untrusted_app_25)
 untrusted_app_domain(untrusted_app_25)
 net_domain(untrusted_app_25)
 bluetooth_domain(untrusted_app_25)
 
+allow untrusted_app_25 self:process execmem;
+auditallow untrusted_app_25 self:process execmem;
+
 # b/35917228 - /proc/misc access
 # This will go away in a future Android release
 allow untrusted_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index b7b6d7213c40fa3dbada04d66f2c431c70dcaedc..27fcb3cc3fcfb4cef9e974f6238404a2bac4ebf3 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_27 coredomain;
 
 app_domain(untrusted_app_27)
 untrusted_app_domain(untrusted_app_27)
 net_domain(untrusted_app_27)
 bluetooth_domain(untrusted_app_27)
 
+allow untrusted_app_27 self:process execmem;
+auditallow untrusted_app_27 self:process execmem;
+
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index 344ae89bd357f75f74ec93941abcb42b7b03fda2..9995afbe8f12b84c7957d742c45e09fabdff8740 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -8,12 +8,15 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
+allow untrusted_app_29 self:process execmem;
+auditallow untrusted_app_29 self:process execmem;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/public/app.te b/public/app.te
index 290292fa190d090f9ec8a414e680f80efd203458..559368149db0130e6518a980373ebb8df4f1a982 100644
--- a/public/app.te
+++ b/public/app.te
@@ -1,24 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-# WebView and other application-specific JIT compilers
-allow appdomain self:process execmem;
-auditallow appdomain self:process execmem;
-
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 

commit 1a6f4c5152976efca60f39f78be37bec043ab9d8
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2020-02-25 20:12:32-0500

    remove base app app_data_file execute_no_trans
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/untrusted_base_app_25.te | 6 ------
 prebuilts/api/30.0/private/untrusted_base_app_27.te | 5 -----
 private/untrusted_base_app_25.te                    | 6 ------
 private/untrusted_base_app_27.te                    | 5 -----
 4 files changed, 22 deletions(-)

diff --git a/prebuilts/api/30.0/private/untrusted_base_app_25.te b/prebuilts/api/30.0/private/untrusted_base_app_25.te
index 3125cca4cf21438fa72bb6df64a729f320eebb7f..d805e85fec42b66ead714379c44a48901eccea07 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app_25.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app_25.te
@@ -19,26 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
-# and 28 in untrusted_app_27.te.
-allow untrusted_base_app_25 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_25 ashmem_device:chr_file open;
 
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_27.te b/prebuilts/api/30.0/private/untrusted_base_app_27.te
index 5d27d18ea288d370a08e8f9a9c54f38d95374875..59e79435d8666f17e8fc25949edaf4211357565c 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app_27.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app_27.te
@@ -8,25 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi 26, 27, and 28.
-allow untrusted_base_app_27 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_27 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_base_app_25.te b/private/untrusted_base_app_25.te
index 3125cca4cf21438fa72bb6df64a729f320eebb7f..d805e85fec42b66ead714379c44a48901eccea07 100644
--- a/private/untrusted_base_app_25.te
+++ b/private/untrusted_base_app_25.te
@@ -19,26 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
-# and 28 in untrusted_app_27.te.
-allow untrusted_base_app_25 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_25 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_base_app_27.te b/private/untrusted_base_app_27.te
index 5d27d18ea288d370a08e8f9a9c54f38d95374875..59e79435d8666f17e8fc25949edaf4211357565c 100644
--- a/private/untrusted_base_app_27.te
+++ b/private/untrusted_base_app_27.te
@@ -8,25 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi 26, 27, and 28.
-allow untrusted_base_app_27 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_27 ashmem_device:chr_file open;
 

commit 10e825f7dd8c4691ece5efd68894e3112217a306
Author: Renlord <me@renlord.com>
Date:   Tue 2020-02-25 22:30:48+1100

    remove base system app app_data_file execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/untrusted_app.te     | 7 +++++++
 prebuilts/api/30.0/private/untrusted_app_25.te  | 7 +++++++
 prebuilts/api/30.0/private/untrusted_app_27.te  | 7 +++++++
 prebuilts/api/30.0/private/untrusted_app_29.te  | 7 +++++++
 prebuilts/api/30.0/private/untrusted_app_all.te | 6 ------
 private/untrusted_app.te                        | 7 +++++++
 private/untrusted_app_25.te                     | 7 +++++++
 private/untrusted_app_27.te                     | 7 +++++++
 private/untrusted_app_29.te                     | 7 +++++++
 private/untrusted_app_all.te                    | 6 ------
 10 files changed, 56 insertions(+), 12 deletions(-)

diff --git a/prebuilts/api/30.0/private/untrusted_app.te b/prebuilts/api/30.0/private/untrusted_app.te
index 44e9295df9de755a08b4b8957898878911cbe786..112015c5a080496be6e9c6d09bec9c13e7fef09e 100644
--- a/prebuilts/api/30.0/private/untrusted_app.te
+++ b/prebuilts/api/30.0/private/untrusted_app.te
@@ -10,10 +10,17 @@
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
+
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=29.
+allow untrusted_app privapp_data_file:file { r_file_perms execute };
+allow untrusted_app app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app app_data_file:file execute;
diff --git a/prebuilts/api/30.0/private/untrusted_app_25.te b/prebuilts/api/30.0/private/untrusted_app_25.te
index 4865ea1e7f81c76eef4f68fe1cf9d0dd03f3d586..0cd6bc41747102096326fe0414a928ae77aeb5fa 100644
--- a/prebuilts/api/30.0/private/untrusted_app_25.te
+++ b/prebuilts/api/30.0/private/untrusted_app_25.te
@@ -32,20 +32,27 @@ allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_app_25 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=25.
+allow untrusted_app_25 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_25 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_25 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
diff --git a/prebuilts/api/30.0/private/untrusted_app_27.te b/prebuilts/api/30.0/private/untrusted_app_27.te
index 27fcb3cc3fcfb4cef9e974f6238404a2bac4ebf3..924119b1c8d5e5b0bb398e76e51c1962b072afdf 100644
--- a/prebuilts/api/30.0/private/untrusted_app_27.te
+++ b/prebuilts/api/30.0/private/untrusted_app_27.te
@@ -20,20 +20,27 @@ auditallow untrusted_app_27 self:process execmem;
 
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_27 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_27 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_27 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
diff --git a/prebuilts/api/30.0/private/untrusted_app_29.te b/prebuilts/api/30.0/private/untrusted_app_29.te
index 9995afbe8f12b84c7957d742c45e09fabdff8740..dbb7a87d60e01cfd26fbaaa1eb7f801db56e739a 100644
--- a/prebuilts/api/30.0/private/untrusted_app_29.te
+++ b/prebuilts/api/30.0/private/untrusted_app_29.te
@@ -11,12 +11,19 @@
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
 allow untrusted_app_29 self:process execmem;
 auditallow untrusted_app_29 self:process execmem;
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_29 app_data_file:file execute;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/30.0/private/untrusted_app_all.te b/prebuilts/api/30.0/private/untrusted_app_all.te
index d9fd5a12e0ffa74ee1e3e5c67b17203c2e43d05c..3bea704155ea3e615e3bde0e45238b9ff02d06e1 100644
--- a/prebuilts/api/30.0/private/untrusted_app_all.te
+++ b/prebuilts/api/30.0/private/untrusted_app_all.te
@@ -13,26 +13,20 @@
 ### attribute is assigned to all non-system apps as well as to any system apps
 ### that are not signed by the platform key.  To move
 ### a system app into a specific domain, add a signer entry for it to
 ### mac_permissions.xml and assign it one of the pre-existing seinfo values
 ### or define and use a new seinfo value in both mac_permissions.xml and
 ### seapp_contexts.
 ###
 ### Note that rules that should apply to all untrusted apps must be in app.te or also
 ### added to ephemeral_app.te.
 
-# Some apps ship with shared libraries and binaries that they write out
-# to their sandbox directory and then execute.
-allow untrusted_app_all privapp_data_file:file { r_file_perms execute };
-allow untrusted_app_all app_data_file:file     { r_file_perms execute };
-auditallow untrusted_app_all app_data_file:file execute;
-
 # Chrome Crashpad uses the the dynamic linker to load native executables
 # from an APK (b/112050209, crbug.com/928422)
 allow untrusted_app_all system_linker_exec:file execute_no_trans;
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow untrusted_app_all privapp_data_file:lnk_file r_file_perms;
 
 # Allow handling of less common filesystem objects
 allow untrusted_app_all app_data_file:{ lnk_file sock_file fifo_file } create_file_perms;
 
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 44e9295df9de755a08b4b8957898878911cbe786..112015c5a080496be6e9c6d09bec9c13e7fef09e 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -10,10 +10,17 @@
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
+
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=29.
+allow untrusted_app privapp_data_file:file { r_file_perms execute };
+allow untrusted_app app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app app_data_file:file execute;
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index 4865ea1e7f81c76eef4f68fe1cf9d0dd03f3d586..0cd6bc41747102096326fe0414a928ae77aeb5fa 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -32,20 +32,27 @@ allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_app_25 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=25.
+allow untrusted_app_25 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_25 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_25 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index 27fcb3cc3fcfb4cef9e974f6238404a2bac4ebf3..924119b1c8d5e5b0bb398e76e51c1962b072afdf 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -20,20 +20,27 @@ auditallow untrusted_app_27 self:process execmem;
 
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_27 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_27 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_27 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index 9995afbe8f12b84c7957d742c45e09fabdff8740..dbb7a87d60e01cfd26fbaaa1eb7f801db56e739a 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -11,12 +11,19 @@
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
 allow untrusted_app_29 self:process execmem;
 auditallow untrusted_app_29 self:process execmem;
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_29 app_data_file:file execute;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/private/untrusted_app_all.te b/private/untrusted_app_all.te
index d9fd5a12e0ffa74ee1e3e5c67b17203c2e43d05c..3bea704155ea3e615e3bde0e45238b9ff02d06e1 100644
--- a/private/untrusted_app_all.te
+++ b/private/untrusted_app_all.te
@@ -13,26 +13,20 @@
 ### attribute is assigned to all non-system apps as well as to any system apps
 ### that are not signed by the platform key.  To move
 ### a system app into a specific domain, add a signer entry for it to
 ### mac_permissions.xml and assign it one of the pre-existing seinfo values
 ### or define and use a new seinfo value in both mac_permissions.xml and
 ### seapp_contexts.
 ###
 ### Note that rules that should apply to all untrusted apps must be in app.te or also
 ### added to ephemeral_app.te.
 
-# Some apps ship with shared libraries and binaries that they write out
-# to their sandbox directory and then execute.
-allow untrusted_app_all privapp_data_file:file { r_file_perms execute };
-allow untrusted_app_all app_data_file:file     { r_file_perms execute };
-auditallow untrusted_app_all app_data_file:file execute;
-
 # Chrome Crashpad uses the the dynamic linker to load native executables
 # from an APK (b/112050209, crbug.com/928422)
 allow untrusted_app_all system_linker_exec:file execute_no_trans;
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow untrusted_app_all privapp_data_file:lnk_file r_file_perms;
 
 # Allow handling of less common filesystem objects
 allow untrusted_app_all app_data_file:{ lnk_file sock_file fifo_file } create_file_perms;
 

commit f19c82f361a817c7665fd2259dcca46efe609655
Author: Renlord <me@renlord.com>
Date:   Wed 2020-02-26 10:23:23+1100

    remove base system app ashmem execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/ephemeral_app.te    | 3 ++-
 prebuilts/api/30.0/private/isolated_app.te     | 3 +++
 prebuilts/api/30.0/private/untrusted_app.te    | 3 +++
 prebuilts/api/30.0/private/untrusted_app_29.te | 3 +++
 prebuilts/api/30.0/public/app.te               | 3 ---
 private/ephemeral_app.te                       | 3 ++-
 private/isolated_app.te                        | 3 +++
 private/untrusted_app.te                       | 3 +++
 private/untrusted_app_29.te                    | 3 +++
 public/app.te                                  | 3 ---
 10 files changed, 22 insertions(+), 8 deletions(-)

diff --git a/prebuilts/api/30.0/private/ephemeral_app.te b/prebuilts/api/30.0/private/ephemeral_app.te
index 065dec36098100b0567009879830d262e609aac2..9f1bcbfca7adb38c8dbf80b6a70c2668651f6387 100644
--- a/prebuilts/api/30.0/private/ephemeral_app.te
+++ b/prebuilts/api/30.0/private/ephemeral_app.te
@@ -58,21 +58,22 @@ perfetto_producer(ephemeral_app)
 
 # Allow profiling if the app opts in by being marked profileable/debuggable.
 can_profile_heap(ephemeral_app)
 can_profile_perf(ephemeral_app)
 
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
-allow ephemeral_app ashmem_device:chr_file rw_file_perms;
+allow ephemeral_app ashmem_device:chr_file { rw_file_perms execute };
+auditallow ephemeral_app ashmem_device:chr_file execute;
 
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
diff --git a/prebuilts/api/30.0/private/isolated_app.te b/prebuilts/api/30.0/private/isolated_app.te
index 73dad2b03d07a5363ea40a84982b94960d9ea1ff..4eb0313f18aa0d57dcc36130b9339e270fb822e8 100644
--- a/prebuilts/api/30.0/private/isolated_app.te
+++ b/prebuilts/api/30.0/private/isolated_app.te
@@ -63,20 +63,23 @@ dontaudit isolated_app shell_data_file:dir search;
 
 # Write app-specific trace data to the Perfetto traced damon. This requires
 # connecting to its producer socket and obtaining a (per-process) tmpfs fd.
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
+allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/prebuilts/api/30.0/private/untrusted_app.te b/prebuilts/api/30.0/private/untrusted_app.te
index 112015c5a080496be6e9c6d09bec9c13e7fef09e..6e75a408746604cf6f6e1f8a811f524130b57de5 100644
--- a/prebuilts/api/30.0/private/untrusted_app.te
+++ b/prebuilts/api/30.0/private/untrusted_app.te
@@ -17,10 +17,13 @@ bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
+
+allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/prebuilts/api/30.0/private/untrusted_app_29.te b/prebuilts/api/30.0/private/untrusted_app_29.te
index dbb7a87d60e01cfd26fbaaa1eb7f801db56e739a..6b8be99fa6984dc1b84c621cee5bd4b36abb1d22 100644
--- a/prebuilts/api/30.0/private/untrusted_app_29.te
+++ b/prebuilts/api/30.0/private/untrusted_app_29.te
@@ -20,10 +20,13 @@ auditallow untrusted_app_29 self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=27.
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/prebuilts/api/30.0/public/app.te b/prebuilts/api/30.0/public/app.te
index 559368149db0130e6518a980373ebb8df4f1a982..bb2d7cfd96f69e2ec852d7e733625c4e1f7bbcdf 100644
--- a/prebuilts/api/30.0/public/app.te
+++ b/prebuilts/api/30.0/public/app.te
@@ -1,23 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;
 
diff --git a/private/ephemeral_app.te b/private/ephemeral_app.te
index 065dec36098100b0567009879830d262e609aac2..9f1bcbfca7adb38c8dbf80b6a70c2668651f6387 100644
--- a/private/ephemeral_app.te
+++ b/private/ephemeral_app.te
@@ -58,21 +58,22 @@ perfetto_producer(ephemeral_app)
 
 # Allow profiling if the app opts in by being marked profileable/debuggable.
 can_profile_heap(ephemeral_app)
 can_profile_perf(ephemeral_app)
 
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
-allow ephemeral_app ashmem_device:chr_file rw_file_perms;
+allow ephemeral_app ashmem_device:chr_file { rw_file_perms execute };
+auditallow ephemeral_app ashmem_device:chr_file execute;
 
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
diff --git a/private/isolated_app.te b/private/isolated_app.te
index 73dad2b03d07a5363ea40a84982b94960d9ea1ff..4eb0313f18aa0d57dcc36130b9339e270fb822e8 100644
--- a/private/isolated_app.te
+++ b/private/isolated_app.te
@@ -63,20 +63,23 @@ dontaudit isolated_app shell_data_file:dir search;
 
 # Write app-specific trace data to the Perfetto traced damon. This requires
 # connecting to its producer socket and obtaining a (per-process) tmpfs fd.
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
+allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 112015c5a080496be6e9c6d09bec9c13e7fef09e..6e75a408746604cf6f6e1f8a811f524130b57de5 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -17,10 +17,13 @@ bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
+
+allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index dbb7a87d60e01cfd26fbaaa1eb7f801db56e739a..6b8be99fa6984dc1b84c621cee5bd4b36abb1d22 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -20,10 +20,13 @@ auditallow untrusted_app_29 self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=27.
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/public/app.te b/public/app.te
index 559368149db0130e6518a980373ebb8df4f1a982..bb2d7cfd96f69e2ec852d7e733625c4e1f7bbcdf 100644
--- a/public/app.te
+++ b/public/app.te
@@ -1,23 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;
 

commit 4fb7e1a22c0861f3680113b247297ab03864b0d4
Author: Renlord <me@renlord.com>
Date:   Wed 2020-02-26 22:53:08+1100

    remove base system app tmpfs execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/untrusted_base_app.te   |  2 +-
 .../api/30.0/private/untrusted_base_app_25.te      |  2 +-
 .../api/30.0/private/untrusted_base_app_27.te      |  2 +-
 .../api/30.0/private/untrusted_base_app_29.te      |  2 +-
 prebuilts/api/30.0/public/te_macros                | 22 ++++++++++++++++++++++
 private/untrusted_base_app.te                      |  2 +-
 private/untrusted_base_app_25.te                   |  2 +-
 private/untrusted_base_app_27.te                   |  2 +-
 private/untrusted_base_app_29.te                   |  2 +-
 public/te_macros                                   | 22 ++++++++++++++++++++++
 10 files changed, 52 insertions(+), 8 deletions(-)

diff --git a/prebuilts/api/30.0/private/untrusted_base_app.te b/prebuilts/api/30.0/private/untrusted_base_app.te
index 8ee2819f16bd19bb7f418f3281ffbec7d7b71551..4e1b4f2c326ca5aa5c773d2ffaef2661a38be032 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app.te
@@ -3,14 +3,14 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### targetSdkVersion >= 30.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app coredomain;
 
-app_domain(untrusted_base_app)
+hardened_app_domain(untrusted_base_app)
 untrusted_app_domain(untrusted_base_app)
 net_domain(untrusted_base_app)
 bluetooth_domain(untrusted_base_app)
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_25.te b/prebuilts/api/30.0/private/untrusted_base_app_25.te
index d805e85fec42b66ead714379c44a48901eccea07..69e1c69830968a5d710f12d5efc0d541ea424868 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app_25.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app_25.te
@@ -3,21 +3,21 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### targetSdkVersion <= 25.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_25 coredomain;
 
-app_domain(untrusted_base_app_25)
+hardened_app_domain(untrusted_base_app_25)
 untrusted_app_domain(untrusted_base_app_25)
 net_domain(untrusted_base_app_25)
 bluetooth_domain(untrusted_base_app_25)
 
 # b/35917228 - /proc/misc access
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_27.te b/prebuilts/api/30.0/private/untrusted_base_app_27.te
index 59e79435d8666f17e8fc25949edaf4211357565c..aaccfb31c1d779516f8d21a6162a8d57fffa00f3 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app_27.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app_27.te
@@ -3,21 +3,21 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### 25 < targetSdkVersion <= 28.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
-app_domain(untrusted_base_app_27)
+hardened_app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
diff --git a/prebuilts/api/30.0/private/untrusted_base_app_29.te b/prebuilts/api/30.0/private/untrusted_base_app_29.te
index a027578017ca22d8789d2b96e1766047e1e6810c..a1a10ca8d8943316ca6487f0a386afd669a4c09e 100644
--- a/prebuilts/api/30.0/private/untrusted_base_app_29.te
+++ b/prebuilts/api/30.0/private/untrusted_base_app_29.te
@@ -3,17 +3,17 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### targetSdkVersion = 29.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_29 coredomain;
 
-app_domain(untrusted_base_app_29)
+hardened_app_domain(untrusted_base_app_29)
 untrusted_app_domain(untrusted_base_app_29)
 net_domain(untrusted_base_app_29)
 bluetooth_domain(untrusted_base_app_29)
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/30.0/public/te_macros b/prebuilts/api/30.0/public/te_macros
index 56f977522e8a2b796a7db4ef5b0f29b98bd82048..fecbeb659939a02531ddfdac0434cd7159e3859d 100644
--- a/prebuilts/api/30.0/public/te_macros
+++ b/prebuilts/api/30.0/public/te_macros
@@ -177,20 +177,42 @@ neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_pe
 # of application data and execution state. Ptrace bypasses those
 # confidentiality guarantees. Disallow ptrace access from system components to
 # apps. crash_dump is excluded, as it needs ptrace access to produce stack
 # traces. runas_app is excluded, as it operates only on debuggable apps.
 # simpleperf is excluded, as it operates only on debuggable or profileable
 # apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
 # live lock conditions.
 neverallow { domain -$1 -crash_dump userdebug_or_eng(`-llkd') -runas_app -simpleperf } $1:process ptrace;
 ')
 
+#####################################
+# hardened_app_domain(domain)
+# Allow the same base set of permissions as per app_domain
+# but removes tmpfs:file execute
+define(`hardened_app_domain', `
+typeattribute $1 appdomain;
+# Label tmpfs objects for all apps.
+type_transition $1 tmpfs:file appdomain_tmpfs;
+allow $1 appdomain_tmpfs:file { getattr map read write };
+neverallow { $1 -runas_app -shell -simpleperf } { domain -$1 }:file no_rw_file_perms;
+neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_perms;
+# The Android security model guarantees the confidentiality and integrity
+# of application data and execution state. Ptrace bypasses those
+# confidentiality guarantees. Disallow ptrace access from system components to
+# apps. crash_dump is excluded, as it needs ptrace access to produce stack
+# traces. runas_app is excluded, as it operates only on debuggable apps.
+# simpleperf is excluded, as it operates only on debuggable or profileable
+# apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
+# live lock conditions.
+neverallow { domain -$1 -crash_dump userdebug_or_eng(`-llkd') -runas_app -simpleperf } $1:process ptrace;
+')
+
 #####################################
 # untrusted_app_domain(domain)
 # Allow a base set of permissions required for all untrusted apps.
 define(`untrusted_app_domain', `
 typeattribute $1 untrusted_app_all;
 ')
 
 #####################################
 # net_domain(domain)
 # Allow a base set of permissions required for network access.
diff --git a/private/untrusted_base_app.te b/private/untrusted_base_app.te
index 8ee2819f16bd19bb7f418f3281ffbec7d7b71551..4e1b4f2c326ca5aa5c773d2ffaef2661a38be032 100644
--- a/private/untrusted_base_app.te
+++ b/private/untrusted_base_app.te
@@ -3,14 +3,14 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### targetSdkVersion >= 30.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app coredomain;
 
-app_domain(untrusted_base_app)
+hardened_app_domain(untrusted_base_app)
 untrusted_app_domain(untrusted_base_app)
 net_domain(untrusted_base_app)
 bluetooth_domain(untrusted_base_app)
diff --git a/private/untrusted_base_app_25.te b/private/untrusted_base_app_25.te
index d805e85fec42b66ead714379c44a48901eccea07..69e1c69830968a5d710f12d5efc0d541ea424868 100644
--- a/private/untrusted_base_app_25.te
+++ b/private/untrusted_base_app_25.te
@@ -3,21 +3,21 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### targetSdkVersion <= 25.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_25 coredomain;
 
-app_domain(untrusted_base_app_25)
+hardened_app_domain(untrusted_base_app_25)
 untrusted_app_domain(untrusted_base_app_25)
 net_domain(untrusted_base_app_25)
 bluetooth_domain(untrusted_base_app_25)
 
 # b/35917228 - /proc/misc access
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
diff --git a/private/untrusted_base_app_27.te b/private/untrusted_base_app_27.te
index 59e79435d8666f17e8fc25949edaf4211357565c..aaccfb31c1d779516f8d21a6162a8d57fffa00f3 100644
--- a/private/untrusted_base_app_27.te
+++ b/private/untrusted_base_app_27.te
@@ -3,21 +3,21 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### 25 < targetSdkVersion <= 28.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
-app_domain(untrusted_base_app_27)
+hardened_app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
diff --git a/private/untrusted_base_app_29.te b/private/untrusted_base_app_29.te
index a027578017ca22d8789d2b96e1766047e1e6810c..a1a10ca8d8943316ca6487f0a386afd669a4c09e 100644
--- a/private/untrusted_base_app_29.te
+++ b/private/untrusted_base_app_29.te
@@ -3,17 +3,17 @@
 ###
 ### This file defines the rules for untrusted apps running with
 ### targetSdkVersion = 29.
 ###
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_29 coredomain;
 
-app_domain(untrusted_base_app_29)
+hardened_app_domain(untrusted_base_app_29)
 untrusted_app_domain(untrusted_base_app_29)
 net_domain(untrusted_base_app_29)
 bluetooth_domain(untrusted_base_app_29)
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/public/te_macros b/public/te_macros
index 56f977522e8a2b796a7db4ef5b0f29b98bd82048..fecbeb659939a02531ddfdac0434cd7159e3859d 100644
--- a/public/te_macros
+++ b/public/te_macros
@@ -177,20 +177,42 @@ neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_pe
 # of application data and execution state. Ptrace bypasses those
 # confidentiality guarantees. Disallow ptrace access from system components to
 # apps. crash_dump is excluded, as it needs ptrace access to produce stack
 # traces. runas_app is excluded, as it operates only on debuggable apps.
 # simpleperf is excluded, as it operates only on debuggable or profileable
 # apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
 # live lock conditions.
 neverallow { domain -$1 -crash_dump userdebug_or_eng(`-llkd') -runas_app -simpleperf } $1:process ptrace;
 ')
 
+#####################################
+# hardened_app_domain(domain)
+# Allow the same base set of permissions as per app_domain
+# but removes tmpfs:file execute
+define(`hardened_app_domain', `
+typeattribute $1 appdomain;
+# Label tmpfs objects for all apps.
+type_transition $1 tmpfs:file appdomain_tmpfs;
+allow $1 appdomain_tmpfs:file { getattr map read write };
+neverallow { $1 -runas_app -shell -simpleperf } { domain -$1 }:file no_rw_file_perms;
+neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_perms;
+# The Android security model guarantees the confidentiality and integrity
+# of application data and execution state. Ptrace bypasses those
+# confidentiality guarantees. Disallow ptrace access from system components to
+# apps. crash_dump is excluded, as it needs ptrace access to produce stack
+# traces. runas_app is excluded, as it operates only on debuggable apps.
+# simpleperf is excluded, as it operates only on debuggable or profileable
+# apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
+# live lock conditions.
+neverallow { domain -$1 -crash_dump userdebug_or_eng(`-llkd') -runas_app -simpleperf } $1:process ptrace;
+')
+
 #####################################
 # untrusted_app_domain(domain)
 # Allow a base set of permissions required for all untrusted apps.
 define(`untrusted_app_domain', `
 typeattribute $1 untrusted_app_all;
 ')
 
 #####################################
 # net_domain(domain)
 # Allow a base set of permissions required for network access.

commit d98ba76433c3a79dd48d2e14a6bd84d55d9513d9
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sat 2020-02-29 11:03:35-0500

    auditallow apk_data_file execute
    
    For libraries, apps should be migrating to the more modern approach of
    storing them in the apk uncompressed and mapping them directly from it.
    
    This is the most modern approach available for executables and is better
    than using app data, but ideally it wouldn't be done. For now, audit use
    of `execute_no_trans` anyway while this is given more thought.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/public/app.te | 1 +
 public/app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/30.0/public/app.te b/prebuilts/api/30.0/public/app.te
index bb2d7cfd96f69e2ec852d7e733625c4e1f7bbcdf..7cb5bac64194b9d01fe0c5ec8eed23ac2f2689f1 100644
--- a/prebuilts/api/30.0/public/app.te
+++ b/prebuilts/api/30.0/public/app.te
@@ -268,20 +268,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
 allow appdomain apk_data_file:file rx_file_perms;
+auditallow appdomain apk_data_file:file { execute execute_no_trans };
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
diff --git a/public/app.te b/public/app.te
index bb2d7cfd96f69e2ec852d7e733625c4e1f7bbcdf..7cb5bac64194b9d01fe0c5ec8eed23ac2f2689f1 100644
--- a/public/app.te
+++ b/public/app.te
@@ -268,20 +268,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
 allow appdomain apk_data_file:file rx_file_perms;
+auditallow appdomain apk_data_file:file { execute execute_no_trans };
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;

commit 83bcdfc284965d090bbac5bbff8fe68463e297f7
Author: Renlord <me@renlord.com>
Date:   Thu 2020-02-27 20:37:55+1100

    remove base system app apk_data_file execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/ephemeral_app.te    | 3 +++
 prebuilts/api/30.0/private/isolated_app.te     | 3 +++
 prebuilts/api/30.0/private/untrusted_app.te    | 3 +++
 prebuilts/api/30.0/private/untrusted_app_25.te | 3 +++
 prebuilts/api/30.0/private/untrusted_app_27.te | 3 +++
 prebuilts/api/30.0/private/untrusted_app_29.te | 3 +++
 prebuilts/api/30.0/public/app.te               | 3 +--
 private/ephemeral_app.te                       | 3 +++
 private/isolated_app.te                        | 3 +++
 private/untrusted_app.te                       | 3 +++
 private/untrusted_app_25.te                    | 3 +++
 private/untrusted_app_27.te                    | 3 +++
 private/untrusted_app_29.te                    | 3 +++
 public/app.te                                  | 3 +--
 14 files changed, 38 insertions(+), 4 deletions(-)

diff --git a/prebuilts/api/30.0/private/ephemeral_app.te b/prebuilts/api/30.0/private/ephemeral_app.te
index 9f1bcbfca7adb38c8dbf80b6a70c2668651f6387..fabbe1d750082eaf7851a4f6490bd8746de75af6 100644
--- a/prebuilts/api/30.0/private/ephemeral_app.te
+++ b/prebuilts/api/30.0/private/ephemeral_app.te
@@ -61,20 +61,23 @@ can_profile_heap(ephemeral_app)
 can_profile_perf(ephemeral_app)
 
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file { rw_file_perms execute };
 auditallow ephemeral_app ashmem_device:chr_file execute;
 
+allow ephemeral_app apk_data_file:file { execute execute_no_trans };
+auditallow ephemeral_app apk_data_file:file { execute execute_no_trans };
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/prebuilts/api/30.0/private/isolated_app.te b/prebuilts/api/30.0/private/isolated_app.te
index 4eb0313f18aa0d57dcc36130b9339e270fb822e8..bf38e44b2aa595c4d3b132cbc03f5420875c1d23 100644
--- a/prebuilts/api/30.0/private/isolated_app.te
+++ b/prebuilts/api/30.0/private/isolated_app.te
@@ -66,20 +66,23 @@ dontaudit isolated_app shell_data_file:dir search;
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
 allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
+allow isolated_app apk_data_file:file { execute execute_no_trans };
+auditallow isolated_app apk_data_file:file { execute execute_no_trans };
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/prebuilts/api/30.0/private/untrusted_app.te b/prebuilts/api/30.0/private/untrusted_app.te
index 6e75a408746604cf6f6e1f8a811f524130b57de5..bf95acd0624f5217c47e7dfe8acf4db463c28f2c 100644
--- a/prebuilts/api/30.0/private/untrusted_app.te
+++ b/prebuilts/api/30.0/private/untrusted_app.te
@@ -20,10 +20,13 @@ auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
 
 allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/30.0/private/untrusted_app_25.te b/prebuilts/api/30.0/private/untrusted_app_25.te
index 0cd6bc41747102096326fe0414a928ae77aeb5fa..3234e005673e21cae262ea42b461619543cb7823 100644
--- a/prebuilts/api/30.0/private/untrusted_app_25.te
+++ b/prebuilts/api/30.0/private/untrusted_app_25.te
@@ -54,10 +54,13 @@ userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/30.0/private/untrusted_app_27.te b/prebuilts/api/30.0/private/untrusted_app_27.te
index 924119b1c8d5e5b0bb398e76e51c1962b072afdf..f0e53a76bdb55c84cb82da4cc9ee9257bf8a17da 100644
--- a/prebuilts/api/30.0/private/untrusted_app_27.te
+++ b/prebuilts/api/30.0/private/untrusted_app_27.te
@@ -42,10 +42,13 @@ userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/30.0/private/untrusted_app_29.te b/prebuilts/api/30.0/private/untrusted_app_29.te
index 6b8be99fa6984dc1b84c621cee5bd4b36abb1d22..561bc1d797ef9e2ebae99fa2c9e3276064be4933 100644
--- a/prebuilts/api/30.0/private/untrusted_app_29.te
+++ b/prebuilts/api/30.0/private/untrusted_app_29.te
@@ -23,10 +23,13 @@ auditallow untrusted_app_29 self:process execmem;
 # This is allowed for non-base system apps targetAPI <=27.
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/30.0/public/app.te b/prebuilts/api/30.0/public/app.te
index 7cb5bac64194b9d01fe0c5ec8eed23ac2f2689f1..98f42478104289cbdaba7967b1edbea6682b2722 100644
--- a/prebuilts/api/30.0/public/app.te
+++ b/prebuilts/api/30.0/public/app.te
@@ -267,22 +267,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
-allow appdomain apk_data_file:file rx_file_perms;
-auditallow appdomain apk_data_file:file { execute execute_no_trans };
+allow appdomain apk_data_file:file r_file_perms;
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
diff --git a/private/ephemeral_app.te b/private/ephemeral_app.te
index 9f1bcbfca7adb38c8dbf80b6a70c2668651f6387..fabbe1d750082eaf7851a4f6490bd8746de75af6 100644
--- a/private/ephemeral_app.te
+++ b/private/ephemeral_app.te
@@ -61,20 +61,23 @@ can_profile_heap(ephemeral_app)
 can_profile_perf(ephemeral_app)
 
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file { rw_file_perms execute };
 auditallow ephemeral_app ashmem_device:chr_file execute;
 
+allow ephemeral_app apk_data_file:file { execute execute_no_trans };
+auditallow ephemeral_app apk_data_file:file { execute execute_no_trans };
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/private/isolated_app.te b/private/isolated_app.te
index 4eb0313f18aa0d57dcc36130b9339e270fb822e8..bf38e44b2aa595c4d3b132cbc03f5420875c1d23 100644
--- a/private/isolated_app.te
+++ b/private/isolated_app.te
@@ -66,20 +66,23 @@ dontaudit isolated_app shell_data_file:dir search;
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
 allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
+allow isolated_app apk_data_file:file { execute execute_no_trans };
+auditallow isolated_app apk_data_file:file { execute execute_no_trans };
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 6e75a408746604cf6f6e1f8a811f524130b57de5..bf95acd0624f5217c47e7dfe8acf4db463c28f2c 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -20,10 +20,13 @@ auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
 
 allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app apk_data_file:file { execute execute_no_trans };
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index 0cd6bc41747102096326fe0414a928ae77aeb5fa..3234e005673e21cae262ea42b461619543cb7823 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -54,10 +54,13 @@ userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index 924119b1c8d5e5b0bb398e76e51c1962b072afdf..f0e53a76bdb55c84cb82da4cc9ee9257bf8a17da 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -42,10 +42,13 @@ userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index 6b8be99fa6984dc1b84c621cee5bd4b36abb1d22..561bc1d797ef9e2ebae99fa2c9e3276064be4933 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -23,10 +23,13 @@ auditallow untrusted_app_29 self:process execmem;
 # This is allowed for non-base system apps targetAPI <=27.
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
diff --git a/public/app.te b/public/app.te
index 7cb5bac64194b9d01fe0c5ec8eed23ac2f2689f1..98f42478104289cbdaba7967b1edbea6682b2722 100644
--- a/public/app.te
+++ b/public/app.te
@@ -267,22 +267,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
-allow appdomain apk_data_file:file rx_file_perms;
-auditallow appdomain apk_data_file:file { execute execute_no_trans };
+allow appdomain apk_data_file:file r_file_perms;
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;

commit fca08692244e9346c26a4ef3c7153fd791665872
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2020-02-25 06:41:22-0500

    remove zygote execmem
    
    GrapheneOS doesn't use the ART JIT compiler.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/app_zygote.te     | 3 ---
 prebuilts/api/30.0/private/webview_zygote.te | 3 ---
 prebuilts/api/30.0/private/zygote.te         | 1 -
 private/app_zygote.te                        | 3 ---
 private/webview_zygote.te                    | 3 ---
 private/zygote.te                            | 1 -
 6 files changed, 14 deletions(-)

diff --git a/prebuilts/api/30.0/private/app_zygote.te b/prebuilts/api/30.0/private/app_zygote.te
index a68cb56e107d4b0c8a1fa8b7aa8f31d6adcdff83..9cb16fb06960f733fea54ff37125ad297341f39b 100644
--- a/prebuilts/api/30.0/private/app_zygote.te
+++ b/prebuilts/api/30.0/private/app_zygote.te
@@ -11,23 +11,20 @@ tmpfs_domain(app_zygote);
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
 allow app_zygote isolated_base_app:process dyntransition;
 
-# For JIT
-allow app_zygote self:process execmem;
-
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
diff --git a/prebuilts/api/30.0/private/webview_zygote.te b/prebuilts/api/30.0/private/webview_zygote.te
index 9dbf0e7d5a59db7ba59a8d082eb1d8fcb3c8a59c..464c5854b8f3755b4b450a6a60cc8d2899657a8a 100644
--- a/prebuilts/api/30.0/private/webview_zygote.te
+++ b/prebuilts/api/30.0/private/webview_zygote.te
@@ -26,23 +26,20 @@ allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
 allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote dalvikcache_data_file:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote dalvikcache_data_file:file { r_file_perms execute };
 
-# Allow webview_zygote to create JIT memory.
-allow webview_zygote self:process execmem;
-
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
diff --git a/prebuilts/api/30.0/private/zygote.te b/prebuilts/api/30.0/private/zygote.te
index 5f08f8d6b1d8d30ea8c7403ccc32b84c3765f770..cb54b14425e7a584994e24556fbad57405f5515c 100644
--- a/prebuilts/api/30.0/private/zygote.te
+++ b/prebuilts/api/30.0/private/zygote.te
@@ -83,21 +83,20 @@ allow zygote {
   radio_data_file
   app_data_file
   shell_data_file
   bluetooth_data_file
   privapp_data_file
   nfc_data_file
   mnt_expand_file
 }:dir getattr;
 
 # Allow zygote to create JIT memory.
-allow zygote self:process execmem;
 allow zygote zygote_tmpfs:file execute;
 allow zygote ashmem_libcutils_device:chr_file execute;
 
 # Execute idmap and dex2oat within zygote's own domain.
 # TODO:  Should either of these be transitioned to the same domain
 # used by installd or stay in-domain for zygote?
 allow zygote idmap_exec:file rx_file_perms;
 allow zygote dex2oat_exec:file rx_file_perms;
 
 # Allow apps access to /vendor/overlay
diff --git a/private/app_zygote.te b/private/app_zygote.te
index a68cb56e107d4b0c8a1fa8b7aa8f31d6adcdff83..9cb16fb06960f733fea54ff37125ad297341f39b 100644
--- a/private/app_zygote.te
+++ b/private/app_zygote.te
@@ -11,23 +11,20 @@ tmpfs_domain(app_zygote);
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
 allow app_zygote isolated_base_app:process dyntransition;
 
-# For JIT
-allow app_zygote self:process execmem;
-
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
diff --git a/private/webview_zygote.te b/private/webview_zygote.te
index 9dbf0e7d5a59db7ba59a8d082eb1d8fcb3c8a59c..464c5854b8f3755b4b450a6a60cc8d2899657a8a 100644
--- a/private/webview_zygote.te
+++ b/private/webview_zygote.te
@@ -26,23 +26,20 @@ allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
 allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote dalvikcache_data_file:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote dalvikcache_data_file:file { r_file_perms execute };
 
-# Allow webview_zygote to create JIT memory.
-allow webview_zygote self:process execmem;
-
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
diff --git a/private/zygote.te b/private/zygote.te
index 5f08f8d6b1d8d30ea8c7403ccc32b84c3765f770..cb54b14425e7a584994e24556fbad57405f5515c 100644
--- a/private/zygote.te
+++ b/private/zygote.te
@@ -83,21 +83,20 @@ allow zygote {
   radio_data_file
   app_data_file
   shell_data_file
   bluetooth_data_file
   privapp_data_file
   nfc_data_file
   mnt_expand_file
 }:dir getattr;
 
 # Allow zygote to create JIT memory.
-allow zygote self:process execmem;
 allow zygote zygote_tmpfs:file execute;
 allow zygote ashmem_libcutils_device:chr_file execute;
 
 # Execute idmap and dex2oat within zygote's own domain.
 # TODO:  Should either of these be transitioned to the same domain
 # used by installd or stay in-domain for zygote?
 allow zygote idmap_exec:file rx_file_perms;
 allow zygote dex2oat_exec:file rx_file_perms;
 
 # Allow apps access to /vendor/overlay

commit 2a983aad76f460d0bae5462b8238c123dd6a0792
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Wed 2020-02-26 18:29:13-0500

    remove zygote access to apk_data_file
    
    GrapheneOS doesn't use out-of-band updates for base system apps (with a
    few exceptions) or APEX, so the zygote should never require this access.
    
    GrapheneOS also uses exec-based app spawning so it doesn't benefit from
    preloading in the standard code path.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/app_zygote.te     | 5 -----
 prebuilts/api/30.0/private/webview_zygote.te | 5 -----
 private/app_zygote.te                        | 5 -----
 private/webview_zygote.te                    | 5 -----
 4 files changed, 20 deletions(-)

diff --git a/prebuilts/api/30.0/private/app_zygote.te b/prebuilts/api/30.0/private/app_zygote.te
index 9cb16fb06960f733fea54ff37125ad297341f39b..bb698d6b063f56bf5899bf45cf7b72b65b6ac2ac 100644
--- a/prebuilts/api/30.0/private/app_zygote.te
+++ b/prebuilts/api/30.0/private/app_zygote.te
@@ -45,25 +45,20 @@ selinux_check_access(app_zygote)
 ######
 
 # Child of zygote.
 allow app_zygote zygote:fd use;
 allow app_zygote zygote:process sigchld;
 
 # For ART (read /data/dalvik-cache).
 r_dir_file(app_zygote, dalvikcache_data_file);
 allow app_zygote dalvikcache_data_file:file execute;
 
-# Allow reading/executing installed binaries to enable preloading
-# application data
-allow app_zygote apk_data_file:dir r_dir_perms;
-allow app_zygote apk_data_file:file { r_file_perms execute };
-
 # /oem accesses.
 allow app_zygote oemfs:dir search;
 
 # Allow app_zygote access to /vendor/overlay
 r_dir_file(app_zygote, vendor_overlay_file)
 
 allow app_zygote system_data_file:lnk_file r_file_perms;
 allow app_zygote system_data_file:file { getattr read map };
 
 # Send unsolicited message to system_server
diff --git a/prebuilts/api/30.0/private/webview_zygote.te b/prebuilts/api/30.0/private/webview_zygote.te
index 464c5854b8f3755b4b450a6a60cc8d2899657a8a..572c0127681f366afe0a9e05956dfd761fac95b8 100644
--- a/prebuilts/api/30.0/private/webview_zygote.te
+++ b/prebuilts/api/30.0/private/webview_zygote.te
@@ -3,25 +3,20 @@
 
 typeattribute webview_zygote coredomain;
 
 # The webview_zygote needs to be able to transition domains.
 typeattribute webview_zygote mlstrustedsubject;
 
 # Allow access to temporary files, which is normally permitted through
 # a domain macro.
 tmpfs_domain(webview_zygote);
 
-# Allow reading/executing installed binaries to enable preloading the
-# installed WebView implementation.
-allow webview_zygote apk_data_file:dir r_dir_perms;
-allow webview_zygote apk_data_file:file { r_file_perms execute };
-
 # Access to the WebView relro file.
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
diff --git a/private/app_zygote.te b/private/app_zygote.te
index 9cb16fb06960f733fea54ff37125ad297341f39b..bb698d6b063f56bf5899bf45cf7b72b65b6ac2ac 100644
--- a/private/app_zygote.te
+++ b/private/app_zygote.te
@@ -45,25 +45,20 @@ selinux_check_access(app_zygote)
 ######
 
 # Child of zygote.
 allow app_zygote zygote:fd use;
 allow app_zygote zygote:process sigchld;
 
 # For ART (read /data/dalvik-cache).
 r_dir_file(app_zygote, dalvikcache_data_file);
 allow app_zygote dalvikcache_data_file:file execute;
 
-# Allow reading/executing installed binaries to enable preloading
-# application data
-allow app_zygote apk_data_file:dir r_dir_perms;
-allow app_zygote apk_data_file:file { r_file_perms execute };
-
 # /oem accesses.
 allow app_zygote oemfs:dir search;
 
 # Allow app_zygote access to /vendor/overlay
 r_dir_file(app_zygote, vendor_overlay_file)
 
 allow app_zygote system_data_file:lnk_file r_file_perms;
 allow app_zygote system_data_file:file { getattr read map };
 
 # Send unsolicited message to system_server
diff --git a/private/webview_zygote.te b/private/webview_zygote.te
index 464c5854b8f3755b4b450a6a60cc8d2899657a8a..572c0127681f366afe0a9e05956dfd761fac95b8 100644
--- a/private/webview_zygote.te
+++ b/private/webview_zygote.te
@@ -3,25 +3,20 @@
 
 typeattribute webview_zygote coredomain;
 
 # The webview_zygote needs to be able to transition domains.
 typeattribute webview_zygote mlstrustedsubject;
 
 # Allow access to temporary files, which is normally permitted through
 # a domain macro.
 tmpfs_domain(webview_zygote);
 
-# Allow reading/executing installed binaries to enable preloading the
-# installed WebView implementation.
-allow webview_zygote apk_data_file:dir r_dir_perms;
-allow webview_zygote apk_data_file:file { r_file_perms execute };
-
 # Access to the WebView relro file.
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;

commit bcc9de9e4df2f56d14b3ca91d9befa62687b32da (HEAD, tag: RQ2A.210305.006.2021.03.02.10, m/master)
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Wed 2020-02-26 06:19:11-0500

    remove system_server_startup domain
    
    APEX isn't used for out-of-band updates by GrapheneOS, so this extra
    attack surface is not required.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/30.0/private/domain.te                     |  1 -
 prebuilts/api/30.0/private/seapp_contexts                |  2 +-
 prebuilts/api/30.0/private/system_server.te              |  5 -----
 .../api/30.0/private/system_server_startup.te (gone)     | 16 ----------------
 prebuilts/api/30.0/private/zygote.te                     |  6 +++---
 private/domain.te                                        |  1 -
 private/seapp_contexts                                   |  2 +-
 private/system_server.te                                 |  5 -----
 private/system_server_startup.te (gone)                  | 16 ----------------
 private/zygote.te                                        |  6 +++---
 10 files changed, 8 insertions(+), 52 deletions(-)

diff --git a/prebuilts/api/30.0/private/domain.te b/prebuilts/api/30.0/private/domain.te
index 7116dadfd9c4c2fec50ffec3eccd874aa2fa767e..bbad79ac32eb025e6b7951e429eac98b901c6b79 100644
--- a/prebuilts/api/30.0/private/domain.te
+++ b/prebuilts/api/30.0/private/domain.te
@@ -230,21 +230,20 @@ neverallow {
 # we want to avoid. See
 # https://bugs.chromium.org/p/project-zero/issues/detail?id=955 for example.
 #
 neverallow {
     domain
     -appdomain
     with_asan(`-asan_extract')
     -iorap_prefetcherd
     -shell
     userdebug_or_eng(`-su')
-    -system_server_startup # for memfd backed executable regions
     -app_zygote
     -webview_zygote
     -zygote
     userdebug_or_eng(`-mediaextractor')
     userdebug_or_eng(`-mediaswcodec')
 } {
     file_type
     -system_file_type
     -system_lib_file
     -system_linker_exec
diff --git a/prebuilts/api/30.0/private/seapp_contexts b/prebuilts/api/30.0/private/seapp_contexts
index 31db163c0ad5e794a46a61110406d118687a60c0..eeb8bb256d818bae1e1a2d006d935ccb3dc82e39 100644
--- a/prebuilts/api/30.0/private/seapp_contexts
+++ b/prebuilts/api/30.0/private/seapp_contexts
@@ -132,21 +132,21 @@ neverallow user=((?!_isolated).)* domain=isolated_base_app
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
 neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
-isSystemServer=true domain=system_server_startup
+isSystemServer=true domain=system_server
 
 user=_app seinfo=platform name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack levelFrom=all type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
 user=shared_relro seinfo=base domain=shared_relro
 user=shared_relro domain=shared_relro
diff --git a/prebuilts/api/30.0/private/system_server.te b/prebuilts/api/30.0/private/system_server.te
index 213b3c80f2e19e84f7e9163389b18b7a21d75c7a..73596b89243cffcf233b1c2fff03ad6421b5a40f 100644
--- a/prebuilts/api/30.0/private/system_server.te
+++ b/prebuilts/api/30.0/private/system_server.te
@@ -1069,25 +1069,20 @@ neverallow system_server { dev_type -frp_block_device }:blk_file no_rw_file_perm
 # rendering via SwiftShader, which requires JIT support. These builds are
 # never shipped to users.
 ifelse(target_requires_insecure_execmem_for_swiftshader, `true',
   `allow system_server self:process execmem;',
   `neverallow system_server self:process execmem;')
 neverallow system_server { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # TODO: deal with tmpfs_domain pub/priv split properly
 neverallow system_server system_server_tmpfs:file execute;
 
-# Resources handed off by system_server_startup
-allow system_server system_server_startup:fd use;
-allow system_server system_server_startup_tmpfs:file { read write map };
-allow system_server system_server_startup:unix_dgram_socket write;
-
 # Allow system server to communicate to apexd
 allow system_server apex_service:service_manager find;
 allow system_server apexd:binder call;
 
 # Allow system server to scan /apex for flattened APEXes
 allow system_server apex_mnt_dir:dir r_dir_perms;
 
 # Allow system server to communicate to system-suspend's control interface
 allow system_server system_suspend_control_service:service_manager find;
 binder_call(system_server, system_suspend)
diff --git a/prebuilts/api/30.0/private/system_server_startup.te b/prebuilts/api/30.0/private/system_server_startup.te
deleted file mode 100644
index 902941ed4d790fb0a6bef8db86ff556075e40291..0000000000000000000000000000000000000000
--- a/prebuilts/api/30.0/private/system_server_startup.te
+++ /dev/null
@@ -1,16 +0,0 @@
-type system_server_startup, domain, coredomain;
-type system_server_startup_tmpfs, file_type;
-
-tmpfs_domain(system_server_startup)
-
-# Create JIT memory
-allow system_server_startup self:process execmem;
-allow system_server_startup system_server_startup_tmpfs:file { execute read write open map };
-
-# Allow system_server_startup to run setcon() and enter the
-# system_server domain
-allow system_server_startup self:process setcurrent;
-allow system_server_startup system_server:process dyntransition;
-
-# Child of the zygote.
-allow system_server_startup zygote:process sigchld;
diff --git a/prebuilts/api/30.0/private/zygote.te b/prebuilts/api/30.0/private/zygote.te
index cb54b14425e7a584994e24556fbad57405f5515c..84a68694e2f9f555b20bc3ca5b13180331e78b33 100644
--- a/prebuilts/api/30.0/private/zygote.te
+++ b/prebuilts/api/30.0/private/zygote.te
@@ -8,21 +8,21 @@ tmpfs_domain(zygote)
 read_runtime_log_tags(zygote)
 
 # Override DAC on files and switch uid/gid.
 allow zygote self:global_capability_class_set { dac_override dac_read_search setgid setuid fowner chown };
 
 # Drop capabilities from bounding set.
 allow zygote self:global_capability_class_set setpcap;
 
 # Switch SELinux context to app domains.
 allow zygote self:process setcurrent;
-allow zygote system_server_startup:process dyntransition;
+allow zygote system_server:process dyntransition;
 allow zygote appdomain:process dyntransition;
 allow zygote webview_zygote:process dyntransition;
 allow zygote app_zygote:process dyntransition;
 
 # Allow zygote to read app /proc/pid dirs (b/10455872).
 allow zygote appdomain:dir { getattr search };
 allow zygote appdomain:file { r_file_perms };
 
 # Move children into the peer process group.
 allow zygote system_server:process { getpgid setpgid };
@@ -201,25 +201,25 @@ get_prop(zygote, media_variant_prop)
 
 ###
 ### neverallow rules
 ###
 
 # Ensure that all types assigned to app processes are included
 # in the appdomain attribute, so that all allow and neverallow rules
 # written on appdomain are applied to all app processes.
 # This is achieved by ensuring that it is impossible for zygote to
 # setcon (dyntransition) to any types other than those associated
-# with appdomain plus system_server_startup, webview_zygote and
+# with appdomain plus system_server, webview_zygote and
 # app_zygote.
 neverallow zygote ~{
   appdomain
-  system_server_startup
+  system_server
   webview_zygote
   app_zygote
 }:process dyntransition;
 
 # Zygote should never execute anything from /data except for /data/dalvik-cache files.
 neverallow zygote {
   data_file_type
   -dalvikcache_data_file # map PROT_EXEC
 }:file no_x_file_perms;
 
diff --git a/private/domain.te b/private/domain.te
index 7116dadfd9c4c2fec50ffec3eccd874aa2fa767e..bbad79ac32eb025e6b7951e429eac98b901c6b79 100644
--- a/private/domain.te
+++ b/private/domain.te
@@ -230,21 +230,20 @@ neverallow {
 # we want to avoid. See
 # https://bugs.chromium.org/p/project-zero/issues/detail?id=955 for example.
 #
 neverallow {
     domain
     -appdomain
     with_asan(`-asan_extract')
     -iorap_prefetcherd
     -shell
     userdebug_or_eng(`-su')
-    -system_server_startup # for memfd backed executable regions
     -app_zygote
     -webview_zygote
     -zygote
     userdebug_or_eng(`-mediaextractor')
     userdebug_or_eng(`-mediaswcodec')
 } {
     file_type
     -system_file_type
     -system_lib_file
     -system_linker_exec
diff --git a/private/seapp_contexts b/private/seapp_contexts
index 31db163c0ad5e794a46a61110406d118687a60c0..eeb8bb256d818bae1e1a2d006d935ccb3dc82e39 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -132,21 +132,21 @@ neverallow user=((?!_isolated).)* domain=isolated_base_app
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
 neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
-isSystemServer=true domain=system_server_startup
+isSystemServer=true domain=system_server
 
 user=_app seinfo=platform name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack levelFrom=all type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
 user=shared_relro seinfo=base domain=shared_relro
 user=shared_relro domain=shared_relro
diff --git a/private/system_server.te b/private/system_server.te
index 213b3c80f2e19e84f7e9163389b18b7a21d75c7a..73596b89243cffcf233b1c2fff03ad6421b5a40f 100644
--- a/private/system_server.te
+++ b/private/system_server.te
@@ -1069,25 +1069,20 @@ neverallow system_server { dev_type -frp_block_device }:blk_file no_rw_file_perm
 # rendering via SwiftShader, which requires JIT support. These builds are
 # never shipped to users.
 ifelse(target_requires_insecure_execmem_for_swiftshader, `true',
   `allow system_server self:process execmem;',
   `neverallow system_server self:process execmem;')
 neverallow system_server { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # TODO: deal with tmpfs_domain pub/priv split properly
 neverallow system_server system_server_tmpfs:file execute;
 
-# Resources handed off by system_server_startup
-allow system_server system_server_startup:fd use;
-allow system_server system_server_startup_tmpfs:file { read write map };
-allow system_server system_server_startup:unix_dgram_socket write;
-
 # Allow system server to communicate to apexd
 allow system_server apex_service:service_manager find;
 allow system_server apexd:binder call;
 
 # Allow system server to scan /apex for flattened APEXes
 allow system_server apex_mnt_dir:dir r_dir_perms;
 
 # Allow system server to communicate to system-suspend's control interface
 allow system_server system_suspend_control_service:service_manager find;
 binder_call(system_server, system_suspend)
diff --git a/private/system_server_startup.te b/private/system_server_startup.te
deleted file mode 100644
index 902941ed4d790fb0a6bef8db86ff556075e40291..0000000000000000000000000000000000000000
--- a/private/system_server_startup.te
+++ /dev/null
@@ -1,16 +0,0 @@
-type system_server_startup, domain, coredomain;
-type system_server_startup_tmpfs, file_type;
-
-tmpfs_domain(system_server_startup)
-
-# Create JIT memory
-allow system_server_startup self:process execmem;
-allow system_server_startup system_server_startup_tmpfs:file { execute read write open map };
-
-# Allow system_server_startup to run setcon() and enter the
-# system_server domain
-allow system_server_startup self:process setcurrent;
-allow system_server_startup system_server:process dyntransition;
-
-# Child of the zygote.
-allow system_server_startup zygote:process sigchld;
diff --git a/private/zygote.te b/private/zygote.te
index cb54b14425e7a584994e24556fbad57405f5515c..84a68694e2f9f555b20bc3ca5b13180331e78b33 100644
--- a/private/zygote.te
+++ b/private/zygote.te
@@ -8,21 +8,21 @@ tmpfs_domain(zygote)
 read_runtime_log_tags(zygote)
 
 # Override DAC on files and switch uid/gid.
 allow zygote self:global_capability_class_set { dac_override dac_read_search setgid setuid fowner chown };
 
 # Drop capabilities from bounding set.
 allow zygote self:global_capability_class_set setpcap;
 
 # Switch SELinux context to app domains.
 allow zygote self:process setcurrent;
-allow zygote system_server_startup:process dyntransition;
+allow zygote system_server:process dyntransition;
 allow zygote appdomain:process dyntransition;
 allow zygote webview_zygote:process dyntransition;
 allow zygote app_zygote:process dyntransition;
 
 # Allow zygote to read app /proc/pid dirs (b/10455872).
 allow zygote appdomain:dir { getattr search };
 allow zygote appdomain:file { r_file_perms };
 
 # Move children into the peer process group.
 allow zygote system_server:process { getpgid setpgid };
@@ -201,25 +201,25 @@ get_prop(zygote, media_variant_prop)
 
 ###
 ### neverallow rules
 ###
 
 # Ensure that all types assigned to app processes are included
 # in the appdomain attribute, so that all allow and neverallow rules
 # written on appdomain are applied to all app processes.
 # This is achieved by ensuring that it is impossible for zygote to
 # setcon (dyntransition) to any types other than those associated
-# with appdomain plus system_server_startup, webview_zygote and
+# with appdomain plus system_server, webview_zygote and
 # app_zygote.
 neverallow zygote ~{
   appdomain
-  system_server_startup
+  system_server
   webview_zygote
   app_zygote
 }:process dyntransition;
 
 # Zygote should never execute anything from /data except for /data/dalvik-cache files.
 neverallow zygote {
   data_file_type
   -dalvikcache_data_file # map PROT_EXEC
 }:file no_x_file_perms;
 
