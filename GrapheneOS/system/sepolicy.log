commit 20aae851740df7bdfb30b7758c25d4d29354043b
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2020-09-14 23:59:13-0400

    disable unused gmscore_app domain
---
 prebuilts/api/32.0/private/seapp_contexts | 4 ----
 private/seapp_contexts                    | 4 ----
 2 files changed, 8 deletions(-)

diff --git a/prebuilts/api/32.0/private/seapp_contexts b/prebuilts/api/32.0/private/seapp_contexts
index 1d38fd926c250e12f250f5359d82293862398c17..a7ed61f782b086fe8a3778dc2df68752ff268a47 100644
--- a/prebuilts/api/32.0/private/seapp_contexts
+++ b/prebuilts/api/32.0/private/seapp_contexts
@@ -157,21 +157,17 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
-user=_app isPrivApp=true name=com.google.android.gms domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms.* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms:* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gsf domain=gmscore_app type=privapp_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/seapp_contexts b/private/seapp_contexts
index 1d38fd926c250e12f250f5359d82293862398c17..a7ed61f782b086fe8a3778dc2df68752ff268a47 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -157,21 +157,17 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
-user=_app isPrivApp=true name=com.google.android.gms domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms.* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gms:* domain=gmscore_app type=privapp_data_file levelFrom=user
-user=_app isPrivApp=true name=com.google.android.gsf domain=gmscore_app type=privapp_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user

commit b8e016e7b3bc6f8202d41daa6ebd837002f43158
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2017-02-17 18:14:24-0500

    expose sys.update. to adb shell
---
 prebuilts/api/32.0/private/property_contexts | 1 +
 private/property_contexts                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/private/property_contexts b/prebuilts/api/32.0/private/property_contexts
index f235b35b710fcc4dfd04c070146554f6dfcb92d8..7ba633b447e7a91c3e5ebaa005a13f16a73bf804 100644
--- a/prebuilts/api/32.0/private/property_contexts
+++ b/prebuilts/api/32.0/private/property_contexts
@@ -39,20 +39,21 @@ init.svc_debug_pid.     u:object_r:init_svc_debug_prop:s0
 llk.                    u:object_r:llkd_prop:s0
 khungtask.              u:object_r:llkd_prop:s0
 ro.llk.                 u:object_r:llkd_prop:s0
 ro.khungtask.           u:object_r:llkd_prop:s0
 log.                    u:object_r:log_prop:s0
 log.tag                 u:object_r:log_tag_prop:s0
 log.tag.WifiHAL         u:object_r:wifi_log_prop:s0
 security.perf_harden    u:object_r:shell_prop:s0
 security.lower_kptr_restrict u:object_r:lower_kptr_restrict_prop:s0
 service.adb.root        u:object_r:shell_prop:s0
+sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
 logd.                   u:object_r:logd_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
diff --git a/private/property_contexts b/private/property_contexts
index f235b35b710fcc4dfd04c070146554f6dfcb92d8..7ba633b447e7a91c3e5ebaa005a13f16a73bf804 100644
--- a/private/property_contexts
+++ b/private/property_contexts
@@ -39,20 +39,21 @@ init.svc_debug_pid.     u:object_r:init_svc_debug_prop:s0
 llk.                    u:object_r:llkd_prop:s0
 khungtask.              u:object_r:llkd_prop:s0
 ro.llk.                 u:object_r:llkd_prop:s0
 ro.khungtask.           u:object_r:llkd_prop:s0
 log.                    u:object_r:log_prop:s0
 log.tag                 u:object_r:log_tag_prop:s0
 log.tag.WifiHAL         u:object_r:wifi_log_prop:s0
 security.perf_harden    u:object_r:shell_prop:s0
 security.lower_kptr_restrict u:object_r:lower_kptr_restrict_prop:s0
 service.adb.root        u:object_r:shell_prop:s0
+sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
 logd.                   u:object_r:logd_prop:s0
 persist.logd.           u:object_r:logd_prop:s0

commit 839a095029161aeeb93fa95cbfbbecad7bb710fa
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2020-09-15 00:08:40-0400

    add SELinux domain for Updater app
---
 prebuilts/api/32.0/private/app_neverallows.te          |  2 +-
 prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil |  1 +
 prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil |  1 +
 prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil |  1 +
 prebuilts/api/32.0/private/seapp_contexts              |  1 +
 prebuilts/api/32.0/private/updater_app.te (new)        | 17 +++++++++++++++++
 prebuilts/api/32.0/public/update_engine.te             |  1 +
 prebuilts/api/32.0/public/updater_app.te (new)         |  5 +++++
 private/app_neverallows.te                             |  2 +-
 private/compat/29.0/29.0.ignore.cil                    |  1 +
 private/compat/30.0/30.0.ignore.cil                    |  1 +
 private/compat/31.0/31.0.ignore.cil                    |  1 +
 private/seapp_contexts                                 |  1 +
 private/updater_app.te (new)                           | 17 +++++++++++++++++
 public/update_engine.te                                |  1 +
 public/updater_app.te (new)                            |  5 +++++
 16 files changed, 56 insertions(+), 2 deletions(-)

diff --git a/prebuilts/api/32.0/private/app_neverallows.te b/prebuilts/api/32.0/private/app_neverallows.te
index c7fa4e8c5081986b7cabd525b5803412a0ad069e..82713420ca2e80103c630ee6398afd478ac8b3bd 100644
--- a/prebuilts/api/32.0/private/app_neverallows.te
+++ b/prebuilts/api/32.0/private/app_neverallows.te
@@ -129,21 +129,21 @@ neverallow {
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
 # application un-installation.
-neverallow { all_untrusted_apps -mediaprovider } {
+neverallow { all_untrusted_apps -mediaprovider -updater_app } {
   fs_type
   -sdcard_type
   file_type
   -app_data_file            # The apps sandbox itself
   -privapp_data_file
   -app_exec_data_file       # stored within the app sandbox directory
   -media_rw_data_file       # Internal storage. Known that apps can
                             # leave artfacts here after uninstall.
   -user_profile_data_file   # Access to profile files
   userdebug_or_eng(`
diff --git a/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil b/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
index 10790468f16ced385ff7d8a87a6e765788b1a12d..b47eb81b867c9e38093dc21d4d490707c7d85fcc 100644
--- a/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
@@ -106,20 +106,21 @@
     system_group_file
     system_jvmti_agent_prop
     system_passwd_file
     system_unsolzygote_socket
     tethering_service
     traced_perf
     traced_perf_enabled_prop
     traced_perf_socket
     timezonedetector_service
     untrusted_app_29
+    updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
diff --git a/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil b/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
index e4acfe8a4a05cd510e7c45a665600f14c6751b40..a8d7421a2cb067cff6dcb6db86c7f3627c9e4357 100644
--- a/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
@@ -131,20 +131,21 @@
     sysfs_devices_cs_etm
     sysfs_dma_heap
     sysfs_dmabuf_stats
     sysfs_uhid
     system_server_dumper_service
     system_suspend_control_internal_service
     task_profiles_api_file
     texttospeech_service
     translation_service
     update_engine_stable_service
+    updater_app
     userdata_sysdev
     userspace_reboot_metadata_file
     uwb_service
     vcn_management_service
     vd_device
     vendor_kernel_modules
     vendor_modprobe
     vibrator_manager_service
     virtualization_service
     vpn_management_service
diff --git a/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil b/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
index 4e95cc6e485e6c8f4fbda9c838d9b6cbbd59b1ca..45e8322ebc8a0249de9d58d7a3df855c8d46ab5b 100644
--- a/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
@@ -1,9 +1,10 @@
 ;; new_objects - a collection of types that have been introduced that have no
 ;;   analogue in older policy.  Thus, we do not need to map these types to
 ;;   previous ones.  Add here to pass checkapi tests.
 (type new_objects)
 (typeattribute new_objects)
 (typeattributeset new_objects
   ( new_objects
     hypervisor_prop
+    updater_app
   ))
diff --git a/prebuilts/api/32.0/private/seapp_contexts b/prebuilts/api/32.0/private/seapp_contexts
index a7ed61f782b086fe8a3778dc2df68752ff268a47..e11e144b6a5db1e0edb8d52eb78bb41aec17c006 100644
--- a/prebuilts/api/32.0/private/seapp_contexts
+++ b/prebuilts/api/32.0/private/seapp_contexts
@@ -157,17 +157,18 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/prebuilts/api/32.0/private/updater_app.te b/prebuilts/api/32.0/private/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..0ce047b97a01f2c1c30e723cd2b9ccb827993892
--- /dev/null
+++ b/prebuilts/api/32.0/private/updater_app.te
@@ -0,0 +1,17 @@
+###
+### Updater app
+###
+
+typeattribute updater_app coredomain;
+
+app_domain(updater_app)
+untrusted_app_domain(updater_app)
+net_domain(updater_app)
+
+# Write to /data/ota_package for OTA packages.
+allow updater_app ota_package_file:dir rw_dir_perms;
+allow updater_app ota_package_file:file create_file_perms;
+
+# Allow Updater to communicate with update_engine for A/B update.
+binder_call(updater_app, update_engine)
+allow updater_app update_engine_service:service_manager find;
diff --git a/prebuilts/api/32.0/public/update_engine.te b/prebuilts/api/32.0/public/update_engine.te
index ab7090bbc6b793d664809eaa615b17f8a7f13f00..5523ff22e33904f6c2a7f4b528e4e0770f28792e 100644
--- a/prebuilts/api/32.0/public/update_engine.te
+++ b/prebuilts/api/32.0/public/update_engine.te
@@ -40,20 +40,21 @@ add_service(update_engine, update_engine_stable_service)
 # Allow update_engine to call the callback function provided by priv_app/GMS core.
 binder_call(update_engine, priv_app)
 # b/142672293: No other priv-app should need this rule now that GMS core runs in its own domain.
 userdebug_or_eng(`
   auditallow update_engine priv_app:binder { call transfer };
   auditallow priv_app update_engine:binder transfer;
   auditallow update_engine priv_app:fd use;
 ')
 
 binder_call(update_engine, gmscore_app)
+binder_call(update_engine, updater_app)
 
 # Allow update_engine to call the callback function provided by system_server.
 binder_call(update_engine, system_server)
 
 # Read OTA zip file at /data/ota_package/.
 allow update_engine ota_package_file:file r_file_perms;
 allow update_engine ota_package_file:dir r_dir_perms;
 
 # Use Boot Control HAL
 hal_client_domain(update_engine, hal_bootctl)
diff --git a/prebuilts/api/32.0/public/updater_app.te b/prebuilts/api/32.0/public/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..97a850ba19008bf220eb55c09bacf86f11f01e37
--- /dev/null
+++ b/prebuilts/api/32.0/public/updater_app.te
@@ -0,0 +1,5 @@
+###
+### Updater app
+###
+
+type updater_app, domain;
diff --git a/private/app_neverallows.te b/private/app_neverallows.te
index c7fa4e8c5081986b7cabd525b5803412a0ad069e..82713420ca2e80103c630ee6398afd478ac8b3bd 100644
--- a/private/app_neverallows.te
+++ b/private/app_neverallows.te
@@ -129,21 +129,21 @@ neverallow {
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
 # application un-installation.
-neverallow { all_untrusted_apps -mediaprovider } {
+neverallow { all_untrusted_apps -mediaprovider -updater_app } {
   fs_type
   -sdcard_type
   file_type
   -app_data_file            # The apps sandbox itself
   -privapp_data_file
   -app_exec_data_file       # stored within the app sandbox directory
   -media_rw_data_file       # Internal storage. Known that apps can
                             # leave artfacts here after uninstall.
   -user_profile_data_file   # Access to profile files
   userdebug_or_eng(`
diff --git a/private/compat/29.0/29.0.ignore.cil b/private/compat/29.0/29.0.ignore.cil
index 10790468f16ced385ff7d8a87a6e765788b1a12d..b47eb81b867c9e38093dc21d4d490707c7d85fcc 100644
--- a/private/compat/29.0/29.0.ignore.cil
+++ b/private/compat/29.0/29.0.ignore.cil
@@ -106,20 +106,21 @@
     system_group_file
     system_jvmti_agent_prop
     system_passwd_file
     system_unsolzygote_socket
     tethering_service
     traced_perf
     traced_perf_enabled_prop
     traced_perf_socket
     timezonedetector_service
     untrusted_app_29
+    updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
diff --git a/private/compat/30.0/30.0.ignore.cil b/private/compat/30.0/30.0.ignore.cil
index e4acfe8a4a05cd510e7c45a665600f14c6751b40..a8d7421a2cb067cff6dcb6db86c7f3627c9e4357 100644
--- a/private/compat/30.0/30.0.ignore.cil
+++ b/private/compat/30.0/30.0.ignore.cil
@@ -131,20 +131,21 @@
     sysfs_devices_cs_etm
     sysfs_dma_heap
     sysfs_dmabuf_stats
     sysfs_uhid
     system_server_dumper_service
     system_suspend_control_internal_service
     task_profiles_api_file
     texttospeech_service
     translation_service
     update_engine_stable_service
+    updater_app
     userdata_sysdev
     userspace_reboot_metadata_file
     uwb_service
     vcn_management_service
     vd_device
     vendor_kernel_modules
     vendor_modprobe
     vibrator_manager_service
     virtualization_service
     vpn_management_service
diff --git a/private/compat/31.0/31.0.ignore.cil b/private/compat/31.0/31.0.ignore.cil
index 4e95cc6e485e6c8f4fbda9c838d9b6cbbd59b1ca..45e8322ebc8a0249de9d58d7a3df855c8d46ab5b 100644
--- a/private/compat/31.0/31.0.ignore.cil
+++ b/private/compat/31.0/31.0.ignore.cil
@@ -1,9 +1,10 @@
 ;; new_objects - a collection of types that have been introduced that have no
 ;;   analogue in older policy.  Thus, we do not need to map these types to
 ;;   previous ones.  Add here to pass checkapi tests.
 (type new_objects)
 (typeattribute new_objects)
 (typeattributeset new_objects
   ( new_objects
     hypervisor_prop
+    updater_app
   ))
diff --git a/private/seapp_contexts b/private/seapp_contexts
index a7ed61f782b086fe8a3778dc2df68752ff268a47..e11e144b6a5db1e0edb8d52eb78bb41aec17c006 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -157,17 +157,18 @@ user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/updater_app.te b/private/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..0ce047b97a01f2c1c30e723cd2b9ccb827993892
--- /dev/null
+++ b/private/updater_app.te
@@ -0,0 +1,17 @@
+###
+### Updater app
+###
+
+typeattribute updater_app coredomain;
+
+app_domain(updater_app)
+untrusted_app_domain(updater_app)
+net_domain(updater_app)
+
+# Write to /data/ota_package for OTA packages.
+allow updater_app ota_package_file:dir rw_dir_perms;
+allow updater_app ota_package_file:file create_file_perms;
+
+# Allow Updater to communicate with update_engine for A/B update.
+binder_call(updater_app, update_engine)
+allow updater_app update_engine_service:service_manager find;
diff --git a/public/update_engine.te b/public/update_engine.te
index ab7090bbc6b793d664809eaa615b17f8a7f13f00..5523ff22e33904f6c2a7f4b528e4e0770f28792e 100644
--- a/public/update_engine.te
+++ b/public/update_engine.te
@@ -40,20 +40,21 @@ add_service(update_engine, update_engine_stable_service)
 # Allow update_engine to call the callback function provided by priv_app/GMS core.
 binder_call(update_engine, priv_app)
 # b/142672293: No other priv-app should need this rule now that GMS core runs in its own domain.
 userdebug_or_eng(`
   auditallow update_engine priv_app:binder { call transfer };
   auditallow priv_app update_engine:binder transfer;
   auditallow update_engine priv_app:fd use;
 ')
 
 binder_call(update_engine, gmscore_app)
+binder_call(update_engine, updater_app)
 
 # Allow update_engine to call the callback function provided by system_server.
 binder_call(update_engine, system_server)
 
 # Read OTA zip file at /data/ota_package/.
 allow update_engine ota_package_file:file r_file_perms;
 allow update_engine ota_package_file:dir r_dir_perms;
 
 # Use Boot Control HAL
 hal_client_domain(update_engine, hal_bootctl)
diff --git a/public/updater_app.te b/public/updater_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..97a850ba19008bf220eb55c09bacf86f11f01e37
--- /dev/null
+++ b/public/updater_app.te
@@ -0,0 +1,5 @@
+###
+### Updater app
+###
+
+type updater_app, domain;

commit 9fa803f0a814c54288861f83590e5602e9b7f073
Author: aeonsolution@protonmail.com <theaeonsolution@protonmail.com>
Date:   Mon 2020-09-14 23:37:37-0500

    allow platform_app to use nfc_service for NFC tile
    
    This is already permitted for priv_app and even untrusted_app.
---
 prebuilts/api/32.0/private/platform_app.te | 1 +
 private/platform_app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/private/platform_app.te b/prebuilts/api/32.0/private/platform_app.te
index f746f1cc400505810dc68c9749228a2954866d45..8bff85d77a5479a811a6c648b7d3f93824674aad 100644
--- a/prebuilts/api/32.0/private/platform_app.te
+++ b/prebuilts/api/32.0/private/platform_app.te
@@ -52,20 +52,21 @@ userdebug_or_eng(`
   auditallow platform_app proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 allow platform_app audioserver_service:service_manager find;
 allow platform_app cameraserver_service:service_manager find;
 allow platform_app drmserver_service:service_manager find;
 allow platform_app mediaserver_service:service_manager find;
 allow platform_app mediametrics_service:service_manager find;
 allow platform_app mediaextractor_service:service_manager find;
 allow platform_app mediadrmserver_service:service_manager find;
+allow platform_app nfc_service:service_manager find;
 allow platform_app persistent_data_block_service:service_manager find;
 allow platform_app radio_service:service_manager find;
 allow platform_app thermal_service:service_manager find;
 allow platform_app timezone_service:service_manager find;
 allow platform_app app_api_service:service_manager find;
 allow platform_app system_api_service:service_manager find;
 allow platform_app vr_manager_service:service_manager find;
 allow platform_app stats_service:service_manager find;
 
 # Allow platform apps to log via statsd.
diff --git a/private/platform_app.te b/private/platform_app.te
index f746f1cc400505810dc68c9749228a2954866d45..8bff85d77a5479a811a6c648b7d3f93824674aad 100644
--- a/private/platform_app.te
+++ b/private/platform_app.te
@@ -52,20 +52,21 @@ userdebug_or_eng(`
   auditallow platform_app proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 allow platform_app audioserver_service:service_manager find;
 allow platform_app cameraserver_service:service_manager find;
 allow platform_app drmserver_service:service_manager find;
 allow platform_app mediaserver_service:service_manager find;
 allow platform_app mediametrics_service:service_manager find;
 allow platform_app mediaextractor_service:service_manager find;
 allow platform_app mediadrmserver_service:service_manager find;
+allow platform_app nfc_service:service_manager find;
 allow platform_app persistent_data_block_service:service_manager find;
 allow platform_app radio_service:service_manager find;
 allow platform_app thermal_service:service_manager find;
 allow platform_app timezone_service:service_manager find;
 allow platform_app app_api_service:service_manager find;
 allow platform_app system_api_service:service_manager find;
 allow platform_app vr_manager_service:service_manager find;
 allow platform_app stats_service:service_manager find;
 
 # Allow platform apps to log via statsd.

commit 452bfdca38a4ffc3d3a2df9439694fcb8d0f9def
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Thu 2019-07-18 21:21:40-0400

    label protected_{fifos,regular} as proc_security
    
    This is needed for init to override the default values.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/genfs_contexts | 2 ++
 private/genfs_contexts                    | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/prebuilts/api/32.0/private/genfs_contexts b/prebuilts/api/32.0/private/genfs_contexts
index 13bfb46e1c5f76074f0d214ec851a0531e31de7c..30f3496e6ceccc92d2780d6636250276f355107a 100644
--- a/prebuilts/api/32.0/private/genfs_contexts
+++ b/prebuilts/api/32.0/private/genfs_contexts
@@ -32,21 +32,23 @@ genfscon proc /pressure/cpu u:object_r:proc_pressure_cpu:s0
 genfscon proc /pressure/io u:object_r:proc_pressure_io:s0
 genfscon proc /pressure/memory u:object_r:proc_pressure_mem:s0
 genfscon proc /slabinfo u:object_r:proc_slabinfo:s0
 genfscon proc /softirqs u:object_r:proc_timer:s0
 genfscon proc /stat u:object_r:proc_stat:s0
 genfscon proc /swaps u:object_r:proc_swaps:s0
 genfscon proc /sysrq-trigger u:object_r:proc_sysrq:s0
 genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
+genfscon proc /sys/fs/protected_fifos u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
+genfscon proc /sys/fs/protected_regular u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/hung_task_ u:object_r:proc_hung_task:s0
diff --git a/private/genfs_contexts b/private/genfs_contexts
index 13bfb46e1c5f76074f0d214ec851a0531e31de7c..30f3496e6ceccc92d2780d6636250276f355107a 100644
--- a/private/genfs_contexts
+++ b/private/genfs_contexts
@@ -32,21 +32,23 @@ genfscon proc /pressure/cpu u:object_r:proc_pressure_cpu:s0
 genfscon proc /pressure/io u:object_r:proc_pressure_io:s0
 genfscon proc /pressure/memory u:object_r:proc_pressure_mem:s0
 genfscon proc /slabinfo u:object_r:proc_slabinfo:s0
 genfscon proc /softirqs u:object_r:proc_timer:s0
 genfscon proc /stat u:object_r:proc_stat:s0
 genfscon proc /swaps u:object_r:proc_swaps:s0
 genfscon proc /sysrq-trigger u:object_r:proc_sysrq:s0
 genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
+genfscon proc /sys/fs/protected_fifos u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
+genfscon proc /sys/fs/protected_regular u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/hung_task_ u:object_r:proc_hung_task:s0

commit 92eac7141fa9fbf75a87cbbd3aefa36c882d4347
Author: inthewaves <inthewaves@pm.me>
Date:   Mon 2021-10-11 02:16:39+0100

    allow system to use persist.keyguard.camera
---
 prebuilts/api/32.0/private/property_contexts | 1 +
 private/property_contexts                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/private/property_contexts b/prebuilts/api/32.0/private/property_contexts
index 7ba633b447e7a91c3e5ebaa005a13f16a73bf804..500618349d00dbd0f542deb301c7267b5eab926d 100644
--- a/prebuilts/api/32.0/private/property_contexts
+++ b/prebuilts/api/32.0/private/property_contexts
@@ -48,20 +48,21 @@ security.lower_kptr_restrict u:object_r:lower_kptr_restrict_prop:s0
 service.adb.root        u:object_r:shell_prop:s0
 sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
+persist.keyguard.camera u:object_r:system_prop:s0
 logd.                   u:object_r:logd_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0
 persist.logd.security   u:object_r:device_logging_prop:s0
 persist.logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 persist.log.tag         u:object_r:log_tag_prop:s0
 persist.mmc.            u:object_r:mmc_prop:s0
 persist.netd.stable_secret      u:object_r:netd_stable_secret_prop:s0
 persist.pm.mock-upgrade u:object_r:mock_ota_prop:s0
diff --git a/private/property_contexts b/private/property_contexts
index 7ba633b447e7a91c3e5ebaa005a13f16a73bf804..500618349d00dbd0f542deb301c7267b5eab926d 100644
--- a/private/property_contexts
+++ b/private/property_contexts
@@ -48,20 +48,21 @@ security.lower_kptr_restrict u:object_r:lower_kptr_restrict_prop:s0
 service.adb.root        u:object_r:shell_prop:s0
 sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
+persist.keyguard.camera u:object_r:system_prop:s0
 logd.                   u:object_r:logd_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0
 persist.logd.security   u:object_r:device_logging_prop:s0
 persist.logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 persist.log.tag         u:object_r:log_tag_prop:s0
 persist.mmc.            u:object_r:mmc_prop:s0
 persist.netd.stable_secret      u:object_r:netd_stable_secret_prop:s0
 persist.pm.mock-upgrade u:object_r:mock_ota_prop:s0

commit 1969d65929ce84a75f502cd4980ad8f10b10db0c
Author: flawedworld <flawedworld@flawed.world>
Date:   Mon 2021-10-11 02:33:31+0100

    allow init to control kernel.yama.ptrace_scope
---
 prebuilts/api/32.0/private/domain.te      | 1 +
 prebuilts/api/32.0/private/genfs_contexts | 1 +
 prebuilts/api/32.0/public/init.te         | 3 +++
 private/domain.te                         | 1 +
 private/genfs_contexts                    | 1 +
 public/init.te                            | 3 +++
 6 files changed, 10 insertions(+)

diff --git a/prebuilts/api/32.0/private/domain.te b/prebuilts/api/32.0/private/domain.te
index b91d36d85d24c202327f2f99d92ce505978c3e12..d4ca398de20fcec0a9aaf0515449ad1486d1ec5d 100644
--- a/prebuilts/api/32.0/private/domain.te
+++ b/prebuilts/api/32.0/private/domain.te
@@ -109,20 +109,21 @@ userdebug_or_eng(`
 allow domain linkerconfig_file:dir search;
 allow domain linkerconfig_file:file r_file_perms;
 
 # Allow all processes to check for the existence of the boringssl_self_test_marker files.
 allow domain boringssl_self_test_marker:dir search;
 
 # Limit ability to ptrace or read sensitive /proc/pid files of processes
 # with other UIDs to these allowlisted domains.
 neverallow {
   domain
+  -init
   -vold
   userdebug_or_eng(`-llkd')
   -dumpstate
   userdebug_or_eng(`-incidentd')
   userdebug_or_eng(`-profcollectd')
   -storaged
   -system_server
 } self:global_capability_class_set sys_ptrace;
 
 # Limit ability to generate hardware unique device ID attestations to priv_apps
diff --git a/prebuilts/api/32.0/private/genfs_contexts b/prebuilts/api/32.0/private/genfs_contexts
index 30f3496e6ceccc92d2780d6636250276f355107a..5c3332f1a888bc702ffccf9c76d5fb6fdc185d68 100644
--- a/prebuilts/api/32.0/private/genfs_contexts
+++ b/prebuilts/api/32.0/private/genfs_contexts
@@ -69,20 +69,21 @@ genfscon proc /sys/kernel/sched_latency_ns u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_rt_period_us u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_rt_runtime_us u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_schedstats u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_tunable_scaling u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_util_clamp_max u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_util_clamp_min u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_util_clamp_min_rt_default u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_wakeup_granularity_ns u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sysrq u:object_r:proc_sysrq:s0
 genfscon proc /sys/kernel/usermodehelper u:object_r:usermodehelper:s0
+genfscon proc /sys/kernel/yama/ptrace_scope u:object_r:proc_security:s0
 genfscon proc /sys/net u:object_r:proc_net:s0
 genfscon proc /sys/vm/dirty_background_ratio u:object_r:proc_dirty:s0
 genfscon proc /sys/vm/dirty_expire_centisecs u:object_r:proc_dirty:s0
 genfscon proc /sys/vm/extra_free_kbytes u:object_r:proc_extra_free_kbytes:s0
 genfscon proc /sys/vm/max_map_count u:object_r:proc_max_map_count:s0
 genfscon proc /sys/vm/mmap_min_addr u:object_r:proc_security:s0
 genfscon proc /sys/vm/mmap_rnd_bits u:object_r:proc_security:s0
 genfscon proc /sys/vm/mmap_rnd_compat_bits u:object_r:proc_security:s0
 genfscon proc /sys/vm/page-cluster u:object_r:proc_page_cluster:s0
 genfscon proc /sys/vm/drop_caches u:object_r:proc_drop_caches:s0
diff --git a/prebuilts/api/32.0/public/init.te b/prebuilts/api/32.0/public/init.te
index ea5a9793d1042b5732672aa6f58ac3814d77f922..49b23ee6182110fedf14eac7dbe785d19bd97ebc 100644
--- a/prebuilts/api/32.0/public/init.te
+++ b/prebuilts/api/32.0/public/init.te
@@ -146,20 +146,23 @@ allow init metadata_file:dir mounton;
 allow init tmpfs:dir relabelfrom;
 
 # Create directories under /dev/cpuctl after chowning it to system.
 allow init self:global_capability_class_set { dac_override dac_read_search };
 
 # Set system clock.
 allow init self:global_capability_class_set sys_time;
 
 allow init self:global_capability_class_set { sys_rawio mknod };
 
+# Set /proc/sys/kernel/yama/ptrace_scope
+allow init self:capability { sys_ptrace };
+
 # Mounting filesystems from block devices.
 allow init dev_type:blk_file r_file_perms;
 allowxperm init dev_type:blk_file ioctl BLKROSET;
 
 # Mounting filesystems.
 # Only allow relabelto for types used in context= mount options,
 # which should all be assigned the contextmount_type attribute.
 # This can be done in device-specific policy via type or typeattribute
 # declarations.
 allow init {
diff --git a/private/domain.te b/private/domain.te
index b91d36d85d24c202327f2f99d92ce505978c3e12..d4ca398de20fcec0a9aaf0515449ad1486d1ec5d 100644
--- a/private/domain.te
+++ b/private/domain.te
@@ -109,20 +109,21 @@ userdebug_or_eng(`
 allow domain linkerconfig_file:dir search;
 allow domain linkerconfig_file:file r_file_perms;
 
 # Allow all processes to check for the existence of the boringssl_self_test_marker files.
 allow domain boringssl_self_test_marker:dir search;
 
 # Limit ability to ptrace or read sensitive /proc/pid files of processes
 # with other UIDs to these allowlisted domains.
 neverallow {
   domain
+  -init
   -vold
   userdebug_or_eng(`-llkd')
   -dumpstate
   userdebug_or_eng(`-incidentd')
   userdebug_or_eng(`-profcollectd')
   -storaged
   -system_server
 } self:global_capability_class_set sys_ptrace;
 
 # Limit ability to generate hardware unique device ID attestations to priv_apps
diff --git a/private/genfs_contexts b/private/genfs_contexts
index 30f3496e6ceccc92d2780d6636250276f355107a..5c3332f1a888bc702ffccf9c76d5fb6fdc185d68 100644
--- a/private/genfs_contexts
+++ b/private/genfs_contexts
@@ -69,20 +69,21 @@ genfscon proc /sys/kernel/sched_latency_ns u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_rt_period_us u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_rt_runtime_us u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_schedstats u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_tunable_scaling u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_util_clamp_max u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_util_clamp_min u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_util_clamp_min_rt_default u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sched_wakeup_granularity_ns u:object_r:proc_sched:s0
 genfscon proc /sys/kernel/sysrq u:object_r:proc_sysrq:s0
 genfscon proc /sys/kernel/usermodehelper u:object_r:usermodehelper:s0
+genfscon proc /sys/kernel/yama/ptrace_scope u:object_r:proc_security:s0
 genfscon proc /sys/net u:object_r:proc_net:s0
 genfscon proc /sys/vm/dirty_background_ratio u:object_r:proc_dirty:s0
 genfscon proc /sys/vm/dirty_expire_centisecs u:object_r:proc_dirty:s0
 genfscon proc /sys/vm/extra_free_kbytes u:object_r:proc_extra_free_kbytes:s0
 genfscon proc /sys/vm/max_map_count u:object_r:proc_max_map_count:s0
 genfscon proc /sys/vm/mmap_min_addr u:object_r:proc_security:s0
 genfscon proc /sys/vm/mmap_rnd_bits u:object_r:proc_security:s0
 genfscon proc /sys/vm/mmap_rnd_compat_bits u:object_r:proc_security:s0
 genfscon proc /sys/vm/page-cluster u:object_r:proc_page_cluster:s0
 genfscon proc /sys/vm/drop_caches u:object_r:proc_drop_caches:s0
diff --git a/public/init.te b/public/init.te
index ea5a9793d1042b5732672aa6f58ac3814d77f922..49b23ee6182110fedf14eac7dbe785d19bd97ebc 100644
--- a/public/init.te
+++ b/public/init.te
@@ -146,20 +146,23 @@ allow init metadata_file:dir mounton;
 allow init tmpfs:dir relabelfrom;
 
 # Create directories under /dev/cpuctl after chowning it to system.
 allow init self:global_capability_class_set { dac_override dac_read_search };
 
 # Set system clock.
 allow init self:global_capability_class_set sys_time;
 
 allow init self:global_capability_class_set { sys_rawio mknod };
 
+# Set /proc/sys/kernel/yama/ptrace_scope
+allow init self:capability { sys_ptrace };
+
 # Mounting filesystems from block devices.
 allow init dev_type:blk_file r_file_perms;
 allowxperm init dev_type:blk_file ioctl BLKROSET;
 
 # Mounting filesystems.
 # Only allow relabelto for types used in context= mount options,
 # which should all be assigned the contextmount_type attribute.
 # This can be done in device-specific policy via type or typeattribute
 # declarations.
 allow init {

commit 5009524a0aa2930c51dba42390a73bb0da376851
Author: flawedworld <flawedworld@flawed.world>
Date:   Mon 2021-10-11 02:35:13+0100

    allow system to use persist.native_debug
---
 prebuilts/api/32.0/private/property_contexts | 1 +
 private/property_contexts                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/private/property_contexts b/prebuilts/api/32.0/private/property_contexts
index 500618349d00dbd0f542deb301c7267b5eab926d..7e933f87ac679869c0c5b7aca6a01c818cccf5d6 100644
--- a/prebuilts/api/32.0/private/property_contexts
+++ b/prebuilts/api/32.0/private/property_contexts
@@ -49,20 +49,21 @@ service.adb.root        u:object_r:shell_prop:s0
 sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
 persist.keyguard.camera u:object_r:system_prop:s0
+persist.native_debug    u:object_r:system_prop:s0
 logd.                   u:object_r:logd_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0
 persist.logd.security   u:object_r:device_logging_prop:s0
 persist.logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 persist.log.tag         u:object_r:log_tag_prop:s0
 persist.mmc.            u:object_r:mmc_prop:s0
 persist.netd.stable_secret      u:object_r:netd_stable_secret_prop:s0
 persist.pm.mock-upgrade u:object_r:mock_ota_prop:s0
diff --git a/private/property_contexts b/private/property_contexts
index 500618349d00dbd0f542deb301c7267b5eab926d..7e933f87ac679869c0c5b7aca6a01c818cccf5d6 100644
--- a/private/property_contexts
+++ b/private/property_contexts
@@ -49,20 +49,21 @@ service.adb.root        u:object_r:shell_prop:s0
 sys.update.             u:object_r:shell_prop:s0
 service.adb.tls.port    u:object_r:adbd_prop:s0
 persist.adb.wifi.       u:object_r:adbd_prop:s0
 persist.adb.tls_server.enable  u:object_r:system_adbd_prop:s0
 
 persist.audio.          u:object_r:audio_prop:s0
 persist.bluetooth.      u:object_r:bluetooth_prop:s0
 persist.nfc_cfg.        u:object_r:nfc_prop:s0
 persist.debug.          u:object_r:persist_debug_prop:s0
 persist.keyguard.camera u:object_r:system_prop:s0
+persist.native_debug    u:object_r:system_prop:s0
 logd.                   u:object_r:logd_prop:s0
 persist.logd.           u:object_r:logd_prop:s0
 ro.logd.                u:object_r:logd_prop:s0
 persist.logd.security   u:object_r:device_logging_prop:s0
 persist.logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 logd.logpersistd        u:object_r:logpersistd_logging_prop:s0
 persist.log.tag         u:object_r:log_tag_prop:s0
 persist.mmc.            u:object_r:mmc_prop:s0
 persist.netd.stable_secret      u:object_r:netd_stable_secret_prop:s0
 persist.pm.mock-upgrade u:object_r:mock_ota_prop:s0

commit da305f6d213f94ffc6803fa45224fc5fbe6be3a1
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2021-10-11 03:15:01+0100

    deny_new_usb sysctl and system property policy
---
 prebuilts/api/28.0/plat_pub_versioned.cil       | 7 +++++--
 prebuilts/api/28.0/vendor_sepolicy.cil          | 2 +-
 prebuilts/api/29.0/plat_pub_versioned.cil       | 2 ++
 prebuilts/api/30.0/plat_pub_versioned.cil       | 2 ++
 prebuilts/api/31.0/plat_pub_versioned.cil       | 2 ++
 prebuilts/api/32.0/private/compat/26.0/26.0.cil | 1 +
 prebuilts/api/32.0/private/compat/27.0/27.0.cil | 1 +
 prebuilts/api/32.0/private/compat/28.0/28.0.cil | 2 ++
 prebuilts/api/32.0/private/compat/29.0/29.0.cil | 2 ++
 prebuilts/api/32.0/private/compat/30.0/30.0.cil | 2 ++
 prebuilts/api/32.0/private/compat/31.0/31.0.cil | 2 ++
 prebuilts/api/32.0/private/genfs_contexts       | 1 +
 prebuilts/api/32.0/private/property_contexts    | 1 +
 prebuilts/api/32.0/public/file.te               | 1 +
 prebuilts/api/32.0/public/init.te               | 1 +
 private/compat/26.0/26.0.cil                    | 1 +
 private/compat/27.0/27.0.cil                    | 1 +
 private/compat/28.0/28.0.cil                    | 2 ++
 private/compat/29.0/29.0.cil                    | 2 ++
 private/compat/30.0/30.0.cil                    | 2 ++
 private/compat/31.0/31.0.cil                    | 2 ++
 private/genfs_contexts                          | 1 +
 private/property_contexts                       | 1 +
 public/file.te                                  | 1 +
 public/init.te                                  | 1 +
 25 files changed, 40 insertions(+), 3 deletions(-)

diff --git a/prebuilts/api/28.0/plat_pub_versioned.cil b/prebuilts/api/28.0/plat_pub_versioned.cil
index d98a249a0b044859462db561931b7afd5c9ef82c..50df7caea1ecca9907bf0acfe8a85ba3974d9ac7 100644
--- a/prebuilts/api/28.0/plat_pub_versioned.cil
+++ b/prebuilts/api/28.0/plat_pub_versioned.cil
@@ -1,34 +1,34 @@
 (roletype r domain)
 (typeattribute dev_type)
 (typeattributeset dev_type (device_28_0 alarm_device_28_0 ashmem_device_28_0 audio_device_28_0 audio_timer_device_28_0 audio_seq_device_28_0 binder_device_28_0 hwbinder_device_28_0 vndbinder_device_28_0 block_device_28_0 camera_device_28_0 dm_device_28_0 keychord_device_28_0 loop_control_device_28_0 loop_device_28_0 pmsg_device_28_0 radio_device_28_0 ram_device_28_0 rtc_device_28_0 vold_device_28_0 console_device_28_0 cpuctl_device_28_0 fscklogs_28_0 full_device_28_0 gpu_device_28_0 graphics_device_28_0 hw_random_device_28_0 input_device_28_0 kmem_device_28_0 port_device_28_0 lowpan_device_28_0 mtd_device_28_0 mtp_device_28_0 nfc_device_28_0 ptmx_device_28_0 kmsg_device_28_0 kmsg_debug_device_28_0 null_device_28_0 random_device_28_0 secure_element_device_28_0 sensors_device_28_0 serial_device_28_0 socket_device_28_0 owntty_device_28_0 tty_device_28_0 video_device_28_0 vcs_device_28_0 zero_device_28_0 fuse_device_28_0 iio_device_28_0 ion_device_28_0 qtaguid_device_28_0 watchdog_device_28_0 uhid_device_28_0 uio_device_28_0 tun_device_28_0 usbaccessory_device_28_0 usb_device_28_0 properties_device_28_0 properties_serial_28_0 property_info_28_0 i2c_device_28_0 hci_attach_dev_28_0 rpmsg_device_28_0 root_block_device_28_0 frp_block_device_28_0 system_block_device_28_0 recovery_block_device_28_0 boot_block_device_28_0 userdata_block_device_28_0 cache_block_device_28_0 swap_block_device_28_0 metadata_block_device_28_0 misc_block_device_28_0 ppp_device_28_0 tee_device_28_0))
 (typeattribute domain)
 (typeattributeset domain (adbd_28_0 audioserver_28_0 blkid_28_0 blkid_untrusted_28_0 bluetooth_28_0 bootanim_28_0 bootstat_28_0 bufferhubd_28_0 cameraserver_28_0 charger_28_0 clatd_28_0 cppreopts_28_0 crash_dump_28_0 dex2oat_28_0 dhcp_28_0 dnsmasq_28_0 drmserver_28_0 dumpstate_28_0 e2fs_28_0 ephemeral_app_28_0 fingerprintd_28_0 fsck_28_0 fsck_untrusted_28_0 gatekeeperd_28_0 healthd_28_0 hwservicemanager_28_0 idmap_28_0 incident_28_0 incident_helper_28_0 incidentd_28_0 init_28_0 inputflinger_28_0 install_recovery_28_0 installd_28_0 isolated_app_28_0 kernel_28_0 keystore_28_0 lmkd_28_0 logd_28_0 logpersist_28_0 mdnsd_28_0 mediacodec_28_0 mediadrmserver_28_0 mediaextractor_28_0 mediametrics_28_0 mediaprovider_28_0 mediaserver_28_0 modprobe_28_0 mtp_28_0 netd_28_0 netutils_wrapper_28_0 nfc_28_0 otapreopt_chroot_28_0 otapreopt_slot_28_0 performanced_28_0 perfprofd_28_0 platform_app_28_0 postinstall_28_0 postinstall_dexopt_28_0 ppp_28_0 preopt2cachename_28_0 priv_app_28_0 profman_28_0 racoon_28_0 radio_28_0 recovery_28_0 recovery_persist_28_0 recovery_refresh_28_0 runas_28_0 sdcardd_28_0 secure_element_28_0 servicemanager_28_0 sgdisk_28_0 shared_relro_28_0 shell_28_0 slideshow_28_0 su_28_0 surfaceflinger_28_0 system_app_28_0 system_server_28_0 tee_28_0 thermalserviced_28_0 tombstoned_28_0 toolbox_28_0 traced_probes_28_0 traceur_app_28_0 tzdatacheck_28_0 ueventd_28_0 uncrypt_28_0 untrusted_app_28_0 untrusted_app_27_28_0 untrusted_app_25_28_0 untrusted_v2_app_28_0 update_engine_28_0 update_verifier_28_0 usbd_28_0 vdc_28_0 vendor_init_28_0 vendor_shell_28_0 virtual_touchpad_28_0 vndservicemanager_28_0 vold_28_0 vold_prepare_subdirs_28_0 vr_hwc_28_0 watchdogd_28_0 webview_zygote_28_0 wificond_28_0 wpantund_28_0 zygote_28_0))
 (typeattribute fs_type)
-(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0))
+(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_deny_new_usb_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0))
 (typeattribute contextmount_type)
 (typeattributeset contextmount_type (oemfs_28_0 app_fusefs_28_0))
 (typeattribute file_type)
 (typeattributeset file_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 drmserver_socket_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 unlabeled_28_0 system_file_28_0 vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 metadata_file_28_0 vold_metadata_file_28_0 runtime_event_log_tags_file_28_0 logcat_exec_28_0 coredump_file_28_0 system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 mnt_media_rw_file_28_0 mnt_user_file_28_0 mnt_expand_file_28_0 storage_file_28_0 mnt_media_rw_stub_file_28_0 storage_stub_file_28_0 mnt_vendor_file_28_0 postinstall_mnt_dir_28_0 postinstall_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 efs_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 bluetooth_efs_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 adbd_socket_28_0 bluetooth_socket_28_0 dnsproxyd_socket_28_0 dumpstate_socket_28_0 fwmarkd_socket_28_0 lmkd_socket_28_0 logd_socket_28_0 logdr_socket_28_0 logdw_socket_28_0 mdns_socket_28_0 mdnsd_socket_28_0 misc_logd_file_28_0 mtpd_socket_28_0 netd_socket_28_0 property_socket_28_0 racoon_socket_28_0 rild_socket_28_0 rild_debug_socket_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 tombstoned_crash_socket_28_0 tombstoned_java_trace_socket_28_0 tombstoned_intercept_socket_28_0 traced_producer_socket_28_0 traced_consumer_socket_28_0 uncrypt_socket_28_0 wpa_socket_28_0 zygote_socket_28_0 gps_control_28_0 pdx_display_dir_28_0 pdx_performance_dir_28_0 pdx_bufferhub_dir_28_0 pdx_display_client_endpoint_socket_28_0 pdx_display_manager_endpoint_socket_28_0 pdx_display_screenshot_endpoint_socket_28_0 pdx_display_vsync_endpoint_socket_28_0 pdx_performance_client_endpoint_socket_28_0 pdx_bufferhub_client_endpoint_socket_28_0 file_contexts_file_28_0 mac_perms_file_28_0 property_contexts_file_28_0 seapp_contexts_file_28_0 sepolicy_file_28_0 service_contexts_file_28_0 nonplat_service_contexts_file_28_0 hwservice_contexts_file_28_0 vndservice_contexts_file_28_0 audiohal_data_file_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0))
 (typeattribute exec_type)
 (typeattributeset exec_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 logcat_exec_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0))
 (typeattribute data_file_type)
 (expandtypeattribute (data_file_type) false)
 (typeattributeset data_file_type (system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 bluetooth_socket_28_0 misc_logd_file_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 wpa_socket_28_0 audiohal_data_file_28_0))
 (typeattribute core_data_file_type)
 (expandtypeattribute (core_data_file_type) false)
 (typeattributeset core_data_file_type (system_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 fingerprintd_data_file_28_0 app_fuse_file_28_0 bluetooth_socket_28_0 misc_logd_file_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 wpa_socket_28_0 audiohal_data_file_28_0))
 (typeattribute vendor_file_type)
 (typeattributeset vendor_file_type (vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 mediacodec_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0))
 (typeattribute proc_type)
 (expandtypeattribute (proc_type) false)
-(typeattributeset proc_type (proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0))
+(typeattributeset proc_type (proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_deny_new_usb_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0))
 (typeattribute sysfs_type)
 (typeattributeset sysfs_type (sysfs_usermodehelper_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0))
 (typeattribute debugfs_type)
 (typeattributeset debugfs_type (debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0))
 (typeattribute sdcard_type)
 (typeattributeset sdcard_type (fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0))
 (typeattribute node_type)
 (typeattributeset node_type (node_28_0))
 (typeattribute netif_type)
 (typeattributeset netif_type (netif_28_0))
@@ -849,20 +849,23 @@
 (roletype object_r proc_asound_28_0)
 (type proc_buddyinfo)
 (typeattribute proc_buddyinfo_28_0)
 (roletype object_r proc_buddyinfo_28_0)
 (type proc_cmdline)
 (typeattribute proc_cmdline_28_0)
 (roletype object_r proc_cmdline_28_0)
 (type proc_cpuinfo)
 (typeattribute proc_cpuinfo_28_0)
 (roletype object_r proc_cpuinfo_28_0)
+(type proc_deny_new_usb)
+(typeattribute proc_deny_new_usb_28_0)
+(roletype object_r proc_deny_new_usb_28_0)
 (type proc_dirty)
 (typeattribute proc_dirty_28_0)
 (roletype object_r proc_dirty_28_0)
 (type proc_diskstats)
 (typeattribute proc_diskstats_28_0)
 (roletype object_r proc_diskstats_28_0)
 (type proc_extra_free_kbytes)
 (typeattribute proc_extra_free_kbytes_28_0)
 (roletype object_r proc_extra_free_kbytes_28_0)
 (type proc_filesystems)
diff --git a/prebuilts/api/28.0/vendor_sepolicy.cil b/prebuilts/api/28.0/vendor_sepolicy.cil
index e116208149213f03b9c5b57dc6ab78f43713f9b2..73ca9419e87de6c42d3c0dc3f3fdbc095cb222ab 100644
--- a/prebuilts/api/28.0/vendor_sepolicy.cil
+++ b/prebuilts/api/28.0/vendor_sepolicy.cil
@@ -2,21 +2,21 @@
 (genfscon sysfs /devices/platform/9020000.goldfish_battery/power_supply (u object_r sysfs_batteryinfo ((s0) (s0))))
 (genfscon sysfs /devices/platform/ANDR0001:00/properties/android (u object_r sysfs_dt_firmware_android ((s0) (s0))))
 (genfscon sysfs /devices/pci0000:00/0000:00:08.0/virtio5/net (u object_r sysfs_net ((s0) (s0))))
 (genfscon sysfs /devices/platform/GFSH0001:00/power_supply (u object_r sysfs_batteryinfo ((s0) (s0))))
 (genfscon sysfs /devices/virtual/mac80211_hwsim/hwsim0/net (u object_r sysfs_net ((s0) (s0))))
 (genfscon sysfs /devices/virtual/mac80211_hwsim/hwsim1/net (u object_r sysfs_net ((s0) (s0))))
 (genfscon sysfs /devices/platform/GFSH0007:00/rtc (u object_r sysfs_rtc ((s0) (s0))))
 (genfscon sysfs /devices/pnp0/00:00/rtc (u object_r sysfs_rtc ((s0) (s0))))
 (typeattributeset dev_type (device_28_0 alarm_device_28_0 ashmem_device_28_0 audio_device_28_0 audio_timer_device_28_0 audio_seq_device_28_0 binder_device_28_0 hwbinder_device_28_0 vndbinder_device_28_0 block_device_28_0 camera_device_28_0 dm_device_28_0 keychord_device_28_0 loop_control_device_28_0 loop_device_28_0 pmsg_device_28_0 radio_device_28_0 ram_device_28_0 rtc_device_28_0 vold_device_28_0 console_device_28_0 cpuctl_device_28_0 fscklogs_28_0 full_device_28_0 gpu_device_28_0 graphics_device_28_0 hw_random_device_28_0 input_device_28_0 kmem_device_28_0 port_device_28_0 lowpan_device_28_0 mtd_device_28_0 mtp_device_28_0 nfc_device_28_0 ptmx_device_28_0 kmsg_device_28_0 kmsg_debug_device_28_0 null_device_28_0 random_device_28_0 secure_element_device_28_0 sensors_device_28_0 serial_device_28_0 socket_device_28_0 owntty_device_28_0 tty_device_28_0 video_device_28_0 vcs_device_28_0 zero_device_28_0 fuse_device_28_0 iio_device_28_0 ion_device_28_0 qtaguid_device_28_0 watchdog_device_28_0 uhid_device_28_0 uio_device_28_0 tun_device_28_0 usbaccessory_device_28_0 usb_device_28_0 properties_device_28_0 properties_serial_28_0 property_info_28_0 i2c_device_28_0 hci_attach_dev_28_0 rpmsg_device_28_0 root_block_device_28_0 frp_block_device_28_0 system_block_device_28_0 recovery_block_device_28_0 boot_block_device_28_0 userdata_block_device_28_0 cache_block_device_28_0 swap_block_device_28_0 metadata_block_device_28_0 misc_block_device_28_0 ppp_device_28_0 tee_device_28_0 qemu_device))
 (typeattributeset domain (adbd_28_0 audioserver_28_0 blkid_28_0 blkid_untrusted_28_0 bluetooth_28_0 bootanim_28_0 bootstat_28_0 bufferhubd_28_0 cameraserver_28_0 charger_28_0 clatd_28_0 cppreopts_28_0 crash_dump_28_0 dex2oat_28_0 dhcp_28_0 dnsmasq_28_0 drmserver_28_0 dumpstate_28_0 e2fs_28_0 ephemeral_app_28_0 fingerprintd_28_0 fsck_28_0 fsck_untrusted_28_0 gatekeeperd_28_0 healthd_28_0 hwservicemanager_28_0 idmap_28_0 incident_28_0 incident_helper_28_0 incidentd_28_0 init_28_0 inputflinger_28_0 install_recovery_28_0 installd_28_0 isolated_app_28_0 kernel_28_0 keystore_28_0 lmkd_28_0 logd_28_0 logpersist_28_0 mdnsd_28_0 mediacodec_28_0 mediadrmserver_28_0 mediaextractor_28_0 mediametrics_28_0 mediaprovider_28_0 mediaserver_28_0 modprobe_28_0 mtp_28_0 netd_28_0 netutils_wrapper_28_0 nfc_28_0 otapreopt_chroot_28_0 otapreopt_slot_28_0 performanced_28_0 perfprofd_28_0 platform_app_28_0 postinstall_28_0 postinstall_dexopt_28_0 ppp_28_0 preopt2cachename_28_0 priv_app_28_0 profman_28_0 racoon_28_0 radio_28_0 recovery_28_0 recovery_persist_28_0 recovery_refresh_28_0 runas_28_0 sdcardd_28_0 secure_element_28_0 servicemanager_28_0 sgdisk_28_0 shared_relro_28_0 shell_28_0 slideshow_28_0 su_28_0 surfaceflinger_28_0 system_app_28_0 system_server_28_0 tee_28_0 thermalserviced_28_0 tombstoned_28_0 toolbox_28_0 traced_probes_28_0 traceur_app_28_0 tzdatacheck_28_0 ueventd_28_0 uncrypt_28_0 untrusted_app_28_0 untrusted_app_27_28_0 untrusted_app_25_28_0 untrusted_v2_app_28_0 update_engine_28_0 update_verifier_28_0 usbd_28_0 vdc_28_0 vendor_init_28_0 vendor_shell_28_0 virtual_touchpad_28_0 vndservicemanager_28_0 vold_28_0 vold_prepare_subdirs_28_0 vr_hwc_28_0 watchdogd_28_0 webview_zygote_28_0 wificond_28_0 wpantund_28_0 zygote_28_0 hal_audio_default hal_audiocontrol_default hal_authsecret_default hal_bluetooth_default hal_bootctl_default hal_broadcastradio_default hal_camera_default hal_cas_default hal_configstore_default hal_confirmationui_default hal_contexthub_default hal_drm_default hal_dumpstate_default hal_evs_default hal_fingerprint_default hal_gatekeeper_default hal_gnss_default hal_graphics_allocator_default hal_graphics_composer_default hal_health_default hal_ir_default hal_keymaster_default hal_light_default hal_lowpan_default hal_memtrack_default hal_nfc_default hal_power_default hal_radio_config_default hal_radio_default hal_secure_element_default hal_sensors_default hal_tetheroffload_default hal_thermal_default hal_tv_cec_default hal_tv_input_default hal_usb_default hal_vehicle_default hal_vibrator_default hal_vr_default hal_wifi_default hal_wifi_hostapd_default hal_wifi_offload_default hal_wifi_supplicant_default rild vendor_modprobe createns dhcpclient dhcpserver execns goldfish_setup hal_drm_clearkey hal_drm_widevine hostapd_nohidl ipv6proxy qemu_props))
-(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0 sysfs_writable nsfs firmware_file))
+(typeattributeset fs_type (device_28_0 labeledfs_28_0 pipefs_28_0 sockfs_28_0 rootfs_28_0 proc_28_0 proc_security_28_0 proc_drop_caches_28_0 proc_overcommit_memory_28_0 proc_min_free_order_shift_28_0 usermodehelper_28_0 sysfs_usermodehelper_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 proc_bluetooth_writable_28_0 proc_abi_28_0 proc_asound_28_0 proc_buddyinfo_28_0 proc_cmdline_28_0 proc_cpuinfo_28_0 proc_deny_new_usb_28_0 proc_dirty_28_0 proc_diskstats_28_0 proc_extra_free_kbytes_28_0 proc_filesystems_28_0 proc_hostname_28_0 proc_hung_task_28_0 proc_interrupts_28_0 proc_iomem_28_0 proc_kmsg_28_0 proc_loadavg_28_0 proc_max_map_count_28_0 proc_meminfo_28_0 proc_misc_28_0 proc_modules_28_0 proc_mounts_28_0 proc_net_28_0 proc_page_cluster_28_0 proc_pagetypeinfo_28_0 proc_panic_28_0 proc_perf_28_0 proc_pid_max_28_0 proc_pipe_conf_28_0 proc_random_28_0 proc_sched_28_0 proc_stat_28_0 proc_swaps_28_0 proc_sysrq_28_0 proc_timer_28_0 proc_tty_drivers_28_0 proc_uid_cputime_showstat_28_0 proc_uid_cputime_removeuid_28_0 proc_uid_io_stats_28_0 proc_uid_procstat_set_28_0 proc_uid_time_in_state_28_0 proc_uid_concurrent_active_time_28_0 proc_uid_concurrent_policy_time_28_0 proc_uid_cpupower_28_0 proc_uptime_28_0 proc_version_28_0 proc_vmallocinfo_28_0 proc_vmstat_28_0 proc_zoneinfo_28_0 selinuxfs_28_0 cgroup_28_0 cgroup_bpf_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 fs_bpf_28_0 configfs_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 inotify_28_0 devpts_28_0 tmpfs_28_0 shm_28_0 mqueue_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_28_0 debugfs_mmc_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 debugfs_tracing_instances_28_0 debugfs_wakeup_sources_28_0 debugfs_wifi_tracing_28_0 pstorefs_28_0 functionfs_28_0 oemfs_28_0 usbfs_28_0 binfmt_miscfs_28_0 app_fusefs_28_0 sysfs_writable nsfs firmware_file))
 (typeattributeset contextmount_type (oemfs_28_0 app_fusefs_28_0 firmware_file))
 (typeattributeset file_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 drmserver_socket_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 unlabeled_28_0 system_file_28_0 vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 metadata_file_28_0 vold_metadata_file_28_0 runtime_event_log_tags_file_28_0 logcat_exec_28_0 coredump_file_28_0 system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 mnt_media_rw_file_28_0 mnt_user_file_28_0 mnt_expand_file_28_0 storage_file_28_0 mnt_media_rw_stub_file_28_0 storage_stub_file_28_0 mnt_vendor_file_28_0 postinstall_mnt_dir_28_0 postinstall_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 efs_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 bluetooth_efs_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 adbd_socket_28_0 bluetooth_socket_28_0 dnsproxyd_socket_28_0 dumpstate_socket_28_0 fwmarkd_socket_28_0 lmkd_socket_28_0 logd_socket_28_0 logdr_socket_28_0 logdw_socket_28_0 mdns_socket_28_0 mdnsd_socket_28_0 misc_logd_file_28_0 mtpd_socket_28_0 netd_socket_28_0 property_socket_28_0 racoon_socket_28_0 rild_socket_28_0 rild_debug_socket_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 tombstoned_crash_socket_28_0 tombstoned_java_trace_socket_28_0 tombstoned_intercept_socket_28_0 traced_producer_socket_28_0 traced_consumer_socket_28_0 uncrypt_socket_28_0 wpa_socket_28_0 zygote_socket_28_0 gps_control_28_0 pdx_display_dir_28_0 pdx_performance_dir_28_0 pdx_bufferhub_dir_28_0 pdx_display_client_endpoint_socket_28_0 pdx_display_manager_endpoint_socket_28_0 pdx_display_screenshot_endpoint_socket_28_0 pdx_display_vsync_endpoint_socket_28_0 pdx_performance_client_endpoint_socket_28_0 pdx_bufferhub_client_endpoint_socket_28_0 file_contexts_file_28_0 mac_perms_file_28_0 property_contexts_file_28_0 seapp_contexts_file_28_0 sepolicy_file_28_0 service_contexts_file_28_0 nonplat_service_contexts_file_28_0 hwservice_contexts_file_28_0 vndservice_contexts_file_28_0 audiohal_data_file_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0 hostapd_data_file wpa_data_file hal_audio_default_exec hal_audio_default_tmpfs hal_audiocontrol_default_exec hal_audiocontrol_default_tmpfs hal_authsecret_default_exec hal_authsecret_default_tmpfs hal_bluetooth_default_exec hal_bluetooth_default_tmpfs hal_bootctl_default_exec hal_bootctl_default_tmpfs hal_broadcastradio_default_exec hal_broadcastradio_default_tmpfs hal_camera_default_exec hal_camera_default_tmpfs hal_cas_default_exec hal_cas_default_tmpfs hal_configstore_default_exec hal_configstore_default_tmpfs hal_confirmationui_default_exec hal_confirmationui_default_tmpfs hal_contexthub_default_exec hal_contexthub_default_tmpfs hal_drm_default_exec hal_drm_default_tmpfs hal_dumpstate_default_exec hal_dumpstate_default_tmpfs hal_evs_default_exec hal_evs_default_tmpfs hal_fingerprint_default_exec hal_fingerprint_default_tmpfs hal_gatekeeper_default_exec hal_gatekeeper_default_tmpfs hal_gnss_default_exec hal_gnss_default_tmpfs hal_graphics_allocator_default_exec hal_graphics_allocator_default_tmpfs hal_graphics_composer_default_exec hal_graphics_composer_default_tmpfs hal_health_default_exec hal_health_default_tmpfs hal_ir_default_exec hal_ir_default_tmpfs hal_keymaster_default_exec hal_keymaster_default_tmpfs hal_light_default_exec hal_light_default_tmpfs hal_lowpan_default_exec hal_lowpan_default_tmpfs hal_memtrack_default_exec hal_memtrack_default_tmpfs hal_nfc_default_exec hal_nfc_default_tmpfs mediacodec_tmpfs hal_power_default_exec hal_power_default_tmpfs hal_radio_config_default_exec hal_radio_config_default_tmpfs hal_radio_default_exec hal_radio_default_tmpfs hal_secure_element_default_exec hal_secure_element_default_tmpfs hal_sensors_default_exec hal_sensors_default_tmpfs hal_tetheroffload_default_exec hal_tetheroffload_default_tmpfs hal_thermal_default_exec hal_thermal_default_tmpfs hal_tv_cec_default_exec hal_tv_cec_default_tmpfs hal_tv_input_default_exec hal_tv_input_default_tmpfs hal_usb_default_exec hal_usb_default_tmpfs hal_vehicle_default_exec hal_vehicle_default_tmpfs hal_vibrator_default_exec hal_vibrator_default_tmpfs hal_vr_default_exec hal_vr_default_tmpfs hal_wifi_default_exec hal_wifi_default_tmpfs hal_wifi_hostapd_default_exec hal_wifi_hostapd_default_tmpfs hal_wifi_offload_default_exec hal_wifi_offload_default_tmpfs hal_wifi_supplicant_default_exec hal_wifi_supplicant_default_tmpfs rild_exec rild_tmpfs tee_exec tee_tmpfs vndservicemanager_exec vndservicemanager_tmpfs createns_exec createns_tmpfs dhcpclient_exec dhcpclient_tmpfs dhcpserver_exec dhcpserver_tmpfs execns_exec execns_tmpfs varrun_file mediadrm_vendor_data_file goldfish_setup_exec goldfish_setup_tmpfs hal_drm_clearkey_exec hal_drm_clearkey_tmpfs hal_drm_widevine_exec hal_drm_widevine_tmpfs hostapd_nohidl_exec hostapd_nohidl_tmpfs ipv6proxy_exec ipv6proxy_tmpfs qemu_props_exec qemu_props_tmpfs persist_file))
 (typeattributeset exec_type (adbd_exec_28_0 bootanim_exec_28_0 bootstat_exec_28_0 bufferhubd_exec_28_0 cameraserver_exec_28_0 clatd_exec_28_0 cppreopts_exec_28_0 crash_dump_exec_28_0 dex2oat_exec_28_0 dhcp_exec_28_0 dnsmasq_exec_28_0 drmserver_exec_28_0 dumpstate_exec_28_0 e2fs_exec_28_0 logcat_exec_28_0 fingerprintd_exec_28_0 fsck_exec_28_0 gatekeeperd_exec_28_0 healthd_exec_28_0 hwservicemanager_exec_28_0 idmap_exec_28_0 init_exec_28_0 inputflinger_exec_28_0 install_recovery_exec_28_0 installd_exec_28_0 keystore_exec_28_0 lmkd_exec_28_0 logd_exec_28_0 mediacodec_exec_28_0 mediadrmserver_exec_28_0 mediaextractor_exec_28_0 mediametrics_exec_28_0 mediaserver_exec_28_0 mtp_exec_28_0 netd_exec_28_0 netutils_wrapper_exec_28_0 otapreopt_chroot_exec_28_0 otapreopt_slot_exec_28_0 performanced_exec_28_0 perfprofd_exec_28_0 ppp_exec_28_0 preopt2cachename_exec_28_0 profman_exec_28_0 racoon_exec_28_0 recovery_persist_exec_28_0 recovery_refresh_exec_28_0 runas_exec_28_0 sdcardd_exec_28_0 servicemanager_exec_28_0 sgdisk_exec_28_0 shell_exec_28_0 su_exec_28_0 thermalserviced_exec_28_0 tombstoned_exec_28_0 toolbox_exec_28_0 tzdatacheck_exec_28_0 uncrypt_exec_28_0 update_engine_exec_28_0 update_verifier_exec_28_0 usbd_exec_28_0 vdc_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 virtual_touchpad_exec_28_0 vold_exec_28_0 vold_prepare_subdirs_exec_28_0 vr_hwc_exec_28_0 webview_zygote_exec_28_0 wificond_exec_28_0 wpantund_exec_28_0 zygote_exec_28_0 hal_audio_default_exec hal_audiocontrol_default_exec hal_authsecret_default_exec hal_bluetooth_default_exec hal_bootctl_default_exec hal_broadcastradio_default_exec hal_camera_default_exec hal_cas_default_exec hal_configstore_default_exec hal_confirmationui_default_exec hal_contexthub_default_exec hal_drm_default_exec hal_dumpstate_default_exec hal_evs_default_exec hal_fingerprint_default_exec hal_gatekeeper_default_exec hal_gnss_default_exec hal_graphics_allocator_default_exec hal_graphics_composer_default_exec hal_health_default_exec hal_ir_default_exec hal_keymaster_default_exec hal_light_default_exec hal_lowpan_default_exec hal_memtrack_default_exec hal_nfc_default_exec hal_power_default_exec hal_radio_config_default_exec hal_radio_default_exec hal_secure_element_default_exec hal_sensors_default_exec hal_tetheroffload_default_exec hal_thermal_default_exec hal_tv_cec_default_exec hal_tv_input_default_exec hal_usb_default_exec hal_vehicle_default_exec hal_vibrator_default_exec hal_vr_default_exec hal_wifi_default_exec hal_wifi_hostapd_default_exec hal_wifi_offload_default_exec hal_wifi_supplicant_default_exec rild_exec tee_exec vndservicemanager_exec createns_exec dhcpclient_exec dhcpserver_exec execns_exec goldfish_setup_exec hal_drm_clearkey_exec hal_drm_widevine_exec hostapd_nohidl_exec ipv6proxy_exec qemu_props_exec))
 (typeattributeset data_file_type (system_data_file_28_0 vendor_data_file_28_0 unencrypted_data_file_28_0 install_data_file_28_0 drm_data_file_28_0 adb_data_file_28_0 anr_data_file_28_0 tombstone_data_file_28_0 tombstone_wifi_data_file_28_0 apk_data_file_28_0 apk_tmp_file_28_0 apk_private_data_file_28_0 apk_private_tmp_file_28_0 dalvikcache_data_file_28_0 ota_data_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 profman_dump_data_file_28_0 resourcecache_data_file_28_0 shell_data_file_28_0 property_data_file_28_0 bootchart_data_file_28_0 heapdump_data_file_28_0 nativetest_data_file_28_0 ringtone_file_28_0 preloads_data_file_28_0 preloads_media_file_28_0 dhcp_data_file_28_0 adb_keys_file_28_0 audio_data_file_28_0 audioserver_data_file_28_0 bluetooth_data_file_28_0 bluetooth_logs_data_file_28_0 bootstat_data_file_28_0 boottrace_data_file_28_0 camera_data_file_28_0 gatekeeper_data_file_28_0 incident_data_file_28_0 keychain_data_file_28_0 keystore_data_file_28_0 media_data_file_28_0 media_rw_data_file_28_0 misc_user_data_file_28_0 net_data_file_28_0 network_watchlist_data_file_28_0 nfc_data_file_28_0 radio_data_file_28_0 recovery_data_file_28_0 shared_relro_file_28_0 systemkeys_data_file_28_0 textclassifier_data_file_28_0 trace_data_file_28_0 vpn_data_file_28_0 wifi_data_file_28_0 zoneinfo_data_file_28_0 vold_data_file_28_0 perfprofd_data_file_28_0 tee_data_file_28_0 update_engine_data_file_28_0 update_engine_log_data_file_28_0 method_trace_data_file_28_0 app_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_private_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 icon_file_28_0 asec_apk_file_28_0 asec_public_file_28_0 asec_image_file_28_0 backup_data_file_28_0 fingerprintd_data_file_28_0 fingerprint_vendor_data_file_28_0 app_fuse_file_28_0 bluetooth_socket_28_0 misc_logd_file_28_0 system_wpa_socket_28_0 system_ndebug_socket_28_0 wpa_socket_28_0 audiohal_data_file_28_0 hostapd_data_file wpa_data_file varrun_file mediadrm_vendor_data_file))
 (typeattributeset vendor_file_type (vendor_hal_file_28_0 vendor_file_28_0 vendor_app_file_28_0 vendor_configs_file_28_0 same_process_hal_file_28_0 vndk_sp_file_28_0 vendor_framework_file_28_0 vendor_overlay_file_28_0 mediacodec_exec_28_0 vendor_shell_exec_28_0 vendor_toolbox_exec_28_0 hal_audio_default_exec hal_audiocontrol_default_exec hal_authsecret_default_exec hal_bluetooth_default_exec hal_bootctl_default_exec hal_broadcastradio_default_exec hal_camera_default_exec hal_cas_default_exec hal_configstore_default_exec hal_confirmationui_default_exec hal_contexthub_default_exec hal_drm_default_exec hal_dumpstate_default_exec hal_evs_default_exec hal_fingerprint_default_exec hal_gatekeeper_default_exec hal_gnss_default_exec hal_graphics_allocator_default_exec hal_graphics_composer_default_exec hal_health_default_exec hal_ir_default_exec hal_keymaster_default_exec hal_light_default_exec hal_lowpan_default_exec hal_memtrack_default_exec hal_nfc_default_exec hal_power_default_exec hal_radio_config_default_exec hal_radio_default_exec hal_secure_element_default_exec hal_sensors_default_exec hal_tetheroffload_default_exec hal_thermal_default_exec hal_tv_cec_default_exec hal_tv_input_default_exec hal_usb_default_exec hal_vehicle_default_exec hal_vibrator_default_exec hal_vr_default_exec hal_wifi_default_exec hal_wifi_hostapd_default_exec hal_wifi_offload_default_exec hal_wifi_supplicant_default_exec rild_exec tee_exec vndservicemanager_exec createns_exec dhcpclient_exec dhcpserver_exec execns_exec goldfish_setup_exec hal_drm_clearkey_exec hal_drm_widevine_exec hostapd_nohidl_exec ipv6proxy_exec qemu_props_exec))
 (typeattributeset sysfs_type (sysfs_usermodehelper_28_0 sysfs_28_0 sysfs_android_usb_28_0 sysfs_uio_28_0 sysfs_batteryinfo_28_0 sysfs_bluetooth_writable_28_0 sysfs_dm_28_0 sysfs_dt_firmware_android_28_0 sysfs_ipv4_28_0 sysfs_kernel_notes_28_0 sysfs_leds_28_0 sysfs_hwrandom_28_0 sysfs_nfc_power_writable_28_0 sysfs_wake_lock_28_0 sysfs_mac_address_28_0 sysfs_net_28_0 sysfs_power_28_0 sysfs_rtc_28_0 sysfs_switch_28_0 sysfs_usb_28_0 sysfs_wakeup_reasons_28_0 sysfs_fs_ext4_features_28_0 sysfs_devices_system_cpu_28_0 sysfs_lowmemorykiller_28_0 sysfs_wlan_fwpath_28_0 sysfs_vibrator_28_0 sysfs_thermal_28_0 sysfs_zram_28_0 sysfs_zram_uevent_28_0 sysfs_writable))
 (typeattributeset property_type (audio_prop_28_0 boottime_prop_28_0 bluetooth_a2dp_offload_prop_28_0 bluetooth_prop_28_0 bootloader_boot_reason_prop_28_0 config_prop_28_0 cppreopt_prop_28_0 ctl_bootanim_prop_28_0 ctl_bugreport_prop_28_0 ctl_console_prop_28_0 ctl_default_prop_28_0 ctl_dumpstate_prop_28_0 ctl_fuse_prop_28_0 ctl_interface_restart_prop_28_0 ctl_interface_start_prop_28_0 ctl_interface_stop_prop_28_0 ctl_mdnsd_prop_28_0 ctl_restart_prop_28_0 ctl_rildaemon_prop_28_0 ctl_sigstop_prop_28_0 ctl_start_prop_28_0 ctl_stop_prop_28_0 dalvik_prop_28_0 debuggerd_prop_28_0 debug_prop_28_0 default_prop_28_0 device_logging_prop_28_0 dhcp_prop_28_0 dumpstate_options_prop_28_0 dumpstate_prop_28_0 exported_secure_prop_28_0 ffs_prop_28_0 fingerprint_prop_28_0 firstboot_prop_28_0 hwservicemanager_prop_28_0 last_boot_reason_prop_28_0 logd_prop_28_0 logpersistd_logging_prop_28_0 log_prop_28_0 log_tag_prop_28_0 lowpan_prop_28_0 mmc_prop_28_0 net_dns_prop_28_0 net_radio_prop_28_0 netd_stable_secret_prop_28_0 nfc_prop_28_0 overlay_prop_28_0 pan_result_prop_28_0 persist_debug_prop_28_0 persistent_properties_ready_prop_28_0 pm_prop_28_0 powerctl_prop_28_0 radio_prop_28_0 restorecon_prop_28_0 safemode_prop_28_0 serialno_prop_28_0 shell_prop_28_0 system_boot_reason_prop_28_0 system_prop_28_0 system_radio_prop_28_0 test_boot_reason_prop_28_0 traced_enabled_prop_28_0 vold_prop_28_0 wifi_log_prop_28_0 wifi_prop_28_0 vendor_security_patch_level_prop_28_0 exported_audio_prop_28_0 exported_bluetooth_prop_28_0 exported_config_prop_28_0 exported_dalvik_prop_28_0 exported_default_prop_28_0 exported_dumpstate_prop_28_0 exported_ffs_prop_28_0 exported_fingerprint_prop_28_0 exported_overlay_prop_28_0 exported_pm_prop_28_0 exported_radio_prop_28_0 exported_system_prop_28_0 exported_system_radio_prop_28_0 exported_vold_prop_28_0 exported_wifi_prop_28_0 exported2_config_prop_28_0 exported2_default_prop_28_0 exported2_radio_prop_28_0 exported2_system_prop_28_0 exported2_vold_prop_28_0 exported3_default_prop_28_0 exported3_radio_prop_28_0 exported3_system_prop_28_0 vendor_default_prop_28_0 qemu_prop qemu_cmdline radio_noril_prop net_eth0_prop net_share_prop))
 (typeattributeset mlstrustedobject (alarm_device_28_0 ashmem_device_28_0 binder_device_28_0 hwbinder_device_28_0 pmsg_device_28_0 gpu_device_28_0 mtp_device_28_0 ptmx_device_28_0 null_device_28_0 random_device_28_0 owntty_device_28_0 zero_device_28_0 fuse_device_28_0 ion_device_28_0 tun_device_28_0 usbaccessory_device_28_0 usb_device_28_0 qtaguid_proc_28_0 proc_qtaguid_stat_28_0 selinuxfs_28_0 cgroup_28_0 sysfs_28_0 sysfs_bluetooth_writable_28_0 sysfs_kernel_notes_28_0 sysfs_nfc_power_writable_28_0 inotify_28_0 devpts_28_0 fuse_28_0 sdcardfs_28_0 vfat_28_0 exfat_28_0 debugfs_trace_marker_28_0 debugfs_tracing_28_0 debugfs_tracing_debug_28_0 functionfs_28_0 anr_data_file_28_0 tombstone_data_file_28_0 apk_tmp_file_28_0 apk_private_tmp_file_28_0 ota_package_file_28_0 user_profile_data_file_28_0 shell_data_file_28_0 heapdump_data_file_28_0 ringtone_file_28_0 media_rw_data_file_28_0 radio_data_file_28_0 trace_data_file_28_0 perfprofd_data_file_28_0 method_trace_data_file_28_0 system_app_data_file_28_0 cache_file_28_0 cache_backup_file_28_0 cache_recovery_file_28_0 wallpaper_file_28_0 shortcut_manager_icons_28_0 asec_apk_file_28_0 backup_data_file_28_0 app_fuse_file_28_0 dnsproxyd_socket_28_0 fwmarkd_socket_28_0 logd_socket_28_0 logdr_socket_28_0 logdw_socket_28_0 mdnsd_socket_28_0 property_socket_28_0 system_ndebug_socket_28_0 tombstoned_crash_socket_28_0 tombstoned_java_trace_socket_28_0 traced_producer_socket_28_0 pdx_display_client_endpoint_socket_28_0 pdx_display_manager_endpoint_socket_28_0 pdx_display_screenshot_endpoint_socket_28_0 pdx_display_vsync_endpoint_socket_28_0 pdx_performance_client_endpoint_socket_28_0 pdx_bufferhub_client_endpoint_socket_28_0 qemu_device sysfs_writable varrun_file))
 (typeattributeset netdomain (clatd_28_0 dhcp_28_0 dnsmasq_28_0 drmserver_28_0 dumpstate_28_0 mediadrmserver_28_0 mediaserver_28_0 mtp_28_0 netd_28_0 ppp_28_0 racoon_28_0 radio_28_0 shell_28_0 su_28_0 update_engine_28_0 wpantund_28_0 hal_wifi_hostapd_default hal_wifi_supplicant_default rild dhcpclient dhcpserver hostapd_nohidl ipv6proxy))
 (typeattributeset data_between_core_and_vendor_violators (hal_fingerprint_default))
diff --git a/prebuilts/api/29.0/plat_pub_versioned.cil b/prebuilts/api/29.0/plat_pub_versioned.cil
index b80abeb36df34f9cae0cd2e23098c97c5d40781a..4e10b6df3d36afe93f480a3cfcedb11bc502e735 100644
--- a/prebuilts/api/29.0/plat_pub_versioned.cil
+++ b/prebuilts/api/29.0/plat_pub_versioned.cil
@@ -580,20 +580,21 @@
 (type print_service)
 (type priv_app)
 (type privapp_data_file)
 (type proc)
 (type proc_abi)
 (type proc_asound)
 (type proc_bluetooth_writable)
 (type proc_buddyinfo)
 (type proc_cmdline)
 (type proc_cpuinfo)
+(type proc_deny_new_usb)
 (type proc_dirty)
 (type proc_diskstats)
 (type proc_drop_caches)
 (type proc_extra_free_kbytes)
 (type proc_filesystems)
 (type proc_fs_verity)
 (type proc_hostname)
 (type proc_hung_task)
 (type proc_interrupts)
 (type proc_iomem)
@@ -1783,20 +1784,21 @@
 (typeattribute print_service_29_0)
 (typeattribute priv_app_29_0)
 (typeattribute privapp_data_file_29_0)
 (typeattribute proc_29_0)
 (typeattribute proc_abi_29_0)
 (typeattribute proc_asound_29_0)
 (typeattribute proc_bluetooth_writable_29_0)
 (typeattribute proc_buddyinfo_29_0)
 (typeattribute proc_cmdline_29_0)
 (typeattribute proc_cpuinfo_29_0)
+(typeattribute proc_deny_new_usb_29_0)
 (typeattribute proc_dirty_29_0)
 (typeattribute proc_diskstats_29_0)
 (typeattribute proc_drop_caches_29_0)
 (typeattribute proc_extra_free_kbytes_29_0)
 (typeattribute proc_filesystems_29_0)
 (typeattribute proc_fs_verity_29_0)
 (typeattribute proc_hostname_29_0)
 (typeattribute proc_hung_task_29_0)
 (typeattribute proc_interrupts_29_0)
 (typeattribute proc_iomem_29_0)
diff --git a/prebuilts/api/30.0/plat_pub_versioned.cil b/prebuilts/api/30.0/plat_pub_versioned.cil
index 3942219c2c9f321c808bc18154082eb9b5b1a0cb..9af16fb76a1b2dcfbb4bc0e64c8a83ab8abfc9cb 100644
--- a/prebuilts/api/30.0/plat_pub_versioned.cil
+++ b/prebuilts/api/30.0/plat_pub_versioned.cil
@@ -650,20 +650,21 @@
 (type print_service)
 (type priv_app)
 (type privapp_data_file)
 (type proc)
 (type proc_abi)
 (type proc_asound)
 (type proc_bluetooth_writable)
 (type proc_buddyinfo)
 (type proc_cmdline)
 (type proc_cpuinfo)
+(type proc_deny_new_usb)
 (type proc_dirty)
 (type proc_diskstats)
 (type proc_drop_caches)
 (type proc_extra_free_kbytes)
 (type proc_filesystems)
 (type proc_fs_verity)
 (type proc_hostname)
 (type proc_hung_task)
 (type proc_interrupts)
 (type proc_iomem)
@@ -2531,20 +2532,21 @@
 (typeattribute print_service_30_0)
 (typeattribute priv_app_30_0)
 (typeattribute privapp_data_file_30_0)
 (typeattribute proc_30_0)
 (typeattribute proc_abi_30_0)
 (typeattribute proc_asound_30_0)
 (typeattribute proc_bluetooth_writable_30_0)
 (typeattribute proc_buddyinfo_30_0)
 (typeattribute proc_cmdline_30_0)
 (typeattribute proc_cpuinfo_30_0)
+(typeattribute proc_deny_new_usb_30_0)
 (typeattribute proc_dirty_30_0)
 (typeattribute proc_diskstats_30_0)
 (typeattribute proc_drop_caches_30_0)
 (typeattribute proc_extra_free_kbytes_30_0)
 (typeattribute proc_filesystems_30_0)
 (typeattribute proc_fs_verity_30_0)
 (typeattribute proc_hostname_30_0)
 (typeattribute proc_hung_task_30_0)
 (typeattribute proc_interrupts_30_0)
 (typeattribute proc_iomem_30_0)
diff --git a/prebuilts/api/31.0/plat_pub_versioned.cil b/prebuilts/api/31.0/plat_pub_versioned.cil
index 9a086c50274c883e0e177893834389785b98fa4c..533d9511aeb38570bc8a6cf2cf9e6e411afe4608 100644
--- a/prebuilts/api/31.0/plat_pub_versioned.cil
+++ b/prebuilts/api/31.0/plat_pub_versioned.cil
@@ -725,20 +725,21 @@
 (type priv_app)
 (type privapp_data_file)
 (type proc)
 (type proc_abi)
 (type proc_asound)
 (type proc_bluetooth_writable)
 (type proc_bootconfig)
 (type proc_buddyinfo)
 (type proc_cmdline)
 (type proc_cpuinfo)
+(type proc_deny_new_usb)
 (type proc_dirty)
 (type proc_diskstats)
 (type proc_drop_caches)
 (type proc_extra_free_kbytes)
 (type proc_filesystems)
 (type proc_fs_verity)
 (type proc_hostname)
 (type proc_hung_task)
 (type proc_interrupts)
 (type proc_iomem)
@@ -2749,20 +2750,21 @@
 (typeattribute priv_app_31_0)
 (typeattribute privapp_data_file_31_0)
 (typeattribute proc_31_0)
 (typeattribute proc_abi_31_0)
 (typeattribute proc_asound_31_0)
 (typeattribute proc_bluetooth_writable_31_0)
 (typeattribute proc_bootconfig_31_0)
 (typeattribute proc_buddyinfo_31_0)
 (typeattribute proc_cmdline_31_0)
 (typeattribute proc_cpuinfo_31_0)
+(typeattribute proc_deny_new_usb_31_0)
 (typeattribute proc_dirty_31_0)
 (typeattribute proc_diskstats_31_0)
 (typeattribute proc_drop_caches_31_0)
 (typeattribute proc_extra_free_kbytes_31_0)
 (typeattribute proc_filesystems_31_0)
 (typeattribute proc_fs_verity_31_0)
 (typeattribute proc_hostname_31_0)
 (typeattribute proc_hung_task_31_0)
 (typeattribute proc_interrupts_31_0)
 (typeattribute proc_iomem_31_0)
diff --git a/prebuilts/api/32.0/private/compat/26.0/26.0.cil b/prebuilts/api/32.0/private/compat/26.0/26.0.cil
index 498bca5a77136ff26fd77d2ab221c1dc51407ca5..0a2d8eb9ac1d7eb532b4b81a43a19284f1818e67 100644
--- a/prebuilts/api/32.0/private/compat/26.0/26.0.cil
+++ b/prebuilts/api/32.0/private/compat/26.0/26.0.cil
@@ -461,20 +461,21 @@
 (typeattributeset preopt2cachename_26_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_26_0 (preopt2cachename_exec))
 (typeattributeset print_service_26_0 (print_service))
 (typeattributeset priv_app_26_0 (mediaprovider priv_app))
 (typeattributeset proc_26_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/prebuilts/api/32.0/private/compat/27.0/27.0.cil b/prebuilts/api/32.0/private/compat/27.0/27.0.cil
index 0d883c0c74c9d8a8bee052000d270b9d1e45a8cb..c8f209a9b23c9024cd2208ec25e30ba299d8ba03 100644
--- a/prebuilts/api/32.0/private/compat/27.0/27.0.cil
+++ b/prebuilts/api/32.0/private/compat/27.0/27.0.cil
@@ -1175,20 +1175,21 @@
 (typeattributeset preopt2cachename_27_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_27_0 (preopt2cachename_exec))
 (typeattributeset print_service_27_0 (print_service))
 (typeattributeset priv_app_27_0 (priv_app))
 (typeattributeset proc_27_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/prebuilts/api/32.0/private/compat/28.0/28.0.cil b/prebuilts/api/32.0/private/compat/28.0/28.0.cil
index 321e9387ed3817dfc61136de9c807a49fffbd785..ba3263e6b0ed1aef4ea3792a28b2bd9dd33016c8 100644
--- a/prebuilts/api/32.0/private/compat/28.0/28.0.cil
+++ b/prebuilts/api/32.0/private/compat/28.0/28.0.cil
@@ -536,20 +536,21 @@
 (expandtypeattribute (preopt2cachename_exec_28_0) true)
 (expandtypeattribute (print_service_28_0) true)
 (expandtypeattribute (priv_app_28_0) true)
 (expandtypeattribute (proc_28_0) true)
 (expandtypeattribute (proc_abi_28_0) true)
 (expandtypeattribute (proc_asound_28_0) true)
 (expandtypeattribute (proc_bluetooth_writable_28_0) true)
 (expandtypeattribute (proc_buddyinfo_28_0) true)
 (expandtypeattribute (proc_cmdline_28_0) true)
 (expandtypeattribute (proc_cpuinfo_28_0) true)
+(expandtypeattribute (proc_deny_new_usb_28_0) true)
 (expandtypeattribute (proc_dirty_28_0) true)
 (expandtypeattribute (proc_diskstats_28_0) true)
 (expandtypeattribute (proc_drop_caches_28_0) true)
 (expandtypeattribute (processinfo_service_28_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_28_0) true)
 (expandtypeattribute (proc_filesystems_28_0) true)
 (expandtypeattribute (proc_hostname_28_0) true)
 (expandtypeattribute (proc_hung_task_28_0) true)
 (expandtypeattribute (proc_interrupts_28_0) true)
 (expandtypeattribute (proc_iomem_28_0) true)
@@ -1385,20 +1386,21 @@
     proc_pressure_cpu
     proc_pressure_io
     proc_pressure_mem
     proc_slabinfo))
 (typeattributeset proc_abi_28_0 (proc_abi))
 (typeattributeset proc_asound_28_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_28_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_28_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_28_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_28_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_28_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_28_0 (proc_dirty))
 (typeattributeset proc_diskstats_28_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_28_0 (proc_drop_caches))
 (typeattributeset processinfo_service_28_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_28_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_28_0 (proc_filesystems))
 (typeattributeset proc_hostname_28_0 (proc_hostname))
 (typeattributeset proc_hung_task_28_0 (proc_hung_task))
 (typeattributeset proc_interrupts_28_0 (proc_interrupts))
 (typeattributeset proc_iomem_28_0 (proc_iomem))
diff --git a/prebuilts/api/32.0/private/compat/29.0/29.0.cil b/prebuilts/api/32.0/private/compat/29.0/29.0.cil
index 0fb0a1c5ba68dfb32205bf0de4950ec2182feb98..6052ff958ecdcaabcb080df79b5d8f9da69761f1 100644
--- a/prebuilts/api/32.0/private/compat/29.0/29.0.cil
+++ b/prebuilts/api/32.0/private/compat/29.0/29.0.cil
@@ -592,20 +592,21 @@
 (expandtypeattribute (print_service_29_0) true)
 (expandtypeattribute (priv_app_29_0) true)
 (expandtypeattribute (privapp_data_file_29_0) true)
 (expandtypeattribute (proc_29_0) true)
 (expandtypeattribute (proc_abi_29_0) true)
 (expandtypeattribute (proc_asound_29_0) true)
 (expandtypeattribute (proc_bluetooth_writable_29_0) true)
 (expandtypeattribute (proc_buddyinfo_29_0) true)
 (expandtypeattribute (proc_cmdline_29_0) true)
 (expandtypeattribute (proc_cpuinfo_29_0) true)
+(expandtypeattribute (proc_deny_new_usb_29_0) true)
 (expandtypeattribute (proc_dirty_29_0) true)
 (expandtypeattribute (proc_diskstats_29_0) true)
 (expandtypeattribute (proc_drop_caches_29_0) true)
 (expandtypeattribute (processinfo_service_29_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_29_0) true)
 (expandtypeattribute (proc_filesystems_29_0) true)
 (expandtypeattribute (proc_fs_verity_29_0) true)
 (expandtypeattribute (proc_hostname_29_0) true)
 (expandtypeattribute (proc_hung_task_29_0) true)
 (expandtypeattribute (proc_interrupts_29_0) true)
@@ -1577,20 +1578,21 @@
 (typeattributeset proc_29_0
   ( proc
     proc_kpageflags
     proc_lowmemorykiller))
 (typeattributeset proc_abi_29_0 (proc_abi))
 (typeattributeset proc_asound_29_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_29_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_29_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_29_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_29_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_29_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_29_0 (proc_dirty))
 (typeattributeset proc_diskstats_29_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_29_0 (proc_drop_caches))
 (typeattributeset processinfo_service_29_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_29_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_29_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_29_0 (proc_fs_verity))
 (typeattributeset proc_hostname_29_0 (proc_hostname))
 (typeattributeset proc_hung_task_29_0 (proc_hung_task))
 (typeattributeset proc_interrupts_29_0 (proc_interrupts))
diff --git a/prebuilts/api/32.0/private/compat/30.0/30.0.cil b/prebuilts/api/32.0/private/compat/30.0/30.0.cil
index 9f40876682452ce5620999c1adb965042f63774b..e6bd5cec6e63c75e3548cc8ad69e382418e3dbf8 100644
--- a/prebuilts/api/32.0/private/compat/30.0/30.0.cil
+++ b/prebuilts/api/32.0/private/compat/30.0/30.0.cil
@@ -667,20 +667,21 @@
 (expandtypeattribute (print_service_30_0) true)
 (expandtypeattribute (priv_app_30_0) true)
 (expandtypeattribute (privapp_data_file_30_0) true)
 (expandtypeattribute (proc_30_0) true)
 (expandtypeattribute (proc_abi_30_0) true)
 (expandtypeattribute (proc_asound_30_0) true)
 (expandtypeattribute (proc_bluetooth_writable_30_0) true)
 (expandtypeattribute (proc_buddyinfo_30_0) true)
 (expandtypeattribute (proc_cmdline_30_0) true)
 (expandtypeattribute (proc_cpuinfo_30_0) true)
+(expandtypeattribute (proc_deny_new_usb_30_0) true)
 (expandtypeattribute (proc_dirty_30_0) true)
 (expandtypeattribute (proc_diskstats_30_0) true)
 (expandtypeattribute (proc_drop_caches_30_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_30_0) true)
 (expandtypeattribute (proc_filesystems_30_0) true)
 (expandtypeattribute (proc_fs_verity_30_0) true)
 (expandtypeattribute (proc_hostname_30_0) true)
 (expandtypeattribute (proc_hung_task_30_0) true)
 (expandtypeattribute (proc_interrupts_30_0) true)
 (expandtypeattribute (proc_iomem_30_0) true)
@@ -1820,20 +1821,21 @@
 (typeattributeset privapp_data_file_30_0 (privapp_data_file))
 (typeattributeset proc_30_0
   ( proc
     proc_bootconfig))
 (typeattributeset proc_abi_30_0 (proc_abi))
 (typeattributeset proc_asound_30_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_30_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_30_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_30_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_30_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_30_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_30_0 (proc_dirty))
 (typeattributeset proc_diskstats_30_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_30_0 (proc_drop_caches))
 (typeattributeset proc_extra_free_kbytes_30_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_30_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_30_0 (proc_fs_verity))
 (typeattributeset proc_hostname_30_0 (proc_hostname))
 (typeattributeset proc_hung_task_30_0 (proc_hung_task))
 (typeattributeset proc_interrupts_30_0 (proc_interrupts))
 (typeattributeset proc_iomem_30_0 (proc_iomem))
diff --git a/prebuilts/api/32.0/private/compat/31.0/31.0.cil b/prebuilts/api/32.0/private/compat/31.0/31.0.cil
index 009d8b2def681d4ae849917f8be61f971b8dbdcd..9923125d92d723d3a0a0467b486aa003715ee2ed 100644
--- a/prebuilts/api/32.0/private/compat/31.0/31.0.cil
+++ b/prebuilts/api/32.0/private/compat/31.0/31.0.cil
@@ -725,20 +725,21 @@
 (expandtypeattribute (priv_app_31_0) true)
 (expandtypeattribute (privapp_data_file_31_0) true)
 (expandtypeattribute (proc_31_0) true)
 (expandtypeattribute (proc_abi_31_0) true)
 (expandtypeattribute (proc_asound_31_0) true)
 (expandtypeattribute (proc_bluetooth_writable_31_0) true)
 (expandtypeattribute (proc_bootconfig_31_0) true)
 (expandtypeattribute (proc_buddyinfo_31_0) true)
 (expandtypeattribute (proc_cmdline_31_0) true)
 (expandtypeattribute (proc_cpuinfo_31_0) true)
+(expandtypeattribute (proc_deny_new_usb_31_0) true)
 (expandtypeattribute (proc_dirty_31_0) true)
 (expandtypeattribute (proc_diskstats_31_0) true)
 (expandtypeattribute (proc_drop_caches_31_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_31_0) true)
 (expandtypeattribute (proc_filesystems_31_0) true)
 (expandtypeattribute (proc_fs_verity_31_0) true)
 (expandtypeattribute (proc_hostname_31_0) true)
 (expandtypeattribute (proc_hung_task_31_0) true)
 (expandtypeattribute (proc_interrupts_31_0) true)
 (expandtypeattribute (proc_iomem_31_0) true)
@@ -1960,20 +1961,21 @@
 (typeattributeset priv_app_31_0 (priv_app))
 (typeattributeset privapp_data_file_31_0 (privapp_data_file))
 (typeattributeset proc_31_0 (proc))
 (typeattributeset proc_abi_31_0 (proc_abi))
 (typeattributeset proc_asound_31_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_31_0 (proc_bluetooth_writable))
 (typeattributeset proc_bootconfig_31_0 (proc_bootconfig))
 (typeattributeset proc_buddyinfo_31_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_31_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_31_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_31_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_31_0 (proc_dirty))
 (typeattributeset proc_diskstats_31_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_31_0 (proc_drop_caches))
 (typeattributeset proc_extra_free_kbytes_31_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_31_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_31_0 (proc_fs_verity))
 (typeattributeset proc_hostname_31_0 (proc_hostname))
 (typeattributeset proc_hung_task_31_0 (proc_hung_task))
 (typeattributeset proc_interrupts_31_0 (proc_interrupts))
 (typeattributeset proc_iomem_31_0 (proc_iomem))
diff --git a/prebuilts/api/32.0/private/genfs_contexts b/prebuilts/api/32.0/private/genfs_contexts
index 5c3332f1a888bc702ffccf9c76d5fb6fdc185d68..7f9cf4cfa0def9c24b437b2b8342299d6a25ceb3 100644
--- a/prebuilts/api/32.0/private/genfs_contexts
+++ b/prebuilts/api/32.0/private/genfs_contexts
@@ -40,20 +40,21 @@ genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
 genfscon proc /sys/fs/protected_fifos u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_regular u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
+genfscon proc /sys/kernel/deny_new_usb u:object_r:proc_deny_new_usb:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/hung_task_ u:object_r:proc_hung_task:s0
 genfscon proc /sys/kernel/kptr_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/modprobe u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/modules_disabled u:object_r:proc_security:s0
 genfscon proc /sys/kernel/panic_on_oops u:object_r:proc_panic:s0
 genfscon proc /sys/kernel/perf_event_max_sample_rate u:object_r:proc_perf:s0
diff --git a/prebuilts/api/32.0/private/property_contexts b/prebuilts/api/32.0/private/property_contexts
index 7e933f87ac679869c0c5b7aca6a01c818cccf5d6..fdda3ffb2c497b180e32b83ce48766c7344b4aaf 100644
--- a/prebuilts/api/32.0/private/property_contexts
+++ b/prebuilts/api/32.0/private/property_contexts
@@ -91,20 +91,21 @@ ro.serialno             u:object_r:serialno_prop:s0
 ro.boot.btmacaddr       u:object_r:bluetooth_prop:s0
 ro.boot.serialno        u:object_r:serialno_prop:s0
 ro.bt.                  u:object_r:bluetooth_prop:s0
 ro.boot.bootreason      u:object_r:bootloader_boot_reason_prop:s0
 persist.sys.boot.reason u:object_r:last_boot_reason_prop:s0
 sys.boot.reason         u:object_r:system_boot_reason_prop:s0
 sys.boot.reason.last    u:object_r:last_boot_reason_prop:s0
 pm.                     u:object_r:pm_prop:s0
 test.sys.boot.reason    u:object_r:test_boot_reason_prop:s0
 test.userspace_reboot.requested u:object_r:userspace_reboot_test_prop:s0
+security.deny_new_usb   u:object_r:system_prop:s0
 sys.lmk.                u:object_r:system_lmk_prop:s0
 sys.trace.              u:object_r:system_trace_prop:s0
 wrap.                   u:object_r:zygote_wrap_prop:s0 prefix string
 
 # Suspend service properties
 suspend.max_sleep_time_millis u:object_r:suspend_prop:s0 exact uint
 suspend.base_sleep_time_millis u:object_r:suspend_prop:s0 exact uint
 suspend.backoff_threshold_count u:object_r:suspend_prop:s0 exact uint
 suspend.short_suspend_threshold_millis u:object_r:suspend_prop:s0 exact uint
 suspend.sleep_time_scale_factor u:object_r:suspend_prop:s0 exact double
diff --git a/prebuilts/api/32.0/public/file.te b/prebuilts/api/32.0/public/file.te
index dc788ac6a39631fe5096a3ab271df52f48aa5149..ecc907291ca32cfd1d63fb47f5a52f7d3a6b2c22 100644
--- a/prebuilts/api/32.0/public/file.te
+++ b/prebuilts/api/32.0/public/file.te
@@ -18,20 +18,21 @@ type usermodehelper, fs_type, proc_type;
 type sysfs_usermodehelper, fs_type, sysfs_type;
 type proc_qtaguid_ctrl, fs_type, mlstrustedobject, proc_type;
 type proc_qtaguid_stat, fs_type, mlstrustedobject, proc_type;
 type proc_bluetooth_writable, fs_type, proc_type;
 type proc_abi, fs_type, proc_type;
 type proc_asound, fs_type, proc_type;
 type proc_bootconfig, fs_type, proc_type;
 type proc_buddyinfo, fs_type, proc_type;
 type proc_cmdline, fs_type, proc_type;
 type proc_cpuinfo, fs_type, proc_type;
+type proc_deny_new_usb, fs_type, proc_type;
 type proc_dirty, fs_type, proc_type;
 type proc_diskstats, fs_type, proc_type;
 type proc_extra_free_kbytes, fs_type, proc_type;
 type proc_filesystems, fs_type, proc_type;
 type proc_fs_verity, fs_type, proc_type;
 type proc_hostname, fs_type, proc_type;
 type proc_hung_task, fs_type, proc_type;
 type proc_interrupts, fs_type, proc_type;
 type proc_iomem, fs_type, proc_type;
 type proc_kallsyms, fs_type, proc_type;
diff --git a/prebuilts/api/32.0/public/init.te b/prebuilts/api/32.0/public/init.te
index 49b23ee6182110fedf14eac7dbe785d19bd97ebc..4c28cc08aee244f92ef7ab7e519ec2906122a7c6 100644
--- a/prebuilts/api/32.0/public/init.te
+++ b/prebuilts/api/32.0/public/init.te
@@ -366,20 +366,21 @@ allow init {
   proc_diskstats
   proc_kmsg # Open /proc/kmsg for logd service.
   proc_meminfo
   proc_stat # Read /proc/stat for bootchart.
   proc_uptime
   proc_version
 }:file r_file_perms;
 
 allow init {
   proc_abi
+  proc_deny_new_usb
   proc_dirty
   proc_hostname
   proc_hung_task
   proc_extra_free_kbytes
   proc_net_type
   proc_max_map_count
   proc_min_free_order_shift
   proc_overcommit_memory      # /proc/sys/vm/overcommit_memory
   proc_panic
   proc_page_cluster
diff --git a/private/compat/26.0/26.0.cil b/private/compat/26.0/26.0.cil
index 498bca5a77136ff26fd77d2ab221c1dc51407ca5..0a2d8eb9ac1d7eb532b4b81a43a19284f1818e67 100644
--- a/private/compat/26.0/26.0.cil
+++ b/private/compat/26.0/26.0.cil
@@ -461,20 +461,21 @@
 (typeattributeset preopt2cachename_26_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_26_0 (preopt2cachename_exec))
 (typeattributeset print_service_26_0 (print_service))
 (typeattributeset priv_app_26_0 (mediaprovider priv_app))
 (typeattributeset proc_26_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/private/compat/27.0/27.0.cil b/private/compat/27.0/27.0.cil
index 0d883c0c74c9d8a8bee052000d270b9d1e45a8cb..c8f209a9b23c9024cd2208ec25e30ba299d8ba03 100644
--- a/private/compat/27.0/27.0.cil
+++ b/private/compat/27.0/27.0.cil
@@ -1175,20 +1175,21 @@
 (typeattributeset preopt2cachename_27_0 (preopt2cachename))
 (typeattributeset preopt2cachename_exec_27_0 (preopt2cachename_exec))
 (typeattributeset print_service_27_0 (print_service))
 (typeattributeset priv_app_27_0 (priv_app))
 (typeattributeset proc_27_0
   ( proc
     proc_abi
     proc_asound
     proc_buddyinfo
     proc_cmdline
+    proc_deny_new_usb
     proc_dirty
     proc_diskstats
     proc_extra_free_kbytes
     proc_filesystems
     proc_hostname
     proc_hung_task
     proc_kmsg
     proc_loadavg
     proc_max_map_count
     proc_min_free_order_shift
diff --git a/private/compat/28.0/28.0.cil b/private/compat/28.0/28.0.cil
index 321e9387ed3817dfc61136de9c807a49fffbd785..ba3263e6b0ed1aef4ea3792a28b2bd9dd33016c8 100644
--- a/private/compat/28.0/28.0.cil
+++ b/private/compat/28.0/28.0.cil
@@ -536,20 +536,21 @@
 (expandtypeattribute (preopt2cachename_exec_28_0) true)
 (expandtypeattribute (print_service_28_0) true)
 (expandtypeattribute (priv_app_28_0) true)
 (expandtypeattribute (proc_28_0) true)
 (expandtypeattribute (proc_abi_28_0) true)
 (expandtypeattribute (proc_asound_28_0) true)
 (expandtypeattribute (proc_bluetooth_writable_28_0) true)
 (expandtypeattribute (proc_buddyinfo_28_0) true)
 (expandtypeattribute (proc_cmdline_28_0) true)
 (expandtypeattribute (proc_cpuinfo_28_0) true)
+(expandtypeattribute (proc_deny_new_usb_28_0) true)
 (expandtypeattribute (proc_dirty_28_0) true)
 (expandtypeattribute (proc_diskstats_28_0) true)
 (expandtypeattribute (proc_drop_caches_28_0) true)
 (expandtypeattribute (processinfo_service_28_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_28_0) true)
 (expandtypeattribute (proc_filesystems_28_0) true)
 (expandtypeattribute (proc_hostname_28_0) true)
 (expandtypeattribute (proc_hung_task_28_0) true)
 (expandtypeattribute (proc_interrupts_28_0) true)
 (expandtypeattribute (proc_iomem_28_0) true)
@@ -1385,20 +1386,21 @@
     proc_pressure_cpu
     proc_pressure_io
     proc_pressure_mem
     proc_slabinfo))
 (typeattributeset proc_abi_28_0 (proc_abi))
 (typeattributeset proc_asound_28_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_28_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_28_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_28_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_28_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_28_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_28_0 (proc_dirty))
 (typeattributeset proc_diskstats_28_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_28_0 (proc_drop_caches))
 (typeattributeset processinfo_service_28_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_28_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_28_0 (proc_filesystems))
 (typeattributeset proc_hostname_28_0 (proc_hostname))
 (typeattributeset proc_hung_task_28_0 (proc_hung_task))
 (typeattributeset proc_interrupts_28_0 (proc_interrupts))
 (typeattributeset proc_iomem_28_0 (proc_iomem))
diff --git a/private/compat/29.0/29.0.cil b/private/compat/29.0/29.0.cil
index 0fb0a1c5ba68dfb32205bf0de4950ec2182feb98..6052ff958ecdcaabcb080df79b5d8f9da69761f1 100644
--- a/private/compat/29.0/29.0.cil
+++ b/private/compat/29.0/29.0.cil
@@ -592,20 +592,21 @@
 (expandtypeattribute (print_service_29_0) true)
 (expandtypeattribute (priv_app_29_0) true)
 (expandtypeattribute (privapp_data_file_29_0) true)
 (expandtypeattribute (proc_29_0) true)
 (expandtypeattribute (proc_abi_29_0) true)
 (expandtypeattribute (proc_asound_29_0) true)
 (expandtypeattribute (proc_bluetooth_writable_29_0) true)
 (expandtypeattribute (proc_buddyinfo_29_0) true)
 (expandtypeattribute (proc_cmdline_29_0) true)
 (expandtypeattribute (proc_cpuinfo_29_0) true)
+(expandtypeattribute (proc_deny_new_usb_29_0) true)
 (expandtypeattribute (proc_dirty_29_0) true)
 (expandtypeattribute (proc_diskstats_29_0) true)
 (expandtypeattribute (proc_drop_caches_29_0) true)
 (expandtypeattribute (processinfo_service_29_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_29_0) true)
 (expandtypeattribute (proc_filesystems_29_0) true)
 (expandtypeattribute (proc_fs_verity_29_0) true)
 (expandtypeattribute (proc_hostname_29_0) true)
 (expandtypeattribute (proc_hung_task_29_0) true)
 (expandtypeattribute (proc_interrupts_29_0) true)
@@ -1577,20 +1578,21 @@
 (typeattributeset proc_29_0
   ( proc
     proc_kpageflags
     proc_lowmemorykiller))
 (typeattributeset proc_abi_29_0 (proc_abi))
 (typeattributeset proc_asound_29_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_29_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_29_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_29_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_29_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_29_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_29_0 (proc_dirty))
 (typeattributeset proc_diskstats_29_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_29_0 (proc_drop_caches))
 (typeattributeset processinfo_service_29_0 (processinfo_service))
 (typeattributeset proc_extra_free_kbytes_29_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_29_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_29_0 (proc_fs_verity))
 (typeattributeset proc_hostname_29_0 (proc_hostname))
 (typeattributeset proc_hung_task_29_0 (proc_hung_task))
 (typeattributeset proc_interrupts_29_0 (proc_interrupts))
diff --git a/private/compat/30.0/30.0.cil b/private/compat/30.0/30.0.cil
index 9f40876682452ce5620999c1adb965042f63774b..e6bd5cec6e63c75e3548cc8ad69e382418e3dbf8 100644
--- a/private/compat/30.0/30.0.cil
+++ b/private/compat/30.0/30.0.cil
@@ -667,20 +667,21 @@
 (expandtypeattribute (print_service_30_0) true)
 (expandtypeattribute (priv_app_30_0) true)
 (expandtypeattribute (privapp_data_file_30_0) true)
 (expandtypeattribute (proc_30_0) true)
 (expandtypeattribute (proc_abi_30_0) true)
 (expandtypeattribute (proc_asound_30_0) true)
 (expandtypeattribute (proc_bluetooth_writable_30_0) true)
 (expandtypeattribute (proc_buddyinfo_30_0) true)
 (expandtypeattribute (proc_cmdline_30_0) true)
 (expandtypeattribute (proc_cpuinfo_30_0) true)
+(expandtypeattribute (proc_deny_new_usb_30_0) true)
 (expandtypeattribute (proc_dirty_30_0) true)
 (expandtypeattribute (proc_diskstats_30_0) true)
 (expandtypeattribute (proc_drop_caches_30_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_30_0) true)
 (expandtypeattribute (proc_filesystems_30_0) true)
 (expandtypeattribute (proc_fs_verity_30_0) true)
 (expandtypeattribute (proc_hostname_30_0) true)
 (expandtypeattribute (proc_hung_task_30_0) true)
 (expandtypeattribute (proc_interrupts_30_0) true)
 (expandtypeattribute (proc_iomem_30_0) true)
@@ -1820,20 +1821,21 @@
 (typeattributeset privapp_data_file_30_0 (privapp_data_file))
 (typeattributeset proc_30_0
   ( proc
     proc_bootconfig))
 (typeattributeset proc_abi_30_0 (proc_abi))
 (typeattributeset proc_asound_30_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_30_0 (proc_bluetooth_writable))
 (typeattributeset proc_buddyinfo_30_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_30_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_30_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_30_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_30_0 (proc_dirty))
 (typeattributeset proc_diskstats_30_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_30_0 (proc_drop_caches))
 (typeattributeset proc_extra_free_kbytes_30_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_30_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_30_0 (proc_fs_verity))
 (typeattributeset proc_hostname_30_0 (proc_hostname))
 (typeattributeset proc_hung_task_30_0 (proc_hung_task))
 (typeattributeset proc_interrupts_30_0 (proc_interrupts))
 (typeattributeset proc_iomem_30_0 (proc_iomem))
diff --git a/private/compat/31.0/31.0.cil b/private/compat/31.0/31.0.cil
index 009d8b2def681d4ae849917f8be61f971b8dbdcd..9923125d92d723d3a0a0467b486aa003715ee2ed 100644
--- a/private/compat/31.0/31.0.cil
+++ b/private/compat/31.0/31.0.cil
@@ -725,20 +725,21 @@
 (expandtypeattribute (priv_app_31_0) true)
 (expandtypeattribute (privapp_data_file_31_0) true)
 (expandtypeattribute (proc_31_0) true)
 (expandtypeattribute (proc_abi_31_0) true)
 (expandtypeattribute (proc_asound_31_0) true)
 (expandtypeattribute (proc_bluetooth_writable_31_0) true)
 (expandtypeattribute (proc_bootconfig_31_0) true)
 (expandtypeattribute (proc_buddyinfo_31_0) true)
 (expandtypeattribute (proc_cmdline_31_0) true)
 (expandtypeattribute (proc_cpuinfo_31_0) true)
+(expandtypeattribute (proc_deny_new_usb_31_0) true)
 (expandtypeattribute (proc_dirty_31_0) true)
 (expandtypeattribute (proc_diskstats_31_0) true)
 (expandtypeattribute (proc_drop_caches_31_0) true)
 (expandtypeattribute (proc_extra_free_kbytes_31_0) true)
 (expandtypeattribute (proc_filesystems_31_0) true)
 (expandtypeattribute (proc_fs_verity_31_0) true)
 (expandtypeattribute (proc_hostname_31_0) true)
 (expandtypeattribute (proc_hung_task_31_0) true)
 (expandtypeattribute (proc_interrupts_31_0) true)
 (expandtypeattribute (proc_iomem_31_0) true)
@@ -1960,20 +1961,21 @@
 (typeattributeset priv_app_31_0 (priv_app))
 (typeattributeset privapp_data_file_31_0 (privapp_data_file))
 (typeattributeset proc_31_0 (proc))
 (typeattributeset proc_abi_31_0 (proc_abi))
 (typeattributeset proc_asound_31_0 (proc_asound))
 (typeattributeset proc_bluetooth_writable_31_0 (proc_bluetooth_writable))
 (typeattributeset proc_bootconfig_31_0 (proc_bootconfig))
 (typeattributeset proc_buddyinfo_31_0 (proc_buddyinfo))
 (typeattributeset proc_cmdline_31_0 (proc_cmdline))
 (typeattributeset proc_cpuinfo_31_0 (proc_cpuinfo))
+(typeattributeset proc_deny_new_usb_31_0 (proc_deny_new_usb))
 (typeattributeset proc_dirty_31_0 (proc_dirty))
 (typeattributeset proc_diskstats_31_0 (proc_diskstats))
 (typeattributeset proc_drop_caches_31_0 (proc_drop_caches))
 (typeattributeset proc_extra_free_kbytes_31_0 (proc_extra_free_kbytes))
 (typeattributeset proc_filesystems_31_0 (proc_filesystems))
 (typeattributeset proc_fs_verity_31_0 (proc_fs_verity))
 (typeattributeset proc_hostname_31_0 (proc_hostname))
 (typeattributeset proc_hung_task_31_0 (proc_hung_task))
 (typeattributeset proc_interrupts_31_0 (proc_interrupts))
 (typeattributeset proc_iomem_31_0 (proc_iomem))
diff --git a/private/genfs_contexts b/private/genfs_contexts
index 5c3332f1a888bc702ffccf9c76d5fb6fdc185d68..7f9cf4cfa0def9c24b437b2b8342299d6a25ceb3 100644
--- a/private/genfs_contexts
+++ b/private/genfs_contexts
@@ -40,20 +40,21 @@ genfscon proc /kpageflags u:object_r:proc_kpageflags:s0
 genfscon proc /sys/abi/swp u:object_r:proc_abi:s0
 genfscon proc /sys/fs/pipe-max-size u:object_r:proc_pipe_conf:s0
 genfscon proc /sys/fs/protected_fifos u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_hardlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_regular u:object_r:proc_security:s0
 genfscon proc /sys/fs/protected_symlinks u:object_r:proc_security:s0
 genfscon proc /sys/fs/suid_dumpable u:object_r:proc_security:s0
 genfscon proc /sys/fs/verity/require_signatures u:object_r:proc_fs_verity:s0
 genfscon proc /sys/kernel/core_pattern u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/core_pipe_limit u:object_r:usermodehelper:s0
+genfscon proc /sys/kernel/deny_new_usb u:object_r:proc_deny_new_usb:s0
 genfscon proc /sys/kernel/domainname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/dmesg_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/hostname u:object_r:proc_hostname:s0
 genfscon proc /sys/kernel/hotplug u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/hung_task_ u:object_r:proc_hung_task:s0
 genfscon proc /sys/kernel/kptr_restrict u:object_r:proc_security:s0
 genfscon proc /sys/kernel/modprobe u:object_r:usermodehelper:s0
 genfscon proc /sys/kernel/modules_disabled u:object_r:proc_security:s0
 genfscon proc /sys/kernel/panic_on_oops u:object_r:proc_panic:s0
 genfscon proc /sys/kernel/perf_event_max_sample_rate u:object_r:proc_perf:s0
diff --git a/private/property_contexts b/private/property_contexts
index 7e933f87ac679869c0c5b7aca6a01c818cccf5d6..fdda3ffb2c497b180e32b83ce48766c7344b4aaf 100644
--- a/private/property_contexts
+++ b/private/property_contexts
@@ -91,20 +91,21 @@ ro.serialno             u:object_r:serialno_prop:s0
 ro.boot.btmacaddr       u:object_r:bluetooth_prop:s0
 ro.boot.serialno        u:object_r:serialno_prop:s0
 ro.bt.                  u:object_r:bluetooth_prop:s0
 ro.boot.bootreason      u:object_r:bootloader_boot_reason_prop:s0
 persist.sys.boot.reason u:object_r:last_boot_reason_prop:s0
 sys.boot.reason         u:object_r:system_boot_reason_prop:s0
 sys.boot.reason.last    u:object_r:last_boot_reason_prop:s0
 pm.                     u:object_r:pm_prop:s0
 test.sys.boot.reason    u:object_r:test_boot_reason_prop:s0
 test.userspace_reboot.requested u:object_r:userspace_reboot_test_prop:s0
+security.deny_new_usb   u:object_r:system_prop:s0
 sys.lmk.                u:object_r:system_lmk_prop:s0
 sys.trace.              u:object_r:system_trace_prop:s0
 wrap.                   u:object_r:zygote_wrap_prop:s0 prefix string
 
 # Suspend service properties
 suspend.max_sleep_time_millis u:object_r:suspend_prop:s0 exact uint
 suspend.base_sleep_time_millis u:object_r:suspend_prop:s0 exact uint
 suspend.backoff_threshold_count u:object_r:suspend_prop:s0 exact uint
 suspend.short_suspend_threshold_millis u:object_r:suspend_prop:s0 exact uint
 suspend.sleep_time_scale_factor u:object_r:suspend_prop:s0 exact double
diff --git a/public/file.te b/public/file.te
index dc788ac6a39631fe5096a3ab271df52f48aa5149..ecc907291ca32cfd1d63fb47f5a52f7d3a6b2c22 100644
--- a/public/file.te
+++ b/public/file.te
@@ -18,20 +18,21 @@ type usermodehelper, fs_type, proc_type;
 type sysfs_usermodehelper, fs_type, sysfs_type;
 type proc_qtaguid_ctrl, fs_type, mlstrustedobject, proc_type;
 type proc_qtaguid_stat, fs_type, mlstrustedobject, proc_type;
 type proc_bluetooth_writable, fs_type, proc_type;
 type proc_abi, fs_type, proc_type;
 type proc_asound, fs_type, proc_type;
 type proc_bootconfig, fs_type, proc_type;
 type proc_buddyinfo, fs_type, proc_type;
 type proc_cmdline, fs_type, proc_type;
 type proc_cpuinfo, fs_type, proc_type;
+type proc_deny_new_usb, fs_type, proc_type;
 type proc_dirty, fs_type, proc_type;
 type proc_diskstats, fs_type, proc_type;
 type proc_extra_free_kbytes, fs_type, proc_type;
 type proc_filesystems, fs_type, proc_type;
 type proc_fs_verity, fs_type, proc_type;
 type proc_hostname, fs_type, proc_type;
 type proc_hung_task, fs_type, proc_type;
 type proc_interrupts, fs_type, proc_type;
 type proc_iomem, fs_type, proc_type;
 type proc_kallsyms, fs_type, proc_type;
diff --git a/public/init.te b/public/init.te
index 49b23ee6182110fedf14eac7dbe785d19bd97ebc..4c28cc08aee244f92ef7ab7e519ec2906122a7c6 100644
--- a/public/init.te
+++ b/public/init.te
@@ -366,20 +366,21 @@ allow init {
   proc_diskstats
   proc_kmsg # Open /proc/kmsg for logd service.
   proc_meminfo
   proc_stat # Read /proc/stat for bootchart.
   proc_uptime
   proc_version
 }:file r_file_perms;
 
 allow init {
   proc_abi
+  proc_deny_new_usb
   proc_dirty
   proc_hostname
   proc_hung_task
   proc_extra_free_kbytes
   proc_net_type
   proc_max_map_count
   proc_min_free_order_shift
   proc_overcommit_memory      # /proc/sys/vm/overcommit_memory
   proc_panic
   proc_page_cluster

commit 7794ef2c12ac7660d7f4c2cc12fc42f184661da7
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Fri 2019-09-13 22:56:27-0400

    drop support for preloads_copy
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/file_contexts           |  1 -
 prebuilts/api/32.0/private/preloads_copy.te (gone) | 18 ------------------
 private/file_contexts                              |  1 -
 private/preloads_copy.te (gone)                    | 18 ------------------
 4 files changed, 38 deletions(-)

diff --git a/prebuilts/api/32.0/private/file_contexts b/prebuilts/api/32.0/private/file_contexts
index 0330d888d3532ea0edf1d5ba42997ddd44d5a08d..d1929304219fa7749688c207df6868ccbacd8588 100644
--- a/prebuilts/api/32.0/private/file_contexts
+++ b/prebuilts/api/32.0/private/file_contexts
@@ -306,21 +306,20 @@
 /system/bin/perfetto        u:object_r:perfetto_exec:s0
 /system/bin/traced        u:object_r:traced_exec:s0
 /system/bin/traced_perf        u:object_r:traced_perf_exec:s0
 /system/bin/traced_probes        u:object_r:traced_probes_exec:s0
 /system/bin/heapprofd        u:object_r:heapprofd_exec:s0
 /system/bin/uncrypt     u:object_r:uncrypt_exec:s0
 /system/bin/update_verifier u:object_r:update_verifier_exec:s0
 /system/bin/logwrapper  u:object_r:system_file:s0
 /system/bin/vdc         u:object_r:vdc_exec:s0
 /system/bin/cppreopts\.sh   u:object_r:cppreopts_exec:s0
-/system/bin/preloads_copy\.sh u:object_r:preloads_copy_exec:s0
 /system/bin/preopt2cachename u:object_r:preopt2cachename_exec:s0
 /system/bin/viewcompiler     u:object_r:viewcompiler_exec:s0
 /system/bin/iorapd          u:object_r:iorapd_exec:s0
 /system/bin/iorap\.inode2filename u:object_r:iorap_inode2filename_exec:s0
 /system/bin/iorap\.prefetcherd u:object_r:iorap_prefetcherd_exec:s0
 /system/bin/sgdisk      u:object_r:sgdisk_exec:s0
 /system/bin/blkid       u:object_r:blkid_exec:s0
 /system/bin/tzdatacheck u:object_r:tzdatacheck_exec:s0
 /system/bin/flags_health_check -- u:object_r:flags_health_check_exec:s0
 /system/bin/idmap u:object_r:idmap_exec:s0
diff --git a/prebuilts/api/32.0/private/preloads_copy.te b/prebuilts/api/32.0/private/preloads_copy.te
deleted file mode 100644
index ba54b70acad2b89a5cbe4e0610d585ce7154555f..0000000000000000000000000000000000000000
--- a/prebuilts/api/32.0/private/preloads_copy.te
+++ /dev/null
@@ -1,18 +0,0 @@
-type preloads_copy, domain, coredomain;
-type preloads_copy_exec, system_file_type, exec_type, file_type;
-
-init_daemon_domain(preloads_copy)
-
-allow preloads_copy shell_exec:file rx_file_perms;
-allow preloads_copy toolbox_exec:file rx_file_perms;
-allow preloads_copy preloads_data_file:dir create_dir_perms;
-allow preloads_copy preloads_data_file:file create_file_perms;
-allow preloads_copy preloads_media_file:dir create_dir_perms;
-allow preloads_copy preloads_media_file:file create_file_perms;
-
-# Allow to copy from /postinstall
-allow preloads_copy system_file:dir r_dir_perms;
-
-# Silence the denial when /postinstall cannot be mounted, e.g., system_other
-# is wiped, but preloads_copy.sh still runs.
-dontaudit preloads_copy postinstall_mnt_dir:dir search;
diff --git a/private/file_contexts b/private/file_contexts
index 0330d888d3532ea0edf1d5ba42997ddd44d5a08d..d1929304219fa7749688c207df6868ccbacd8588 100644
--- a/private/file_contexts
+++ b/private/file_contexts
@@ -306,21 +306,20 @@
 /system/bin/perfetto        u:object_r:perfetto_exec:s0
 /system/bin/traced        u:object_r:traced_exec:s0
 /system/bin/traced_perf        u:object_r:traced_perf_exec:s0
 /system/bin/traced_probes        u:object_r:traced_probes_exec:s0
 /system/bin/heapprofd        u:object_r:heapprofd_exec:s0
 /system/bin/uncrypt     u:object_r:uncrypt_exec:s0
 /system/bin/update_verifier u:object_r:update_verifier_exec:s0
 /system/bin/logwrapper  u:object_r:system_file:s0
 /system/bin/vdc         u:object_r:vdc_exec:s0
 /system/bin/cppreopts\.sh   u:object_r:cppreopts_exec:s0
-/system/bin/preloads_copy\.sh u:object_r:preloads_copy_exec:s0
 /system/bin/preopt2cachename u:object_r:preopt2cachename_exec:s0
 /system/bin/viewcompiler     u:object_r:viewcompiler_exec:s0
 /system/bin/iorapd          u:object_r:iorapd_exec:s0
 /system/bin/iorap\.inode2filename u:object_r:iorap_inode2filename_exec:s0
 /system/bin/iorap\.prefetcherd u:object_r:iorap_prefetcherd_exec:s0
 /system/bin/sgdisk      u:object_r:sgdisk_exec:s0
 /system/bin/blkid       u:object_r:blkid_exec:s0
 /system/bin/tzdatacheck u:object_r:tzdatacheck_exec:s0
 /system/bin/flags_health_check -- u:object_r:flags_health_check_exec:s0
 /system/bin/idmap u:object_r:idmap_exec:s0
diff --git a/private/preloads_copy.te b/private/preloads_copy.te
deleted file mode 100644
index ba54b70acad2b89a5cbe4e0610d585ce7154555f..0000000000000000000000000000000000000000
--- a/private/preloads_copy.te
+++ /dev/null
@@ -1,18 +0,0 @@
-type preloads_copy, domain, coredomain;
-type preloads_copy_exec, system_file_type, exec_type, file_type;
-
-init_daemon_domain(preloads_copy)
-
-allow preloads_copy shell_exec:file rx_file_perms;
-allow preloads_copy toolbox_exec:file rx_file_perms;
-allow preloads_copy preloads_data_file:dir create_dir_perms;
-allow preloads_copy preloads_data_file:file create_file_perms;
-allow preloads_copy preloads_media_file:dir create_dir_perms;
-allow preloads_copy preloads_media_file:file create_file_perms;
-
-# Allow to copy from /postinstall
-allow preloads_copy system_file:dir r_dir_perms;
-
-# Silence the denial when /postinstall cannot be mounted, e.g., system_other
-# is wiped, but preloads_copy.sh still runs.
-dontaudit preloads_copy postinstall_mnt_dir:dir search;

commit 9210a60710beb2f1dcbd75b3065663e99d218a9b
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:14:26-0400

    remove priv_app app_data_file execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/priv_app.te | 11 -----------
 private/priv_app.te                    | 11 -----------
 2 files changed, 22 deletions(-)

diff --git a/prebuilts/api/32.0/private/priv_app.te b/prebuilts/api/32.0/private/priv_app.te
index 3ceb7a3058be3664788660e6d2a2ab126caec27d..180f97d9ef11c691c690f91f123ce55203a25fd5 100644
--- a/prebuilts/api/32.0/private/priv_app.te
+++ b/prebuilts/api/32.0/private/priv_app.te
@@ -7,31 +7,20 @@ app_domain(priv_app)
 
 # Access the network.
 net_domain(priv_app)
 # Access bluetooth.
 bluetooth_domain(priv_app)
 
 # Allow the allocation and use of ptys
 # Used by: https://play.privileged.com/store/apps/details?id=jackpal.androidterm
 create_pty(priv_app)
 
-# Allow loading executable code from writable priv-app home
-# directories. This is a W^X violation, however, it needs
-# to be supported for now for the following reasons.
-# * /data/user_*/0/*/code_cache/* POSSIBLE uses (b/117841367)
-#   1) com.android.opengl.shaders_cache
-#   2) com.android.skia.shaders_cache
-#   3) com.android.renderscript.cache
-# * /data/user_de/0/com.google.android.gms/app_chimera
-# TODO: Tighten (b/112357170)
-allow priv_app privapp_data_file:file execute;
-
 # Chrome Crashpad uses the the dynamic linker to load native executables
 # from an APK (b/112050209, crbug.com/928422)
 allow priv_app system_linker_exec:file execute_no_trans;
 
 allow priv_app privapp_data_file:lnk_file create_file_perms;
 
 # Priv apps can find services that expose both @SystemAPI and normal APIs.
 allow priv_app app_api_service:service_manager find;
 allow priv_app system_api_service:service_manager find;
 
diff --git a/private/priv_app.te b/private/priv_app.te
index 3ceb7a3058be3664788660e6d2a2ab126caec27d..180f97d9ef11c691c690f91f123ce55203a25fd5 100644
--- a/private/priv_app.te
+++ b/private/priv_app.te
@@ -7,31 +7,20 @@ app_domain(priv_app)
 
 # Access the network.
 net_domain(priv_app)
 # Access bluetooth.
 bluetooth_domain(priv_app)
 
 # Allow the allocation and use of ptys
 # Used by: https://play.privileged.com/store/apps/details?id=jackpal.androidterm
 create_pty(priv_app)
 
-# Allow loading executable code from writable priv-app home
-# directories. This is a W^X violation, however, it needs
-# to be supported for now for the following reasons.
-# * /data/user_*/0/*/code_cache/* POSSIBLE uses (b/117841367)
-#   1) com.android.opengl.shaders_cache
-#   2) com.android.skia.shaders_cache
-#   3) com.android.renderscript.cache
-# * /data/user_de/0/com.google.android.gms/app_chimera
-# TODO: Tighten (b/112357170)
-allow priv_app privapp_data_file:file execute;
-
 # Chrome Crashpad uses the the dynamic linker to load native executables
 # from an APK (b/112050209, crbug.com/928422)
 allow priv_app system_linker_exec:file execute_no_trans;
 
 allow priv_app privapp_data_file:lnk_file create_file_perms;
 
 # Priv apps can find services that expose both @SystemAPI and normal APIs.
 allow priv_app app_api_service:service_manager find;
 allow priv_app system_api_service:service_manager find;
 

commit 1e41a1e93f6f6fac87daef7518684244ca8b4522
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:17:31-0400

    remove healthd ashmem execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/public/healthd.te | 1 -
 public/healthd.te                    | 1 -
 2 files changed, 2 deletions(-)

diff --git a/prebuilts/api/32.0/public/healthd.te b/prebuilts/api/32.0/public/healthd.te
index 05acb84a023cfb1f05172e2066341a6fc318725c..1d42fb5be76a1817274c0bf2ab9f6227dcac4972 100644
--- a/prebuilts/api/32.0/public/healthd.te
+++ b/prebuilts/api/32.0/public/healthd.te
@@ -39,12 +39,11 @@ r_dir_file(healthd, sysfs_batteryinfo)
 # Don't worry about overly broad permissions for now, as there's
 # only one file in /sys/fs/pstore
 allow healthd pstorefs:dir r_dir_perms;
 allow healthd pstorefs:file r_file_perms;
 
 allow healthd graphics_device:dir r_dir_perms;
 allow healthd graphics_device:chr_file rw_file_perms;
 allow healthd input_device:dir r_dir_perms;
 allow healthd input_device:chr_file r_file_perms;
 allow healthd tty_device:chr_file rw_file_perms;
-allow healthd ashmem_device:chr_file execute;
 allow healthd proc_sysrq:file rw_file_perms;
diff --git a/public/healthd.te b/public/healthd.te
index 05acb84a023cfb1f05172e2066341a6fc318725c..1d42fb5be76a1817274c0bf2ab9f6227dcac4972 100644
--- a/public/healthd.te
+++ b/public/healthd.te
@@ -39,12 +39,11 @@ r_dir_file(healthd, sysfs_batteryinfo)
 # Don't worry about overly broad permissions for now, as there's
 # only one file in /sys/fs/pstore
 allow healthd pstorefs:dir r_dir_perms;
 allow healthd pstorefs:file r_file_perms;
 
 allow healthd graphics_device:dir r_dir_perms;
 allow healthd graphics_device:chr_file rw_file_perms;
 allow healthd input_device:dir r_dir_perms;
 allow healthd input_device:chr_file r_file_perms;
 allow healthd tty_device:chr_file rw_file_perms;
-allow healthd ashmem_device:chr_file execute;
 allow healthd proc_sysrq:file rw_file_perms;

commit 6f4379a59f7142c101abd2aee0b3c085aa0f2ea4
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:20:43-0400

    auditallow app execmem
    
    Moving back towards an exception system.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/public/app.te | 1 +
 public/app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/public/app.te b/prebuilts/api/32.0/public/app.te
index 5527f9994137d506b4e265ac6631087677ddbd0e..11bc5a1ef47462ddfbdc96a264ced0ac40e53183 100644
--- a/prebuilts/api/32.0/public/app.te
+++ b/prebuilts/api/32.0/public/app.te
@@ -3,20 +3,21 @@
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
+auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
diff --git a/public/app.te b/public/app.te
index 5527f9994137d506b4e265ac6631087677ddbd0e..11bc5a1ef47462ddfbdc96a264ced0ac40e53183 100644
--- a/public/app.te
+++ b/public/app.te
@@ -3,20 +3,21 @@
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
+auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.

commit 2ea92991d0175305937cc6eed99e0a4387e24e39
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sun 2019-05-05 08:21:01-0400

    auditallow app ashmem execute
    
    Moving back towards an exception system.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/public/app.te | 1 +
 public/app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/public/app.te b/prebuilts/api/32.0/public/app.te
index 11bc5a1ef47462ddfbdc96a264ced0ac40e53183..8dd14179257e92b396bb32b333edf88a468aaba2 100644
--- a/prebuilts/api/32.0/public/app.te
+++ b/prebuilts/api/32.0/public/app.te
@@ -6,20 +6,21 @@
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
 auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
diff --git a/public/app.te b/public/app.te
index 11bc5a1ef47462ddfbdc96a264ced0ac40e53183..8dd14179257e92b396bb32b333edf88a468aaba2 100644
--- a/public/app.te
+++ b/public/app.te
@@ -6,20 +6,21 @@
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
 # WebView and other application-specific JIT compilers
 allow appdomain self:process execmem;
 auditallow appdomain self:process execmem;
 
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;

commit 4270332ba67dfbecb0ac39f53373b5b1b31b4361
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Thu 2020-10-22 23:39:34-0400

    add base system seinfo for shared/release keys
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/mac_permissions.xml | 10 ++++++++++
 prebuilts/api/32.0/private/seapp_contexts      | 18 ++++++++++++++++++
 private/mac_permissions.xml                    | 10 ++++++++++
 private/seapp_contexts                         | 18 ++++++++++++++++++
 4 files changed, 56 insertions(+)

diff --git a/prebuilts/api/32.0/private/mac_permissions.xml b/prebuilts/api/32.0/private/mac_permissions.xml
index 7fc37c13efd9826040450b0b6bbda69e6bd7374f..6b2d6ad094a96ac80640ed8c631d8c68982c684e 100644
--- a/prebuilts/api/32.0/private/mac_permissions.xml
+++ b/prebuilts/api/32.0/private/mac_permissions.xml
@@ -49,14 +49,24 @@
     <!-- Platform dev key in AOSP -->
     <signer signature="@PLATFORM" >
       <seinfo value="platform" />
     </signer>
 
     <!-- Media key in AOSP -->
     <signer signature="@MEDIA" >
       <seinfo value="media" />
     </signer>
 
+    <!-- Shared dev key in AOSP -->
+    <signer signature="@SHARED" >
+      <seinfo value="base" />
+    </signer>
+
+    <!-- Release dev key in AOSP -->
+    <signer signature="@RELEASE" >
+      <seinfo value="base" />
+    </signer>
+
     <signer signature="@NETWORK_STACK" >
       <seinfo value="network_stack" />
     </signer>
 </policy>
diff --git a/prebuilts/api/32.0/private/seapp_contexts b/prebuilts/api/32.0/private/seapp_contexts
index e11e144b6a5db1e0edb8d52eb78bb41aec17c006..a919d162bd893d97b22b0eb73bf46b779b0bc589 100644
--- a/prebuilts/api/32.0/private/seapp_contexts
+++ b/prebuilts/api/32.0/private/seapp_contexts
@@ -135,40 +135,58 @@ neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
 neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
 isSystemServer=true domain=system_server_startup
 
+user=_app seinfo=base isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
+user=shared_relro seinfo=base domain=shared_relro levelFrom=all
 user=shared_relro domain=shared_relro levelFrom=all
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
+user=_isolated seinfo=base domain=isolated_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
+user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
+user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
+user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/mac_permissions.xml b/private/mac_permissions.xml
index 7fc37c13efd9826040450b0b6bbda69e6bd7374f..6b2d6ad094a96ac80640ed8c631d8c68982c684e 100644
--- a/private/mac_permissions.xml
+++ b/private/mac_permissions.xml
@@ -49,14 +49,24 @@
     <!-- Platform dev key in AOSP -->
     <signer signature="@PLATFORM" >
       <seinfo value="platform" />
     </signer>
 
     <!-- Media key in AOSP -->
     <signer signature="@MEDIA" >
       <seinfo value="media" />
     </signer>
 
+    <!-- Shared dev key in AOSP -->
+    <signer signature="@SHARED" >
+      <seinfo value="base" />
+    </signer>
+
+    <!-- Release dev key in AOSP -->
+    <signer signature="@RELEASE" >
+      <seinfo value="base" />
+    </signer>
+
     <signer signature="@NETWORK_STACK" >
       <seinfo value="network_stack" />
     </signer>
 </policy>
diff --git a/private/seapp_contexts b/private/seapp_contexts
index e11e144b6a5db1e0edb8d52eb78bb41aec17c006..a919d162bd893d97b22b0eb73bf46b779b0bc589 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -135,40 +135,58 @@ neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
 neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
 isSystemServer=true domain=system_server_startup
 
+user=_app seinfo=base isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
+user=shared_relro seinfo=base domain=shared_relro levelFrom=all
 user=shared_relro domain=shared_relro levelFrom=all
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
+user=_isolated seinfo=base domain=isolated_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
+user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
+user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
+user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
+user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user

commit ea9598fd2b3dcdd4925d09dc672cfd284a2c9fa3
Author: Renlord <me@renlord.com>
Date:   Sat 2020-02-22 02:04:41+1100

    split out untrusted base app domains
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/app_neverallows.te      | 19 +++++++-
 .../api/32.0/private/compat/26.0/26.0.ignore.cil   |  4 ++
 .../api/32.0/private/compat/27.0/27.0.ignore.cil   |  4 ++
 .../api/32.0/private/compat/28.0/28.0.ignore.cil   |  4 ++
 .../api/32.0/private/compat/29.0/29.0.ignore.cil   |  4 ++
 .../api/32.0/private/compat/30.0/30.0.ignore.cil   |  4 ++
 .../api/32.0/private/compat/31.0/31.0.ignore.cil   |  4 ++
 prebuilts/api/32.0/private/seapp_contexts          | 10 ++--
 .../api/32.0/private/untrusted_base_app.te (new)   | 16 +++++++
 .../32.0/private/untrusted_base_app_25.te (new)    | 53 +++++++++++++++++++++
 .../32.0/private/untrusted_base_app_27.te (new)    | 41 ++++++++++++++++
 .../32.0/private/untrusted_base_app_29.te (new)    | 19 ++++++++
 prebuilts/api/32.0/public/domain.te                |  4 +-
 .../api/32.0/public/untrusted_base_app.te (new)    | 19 ++++++++
 .../api/32.0/public/untrusted_base_app_25.te (new) | 19 ++++++++
 .../api/32.0/public/untrusted_base_app_27.te (new) | 19 ++++++++
 .../api/32.0/public/untrusted_base_app_29.te (new) | 19 ++++++++
 private/app_neverallows.te                         | 19 +++++++-
 private/compat/26.0/26.0.ignore.cil                |  4 ++
 private/compat/27.0/27.0.ignore.cil                |  4 ++
 private/compat/28.0/28.0.ignore.cil                |  4 ++
 private/compat/29.0/29.0.ignore.cil                |  4 ++
 private/compat/30.0/30.0.ignore.cil                |  4 ++
 private/compat/31.0/31.0.ignore.cil                |  4 ++
 private/seapp_contexts                             | 10 ++--
 private/untrusted_base_app.te (new)                | 16 +++++++
 private/untrusted_base_app_25.te (new)             | 54 ++++++++++++++++++++++
 private/untrusted_base_app_27.te (new)             | 42 +++++++++++++++++
 private/untrusted_base_app_29.te (new)             | 20 ++++++++
 public/domain.te                                   |  4 +-
 public/untrusted_base_app.te (new)                 | 19 ++++++++
 public/untrusted_base_app_25.te (new)              | 19 ++++++++
 public/untrusted_base_app_27.te (new)              | 19 ++++++++
 public/untrusted_base_app_29.te (new)              | 19 ++++++++
 34 files changed, 513 insertions(+), 14 deletions(-)

diff --git a/prebuilts/api/32.0/private/app_neverallows.te b/prebuilts/api/32.0/private/app_neverallows.te
index 82713420ca2e80103c630ee6398afd478ac8b3bd..c8e4a23b0437872da4426a752d26835994e0c966 100644
--- a/prebuilts/api/32.0/private/app_neverallows.te
+++ b/prebuilts/api/32.0/private/app_neverallows.te
@@ -5,20 +5,24 @@
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
+  untrusted_base_app
+  untrusted_base_app_25
+  untrusted_base_app_27
+  untrusted_base_app_29
 }')
 # Receive or send uevent messages.
 neverallow all_untrusted_apps domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
 neverallow all_untrusted_apps domain:netlink_socket *;
 
 # Read or write kernel printk buffer
 neverallow all_untrusted_apps kmsg_device:chr_file no_rw_file_perms;
 
@@ -54,31 +58,35 @@ neverallow { all_untrusted_apps } radio_cdma_ecm_prop:file read;
 neverallow all_untrusted_apps app_exec_data_file:file
   { append create link relabelfrom relabelto rename setattr write };
 
 # Block calling execve() on files in an apps home directory.
 # This is a W^X violation (loading executable code from a writable
 # home directory). For compatibility, allow for targetApi <= 28.
 # b/112357170
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -runas_app
 } { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Do not allow untrusted apps to invoke dex2oat. This was historically required
 # by ART for compiling secondary dex files but has been removed in Q.
 # Exempt legacy apps (targetApi<=28) for compatibility.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } dex2oat_exec:file no_x_file_perms;
 
 # Do not allow untrusted apps to be assigned mlstrustedsubject.
 # This would undermine the per-user isolation model being
 # enforced via levelFrom=user in seapp_contexts and the mls
 # constraints.  As there is no direct way to specify a neverallow
 # on attribute assignment, this relies on the fact that fork
 # permission only makes sense within a domain (hence should
 # never be granted to any other domain within mlstrustedsubject)
 # and an untrusted app is allowed fork permission to itself.
@@ -116,22 +124,25 @@ neverallow all_untrusted_apps *:{
   ax25_socket ipx_socket netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket
   atmsvc_socket rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
   bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket ieee802154_socket caif_socket
   alg_socket nfc_socket vsock_socket kcm_socket qipcrtr_socket smc_socket xdp_socket
 } *;
 
 # Disallow sending RTM_GETLINK messages on netlink sockets.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -untrusted_app_29
+  -untrusted_base_app_29
 } domain:netlink_route_socket { bind nlmsg_readpriv };
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
@@ -219,27 +230,33 @@ neverallow all_untrusted_apps protected_hwservice:hwservice_manager find;
 neverallow all_untrusted_apps protected_service:service_manager find;
 
 # SELinux is not an API for untrusted apps to use
 neverallow all_untrusted_apps selinuxfs:file no_rw_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
-neverallow { all_untrusted_apps -untrusted_app_25 } proc_tty_drivers:file r_file_perms;
+neverallow {
+    all_untrusted_apps
+    -untrusted_app_25
+    -untrusted_base_app_25
+} proc_tty_drivers:file r_file_perms;
 neverallow all_untrusted_apps proc_tty_drivers:file ~r_file_perms;
 
 # Untrusted apps are not allowed to use cgroups.
 neverallow all_untrusted_apps cgroup:file *;
 neverallow all_untrusted_apps cgroup_v2:file *;
 
 # /mnt/sdcard symlink was supposed to have been removed in Gingerbread. Apps
 # must not use it.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } mnt_sdcard_file:lnk_file *;
 
 # Only privileged apps may find the incident service
 neverallow all_untrusted_apps incident_service:service_manager find;
diff --git a/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil b/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil
index 98d5840f6c3543d64574add4396c3b723b74350e..8721e9b736ed0c9f91b6b7732caa57550ba3bf95 100644
--- a/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil
@@ -189,20 +189,24 @@
     traceur_app_tmpfs
     traced
     traced_consumer_socket
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     untrusted_app_all_devpts
     update_engine_log_data_file
     vendor_default_prop
     vendor_security_patch_level_prop
     uri_grants_service
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_init
diff --git a/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil b/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil
index 427f4d4d186944e252f2e127b8d782db41159d54..3a019302728c52a81077d6634be329ebf98ab6ca 100644
--- a/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil
@@ -205,20 +205,24 @@
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
     traceur_app
     traceur_app_tmpfs
     untrusted_app_all_devpts
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     update_engine_log_data_file
     uri_grants_service
     usb_config_prop
     usb_control_prop
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_default_prop
     vendor_init
diff --git a/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil b/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil
index e7ddf48057715e44bb75716d8a58761fe1354dc5..9ab335b0e695eb0eac3a1d041d5da4e0b438f1bc 100644
--- a/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil
@@ -139,20 +139,24 @@
     task_profiles_file
     testharness_service
     test_harness_prop
     theme_prop
     time_prop
     timedetector_service
     timezonedetector_service
     traced_lazy_prop
     uri_grants_service
     use_memfd_prop
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_cgroup_desc_file
     vendor_idc_file
     vendor_keychars_file
     vendor_keylayout_file
     vendor_misc_writer
     vendor_misc_writer_exec
     vendor_socket_hook_prop
     vendor_task_profiles_file
     vndk_prop
diff --git a/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil b/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
index b47eb81b867c9e38093dc21d4d490707c7d85fcc..0d74d4bd38f2f25152f9a4c493e7981732faa5f1 100644
--- a/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
@@ -114,18 +114,22 @@
     timezonedetector_service
     untrusted_app_29
     updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
     vendor_install_recovery_exec
     vendor_service_contexts_file
     vendor_socket_hook_prop
     vendor_socket_hook_prop
     virtual_ab_prop))
diff --git a/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil b/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
index a8d7421a2cb067cff6dcb6db86c7f3627c9e4357..f4dff53212b2abb933424922804affd2e745dd55 100644
--- a/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
@@ -130,20 +130,24 @@
     sysfs_devfreq_dir
     sysfs_devices_cs_etm
     sysfs_dma_heap
     sysfs_dmabuf_stats
     sysfs_uhid
     system_server_dumper_service
     system_suspend_control_internal_service
     task_profiles_api_file
     texttospeech_service
     translation_service
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     update_engine_stable_service
     updater_app
     userdata_sysdev
     userspace_reboot_metadata_file
     uwb_service
     vcn_management_service
     vd_device
     vendor_kernel_modules
     vendor_modprobe
     vibrator_manager_service
diff --git a/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil b/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
index 45e8322ebc8a0249de9d58d7a3df855c8d46ab5b..cce473dc2a86a3d51c11054440be08dd62b363cb 100644
--- a/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
@@ -1,10 +1,14 @@
 ;; new_objects - a collection of types that have been introduced that have no
 ;;   analogue in older policy.  Thus, we do not need to map these types to
 ;;   previous ones.  Add here to pass checkapi tests.
 (type new_objects)
 (typeattribute new_objects)
 (typeattributeset new_objects
   ( new_objects
     hypervisor_prop
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     updater_app
   ))
diff --git a/prebuilts/api/32.0/private/seapp_contexts b/prebuilts/api/32.0/private/seapp_contexts
index a919d162bd893d97b22b0eb73bf46b779b0bc589..b7b668d7c15efda748f1b4367fac7f212fc27db5 100644
--- a/prebuilts/api/32.0/private/seapp_contexts
+++ b/prebuilts/api/32.0/private/seapp_contexts
@@ -169,24 +169,24 @@ user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontrolle
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
-user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_base_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_base_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_base_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_base_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
-user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_base_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/prebuilts/api/32.0/private/untrusted_base_app.te b/prebuilts/api/32.0/private/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..8ee2819f16bd19bb7f418f3281ffbec7d7b71551
--- /dev/null
+++ b/prebuilts/api/32.0/private/untrusted_base_app.te
@@ -0,0 +1,16 @@
+###
+### Untrusted apps.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion >= 30.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app coredomain;
+
+app_domain(untrusted_base_app)
+untrusted_app_domain(untrusted_base_app)
+net_domain(untrusted_base_app)
+bluetooth_domain(untrusted_base_app)
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_25.te b/prebuilts/api/32.0/private/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..4bcaa19eb3432a045ce94b18c6521c894125ee32
--- /dev/null
+++ b/prebuilts/api/32.0/private/untrusted_base_app_25.te
@@ -0,0 +1,53 @@
+###
+### untrusted_base_app_25
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion <= 25.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_25 coredomain;
+
+app_domain(untrusted_base_app_25)
+untrusted_app_domain(untrusted_base_app_25)
+net_domain(untrusted_base_app_25)
+bluetooth_domain(untrusted_base_app_25)
+
+# b/35917228 - /proc/misc access
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_misc:file r_file_perms;
+
+# Access to /proc/tty/drivers, to allow apps to determine if they
+# are running in an emulated environment.
+# b/33214085 b/33814662 b/33791054 b/33211769
+# https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
+# and 28 in untrusted_app_27.te.
+allow untrusted_base_app_25 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_25 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_25 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_27.te b/prebuilts/api/32.0/private/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..4ef4e963cd1b12b546a923d985e0d1c54dc60a74
--- /dev/null
+++ b/prebuilts/api/32.0/private/untrusted_base_app_27.te
@@ -0,0 +1,41 @@
+###
+### Untrusted_27.
+###
+### This file defines the rules for untrusted apps running with
+### 25 < targetSdkVersion <= 28.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_27 coredomain;
+
+app_domain(untrusted_base_app_27)
+untrusted_app_domain(untrusted_base_app_27)
+net_domain(untrusted_base_app_27)
+bluetooth_domain(untrusted_base_app_27)
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi 26, 27, and 28.
+allow untrusted_base_app_27 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_27 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_27 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_29.te b/prebuilts/api/32.0/private/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..a027578017ca22d8789d2b96e1766047e1e6810c
--- /dev/null
+++ b/prebuilts/api/32.0/private/untrusted_base_app_29.te
@@ -0,0 +1,19 @@
+###
+### Untrusted_29.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion = 29.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_29 coredomain;
+
+app_domain(untrusted_base_app_29)
+untrusted_app_domain(untrusted_base_app_29)
+net_domain(untrusted_base_app_29)
+bluetooth_domain(untrusted_base_app_29)
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/public/domain.te b/prebuilts/api/32.0/public/domain.te
index 799a2f1c570b91f1bf724c86f017fcc2f24aaf39..11c6519a132c42c42e6e05b295f7417fc4d686ba 100644
--- a/prebuilts/api/32.0/public/domain.te
+++ b/prebuilts/api/32.0/public/domain.te
@@ -1106,21 +1106,21 @@ neverallow * {
   -asec_public_file
 }:file execmod;
 
 # Do not allow making the stack or heap executable.
 # We would also like to minimize execmem but it seems to be
 # required by some device-specific service domains.
 neverallow * self:process { execstack execheap };
 
 # Do not allow the introduction of new execmod rules. Text relocations
 # and modification of executable pages are unsafe.
-neverallow { domain -untrusted_app_25 -untrusted_app_27 } file_type:file execmod;
+neverallow { domain -untrusted_app_25 -untrusted_base_app_25 -untrusted_app_27 -untrusted_base_app_27 } file_type:file execmod;
 
 neverallow { domain -init } proc:{ file dir } mounton;
 
 # Ensure that all types assigned to processes are included
 # in the domain attribute, so that all allow and neverallow rules
 # written on domain are applied to all processes.
 # This is achieved by ensuring that it is impossible to transition
 # from a domain to a non-domain type and vice versa.
 # TODO - rework this: neverallow domain ~domain:process { transition dyntransition };
 neverallow ~domain domain:process { transition dyntransition };
@@ -1384,17 +1384,19 @@ neverallow {
   -hal_codec2_server
   -hal_omx_server
 } hal_codec2_hwservice:hwservice_manager add;
 
 # Only apps targetting < Q are allowed to open /dev/ashmem directly.
 # Apps must use ASharedMemory NDK API. Native code must use libcutils API.
 neverallow {
   domain
   -ephemeral_app # We don't distinguish ephemeral apps based on target API.
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } ashmem_device:chr_file open;
 
 neverallow { domain -traced_probes -init -vendor_init } debugfs_tracing_printk_formats:file *;
 
 # Linux lockdown "integrity" level is enforced for user builds.
 neverallow { domain userdebug_or_eng(`-domain') } self:lockdown integrity;
diff --git a/prebuilts/api/32.0/public/untrusted_base_app.te b/prebuilts/api/32.0/public/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..39071d9b9f5dc468d2e063c0ce663f35c9c890d6
--- /dev/null
+++ b/prebuilts/api/32.0/public/untrusted_base_app.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app, domain;
diff --git a/prebuilts/api/32.0/public/untrusted_base_app_25.te b/prebuilts/api/32.0/public/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..45763c533f84f2e46bfebd0e5add6a8261f2d3eb
--- /dev/null
+++ b/prebuilts/api/32.0/public/untrusted_base_app_25.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_25, domain;
diff --git a/prebuilts/api/32.0/public/untrusted_base_app_27.te b/prebuilts/api/32.0/public/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..62a8618a6d9e069d03c6d233bc0458f407fc5f98
--- /dev/null
+++ b/prebuilts/api/32.0/public/untrusted_base_app_27.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_27, domain;
diff --git a/prebuilts/api/32.0/public/untrusted_base_app_29.te b/prebuilts/api/32.0/public/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..f6b7aa8ea60c9172cc4bbf55eefcce307d60a398
--- /dev/null
+++ b/prebuilts/api/32.0/public/untrusted_base_app_29.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_29, domain;
diff --git a/private/app_neverallows.te b/private/app_neverallows.te
index 82713420ca2e80103c630ee6398afd478ac8b3bd..c8e4a23b0437872da4426a752d26835994e0c966 100644
--- a/private/app_neverallows.te
+++ b/private/app_neverallows.te
@@ -5,20 +5,24 @@
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
+  untrusted_base_app
+  untrusted_base_app_25
+  untrusted_base_app_27
+  untrusted_base_app_29
 }')
 # Receive or send uevent messages.
 neverallow all_untrusted_apps domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
 neverallow all_untrusted_apps domain:netlink_socket *;
 
 # Read or write kernel printk buffer
 neverallow all_untrusted_apps kmsg_device:chr_file no_rw_file_perms;
 
@@ -54,31 +58,35 @@ neverallow { all_untrusted_apps } radio_cdma_ecm_prop:file read;
 neverallow all_untrusted_apps app_exec_data_file:file
   { append create link relabelfrom relabelto rename setattr write };
 
 # Block calling execve() on files in an apps home directory.
 # This is a W^X violation (loading executable code from a writable
 # home directory). For compatibility, allow for targetApi <= 28.
 # b/112357170
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -runas_app
 } { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Do not allow untrusted apps to invoke dex2oat. This was historically required
 # by ART for compiling secondary dex files but has been removed in Q.
 # Exempt legacy apps (targetApi<=28) for compatibility.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } dex2oat_exec:file no_x_file_perms;
 
 # Do not allow untrusted apps to be assigned mlstrustedsubject.
 # This would undermine the per-user isolation model being
 # enforced via levelFrom=user in seapp_contexts and the mls
 # constraints.  As there is no direct way to specify a neverallow
 # on attribute assignment, this relies on the fact that fork
 # permission only makes sense within a domain (hence should
 # never be granted to any other domain within mlstrustedsubject)
 # and an untrusted app is allowed fork permission to itself.
@@ -116,22 +124,25 @@ neverallow all_untrusted_apps *:{
   ax25_socket ipx_socket netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket
   atmsvc_socket rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
   bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket ieee802154_socket caif_socket
   alg_socket nfc_socket vsock_socket kcm_socket qipcrtr_socket smc_socket xdp_socket
 } *;
 
 # Disallow sending RTM_GETLINK messages on netlink sockets.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
   -untrusted_app_29
+  -untrusted_base_app_29
 } domain:netlink_route_socket { bind nlmsg_readpriv };
 
 # Do not allow untrusted apps access to /cache
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:dir ~{ r_dir_perms };
 neverallow { all_untrusted_apps -mediaprovider } { cache_file cache_recovery_file }:file ~{ read getattr };
 
 # Do not allow untrusted apps to create/unlink files outside of its sandbox,
 # internal storage or sdcard.
 # World accessible data locations allow application to fill the device
 # with unaccounted for data. This data will not get removed during
@@ -219,27 +230,33 @@ neverallow all_untrusted_apps protected_hwservice:hwservice_manager find;
 neverallow all_untrusted_apps protected_service:service_manager find;
 
 # SELinux is not an API for untrusted apps to use
 neverallow all_untrusted_apps selinuxfs:file no_rw_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
-neverallow { all_untrusted_apps -untrusted_app_25 } proc_tty_drivers:file r_file_perms;
+neverallow {
+    all_untrusted_apps
+    -untrusted_app_25
+    -untrusted_base_app_25
+} proc_tty_drivers:file r_file_perms;
 neverallow all_untrusted_apps proc_tty_drivers:file ~r_file_perms;
 
 # Untrusted apps are not allowed to use cgroups.
 neverallow all_untrusted_apps cgroup:file *;
 neverallow all_untrusted_apps cgroup_v2:file *;
 
 # /mnt/sdcard symlink was supposed to have been removed in Gingerbread. Apps
 # must not use it.
 neverallow {
   all_untrusted_apps
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } mnt_sdcard_file:lnk_file *;
 
 # Only privileged apps may find the incident service
 neverallow all_untrusted_apps incident_service:service_manager find;
diff --git a/private/compat/26.0/26.0.ignore.cil b/private/compat/26.0/26.0.ignore.cil
index 98d5840f6c3543d64574add4396c3b723b74350e..8721e9b736ed0c9f91b6b7732caa57550ba3bf95 100644
--- a/private/compat/26.0/26.0.ignore.cil
+++ b/private/compat/26.0/26.0.ignore.cil
@@ -189,20 +189,24 @@
     traceur_app_tmpfs
     traced
     traced_consumer_socket
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     untrusted_app_all_devpts
     update_engine_log_data_file
     vendor_default_prop
     vendor_security_patch_level_prop
     uri_grants_service
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_init
diff --git a/private/compat/27.0/27.0.ignore.cil b/private/compat/27.0/27.0.ignore.cil
index 427f4d4d186944e252f2e127b8d782db41159d54..3a019302728c52a81077d6634be329ebf98ab6ca 100644
--- a/private/compat/27.0/27.0.ignore.cil
+++ b/private/compat/27.0/27.0.ignore.cil
@@ -205,20 +205,24 @@
     traced_enabled_prop
     traced_exec
     traced_probes
     traced_probes_exec
     traced_probes_tmpfs
     traced_producer_socket
     traced_tmpfs
     traceur_app
     traceur_app_tmpfs
     untrusted_app_all_devpts
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     update_engine_log_data_file
     uri_grants_service
     usb_config_prop
     usb_control_prop
     usbd
     usbd_exec
     usbd_tmpfs
     vendor_apex_file
     vendor_default_prop
     vendor_init
diff --git a/private/compat/28.0/28.0.ignore.cil b/private/compat/28.0/28.0.ignore.cil
index e7ddf48057715e44bb75716d8a58761fe1354dc5..9ab335b0e695eb0eac3a1d041d5da4e0b438f1bc 100644
--- a/private/compat/28.0/28.0.ignore.cil
+++ b/private/compat/28.0/28.0.ignore.cil
@@ -139,20 +139,24 @@
     task_profiles_file
     testharness_service
     test_harness_prop
     theme_prop
     time_prop
     timedetector_service
     timezonedetector_service
     traced_lazy_prop
     uri_grants_service
     use_memfd_prop
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_cgroup_desc_file
     vendor_idc_file
     vendor_keychars_file
     vendor_keylayout_file
     vendor_misc_writer
     vendor_misc_writer_exec
     vendor_socket_hook_prop
     vendor_task_profiles_file
     vndk_prop
diff --git a/private/compat/29.0/29.0.ignore.cil b/private/compat/29.0/29.0.ignore.cil
index b47eb81b867c9e38093dc21d4d490707c7d85fcc..0d74d4bd38f2f25152f9a4c493e7981732faa5f1 100644
--- a/private/compat/29.0/29.0.ignore.cil
+++ b/private/compat/29.0/29.0.ignore.cil
@@ -114,18 +114,22 @@
     timezonedetector_service
     untrusted_app_29
     updater_app
     usb_serial_device
     userspace_reboot_config_prop
     userspace_reboot_exported_prop
     userspace_reboot_log_prop
     userspace_reboot_test_prop
     vehicle_hal_prop
     tv_tuner_resource_mgr_service
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     vendor_apex_file
     vendor_boringssl_self_test
     vendor_install_recovery
     vendor_install_recovery_exec
     vendor_service_contexts_file
     vendor_socket_hook_prop
     vendor_socket_hook_prop
     virtual_ab_prop))
diff --git a/private/compat/30.0/30.0.ignore.cil b/private/compat/30.0/30.0.ignore.cil
index a8d7421a2cb067cff6dcb6db86c7f3627c9e4357..f4dff53212b2abb933424922804affd2e745dd55 100644
--- a/private/compat/30.0/30.0.ignore.cil
+++ b/private/compat/30.0/30.0.ignore.cil
@@ -130,20 +130,24 @@
     sysfs_devfreq_dir
     sysfs_devices_cs_etm
     sysfs_dma_heap
     sysfs_dmabuf_stats
     sysfs_uhid
     system_server_dumper_service
     system_suspend_control_internal_service
     task_profiles_api_file
     texttospeech_service
     translation_service
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     update_engine_stable_service
     updater_app
     userdata_sysdev
     userspace_reboot_metadata_file
     uwb_service
     vcn_management_service
     vd_device
     vendor_kernel_modules
     vendor_modprobe
     vibrator_manager_service
diff --git a/private/compat/31.0/31.0.ignore.cil b/private/compat/31.0/31.0.ignore.cil
index 45e8322ebc8a0249de9d58d7a3df855c8d46ab5b..cce473dc2a86a3d51c11054440be08dd62b363cb 100644
--- a/private/compat/31.0/31.0.ignore.cil
+++ b/private/compat/31.0/31.0.ignore.cil
@@ -1,10 +1,14 @@
 ;; new_objects - a collection of types that have been introduced that have no
 ;;   analogue in older policy.  Thus, we do not need to map these types to
 ;;   previous ones.  Add here to pass checkapi tests.
 (type new_objects)
 (typeattribute new_objects)
 (typeattributeset new_objects
   ( new_objects
     hypervisor_prop
+    untrusted_base_app
+    untrusted_base_app_25
+    untrusted_base_app_27
+    untrusted_base_app_29
     updater_app
   ))
diff --git a/private/seapp_contexts b/private/seapp_contexts
index a919d162bd893d97b22b0eb73bf46b779b0bc589..b7b668d7c15efda748f1b4367fac7f212fc27db5 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -169,24 +169,24 @@ user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontrolle
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=media isPrivApp=true name=com.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.providers.media.module domain=mediaprovider_app type=privapp_data_file levelFrom=all
 user=_app seinfo=platform isPrivApp=true name=com.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.vzwomatrigger domain=vzwomatrigger_app type=privapp_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
 user=_app isPrivApp=true name=app.seamlessupdate.client domain=updater_app type=app_data_file levelFrom=user
-user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=30 domain=untrusted_base_app type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=30 domain=untrusted_app type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=29 domain=untrusted_base_app_29 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=29 domain=untrusted_app_29 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
+user=_app seinfo=base minTargetSdkVersion=28 domain=untrusted_base_app_27 type=app_data_file levelFrom=all
 user=_app minTargetSdkVersion=28 domain=untrusted_app_27 type=app_data_file levelFrom=all
-user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
+user=_app seinfo=base minTargetSdkVersion=26 domain=untrusted_base_app_27 type=app_data_file levelFrom=user
 user=_app minTargetSdkVersion=26 domain=untrusted_app_27 type=app_data_file levelFrom=user
-user=_app seinfo=base domain=untrusted_app_25 type=app_data_file levelFrom=user
+user=_app seinfo=base domain=untrusted_base_app_25 type=app_data_file levelFrom=user
 user=_app domain=untrusted_app_25 type=app_data_file levelFrom=user
 user=_app seinfo=base minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app minTargetSdkVersion=28 fromRunAs=true domain=runas_app levelFrom=all
 user=_app seinfo=base fromRunAs=true domain=runas_app levelFrom=user
 user=_app fromRunAs=true domain=runas_app levelFrom=user
diff --git a/private/untrusted_base_app.te b/private/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..8ee2819f16bd19bb7f418f3281ffbec7d7b71551
--- /dev/null
+++ b/private/untrusted_base_app.te
@@ -0,0 +1,16 @@
+###
+### Untrusted apps.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion >= 30.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app coredomain;
+
+app_domain(untrusted_base_app)
+untrusted_app_domain(untrusted_base_app)
+net_domain(untrusted_base_app)
+bluetooth_domain(untrusted_base_app)
diff --git a/private/untrusted_base_app_25.te b/private/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..ef83692eaa06cf0e1a7a716f54349a058b2c304a
--- /dev/null
+++ b/private/untrusted_base_app_25.te
@@ -0,0 +1,54 @@
+###
+### untrusted_base_app_25
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion <= 25.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_25 coredomain;
+
+app_domain(untrusted_base_app_25)
+untrusted_app_domain(untrusted_base_app_25)
+net_domain(untrusted_base_app_25)
+bluetooth_domain(untrusted_base_app_25)
+
+# b/35917228 - /proc/misc access
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_misc:file r_file_perms;
+
+# Access to /proc/tty/drivers, to allow apps to determine if they
+# are running in an emulated environment.
+# b/33214085 b/33814662 b/33791054 b/33211769
+# https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
+# This will go away in a future Android release
+allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
+# and 28 in untrusted_app_27.te.
+allow untrusted_base_app_25 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_25 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_25 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
+auditallow untrusted_base_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/private/untrusted_base_app_27.te b/private/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..273ee2491a2f65d5fd96503ac063116ad76c1bf9
--- /dev/null
+++ b/private/untrusted_base_app_27.te
@@ -0,0 +1,42 @@
+###
+### Untrusted_27.
+###
+### This file defines the rules for untrusted apps running with
+### 25 < targetSdkVersion <= 28.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_27 coredomain;
+
+app_domain(untrusted_base_app_27)
+untrusted_app_domain(untrusted_base_app_27)
+net_domain(untrusted_base_app_27)
+bluetooth_domain(untrusted_base_app_27)
+
+# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
+# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
+allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
+
+# The ability to call exec() on files in the apps home directories
+# for targetApi 26, 27, and 28.
+allow untrusted_base_app_27 app_data_file:file execute_no_trans;
+auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
+
+# The ability to invoke dex2oat. Historically required by ART, now only
+# allowed for targetApi<=28 for compat reasons.
+allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
+userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
+
+# The ability to talk to /dev/ashmem directly. targetApi>=29 must use
+# ASharedMemory instead.
+allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
+auditallow untrusted_base_app_27 ashmem_device:chr_file open;
+
+# Read /mnt/sdcard symlink.
+allow untrusted_base_app_27 mnt_sdcard_file:lnk_file r_file_perms;
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
+auditallow untrusted_base_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/private/untrusted_base_app_29.te b/private/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..11c2f4236e0eacf8fcdefd621196bc5b6a0c6e17
--- /dev/null
+++ b/private/untrusted_base_app_29.te
@@ -0,0 +1,20 @@
+###
+### Untrusted_29.
+###
+### This file defines the rules for untrusted apps running with
+### targetSdkVersion = 29.
+###
+### See public/untrusted_app.te for more information about which apps are
+### placed in this selinux domain.
+###
+
+typeattribute untrusted_base_app_29 coredomain;
+
+app_domain(untrusted_base_app_29)
+untrusted_app_domain(untrusted_base_app_29)
+net_domain(untrusted_base_app_29)
+bluetooth_domain(untrusted_base_app_29)
+
+# allow binding to netlink route sockets and sending RTM_GETLINK messages.
+allow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
+auditallow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/public/domain.te b/public/domain.te
index 799a2f1c570b91f1bf724c86f017fcc2f24aaf39..11c6519a132c42c42e6e05b295f7417fc4d686ba 100644
--- a/public/domain.te
+++ b/public/domain.te
@@ -1106,21 +1106,21 @@ neverallow * {
   -asec_public_file
 }:file execmod;
 
 # Do not allow making the stack or heap executable.
 # We would also like to minimize execmem but it seems to be
 # required by some device-specific service domains.
 neverallow * self:process { execstack execheap };
 
 # Do not allow the introduction of new execmod rules. Text relocations
 # and modification of executable pages are unsafe.
-neverallow { domain -untrusted_app_25 -untrusted_app_27 } file_type:file execmod;
+neverallow { domain -untrusted_app_25 -untrusted_base_app_25 -untrusted_app_27 -untrusted_base_app_27 } file_type:file execmod;
 
 neverallow { domain -init } proc:{ file dir } mounton;
 
 # Ensure that all types assigned to processes are included
 # in the domain attribute, so that all allow and neverallow rules
 # written on domain are applied to all processes.
 # This is achieved by ensuring that it is impossible to transition
 # from a domain to a non-domain type and vice versa.
 # TODO - rework this: neverallow domain ~domain:process { transition dyntransition };
 neverallow ~domain domain:process { transition dyntransition };
@@ -1384,17 +1384,19 @@ neverallow {
   -hal_codec2_server
   -hal_omx_server
 } hal_codec2_hwservice:hwservice_manager add;
 
 # Only apps targetting < Q are allowed to open /dev/ashmem directly.
 # Apps must use ASharedMemory NDK API. Native code must use libcutils API.
 neverallow {
   domain
   -ephemeral_app # We don't distinguish ephemeral apps based on target API.
   -untrusted_app_25
+  -untrusted_base_app_25
   -untrusted_app_27
+  -untrusted_base_app_27
 } ashmem_device:chr_file open;
 
 neverallow { domain -traced_probes -init -vendor_init } debugfs_tracing_printk_formats:file *;
 
 # Linux lockdown "integrity" level is enforced for user builds.
 neverallow { domain userdebug_or_eng(`-domain') } self:lockdown integrity;
diff --git a/public/untrusted_base_app.te b/public/untrusted_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..39071d9b9f5dc468d2e063c0ce663f35c9c890d6
--- /dev/null
+++ b/public/untrusted_base_app.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app, domain;
diff --git a/public/untrusted_base_app_25.te b/public/untrusted_base_app_25.te
new file mode 100644
index 0000000000000000000000000000000000000000..45763c533f84f2e46bfebd0e5add6a8261f2d3eb
--- /dev/null
+++ b/public/untrusted_base_app_25.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_25, domain;
diff --git a/public/untrusted_base_app_27.te b/public/untrusted_base_app_27.te
new file mode 100644
index 0000000000000000000000000000000000000000..62a8618a6d9e069d03c6d233bc0458f407fc5f98
--- /dev/null
+++ b/public/untrusted_base_app_27.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_27, domain;
diff --git a/public/untrusted_base_app_29.te b/public/untrusted_base_app_29.te
new file mode 100644
index 0000000000000000000000000000000000000000..f6b7aa8ea60c9172cc4bbf55eefcce307d60a398
--- /dev/null
+++ b/public/untrusted_base_app_29.te
@@ -0,0 +1,19 @@
+###
+### Untrusted apps.
+###
+### Apps are labeled based on mac_permissions.xml (maps signer and
+### optionally package name to seinfo value) and seapp_contexts (maps UID
+### and optionally seinfo value to domain for process and type for data
+### directory).  The untrusted_app domain is the default assignment in
+### seapp_contexts for any app with UID between APP_AID (10000)
+### and AID_ISOLATED_START (99000) if the app has no specific seinfo
+### value as determined from mac_permissions.xml.  In current AOSP, this
+### domain is assigned to all non-system apps as well as to any system apps
+### that are not signed by the platform key.  To move
+### a system app into a specific domain, add a signer entry for it to
+### mac_permissions.xml and assign it one of the pre-existing seinfo values
+### or define and use a new seinfo value in both mac_permissions.xml and
+### seapp_contexts.
+###
+
+type untrusted_base_app_29, domain;

commit dd40626b5c3dbee1acceefa2647c321a3d2c5333
Author: Renlord <me@renlord.com>
Date:   Sun 2020-02-23 22:41:07+1100

    split base isolated app
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/app_neverallows.te      |   1 +
 prebuilts/api/32.0/private/app_zygote.te           |   4 +-
 .../api/32.0/private/compat/26.0/26.0.ignore.cil   |   1 +
 .../api/32.0/private/compat/27.0/27.0.ignore.cil   |   1 +
 .../api/32.0/private/compat/28.0/28.0.ignore.cil   |   1 +
 .../api/32.0/private/compat/29.0/29.0.ignore.cil   |   1 +
 .../api/32.0/private/compat/30.0/30.0.ignore.cil   |   1 +
 .../api/32.0/private/compat/31.0/31.0.ignore.cil   |   1 +
 .../api/32.0/private/isolated_base_app.te (new)    | 153 +++++++++++++++++++++
 prebuilts/api/32.0/private/seapp_contexts          |   6 +-
 prebuilts/api/32.0/private/technical_debt.cil      |  30 ++--
 .../api/32.0/private/untrusted_base_app_25.te      |   1 +
 .../api/32.0/private/untrusted_base_app_27.te      |   1 +
 .../api/32.0/private/untrusted_base_app_29.te      |   1 +
 prebuilts/api/32.0/private/webview_zygote.te       |   4 +-
 prebuilts/api/32.0/public/app.te                   |  86 ++++++------
 prebuilts/api/32.0/public/domain.te                |   3 +-
 prebuilts/api/32.0/public/hal_camera.te            |   2 +-
 prebuilts/api/32.0/public/hal_drm.te               |   2 +-
 prebuilts/api/32.0/public/hal_omx.te               |   2 +-
 prebuilts/api/32.0/public/hal_sensors.te           |   2 +-
 .../api/32.0/public/isolated_base_app.te (new)     |   9 ++
 private/app_neverallows.te                         |   1 +
 private/app_zygote.te                              |   4 +-
 private/compat/26.0/26.0.ignore.cil                |   1 +
 private/compat/27.0/27.0.ignore.cil                |   1 +
 private/compat/28.0/28.0.ignore.cil                |   1 +
 private/compat/29.0/29.0.ignore.cil                |   1 +
 private/compat/30.0/30.0.ignore.cil                |   1 +
 private/compat/31.0/31.0.ignore.cil                |   1 +
 private/isolated_base_app.te (new)                 | 153 +++++++++++++++++++++
 private/seapp_contexts                             |   6 +-
 private/technical_debt.cil                         |  30 ++--
 private/webview_zygote.te                          |   4 +-
 public/app.te                                      |  86 ++++++------
 public/domain.te                                   |   3 +-
 public/hal_camera.te                               |   2 +-
 public/hal_drm.te                                  |   2 +-
 public/hal_omx.te                                  |   2 +-
 public/hal_sensors.te                              |   2 +-
 public/isolated_base_app.te (new)                  |   9 ++
 41 files changed, 489 insertions(+), 134 deletions(-)

diff --git a/prebuilts/api/32.0/private/app_neverallows.te b/prebuilts/api/32.0/private/app_neverallows.te
index c8e4a23b0437872da4426a752d26835994e0c966..ff18902778bdfae3467927dec74168aa40f6c809 100644
--- a/prebuilts/api/32.0/private/app_neverallows.te
+++ b/prebuilts/api/32.0/private/app_neverallows.te
@@ -1,17 +1,18 @@
 ###
 ### neverallow rules for untrusted app domains
 ###
 
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
+  isolated_base_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
   untrusted_base_app
   untrusted_base_app_25
   untrusted_base_app_27
diff --git a/prebuilts/api/32.0/private/app_zygote.te b/prebuilts/api/32.0/private/app_zygote.te
index 004c10844d8935d67174038f6082a179dded8898..e671a99216698750dd3c1f5f3bc37b82b54fae09 100644
--- a/prebuilts/api/32.0/private/app_zygote.te
+++ b/prebuilts/api/32.0/private/app_zygote.te
@@ -9,34 +9,36 @@ typeattribute app_zygote coredomain;
 tmpfs_domain(app_zygote);
 
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
+allow app_zygote isolated_base_app:process dyntransition;
 
 # For JIT
 allow app_zygote self:process execmem;
 
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
+allow app_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 dontaudit app_zygote mnt_expand_file:dir getattr;
 
 # Get seapp_contexts
 allow app_zygote seapp_contexts_file:file r_file_perms;
 # Check validity of SELinux context before use.
 selinux_check_context(app_zygote)
 # Check SELinux permissions.
 selinux_check_access(app_zygote)
@@ -83,21 +85,21 @@ get_prop(app_zygote, device_config_runtime_native_prop)
 get_prop(app_zygote, device_config_runtime_native_boot_prop)
 
 # Allow app_zygote to access odsign verification status
 get_prop(app_zygote, odsign_prop)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow app_zygote { domain -isolated_app }:process dyntransition;
+neverallow app_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow app_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow app_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # app_zygote child.
diff --git a/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil b/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil
index 8721e9b736ed0c9f91b6b7732caa57550ba3bf95..37f10ab1a30085ba4e30abb7ebf34e73c081a1fa 100644
--- a/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/26.0/26.0.ignore.cil
@@ -98,20 +98,21 @@
     heapprofd
     heapprofd_exec
     heapprofd_socket
     incident_helper
     incident_helper_exec
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     kmsg_debug_device
     last_boot_reason_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     lmkd_config_prop
     looper_stats_service
     lowpan_device
     lowpan_prop
diff --git a/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil b/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil
index 3a019302728c52a81077d6634be329ebf98ab6ca..895472976b99021e78c37a97dfc6f2af25b4dc43 100644
--- a/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/27.0/27.0.ignore.cil
@@ -111,20 +111,21 @@
     heapprofd_socket
     incident_helper
     incident_helper_exec
     init_service_status_private_prop
     init_service_status_prop
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     keyguard_config_prop
     last_boot_reason_prop
     libc_debug_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     lmkd_config_prop
     looper_stats_service
     lowpan_device
diff --git a/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil b/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil
index 9ab335b0e695eb0eac3a1d041d5da4e0b438f1bc..5e6a5ec7e91ac2891ae9906b8e23acde18eccf9b 100644
--- a/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/28.0/28.0.ignore.cil
@@ -89,20 +89,21 @@
     looper_stats_service
     lpdumpd
     lpdumpd_exec
     lpdumpd_prop
     lpdump_service
     iorapd
     iorapd_exec
     iorapd_data_file
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     mediaswcodec
     mediaswcodec_exec
     mediaswcodec_tmpfs
     metadata_bootstat_file
     mnt_product_file
     network_stack
     network_stack_service
     network_stack_tmpfs
     nnapi_ext_deny_product_prop
     overlayfs_file
diff --git a/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil b/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
index 0d74d4bd38f2f25152f9a4c493e7981732faa5f1..25214c7dfc32dad7e58f571f692ba967dd345bb1 100644
--- a/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/29.0/29.0.ignore.cil
@@ -65,20 +65,21 @@
     init_perf_lsm_hooks_prop
     init_svc_debug_prop
     iorap_inode2filename
     iorap_inode2filename_data_file
     iorap_inode2filename_exec
     iorap_inode2filename_tmpfs
     iorap_prefetcherd
     iorap_prefetcherd_data_file
     iorap_prefetcherd_exec
     iorap_prefetcherd_tmpfs
+    isolated_base_app
     mediatranscoding_service
     mediatranscoding
     mediatranscoding_exec
     mediatranscoding_tmpfs
     mirror_data_file
     light_service
     linkerconfig_file
     lmkd_prop
     media_variant_prop
     metadata_bootstat_file
diff --git a/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil b/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
index f4dff53212b2abb933424922804affd2e745dd55..8e46053cf14d4034337e8d48f5fa0d92704b8485 100644
--- a/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/30.0/30.0.ignore.cil
@@ -64,20 +64,21 @@
     hal_keymint_service
     hal_neuralnetworks_service
     hal_power_stats_service
     hal_remotelyprovisionedcomponent_service
     hal_secureclock_service
     hal_sharedsecret_service
     hal_uwb_service
     hal_weaver_service
     hw_timeout_multiplier_prop
     hypervisor_prop
+    isolated_base_app
     keystore_compat_hal_service
     keystore_maintenance_service
     keystore_metrics_service
     keystore2_key_contexts_file
     legacy_permission_service
     legacykeystore_service
     location_time_zone_manager_service
     media_communication_service
     media_metrics_service
     mediatuner_exec
diff --git a/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil b/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
index cce473dc2a86a3d51c11054440be08dd62b363cb..56488bc1af5cf5b0176a7f4ced6058ce75e5b694 100644
--- a/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
+++ b/prebuilts/api/32.0/private/compat/31.0/31.0.ignore.cil
@@ -1,14 +1,15 @@
 ;; new_objects - a collection of types that have been introduced that have no
 ;;   analogue in older policy.  Thus, we do not need to map these types to
 ;;   previous ones.  Add here to pass checkapi tests.
 (type new_objects)
 (typeattribute new_objects)
 (typeattributeset new_objects
   ( new_objects
     hypervisor_prop
+    isolated_base_app
     untrusted_base_app
     untrusted_base_app_25
     untrusted_base_app_27
     untrusted_base_app_29
     updater_app
   ))
diff --git a/prebuilts/api/32.0/private/isolated_base_app.te b/prebuilts/api/32.0/private/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..72db8f620fd3e892e07340ed07f483454c04640b
--- /dev/null
+++ b/prebuilts/api/32.0/private/isolated_base_app.te
@@ -0,0 +1,153 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+typeattribute isolated_base_app coredomain;
+
+app_domain(isolated_base_app)
+
+# Access already open app data files received over Binder or local socket IPC.
+allow isolated_base_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
+
+# Allow access to network sockets received over IPC. New socket creation is not
+# permitted.
+allow isolated_base_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
+
+allow isolated_base_app activity_service:service_manager find;
+allow isolated_base_app display_service:service_manager find;
+allow isolated_base_app webviewupdate_service:service_manager find;
+
+# Google Breakpad (crash reporter for Chrome) relies on ptrace
+# functionality. Without the ability to ptrace, the crash reporter
+# tool is broken.
+# b/20150694
+# https://code.google.com/p/chromium/issues/detail?id=475270
+allow isolated_base_app self:process ptrace;
+
+# b/32896414: Allow accessing sdcard file descriptors passed to isolated_base_apps
+# by other processes. Open should never be allowed, and is blocked by
+# neverallow rules below.
+# media_rw_data_file is included for sdcardfs, and can be removed if sdcardfs
+# is modified to change the secontext when accessing the lower filesystem.
+allow isolated_base_app { sdcard_type media_rw_data_file }:file { read write append getattr lock map };
+
+# For webviews, isolated_base_app processes can be forked from the webview_zygote
+# in addition to the zygote. Allow access to resources inherited from the
+# webview_zygote process. These rules are specialized copies of the ones in app.te.
+# Inherit FDs from the webview_zygote.
+allow isolated_base_app webview_zygote:fd use;
+# Notify webview_zygote of child death.
+allow isolated_base_app webview_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app webview_zygote:unix_dgram_socket write;
+# Read system properties managed by webview_zygote.
+allow isolated_base_app webview_zygote_tmpfs:file read;
+
+# Inherit FDs from the app_zygote.
+allow isolated_base_app app_zygote:fd use;
+# Notify app_zygote of child death.
+allow isolated_base_app app_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app app_zygote:unix_dgram_socket write;
+
+# TODO (b/63631799) fix this access
+# suppress denials to /data/local/tmp
+dontaudit isolated_base_app shell_data_file:dir search;
+
+# Write app-specific trace data to the Perfetto traced damon. This requires
+# connecting to its producer socket and obtaining a (per-process) tmpfs fd.
+perfetto_producer(isolated_base_app)
+
+# Allow profiling if the main app has been marked as profileable or
+# debuggable.
+can_profile_heap(isolated_base_app)
+can_profile_perf(isolated_base_app)
+
+#####
+##### Neverallow
+#####
+
+# Isolated apps should not directly open app data files themselves.
+neverallow isolated_base_app { app_data_file privapp_data_file }:file open;
+
+# Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
+# TODO: are there situations where isolated_base_apps write to this file?
+# TODO: should we tighten these restrictions further?
+neverallow isolated_base_app anr_data_file:file ~{ open append };
+neverallow isolated_base_app anr_data_file:dir ~search;
+
+# Isolated apps must not be permitted to use HwBinder
+neverallow isolated_base_app hwbinder_device:chr_file *;
+neverallow isolated_base_app *:hwservice_manager *;
+
+# Isolated apps must not be permitted to use VndBinder
+neverallow isolated_base_app vndbinder_device:chr_file *;
+
+# Isolated apps must not be permitted to perform actions on Binder and VndBinder service_manager
+# except the find actions for services whitelisted below.
+neverallow isolated_base_app *:service_manager ~find;
+
+# b/17487348
+# Isolated apps can only access three services,
+# activity_service, display_service, webviewupdate_service.
+neverallow isolated_base_app {
+    service_manager_type
+    -activity_service
+    -display_service
+    -webviewupdate_service
+}:service_manager find;
+
+# Isolated apps shouldn't be able to access the driver directly.
+neverallow isolated_base_app gpu_device:chr_file { rw_file_perms execute };
+
+# Do not allow isolated_base_app access to /cache
+neverallow isolated_base_app cache_file:dir ~{ r_dir_perms };
+neverallow isolated_base_app cache_file:file ~{ read getattr };
+
+# Do not allow isolated_base_app to access external storage, except for files passed
+# via file descriptors (b/32896414).
+neverallow isolated_base_app { storage_file mnt_user_file sdcard_type }:dir ~getattr;
+neverallow isolated_base_app { storage_file mnt_user_file }:file_class_set *;
+neverallow isolated_base_app sdcard_type:{ devfile_class_set lnk_file sock_file fifo_file } *;
+neverallow isolated_base_app sdcard_type:file ~{ read write append getattr lock map };
+
+# Do not allow USB access
+neverallow isolated_base_app { usb_device usbaccessory_device }:chr_file *;
+
+# Restrict the webview_zygote control socket.
+neverallow isolated_base_app webview_zygote:sock_file write;
+
+# Limit the /sys files which isolated_base_app can access. This is important
+# for controlling isolated_base_app attack surface.
+neverallow isolated_base_app {
+  sysfs_type
+  -sysfs_devices_system_cpu
+  -sysfs_transparent_hugepage
+  -sysfs_usb # TODO: check with audio team if needed for isolated_base_app (b/28417852)
+  -sysfs_fs_incfs_features
+}:file no_rw_file_perms;
+
+# No creation of sockets families other than AF_UNIX sockets.
+# List taken from system/sepolicy/public/global_macros - socket_class_set
+# excluding unix_stream_socket and unix_dgram_socket.
+# Many of these are socket families which have never and will never
+# be compiled into the Android kernel.
+neverallow isolated_base_app { self ephemeral_app priv_app untrusted_app_all }:{
+  socket tcp_socket udp_socket rawip_socket netlink_socket packet_socket
+  key_socket appletalk_socket netlink_route_socket
+  netlink_tcpdiag_socket netlink_nflog_socket netlink_xfrm_socket
+  netlink_selinux_socket netlink_audit_socket netlink_dnrt_socket
+  netlink_kobject_uevent_socket tun_socket netlink_iscsi_socket
+  netlink_fib_lookup_socket netlink_connector_socket netlink_netfilter_socket
+  netlink_generic_socket netlink_scsitransport_socket netlink_rdma_socket
+  netlink_crypto_socket sctp_socket icmp_socket ax25_socket ipx_socket
+  netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket atmsvc_socket
+  rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
+  bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket
+  ieee802154_socket caif_socket alg_socket nfc_socket vsock_socket kcm_socket
+  qipcrtr_socket smc_socket xdp_socket
+} create;
diff --git a/prebuilts/api/32.0/private/seapp_contexts b/prebuilts/api/32.0/private/seapp_contexts
index b7b668d7c15efda748f1b4367fac7f212fc27db5..3982c1e8543f594f7a09791ff11051de9e60151e 100644
--- a/prebuilts/api/32.0/private/seapp_contexts
+++ b/prebuilts/api/32.0/private/seapp_contexts
@@ -119,22 +119,22 @@ neverallow user=((?!system).)* type=system_app_data_file
 neverallow user=_app isPrivApp=false name=.* seinfo=""
 neverallow user=_app isPrivApp=false name=.* seinfo=default
 
 # neverallow shared relro to any other domain
 # and neverallow any other uid into shared_relro
 neverallow user=shared_relro domain=((?!shared_relro).)*
 neverallow user=((?!shared_relro).)* domain=shared_relro
 
 # neverallow non-isolated uids into isolated_app domain
 # and vice versa
-neverallow user=_isolated domain=((?!isolated_app).)*
-neverallow user=((?!_isolated).)* domain=isolated_app
+neverallow user=_isolated domain=((?!isolated_(base_)?app).)*
+neverallow user=((?!_isolated).)* domain=isolated_base_app
 
 # uid shell should always be in shell domain, however non-shell
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
@@ -149,21 +149,21 @@ user=_app isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_a
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
 user=shared_relro seinfo=base domain=shared_relro levelFrom=all
 user=shared_relro domain=shared_relro levelFrom=all
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
-user=_isolated seinfo=base domain=isolated_app levelFrom=user
+user=_isolated seinfo=base domain=isolated_base_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
diff --git a/prebuilts/api/32.0/private/technical_debt.cil b/prebuilts/api/32.0/private/technical_debt.cil
index 9b3e3c6adfdba9da482bb87568efdc72141fb876..f2acabe6471fcb7f2aee21335dbc166dc27684f4 100644
--- a/prebuilts/api/32.0/private/technical_debt.cil
+++ b/prebuilts/api/32.0/private/technical_debt.cil
@@ -1,71 +1,71 @@
 ; THIS IS A WORKAROUND for the current limitations of the module policy language
 ; This should be used sparingly until we figure out a saner way to achieve the
 ; stuff below, for example, by improving typeattribute statement of module
 ; language.
 ;
 ; NOTE: This file has no effect on recovery policy.
 
 ; Apps, except isolated apps, are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_allocator_client;
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_allocator_client;
 ;     typeattribute hal_allocator_client halclientdomain;
-(typeattributeset hal_allocator_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 (typeattributeset halclientdomain (hal_allocator_client))
 
 ; Apps, except isolated apps, are clients of OMX-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_omx_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_omx_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Codec2-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_codec2_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_codec2_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Drm-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_drm_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_drm_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Configstore HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_configstore_client;
-(typeattributeset hal_configstore_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_configstore_client;
+(typeattributeset hal_configstore_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Graphics Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_graphics_allocator_client;
-(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_graphics_allocator_client;
+(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Cas HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_cas_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_cas_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Domains hosting Camera HAL implementations are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute hal_camera hal_allocator_client;
 (typeattributeset hal_allocator_client (hal_camera))
 
 ; Apps, except isolated apps, are clients of Neuralnetworks HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_neuralnetworks_client;
-(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_neuralnetworks_client;
+(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; TODO(b/112056006): move these to mapping files when/if we implement 'versioned' attributes.
 ; Rename untrusted_app_visible_* to untrusted_app_visible_*_violators.
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute untrusted_app_visible_hwservice untrusted_app_visible_hwservice_violators;
 ;     typeattribute untrusted_app_visible_halserver untrusted_app_visible_halserver_violators;
 (typeattribute untrusted_app_visible_hwservice)
 (typeattributeset untrusted_app_visible_hwservice_violators (untrusted_app_visible_hwservice))
 (typeattribute untrusted_app_visible_halserver)
 (typeattributeset untrusted_app_visible_halserver_violators (untrusted_app_visible_halserver))
 
 ; Apps, except isolated apps, are clients of BufferHub HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Properties having both system_property_type and vendor_property_type are illegal
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute { system_property_type && vendor_property_type } system_and_vendor_property_type;
 (typeattribute system_and_vendor_property_type)
 (typeattributeset system_and_vendor_property_type ((and (system_property_type) (vendor_property_type))))
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_25.te b/prebuilts/api/32.0/private/untrusted_base_app_25.te
index 4bcaa19eb3432a045ce94b18c6521c894125ee32..ef83692eaa06cf0e1a7a716f54349a058b2c304a 100644
--- a/prebuilts/api/32.0/private/untrusted_base_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_base_app_25.te
@@ -44,10 +44,11 @@ userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_per
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_25 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_base_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_base_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
+auditallow untrusted_base_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_27.te b/prebuilts/api/32.0/private/untrusted_base_app_27.te
index 4ef4e963cd1b12b546a923d985e0d1c54dc60a74..273ee2491a2f65d5fd96503ac063116ad76c1bf9 100644
--- a/prebuilts/api/32.0/private/untrusted_base_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_base_app_27.te
@@ -32,10 +32,11 @@ userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_per
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_27 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_base_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_base_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
+auditallow untrusted_base_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_29.te b/prebuilts/api/32.0/private/untrusted_base_app_29.te
index a027578017ca22d8789d2b96e1766047e1e6810c..11c2f4236e0eacf8fcdefd621196bc5b6a0c6e17 100644
--- a/prebuilts/api/32.0/private/untrusted_base_app_29.te
+++ b/prebuilts/api/32.0/private/untrusted_base_app_29.te
@@ -10,10 +10,11 @@
 
 typeattribute untrusted_base_app_29 coredomain;
 
 app_domain(untrusted_base_app_29)
 untrusted_app_domain(untrusted_base_app_29)
 net_domain(untrusted_base_app_29)
 bluetooth_domain(untrusted_base_app_29)
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
+auditallow untrusted_base_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/private/webview_zygote.te b/prebuilts/api/32.0/private/webview_zygote.te
index 3473ecaee77923e5080c2b4e8b176b97fcf4ce31..7dcfb5385c84c40e9047f28938963ad9ef8c43e9 100644
--- a/prebuilts/api/32.0/private/webview_zygote.te
+++ b/prebuilts/api/32.0/private/webview_zygote.te
@@ -21,40 +21,42 @@ allow webview_zygote apk_data_file:file { r_file_perms execute };
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
+allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:file { r_file_perms execute };
 allow webview_zygote apex_module_data_file:dir search;
 
 # Allow webview_zygote to create JIT memory.
 allow webview_zygote self:process execmem;
 
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
+allow webview_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 # Suppress denials to storage. Webview zygote should not be accessing.
 dontaudit webview_zygote mnt_expand_file:dir getattr;
 
 # TODO (b/72957399) remove this when webview_zygote is reparented to
 # app_process zygote
 dontaudit webview_zygote dex2oat_exec:file execute;
 
 # Get seapp_contexts
@@ -88,21 +90,21 @@ get_prop(webview_zygote, device_config_runtime_native_prop)
 get_prop(webview_zygote, device_config_runtime_native_boot_prop)
 
 # Allow webview_zygote to access odsign verification status
 get_prop(zygote, odsign_prop)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow webview_zygote { domain -isolated_app }:process dyntransition;
+neverallow webview_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow webview_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow webview_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # webview_zygote child.
diff --git a/prebuilts/api/32.0/public/app.te b/prebuilts/api/32.0/public/app.te
index 8dd14179257e92b396bb32b333edf88a468aaba2..561ddba08d4e0e79106581285fe1733ed563d025 100644
--- a/prebuilts/api/32.0/public/app.te
+++ b/prebuilts/api/32.0/public/app.te
@@ -26,22 +26,22 @@ allow appdomain app_zygote:fd use;
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;
 
 # Read /data/dalvik-cache.
 allow appdomain dalvikcache_data_file:dir { search getattr };
 allow appdomain dalvikcache_data_file:file r_file_perms;
 
 # Read the /sdcard and /mnt/sdcard symlinks
-allow { appdomain -isolated_app } rootfs:lnk_file r_file_perms;
-allow { appdomain -isolated_app } tmpfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } rootfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } tmpfs:lnk_file r_file_perms;
 
 # Search /storage/emulated tmpfs mount.
 allow appdomain tmpfs:dir r_dir_perms;
 
 # Notify zygote of the wrapped process PID when using --invoke-with.
 allow appdomain zygote:fifo_file write;
 
 userdebug_or_eng(`
   # Allow apps to create and write method traces in /data/misc/trace.
   allow appdomain method_trace_data_file:dir w_dir_perms;
@@ -64,36 +64,36 @@ allow appdomain system_server:tcp_socket { read write getattr getopt shutdown };
 # For AppFuse.
 allow appdomain vold:fd use;
 
 # Communication with other apps via fifos
 allow appdomain appdomain:fifo_file rw_file_perms;
 
 # Communicate with surfaceflinger.
 allow appdomain surfaceflinger:unix_stream_socket { read write setopt getattr getopt shutdown };
 
 # App sandbox file accesses.
-allow { appdomain -isolated_app -mlstrustedsubject } { app_data_file privapp_data_file }:dir create_dir_perms;
-allow { appdomain -isolated_app -mlstrustedsubject } { app_data_file privapp_data_file }:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -mlstrustedsubject } { app_data_file privapp_data_file }:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -mlstrustedsubject } { app_data_file privapp_data_file }:file create_file_perms;
 
 # Access via already open fds is ok even for mlstrustedsubject.
-allow { appdomain -isolated_app } { app_data_file privapp_data_file system_app_data_file }:file { getattr map read write };
+allow { appdomain -isolated_app -isolated_base_app } { app_data_file privapp_data_file system_app_data_file }:file { getattr map read write };
 
 # Traverse into expanded storage
 allow appdomain mnt_expand_file:dir r_dir_perms;
 
 # Keychain and user-trusted credentials
 r_dir_file(appdomain, keychain_data_file)
 allow appdomain misc_user_data_file:dir r_dir_perms;
 allow appdomain misc_user_data_file:file r_file_perms;
 
 # TextClassifier
-r_dir_file({ appdomain -isolated_app }, textclassifier_data_file)
+r_dir_file({ appdomain -isolated_app -isolated_base_app }, textclassifier_data_file)
 
 # Access to OEM provided data and apps
 allow appdomain oemfs:dir r_dir_perms;
 allow appdomain oemfs:file rx_file_perms;
 
 # Execute the shell or other system executables.
 allow { appdomain -ephemeral_app } shell_exec:file rx_file_perms;
 allow { appdomain -ephemeral_app } toolbox_exec:file rx_file_perms;
 allow appdomain system_file:file x_file_perms;
 not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perms;')
@@ -102,21 +102,21 @@ not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perm
 allow appdomain system_file:dir r_dir_perms;
 allow appdomain system_file:lnk_file { getattr open read };
 # Renderscript specific permissions to open /system/vendor/lib64.
 not_full_treble(`
     allow appdomain vendor_file_type:dir r_dir_perms;
     allow appdomain vendor_file_type:lnk_file { getattr open read };
 ')
 
 full_treble_only(`
     # For looking up Renderscript vendor drivers
-    allow { appdomain -isolated_app } vendor_file:dir { open read };
+    allow { appdomain -isolated_app -isolated_base_app } vendor_file:dir { open read };
 ')
 
 # Allow apps access to /vendor/app except for privileged
 # apps which cannot be in /vendor.
 r_dir_file({ appdomain -ephemeral_app }, vendor_app_file)
 allow { appdomain -ephemeral_app } vendor_app_file:file execute;
 
 # Allow apps access to /vendor/overlay
 r_dir_file(appdomain, vendor_overlay_file)
 
@@ -188,102 +188,104 @@ userdebug_or_eng(`
 ')
 
 # /proc/net access.
 # TODO(b/9496886) Audit access for removal.
 # proc_net access for the negated domains below is granted (or not) in their
 # individual .te files.
 r_dir_file({
   appdomain
   -ephemeral_app
   -isolated_app
+  -isolated_base_app
   -platform_app
   -priv_app
   -shell
   -system_app
   -untrusted_app_all
 }, proc_net_type)
 # audit access for all these non-core app domains.
 userdebug_or_eng(`
   auditallow {
     appdomain
     -ephemeral_app
     -isolated_app
+    -isolated_base_app
     -platform_app
     -priv_app
     -shell
     -su
     -system_app
     -untrusted_app_all
   } proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 # Grant GPU access to all processes started by Zygote.
 # They need that to render the standard UI.
-allow { appdomain -isolated_app } gpu_device:chr_file rw_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } gpu_device:chr_file rw_file_perms;
 
 # Use the Binder.
 binder_use(appdomain)
 # Perform binder IPC to binder services.
 binder_call(appdomain, binderservicedomain)
 # Perform binder IPC to other apps.
 binder_call(appdomain, appdomain)
 # Perform binder IPC to ephemeral apps.
 binder_call(appdomain, ephemeral_app)
 # Perform binder IPC to gpuservice.
-binder_call({ appdomain -isolated_app }, gpuservice)
+binder_call({ appdomain -isolated_app -isolated_base_app }, gpuservice)
 
 # Talk with graphics composer fences
 allow appdomain hal_graphics_composer:fd use;
 
 # Already connected, unnamed sockets being passed over some other IPC
 # hence no sock_file or connectto permission. This appears to be how
 # Chrome works, may need to be updated as more apps using isolated services
 # are examined.
 allow appdomain appdomain:unix_stream_socket { getopt getattr read write shutdown };
 
 # Backup ability for every app. BMS opens and passes the fd
 # to any app that has backup ability. Hence, no open permissions here.
 allow appdomain backup_data_file:file { read write getattr map };
 allow appdomain cache_backup_file:file { read write getattr map };
 allow appdomain cache_backup_file:dir getattr;
 # Backup ability using 'adb backup'
 allow appdomain system_data_file:lnk_file r_file_perms;
 allow appdomain system_data_file:file { getattr read map };
 
 # Allow read/stat of /data/media files passed by Binder or local socket IPC.
-allow { appdomain -isolated_app } media_rw_data_file:file { read getattr };
+allow { appdomain -isolated_app -isolated_base_app } media_rw_data_file:file { read getattr };
 
 # Read and write /data/data/com.android.providers.telephony files passed over Binder.
-allow { appdomain -isolated_app } radio_data_file:file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app } radio_data_file:file { read write getattr };
 
 # Allow access to external storage; we have several visible mount points under /storage
 # and symlinks to primary storage at places like /storage/sdcard0 and /mnt/user/0/primary
-allow { appdomain -isolated_app -ephemeral_app } storage_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } storage_file:lnk_file r_file_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
 
 # Read/write visible storage
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:file create_file_perms;
 # This should be removed if sdcardfs is modified to alter the secontext for its
 # accesses to the underlying FS.
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:file create_file_perms;
 
 # Allow apps to use the USB Accessory interface.
 # http://developer.android.com/guide/topics/connectivity/usb/accessory.html
 #
 # USB devices are first opened by the system server (USBDeviceManagerService)
 # and the file descriptor is passed to the right Activity via binder.
-allow { appdomain -isolated_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
-allow { appdomain -isolated_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
 
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
@@ -293,79 +295,79 @@ allow appdomain apk_data_file:file rx_file_perms;
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
 
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore2_key { delete use get_info rebind update };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore2_key { delete use get_info rebind update };
 
-allow { appdomain -isolated_app -ephemeral_app } keystore_maintenance_service:service_manager find;
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore2 get_state;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore_maintenance_service:service_manager find;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore2 get_state;
 
-use_keystore({ appdomain -isolated_app -ephemeral_app })
+use_keystore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
-use_credstore({ appdomain -isolated_app -ephemeral_app })
+use_credstore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
 allow appdomain console_device:chr_file { read write };
 
 # only allow unprivileged socket ioctl commands
 allowxperm { appdomain -bluetooth } self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
-allow { appdomain -isolated_app } ion_device:chr_file r_file_perms;
-allow { appdomain -isolated_app } dmabuf_system_heap_device:chr_file r_file_perms;
-allow { appdomain -isolated_app } dmabuf_system_secure_heap_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } ion_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } dmabuf_system_heap_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } dmabuf_system_secure_heap_device:chr_file r_file_perms;
 
 # Allow AAudio apps to use shared memory file descriptors from the HAL
-allow { appdomain -isolated_app } hal_audio:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_audio:fd use;
 
 # Allow app to access shared memory created by camera HAL1
-allow { appdomain -isolated_app } hal_camera:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_camera:fd use;
 
 # Allow apps to access shared memory file descriptor from the tuner HAL
-allow {appdomain -isolated_app} hal_tv_tuner_server:fd use;
+allow {appdomain -isolated_app  -isolated_base_app } hal_tv_tuner_server:fd use;
 
 # RenderScript always-passthrough HAL
-allow { appdomain -isolated_app } hal_renderscript_hwservice:hwservice_manager find;
+allow { appdomain -isolated_app -isolated_base_app } hal_renderscript_hwservice:hwservice_manager find;
 allow appdomain same_process_hal_file:file { execute read open getattr map };
 
 # TODO: switch to meminfo service
 allow appdomain proc_meminfo:file r_file_perms;
 
 # For app fuse.
 allow appdomain app_fuse_file:file { getattr read append write map };
 
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_client)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_manager)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_vsync)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, performance_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_manager)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_vsync)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, performance_client)
 # Apps do not directly open the IPC socket for bufferhubd.
-pdx_use({ appdomain -isolated_app -ephemeral_app }, bufferhub_client)
+pdx_use({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, bufferhub_client)
 
 ###
 ### CTS-specific rules
 ###
 
 # For cts/tests/tests/permission/src/android/permission/cts/FileSystemPermissionTest.java.
 # testRunAsHasCorrectCapabilities
 allow appdomain runas_exec:file getattr;
 # Others are either allowed elsewhere or not desired.
 
 # Apps receive an open tun fd from the framework for
 # device traffic. Do not allow untrusted app to directly open tun_device
-allow { appdomain -isolated_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
-allowxperm { appdomain -isolated_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
+allowxperm { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
 
 # Connect to adbd and use a socket transferred from it.
 # This is used for e.g. adb backup/restore.
 allow appdomain adbd:unix_stream_socket connectto;
 allow appdomain adbd:fd use;
 allow appdomain adbd:unix_stream_socket { getattr getopt ioctl read write shutdown };
 
 allow appdomain cache_file:dir getattr;
 
 # Allow apps to run with asanwrapper.
@@ -396,21 +398,21 @@ neverallow appdomain dev_type:blk_file { read write };
 neverallow appdomain {
     audio_device
     camera_device
     dm_device
     radio_device
     rpmsg_device
     video_device
 }:chr_file { read write };
 
 # Note: Try expanding list of app domains in the future.
-neverallow { untrusted_app isolated_app shell } graphics_device:chr_file { read write };
+neverallow { untrusted_app isolated_app isolated_base_app shell } graphics_device:chr_file { read write };
 
 neverallow { appdomain -nfc } nfc_device:chr_file
     { read write };
 neverallow { appdomain -bluetooth } hci_attach_dev:chr_file
     { read write };
 neverallow appdomain tee_device:chr_file { read write };
 
 # Privileged netlink socket interfaces.
 neverallow { appdomain -network_stack }
     domain:{
diff --git a/prebuilts/api/32.0/public/domain.te b/prebuilts/api/32.0/public/domain.te
index 11c6519a132c42c42e6e05b295f7417fc4d686ba..cf834515fc8299cbd97fff90ac409b2649a20768 100644
--- a/prebuilts/api/32.0/public/domain.te
+++ b/prebuilts/api/32.0/public/domain.te
@@ -82,21 +82,21 @@ allow domain ashmem_libcutils_device:chr_file rw_file_perms;
 allow { domain -hwservicemanager -vndservicemanager } binder_device:chr_file rw_file_perms;
 
 # Restrict binder ioctls to an allowlist. Additional ioctl commands may be
 # added to individual domains, but this sets safe defaults for all processes.
 allowxperm domain binder_device:chr_file ioctl { unpriv_binder_ioctls };
 
 # /dev/binderfs needs to be accessed by everyone too!
 allow domain binderfs:dir { getattr search };
 allow domain binderfs_logs_proc:dir search;
 
-allow { domain -servicemanager -vndservicemanager -isolated_app } hwbinder_device:chr_file rw_file_perms;
+allow { domain -servicemanager -vndservicemanager -isolated_app -isolated_base_app } hwbinder_device:chr_file rw_file_perms;
 allow domain ptmx_device:chr_file rw_file_perms;
 allow domain random_device:chr_file rw_file_perms;
 allow domain proc_random:dir r_dir_perms;
 allow domain proc_random:file r_file_perms;
 allow domain properties_device:dir { search getattr };
 allow domain properties_serial:file r_file_perms;
 allow domain property_info:file r_file_perms;
 
 # Public readable properties
 get_prop(domain, aaudio_config_prop)
@@ -1153,20 +1153,21 @@ neverallow {
   -appdomain # finer-grained rules for appdomain are listed below
   -system_server #populate com.android.providers.settings/databases/settings.db.
   -installd # creation of app sandbox
   -iorap_inode2filename
   -traced_probes # resolve inodes for i/o tracing.
                  # only needs open and read, the rest is neverallow in
                  # traced_probes.te.
 } system_app_data_file:dir_file_class_set { create unlink open };
 neverallow {
   isolated_app
+  isolated_base_app
   untrusted_app_all # finer-grained rules for appdomain are listed below
   ephemeral_app
   priv_app
 } system_app_data_file:dir_file_class_set { create unlink open };
 
 #
 # Only these domains should transition to shell domain. This domain is
 # permissible for the "shell user". If you need a process to exec a shell
 # script with differing privilege, define a domain and set up a transition.
 #
diff --git a/prebuilts/api/32.0/public/hal_camera.te b/prebuilts/api/32.0/public/hal_camera.te
index 45fad56e7949d8b811ef1b6e0c6205979eb1385c..afa32661025c5afae165b16f0f503326cb4c6089 100644
--- a/prebuilts/api/32.0/public/hal_camera.te
+++ b/prebuilts/api/32.0/public/hal_camera.te
@@ -8,21 +8,21 @@ allow hal_camera device:dir r_dir_perms;
 allow hal_camera video_device:dir r_dir_perms;
 allow hal_camera video_device:chr_file rw_file_perms;
 allow hal_camera camera_device:chr_file rw_file_perms;
 allow hal_camera ion_device:chr_file rw_file_perms;
 allow hal_camera dmabuf_system_heap_device:chr_file r_file_perms;
 
 # Both the client and the server need to use the graphics allocator
 allow { hal_camera_client hal_camera_server } hal_graphics_allocator:fd use;
 
 # Allow hal_camera to use fd from app,gralloc,and ashmem HAL
-allow hal_camera { appdomain -isolated_app }:fd use;
+allow hal_camera { appdomain -isolated_app -isolated_base_app }:fd use;
 allow hal_camera surfaceflinger:fd use;
 allow hal_camera hal_allocator_server:fd use;
 
 # Needed to provide debug dump output via dumpsys' pipes.
 allow hal_camera shell:fd use;
 allow hal_camera shell:fifo_file write;
 
 ###
 ### neverallow rules
 ###
diff --git a/prebuilts/api/32.0/public/hal_drm.te b/prebuilts/api/32.0/public/hal_drm.te
index bb1bd91e67c6aeebdc9c62d565f27f89c83a6273..b7363db07e55629115e72b8731ffb7b0c227abfe 100644
--- a/prebuilts/api/32.0/public/hal_drm.te
+++ b/prebuilts/api/32.0/public/hal_drm.te
@@ -31,21 +31,21 @@ allow hal_drm hal_graphics_allocator:fd use;
 # Allow access to hidl_memory allocation service
 allow hal_drm hal_allocator_server:fd use;
 
 # Allow access to fds allocated by mediaserver
 allow hal_drm mediaserver:fd use;
 
 allow hal_drm sysfs:file r_file_perms;
 
 allow hal_drm tee_device:chr_file rw_file_perms;
 
-allow hal_drm_server { appdomain -isolated_app }:fd use;
+allow hal_drm_server { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # only allow unprivileged socket ioctl commands
 allowxperm hal_drm self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
 ###
 ### neverallow rules
 ###
 
 # hal_drm should never execute any executable without a
diff --git a/prebuilts/api/32.0/public/hal_omx.te b/prebuilts/api/32.0/public/hal_omx.te
index 8e74383d31b59239c297fb4bbf31c07a93cf4ea3..b4940f30b0daffcd6094d6eb73ac91c0953271c4 100644
--- a/prebuilts/api/32.0/public/hal_omx.te
+++ b/prebuilts/api/32.0/public/hal_omx.te
@@ -1,15 +1,15 @@
 # applies all permissions to hal_omx NOT hal_omx_server
 # since OMX must always be in its own process.
 
 binder_call(hal_omx_server, binderservicedomain)
-binder_call(hal_omx_server, { appdomain -isolated_app })
+binder_call(hal_omx_server, { appdomain -isolated_app -isolated_base_app })
 
 # Allow hal_omx_server access to composer sync fences
 allow hal_omx_server hal_graphics_composer:fd use;
 
 allow hal_omx_server ion_device:chr_file rw_file_perms;
 allow hal_omx_server hal_camera:fd use;
 
 crash_dump_fallback(hal_omx_server)
 
 # Recieve gralloc buffer FDs from bufferhubd. Note that hal_omx_server never
diff --git a/prebuilts/api/32.0/public/hal_sensors.te b/prebuilts/api/32.0/public/hal_sensors.te
index 06e76f1e17e171b969f97e94461944d6c1d09892..0405b6eab322037f70965156f083dfc038c44c8d 100644
--- a/prebuilts/api/32.0/public/hal_sensors.te
+++ b/prebuilts/api/32.0/public/hal_sensors.te
@@ -1,14 +1,14 @@
 # HwBinder IPC from client to server
 binder_call(hal_sensors_client, hal_sensors_server)
 
 hal_attribute_hwservice(hal_sensors, hal_sensors_hwservice)
 
 # Allow sensor hals to access ashmem memory allocated by apps
-allow hal_sensors { appdomain -isolated_app }:fd use;
+allow hal_sensors { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # Allow sensor hals to access ashmem memory allocated by android.hidl.allocator
 # fd is passed in from framework sensorservice HAL.
 allow hal_sensors hal_allocator:fd use;
 
 # allow to run with real-time scheduling policy
 allow hal_sensors self:global_capability_class_set sys_nice;
diff --git a/prebuilts/api/32.0/public/isolated_base_app.te b/prebuilts/api/32.0/public/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..86740d042480b7f0c165b0e6f41cd0f1edce0b0f
--- /dev/null
+++ b/prebuilts/api/32.0/public/isolated_base_app.te
@@ -0,0 +1,9 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+type isolated_base_app, domain;
diff --git a/private/app_neverallows.te b/private/app_neverallows.te
index c8e4a23b0437872da4426a752d26835994e0c966..ff18902778bdfae3467927dec74168aa40f6c809 100644
--- a/private/app_neverallows.te
+++ b/private/app_neverallows.te
@@ -1,17 +1,18 @@
 ###
 ### neverallow rules for untrusted app domains
 ###
 
 define(`all_untrusted_apps',`{
   ephemeral_app
   isolated_app
+  isolated_base_app
   mediaprovider
   mediaprovider_app
   untrusted_app
   untrusted_app_25
   untrusted_app_27
   untrusted_app_29
   untrusted_app_all
   untrusted_base_app
   untrusted_base_app_25
   untrusted_base_app_27
diff --git a/private/app_zygote.te b/private/app_zygote.te
index 004c10844d8935d67174038f6082a179dded8898..e671a99216698750dd3c1f5f3bc37b82b54fae09 100644
--- a/private/app_zygote.te
+++ b/private/app_zygote.te
@@ -9,34 +9,36 @@ typeattribute app_zygote coredomain;
 tmpfs_domain(app_zygote);
 
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
+allow app_zygote isolated_base_app:process dyntransition;
 
 # For JIT
 allow app_zygote self:process execmem;
 
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
+allow app_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 dontaudit app_zygote mnt_expand_file:dir getattr;
 
 # Get seapp_contexts
 allow app_zygote seapp_contexts_file:file r_file_perms;
 # Check validity of SELinux context before use.
 selinux_check_context(app_zygote)
 # Check SELinux permissions.
 selinux_check_access(app_zygote)
@@ -83,21 +85,21 @@ get_prop(app_zygote, device_config_runtime_native_prop)
 get_prop(app_zygote, device_config_runtime_native_boot_prop)
 
 # Allow app_zygote to access odsign verification status
 get_prop(app_zygote, odsign_prop)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow app_zygote { domain -isolated_app }:process dyntransition;
+neverallow app_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow app_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow app_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # app_zygote child.
diff --git a/private/compat/26.0/26.0.ignore.cil b/private/compat/26.0/26.0.ignore.cil
index 8721e9b736ed0c9f91b6b7732caa57550ba3bf95..37f10ab1a30085ba4e30abb7ebf34e73c081a1fa 100644
--- a/private/compat/26.0/26.0.ignore.cil
+++ b/private/compat/26.0/26.0.ignore.cil
@@ -98,20 +98,21 @@
     heapprofd
     heapprofd_exec
     heapprofd_socket
     incident_helper
     incident_helper_exec
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     kmsg_debug_device
     last_boot_reason_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     lmkd_config_prop
     looper_stats_service
     lowpan_device
     lowpan_prop
diff --git a/private/compat/27.0/27.0.ignore.cil b/private/compat/27.0/27.0.ignore.cil
index 3a019302728c52a81077d6634be329ebf98ab6ca..895472976b99021e78c37a97dfc6f2af25b4dc43 100644
--- a/private/compat/27.0/27.0.ignore.cil
+++ b/private/compat/27.0/27.0.ignore.cil
@@ -111,20 +111,21 @@
     heapprofd_socket
     incident_helper
     incident_helper_exec
     init_service_status_private_prop
     init_service_status_prop
     iorapd
     iorapd_data_file
     iorapd_exec
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     keyguard_config_prop
     last_boot_reason_prop
     libc_debug_prop
     llkd
     llkd_exec
     llkd_prop
     llkd_tmpfs
     lmkd_config_prop
     looper_stats_service
     lowpan_device
diff --git a/private/compat/28.0/28.0.ignore.cil b/private/compat/28.0/28.0.ignore.cil
index 9ab335b0e695eb0eac3a1d041d5da4e0b438f1bc..5e6a5ec7e91ac2891ae9906b8e23acde18eccf9b 100644
--- a/private/compat/28.0/28.0.ignore.cil
+++ b/private/compat/28.0/28.0.ignore.cil
@@ -89,20 +89,21 @@
     looper_stats_service
     lpdumpd
     lpdumpd_exec
     lpdumpd_prop
     lpdump_service
     iorapd
     iorapd_exec
     iorapd_data_file
     iorapd_service
     iorapd_tmpfs
+    isolated_base_app
     mediaswcodec
     mediaswcodec_exec
     mediaswcodec_tmpfs
     metadata_bootstat_file
     mnt_product_file
     network_stack
     network_stack_service
     network_stack_tmpfs
     nnapi_ext_deny_product_prop
     overlayfs_file
diff --git a/private/compat/29.0/29.0.ignore.cil b/private/compat/29.0/29.0.ignore.cil
index 0d74d4bd38f2f25152f9a4c493e7981732faa5f1..25214c7dfc32dad7e58f571f692ba967dd345bb1 100644
--- a/private/compat/29.0/29.0.ignore.cil
+++ b/private/compat/29.0/29.0.ignore.cil
@@ -65,20 +65,21 @@
     init_perf_lsm_hooks_prop
     init_svc_debug_prop
     iorap_inode2filename
     iorap_inode2filename_data_file
     iorap_inode2filename_exec
     iorap_inode2filename_tmpfs
     iorap_prefetcherd
     iorap_prefetcherd_data_file
     iorap_prefetcherd_exec
     iorap_prefetcherd_tmpfs
+    isolated_base_app
     mediatranscoding_service
     mediatranscoding
     mediatranscoding_exec
     mediatranscoding_tmpfs
     mirror_data_file
     light_service
     linkerconfig_file
     lmkd_prop
     media_variant_prop
     metadata_bootstat_file
diff --git a/private/compat/30.0/30.0.ignore.cil b/private/compat/30.0/30.0.ignore.cil
index f4dff53212b2abb933424922804affd2e745dd55..8e46053cf14d4034337e8d48f5fa0d92704b8485 100644
--- a/private/compat/30.0/30.0.ignore.cil
+++ b/private/compat/30.0/30.0.ignore.cil
@@ -64,20 +64,21 @@
     hal_keymint_service
     hal_neuralnetworks_service
     hal_power_stats_service
     hal_remotelyprovisionedcomponent_service
     hal_secureclock_service
     hal_sharedsecret_service
     hal_uwb_service
     hal_weaver_service
     hw_timeout_multiplier_prop
     hypervisor_prop
+    isolated_base_app
     keystore_compat_hal_service
     keystore_maintenance_service
     keystore_metrics_service
     keystore2_key_contexts_file
     legacy_permission_service
     legacykeystore_service
     location_time_zone_manager_service
     media_communication_service
     media_metrics_service
     mediatuner_exec
diff --git a/private/compat/31.0/31.0.ignore.cil b/private/compat/31.0/31.0.ignore.cil
index cce473dc2a86a3d51c11054440be08dd62b363cb..56488bc1af5cf5b0176a7f4ced6058ce75e5b694 100644
--- a/private/compat/31.0/31.0.ignore.cil
+++ b/private/compat/31.0/31.0.ignore.cil
@@ -1,14 +1,15 @@
 ;; new_objects - a collection of types that have been introduced that have no
 ;;   analogue in older policy.  Thus, we do not need to map these types to
 ;;   previous ones.  Add here to pass checkapi tests.
 (type new_objects)
 (typeattribute new_objects)
 (typeattributeset new_objects
   ( new_objects
     hypervisor_prop
+    isolated_base_app
     untrusted_base_app
     untrusted_base_app_25
     untrusted_base_app_27
     untrusted_base_app_29
     updater_app
   ))
diff --git a/private/isolated_base_app.te b/private/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..72db8f620fd3e892e07340ed07f483454c04640b
--- /dev/null
+++ b/private/isolated_base_app.te
@@ -0,0 +1,153 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+typeattribute isolated_base_app coredomain;
+
+app_domain(isolated_base_app)
+
+# Access already open app data files received over Binder or local socket IPC.
+allow isolated_base_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
+
+# Allow access to network sockets received over IPC. New socket creation is not
+# permitted.
+allow isolated_base_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
+
+allow isolated_base_app activity_service:service_manager find;
+allow isolated_base_app display_service:service_manager find;
+allow isolated_base_app webviewupdate_service:service_manager find;
+
+# Google Breakpad (crash reporter for Chrome) relies on ptrace
+# functionality. Without the ability to ptrace, the crash reporter
+# tool is broken.
+# b/20150694
+# https://code.google.com/p/chromium/issues/detail?id=475270
+allow isolated_base_app self:process ptrace;
+
+# b/32896414: Allow accessing sdcard file descriptors passed to isolated_base_apps
+# by other processes. Open should never be allowed, and is blocked by
+# neverallow rules below.
+# media_rw_data_file is included for sdcardfs, and can be removed if sdcardfs
+# is modified to change the secontext when accessing the lower filesystem.
+allow isolated_base_app { sdcard_type media_rw_data_file }:file { read write append getattr lock map };
+
+# For webviews, isolated_base_app processes can be forked from the webview_zygote
+# in addition to the zygote. Allow access to resources inherited from the
+# webview_zygote process. These rules are specialized copies of the ones in app.te.
+# Inherit FDs from the webview_zygote.
+allow isolated_base_app webview_zygote:fd use;
+# Notify webview_zygote of child death.
+allow isolated_base_app webview_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app webview_zygote:unix_dgram_socket write;
+# Read system properties managed by webview_zygote.
+allow isolated_base_app webview_zygote_tmpfs:file read;
+
+# Inherit FDs from the app_zygote.
+allow isolated_base_app app_zygote:fd use;
+# Notify app_zygote of child death.
+allow isolated_base_app app_zygote:process sigchld;
+# Inherit logd write socket.
+allow isolated_base_app app_zygote:unix_dgram_socket write;
+
+# TODO (b/63631799) fix this access
+# suppress denials to /data/local/tmp
+dontaudit isolated_base_app shell_data_file:dir search;
+
+# Write app-specific trace data to the Perfetto traced damon. This requires
+# connecting to its producer socket and obtaining a (per-process) tmpfs fd.
+perfetto_producer(isolated_base_app)
+
+# Allow profiling if the main app has been marked as profileable or
+# debuggable.
+can_profile_heap(isolated_base_app)
+can_profile_perf(isolated_base_app)
+
+#####
+##### Neverallow
+#####
+
+# Isolated apps should not directly open app data files themselves.
+neverallow isolated_base_app { app_data_file privapp_data_file }:file open;
+
+# Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
+# TODO: are there situations where isolated_base_apps write to this file?
+# TODO: should we tighten these restrictions further?
+neverallow isolated_base_app anr_data_file:file ~{ open append };
+neverallow isolated_base_app anr_data_file:dir ~search;
+
+# Isolated apps must not be permitted to use HwBinder
+neverallow isolated_base_app hwbinder_device:chr_file *;
+neverallow isolated_base_app *:hwservice_manager *;
+
+# Isolated apps must not be permitted to use VndBinder
+neverallow isolated_base_app vndbinder_device:chr_file *;
+
+# Isolated apps must not be permitted to perform actions on Binder and VndBinder service_manager
+# except the find actions for services whitelisted below.
+neverallow isolated_base_app *:service_manager ~find;
+
+# b/17487348
+# Isolated apps can only access three services,
+# activity_service, display_service, webviewupdate_service.
+neverallow isolated_base_app {
+    service_manager_type
+    -activity_service
+    -display_service
+    -webviewupdate_service
+}:service_manager find;
+
+# Isolated apps shouldn't be able to access the driver directly.
+neverallow isolated_base_app gpu_device:chr_file { rw_file_perms execute };
+
+# Do not allow isolated_base_app access to /cache
+neverallow isolated_base_app cache_file:dir ~{ r_dir_perms };
+neverallow isolated_base_app cache_file:file ~{ read getattr };
+
+# Do not allow isolated_base_app to access external storage, except for files passed
+# via file descriptors (b/32896414).
+neverallow isolated_base_app { storage_file mnt_user_file sdcard_type }:dir ~getattr;
+neverallow isolated_base_app { storage_file mnt_user_file }:file_class_set *;
+neverallow isolated_base_app sdcard_type:{ devfile_class_set lnk_file sock_file fifo_file } *;
+neverallow isolated_base_app sdcard_type:file ~{ read write append getattr lock map };
+
+# Do not allow USB access
+neverallow isolated_base_app { usb_device usbaccessory_device }:chr_file *;
+
+# Restrict the webview_zygote control socket.
+neverallow isolated_base_app webview_zygote:sock_file write;
+
+# Limit the /sys files which isolated_base_app can access. This is important
+# for controlling isolated_base_app attack surface.
+neverallow isolated_base_app {
+  sysfs_type
+  -sysfs_devices_system_cpu
+  -sysfs_transparent_hugepage
+  -sysfs_usb # TODO: check with audio team if needed for isolated_base_app (b/28417852)
+  -sysfs_fs_incfs_features
+}:file no_rw_file_perms;
+
+# No creation of sockets families other than AF_UNIX sockets.
+# List taken from system/sepolicy/public/global_macros - socket_class_set
+# excluding unix_stream_socket and unix_dgram_socket.
+# Many of these are socket families which have never and will never
+# be compiled into the Android kernel.
+neverallow isolated_base_app { self ephemeral_app priv_app untrusted_app_all }:{
+  socket tcp_socket udp_socket rawip_socket netlink_socket packet_socket
+  key_socket appletalk_socket netlink_route_socket
+  netlink_tcpdiag_socket netlink_nflog_socket netlink_xfrm_socket
+  netlink_selinux_socket netlink_audit_socket netlink_dnrt_socket
+  netlink_kobject_uevent_socket tun_socket netlink_iscsi_socket
+  netlink_fib_lookup_socket netlink_connector_socket netlink_netfilter_socket
+  netlink_generic_socket netlink_scsitransport_socket netlink_rdma_socket
+  netlink_crypto_socket sctp_socket icmp_socket ax25_socket ipx_socket
+  netrom_socket atmpvc_socket x25_socket rose_socket decnet_socket atmsvc_socket
+  rds_socket irda_socket pppox_socket llc_socket can_socket tipc_socket
+  bluetooth_socket iucv_socket rxrpc_socket isdn_socket phonet_socket
+  ieee802154_socket caif_socket alg_socket nfc_socket vsock_socket kcm_socket
+  qipcrtr_socket smc_socket xdp_socket
+} create;
diff --git a/private/seapp_contexts b/private/seapp_contexts
index b7b668d7c15efda748f1b4367fac7f212fc27db5..3982c1e8543f594f7a09791ff11051de9e60151e 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -119,22 +119,22 @@ neverallow user=((?!system).)* type=system_app_data_file
 neverallow user=_app isPrivApp=false name=.* seinfo=""
 neverallow user=_app isPrivApp=false name=.* seinfo=default
 
 # neverallow shared relro to any other domain
 # and neverallow any other uid into shared_relro
 neverallow user=shared_relro domain=((?!shared_relro).)*
 neverallow user=((?!shared_relro).)* domain=shared_relro
 
 # neverallow non-isolated uids into isolated_app domain
 # and vice versa
-neverallow user=_isolated domain=((?!isolated_app).)*
-neverallow user=((?!_isolated).)* domain=isolated_app
+neverallow user=_isolated domain=((?!isolated_(base_)?app).)*
+neverallow user=((?!_isolated).)* domain=isolated_base_app
 
 # uid shell should always be in shell domain, however non-shell
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
@@ -149,21 +149,21 @@ user=_app isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_a
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
 user=radio seinfo=platform domain=radio type=radio_data_file
 user=shared_relro seinfo=base domain=shared_relro levelFrom=all
 user=shared_relro domain=shared_relro levelFrom=all
 user=shell seinfo=platform domain=shell name=com.android.shell type=shell_data_file
 user=webview_zygote seinfo=webview_zygote domain=webview_zygote
-user=_isolated seinfo=base domain=isolated_app levelFrom=user
+user=_isolated seinfo=base domain=isolated_base_app levelFrom=user
 user=_isolated domain=isolated_app levelFrom=user
 user=_app seinfo=app_zygote domain=app_zygote levelFrom=user
 user=_app seinfo=media domain=mediaprovider type=app_data_file levelFrom=user
 user=_app seinfo=platform domain=platform_app type=app_data_file levelFrom=user
 user=_app seinfo=base isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app isEphemeralApp=true domain=ephemeral_app type=app_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app isPrivApp=true domain=priv_app type=privapp_data_file levelFrom=user
 user=_app seinfo=base isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
 user=_app isPrivApp=true name=com.google.android.permissioncontroller domain=permissioncontroller_app type=privapp_data_file levelFrom=all
diff --git a/private/technical_debt.cil b/private/technical_debt.cil
index 9b3e3c6adfdba9da482bb87568efdc72141fb876..f2acabe6471fcb7f2aee21335dbc166dc27684f4 100644
--- a/private/technical_debt.cil
+++ b/private/technical_debt.cil
@@ -1,71 +1,71 @@
 ; THIS IS A WORKAROUND for the current limitations of the module policy language
 ; This should be used sparingly until we figure out a saner way to achieve the
 ; stuff below, for example, by improving typeattribute statement of module
 ; language.
 ;
 ; NOTE: This file has no effect on recovery policy.
 
 ; Apps, except isolated apps, are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_allocator_client;
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_allocator_client;
 ;     typeattribute hal_allocator_client halclientdomain;
-(typeattributeset hal_allocator_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 (typeattributeset halclientdomain (hal_allocator_client))
 
 ; Apps, except isolated apps, are clients of OMX-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_omx_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_omx_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Codec2-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_codec2_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_codec2_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Drm-related services
 ; Unfortunately, we can't currently express this in module policy language:
-(typeattributeset hal_drm_client ((and (appdomain) ((not (isolated_app))))))
+(typeattributeset hal_drm_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Configstore HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_configstore_client;
-(typeattributeset hal_configstore_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_configstore_client;
+(typeattributeset hal_configstore_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Graphics Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_graphics_allocator_client;
-(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_graphics_allocator_client;
+(typeattributeset hal_graphics_allocator_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Apps, except isolated apps, are clients of Cas HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_cas_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_cas_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Domains hosting Camera HAL implementations are clients of Allocator HAL
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute hal_camera hal_allocator_client;
 (typeattributeset hal_allocator_client (hal_camera))
 
 ; Apps, except isolated apps, are clients of Neuralnetworks HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_neuralnetworks_client;
-(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_neuralnetworks_client;
+(typeattributeset hal_neuralnetworks_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; TODO(b/112056006): move these to mapping files when/if we implement 'versioned' attributes.
 ; Rename untrusted_app_visible_* to untrusted_app_visible_*_violators.
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute untrusted_app_visible_hwservice untrusted_app_visible_hwservice_violators;
 ;     typeattribute untrusted_app_visible_halserver untrusted_app_visible_halserver_violators;
 (typeattribute untrusted_app_visible_hwservice)
 (typeattributeset untrusted_app_visible_hwservice_violators (untrusted_app_visible_hwservice))
 (typeattribute untrusted_app_visible_halserver)
 (typeattributeset untrusted_app_visible_halserver_violators (untrusted_app_visible_halserver))
 
 ; Apps, except isolated apps, are clients of BufferHub HAL
 ; Unfortunately, we can't currently express this in module policy language:
-;     typeattribute { appdomain -isolated_app } hal_cas_client;
-(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (isolated_app))))))
+;     typeattribute { appdomain -isolated_app -isolated_base_app } hal_cas_client;
+(typeattributeset hal_bufferhub_client ((and (appdomain) ((not (or (isolated_app) (isolated_base_app)))))))
 
 ; Properties having both system_property_type and vendor_property_type are illegal
 ; Unfortunately, we can't currently express this in module policy language:
 ;     typeattribute { system_property_type && vendor_property_type } system_and_vendor_property_type;
 (typeattribute system_and_vendor_property_type)
 (typeattributeset system_and_vendor_property_type ((and (system_property_type) (vendor_property_type))))
diff --git a/private/webview_zygote.te b/private/webview_zygote.te
index 3473ecaee77923e5080c2b4e8b176b97fcf4ce31..7dcfb5385c84c40e9047f28938963ad9ef8c43e9 100644
--- a/private/webview_zygote.te
+++ b/private/webview_zygote.te
@@ -21,40 +21,42 @@ allow webview_zygote apk_data_file:file { r_file_perms execute };
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
+allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:file { r_file_perms execute };
 allow webview_zygote apex_module_data_file:dir search;
 
 # Allow webview_zygote to create JIT memory.
 allow webview_zygote self:process execmem;
 
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
+allow webview_zygote isolated_base_app:process setpgid;
 
 # TODO (b/63631799) fix this access
 # Suppress denials to storage. Webview zygote should not be accessing.
 dontaudit webview_zygote mnt_expand_file:dir getattr;
 
 # TODO (b/72957399) remove this when webview_zygote is reparented to
 # app_process zygote
 dontaudit webview_zygote dex2oat_exec:file execute;
 
 # Get seapp_contexts
@@ -88,21 +90,21 @@ get_prop(webview_zygote, device_config_runtime_native_prop)
 get_prop(webview_zygote, device_config_runtime_native_boot_prop)
 
 # Allow webview_zygote to access odsign verification status
 get_prop(zygote, odsign_prop)
 
 #####
 ##### Neverallow
 #####
 
 # Only permit transition to isolated_app.
-neverallow webview_zygote { domain -isolated_app }:process dyntransition;
+neverallow webview_zygote { domain -isolated_app -isolated_base_app }:process dyntransition;
 
 # Only setcon() transitions, no exec() based transitions, except for crash_dump.
 neverallow webview_zygote { domain -crash_dump }:process transition;
 
 # Must not exec() a program without changing domains.
 # Having said that, exec() above is not allowed.
 neverallow webview_zygote *:file execute_no_trans;
 
 # The only way to enter this domain is for the zygote to fork a new
 # webview_zygote child.
diff --git a/public/app.te b/public/app.te
index 8dd14179257e92b396bb32b333edf88a468aaba2..561ddba08d4e0e79106581285fe1733ed563d025 100644
--- a/public/app.te
+++ b/public/app.te
@@ -26,22 +26,22 @@ allow appdomain app_zygote:fd use;
 allow appdomain zygote_exec:file rx_file_perms;
 
 # Notify zygote of death;
 allow appdomain zygote:process sigchld;
 
 # Read /data/dalvik-cache.
 allow appdomain dalvikcache_data_file:dir { search getattr };
 allow appdomain dalvikcache_data_file:file r_file_perms;
 
 # Read the /sdcard and /mnt/sdcard symlinks
-allow { appdomain -isolated_app } rootfs:lnk_file r_file_perms;
-allow { appdomain -isolated_app } tmpfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } rootfs:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } tmpfs:lnk_file r_file_perms;
 
 # Search /storage/emulated tmpfs mount.
 allow appdomain tmpfs:dir r_dir_perms;
 
 # Notify zygote of the wrapped process PID when using --invoke-with.
 allow appdomain zygote:fifo_file write;
 
 userdebug_or_eng(`
   # Allow apps to create and write method traces in /data/misc/trace.
   allow appdomain method_trace_data_file:dir w_dir_perms;
@@ -64,36 +64,36 @@ allow appdomain system_server:tcp_socket { read write getattr getopt shutdown };
 # For AppFuse.
 allow appdomain vold:fd use;
 
 # Communication with other apps via fifos
 allow appdomain appdomain:fifo_file rw_file_perms;
 
 # Communicate with surfaceflinger.
 allow appdomain surfaceflinger:unix_stream_socket { read write setopt getattr getopt shutdown };
 
 # App sandbox file accesses.
-allow { appdomain -isolated_app -mlstrustedsubject } { app_data_file privapp_data_file }:dir create_dir_perms;
-allow { appdomain -isolated_app -mlstrustedsubject } { app_data_file privapp_data_file }:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -mlstrustedsubject } { app_data_file privapp_data_file }:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -mlstrustedsubject } { app_data_file privapp_data_file }:file create_file_perms;
 
 # Access via already open fds is ok even for mlstrustedsubject.
-allow { appdomain -isolated_app } { app_data_file privapp_data_file system_app_data_file }:file { getattr map read write };
+allow { appdomain -isolated_app -isolated_base_app } { app_data_file privapp_data_file system_app_data_file }:file { getattr map read write };
 
 # Traverse into expanded storage
 allow appdomain mnt_expand_file:dir r_dir_perms;
 
 # Keychain and user-trusted credentials
 r_dir_file(appdomain, keychain_data_file)
 allow appdomain misc_user_data_file:dir r_dir_perms;
 allow appdomain misc_user_data_file:file r_file_perms;
 
 # TextClassifier
-r_dir_file({ appdomain -isolated_app }, textclassifier_data_file)
+r_dir_file({ appdomain -isolated_app -isolated_base_app }, textclassifier_data_file)
 
 # Access to OEM provided data and apps
 allow appdomain oemfs:dir r_dir_perms;
 allow appdomain oemfs:file rx_file_perms;
 
 # Execute the shell or other system executables.
 allow { appdomain -ephemeral_app } shell_exec:file rx_file_perms;
 allow { appdomain -ephemeral_app } toolbox_exec:file rx_file_perms;
 allow appdomain system_file:file x_file_perms;
 not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perms;')
@@ -102,21 +102,21 @@ not_full_treble(`allow { appdomain -ephemeral_app } vendor_file:file x_file_perm
 allow appdomain system_file:dir r_dir_perms;
 allow appdomain system_file:lnk_file { getattr open read };
 # Renderscript specific permissions to open /system/vendor/lib64.
 not_full_treble(`
     allow appdomain vendor_file_type:dir r_dir_perms;
     allow appdomain vendor_file_type:lnk_file { getattr open read };
 ')
 
 full_treble_only(`
     # For looking up Renderscript vendor drivers
-    allow { appdomain -isolated_app } vendor_file:dir { open read };
+    allow { appdomain -isolated_app -isolated_base_app } vendor_file:dir { open read };
 ')
 
 # Allow apps access to /vendor/app except for privileged
 # apps which cannot be in /vendor.
 r_dir_file({ appdomain -ephemeral_app }, vendor_app_file)
 allow { appdomain -ephemeral_app } vendor_app_file:file execute;
 
 # Allow apps access to /vendor/overlay
 r_dir_file(appdomain, vendor_overlay_file)
 
@@ -188,102 +188,104 @@ userdebug_or_eng(`
 ')
 
 # /proc/net access.
 # TODO(b/9496886) Audit access for removal.
 # proc_net access for the negated domains below is granted (or not) in their
 # individual .te files.
 r_dir_file({
   appdomain
   -ephemeral_app
   -isolated_app
+  -isolated_base_app
   -platform_app
   -priv_app
   -shell
   -system_app
   -untrusted_app_all
 }, proc_net_type)
 # audit access for all these non-core app domains.
 userdebug_or_eng(`
   auditallow {
     appdomain
     -ephemeral_app
     -isolated_app
+    -isolated_base_app
     -platform_app
     -priv_app
     -shell
     -su
     -system_app
     -untrusted_app_all
   } proc_net_type:{ dir file lnk_file } { getattr open read };
 ')
 
 # Grant GPU access to all processes started by Zygote.
 # They need that to render the standard UI.
-allow { appdomain -isolated_app } gpu_device:chr_file rw_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } gpu_device:chr_file rw_file_perms;
 
 # Use the Binder.
 binder_use(appdomain)
 # Perform binder IPC to binder services.
 binder_call(appdomain, binderservicedomain)
 # Perform binder IPC to other apps.
 binder_call(appdomain, appdomain)
 # Perform binder IPC to ephemeral apps.
 binder_call(appdomain, ephemeral_app)
 # Perform binder IPC to gpuservice.
-binder_call({ appdomain -isolated_app }, gpuservice)
+binder_call({ appdomain -isolated_app -isolated_base_app }, gpuservice)
 
 # Talk with graphics composer fences
 allow appdomain hal_graphics_composer:fd use;
 
 # Already connected, unnamed sockets being passed over some other IPC
 # hence no sock_file or connectto permission. This appears to be how
 # Chrome works, may need to be updated as more apps using isolated services
 # are examined.
 allow appdomain appdomain:unix_stream_socket { getopt getattr read write shutdown };
 
 # Backup ability for every app. BMS opens and passes the fd
 # to any app that has backup ability. Hence, no open permissions here.
 allow appdomain backup_data_file:file { read write getattr map };
 allow appdomain cache_backup_file:file { read write getattr map };
 allow appdomain cache_backup_file:dir getattr;
 # Backup ability using 'adb backup'
 allow appdomain system_data_file:lnk_file r_file_perms;
 allow appdomain system_data_file:file { getattr read map };
 
 # Allow read/stat of /data/media files passed by Binder or local socket IPC.
-allow { appdomain -isolated_app } media_rw_data_file:file { read getattr };
+allow { appdomain -isolated_app -isolated_base_app } media_rw_data_file:file { read getattr };
 
 # Read and write /data/data/com.android.providers.telephony files passed over Binder.
-allow { appdomain -isolated_app } radio_data_file:file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app } radio_data_file:file { read write getattr };
 
 # Allow access to external storage; we have several visible mount points under /storage
 # and symlinks to primary storage at places like /storage/sdcard0 and /mnt/user/0/primary
-allow { appdomain -isolated_app -ephemeral_app } storage_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } storage_file:lnk_file r_file_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } storage_file:lnk_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:dir r_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } mnt_user_file:lnk_file r_file_perms;
 
 # Read/write visible storage
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } sdcard_type:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } sdcard_type:file create_file_perms;
 # This should be removed if sdcardfs is modified to alter the secontext for its
 # accesses to the underlying FS.
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
-allow { appdomain -isolated_app -ephemeral_app } media_rw_data_file:file create_file_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:dir create_dir_perms;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } media_rw_data_file:file create_file_perms;
 
 # Allow apps to use the USB Accessory interface.
 # http://developer.android.com/guide/topics/connectivity/usb/accessory.html
 #
 # USB devices are first opened by the system server (USBDeviceManagerService)
 # and the file descriptor is passed to the right Activity via binder.
-allow { appdomain -isolated_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
-allow { appdomain -isolated_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usb_device:chr_file { read write getattr ioctl };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory_device:chr_file { read write getattr };
 
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
@@ -293,79 +295,79 @@ allow appdomain apk_data_file:file rx_file_perms;
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
 
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore2_key { delete use get_info rebind update };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore_key { get_state get insert delete exist list sign verify };
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore2_key { delete use get_info rebind update };
 
-allow { appdomain -isolated_app -ephemeral_app } keystore_maintenance_service:service_manager find;
-allow { appdomain -isolated_app -ephemeral_app } keystore:keystore2 get_state;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore_maintenance_service:service_manager find;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } keystore:keystore2 get_state;
 
-use_keystore({ appdomain -isolated_app -ephemeral_app })
+use_keystore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
-use_credstore({ appdomain -isolated_app -ephemeral_app })
+use_credstore({ appdomain -isolated_app -isolated_base_app -ephemeral_app })
 
 allow appdomain console_device:chr_file { read write };
 
 # only allow unprivileged socket ioctl commands
 allowxperm { appdomain -bluetooth } self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
-allow { appdomain -isolated_app } ion_device:chr_file r_file_perms;
-allow { appdomain -isolated_app } dmabuf_system_heap_device:chr_file r_file_perms;
-allow { appdomain -isolated_app } dmabuf_system_secure_heap_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } ion_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } dmabuf_system_heap_device:chr_file r_file_perms;
+allow { appdomain -isolated_app -isolated_base_app } dmabuf_system_secure_heap_device:chr_file r_file_perms;
 
 # Allow AAudio apps to use shared memory file descriptors from the HAL
-allow { appdomain -isolated_app } hal_audio:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_audio:fd use;
 
 # Allow app to access shared memory created by camera HAL1
-allow { appdomain -isolated_app } hal_camera:fd use;
+allow { appdomain -isolated_app -isolated_base_app } hal_camera:fd use;
 
 # Allow apps to access shared memory file descriptor from the tuner HAL
-allow {appdomain -isolated_app} hal_tv_tuner_server:fd use;
+allow {appdomain -isolated_app  -isolated_base_app } hal_tv_tuner_server:fd use;
 
 # RenderScript always-passthrough HAL
-allow { appdomain -isolated_app } hal_renderscript_hwservice:hwservice_manager find;
+allow { appdomain -isolated_app -isolated_base_app } hal_renderscript_hwservice:hwservice_manager find;
 allow appdomain same_process_hal_file:file { execute read open getattr map };
 
 # TODO: switch to meminfo service
 allow appdomain proc_meminfo:file r_file_perms;
 
 # For app fuse.
 allow appdomain app_fuse_file:file { getattr read append write map };
 
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_client)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_manager)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, display_vsync)
-pdx_client({ appdomain -isolated_app -ephemeral_app }, performance_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_client)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_manager)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, display_vsync)
+pdx_client({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, performance_client)
 # Apps do not directly open the IPC socket for bufferhubd.
-pdx_use({ appdomain -isolated_app -ephemeral_app }, bufferhub_client)
+pdx_use({ appdomain -isolated_app -isolated_base_app -ephemeral_app }, bufferhub_client)
 
 ###
 ### CTS-specific rules
 ###
 
 # For cts/tests/tests/permission/src/android/permission/cts/FileSystemPermissionTest.java.
 # testRunAsHasCorrectCapabilities
 allow appdomain runas_exec:file getattr;
 # Others are either allowed elsewhere or not desired.
 
 # Apps receive an open tun fd from the framework for
 # device traffic. Do not allow untrusted app to directly open tun_device
-allow { appdomain -isolated_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
-allowxperm { appdomain -isolated_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
+allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file { read write getattr append ioctl };
+allowxperm { appdomain -isolated_app -isolated_base_app -ephemeral_app } tun_device:chr_file ioctl TUNGETIFF;
 
 # Connect to adbd and use a socket transferred from it.
 # This is used for e.g. adb backup/restore.
 allow appdomain adbd:unix_stream_socket connectto;
 allow appdomain adbd:fd use;
 allow appdomain adbd:unix_stream_socket { getattr getopt ioctl read write shutdown };
 
 allow appdomain cache_file:dir getattr;
 
 # Allow apps to run with asanwrapper.
@@ -396,21 +398,21 @@ neverallow appdomain dev_type:blk_file { read write };
 neverallow appdomain {
     audio_device
     camera_device
     dm_device
     radio_device
     rpmsg_device
     video_device
 }:chr_file { read write };
 
 # Note: Try expanding list of app domains in the future.
-neverallow { untrusted_app isolated_app shell } graphics_device:chr_file { read write };
+neverallow { untrusted_app isolated_app isolated_base_app shell } graphics_device:chr_file { read write };
 
 neverallow { appdomain -nfc } nfc_device:chr_file
     { read write };
 neverallow { appdomain -bluetooth } hci_attach_dev:chr_file
     { read write };
 neverallow appdomain tee_device:chr_file { read write };
 
 # Privileged netlink socket interfaces.
 neverallow { appdomain -network_stack }
     domain:{
diff --git a/public/domain.te b/public/domain.te
index 11c6519a132c42c42e6e05b295f7417fc4d686ba..cf834515fc8299cbd97fff90ac409b2649a20768 100644
--- a/public/domain.te
+++ b/public/domain.te
@@ -82,21 +82,21 @@ allow domain ashmem_libcutils_device:chr_file rw_file_perms;
 allow { domain -hwservicemanager -vndservicemanager } binder_device:chr_file rw_file_perms;
 
 # Restrict binder ioctls to an allowlist. Additional ioctl commands may be
 # added to individual domains, but this sets safe defaults for all processes.
 allowxperm domain binder_device:chr_file ioctl { unpriv_binder_ioctls };
 
 # /dev/binderfs needs to be accessed by everyone too!
 allow domain binderfs:dir { getattr search };
 allow domain binderfs_logs_proc:dir search;
 
-allow { domain -servicemanager -vndservicemanager -isolated_app } hwbinder_device:chr_file rw_file_perms;
+allow { domain -servicemanager -vndservicemanager -isolated_app -isolated_base_app } hwbinder_device:chr_file rw_file_perms;
 allow domain ptmx_device:chr_file rw_file_perms;
 allow domain random_device:chr_file rw_file_perms;
 allow domain proc_random:dir r_dir_perms;
 allow domain proc_random:file r_file_perms;
 allow domain properties_device:dir { search getattr };
 allow domain properties_serial:file r_file_perms;
 allow domain property_info:file r_file_perms;
 
 # Public readable properties
 get_prop(domain, aaudio_config_prop)
@@ -1153,20 +1153,21 @@ neverallow {
   -appdomain # finer-grained rules for appdomain are listed below
   -system_server #populate com.android.providers.settings/databases/settings.db.
   -installd # creation of app sandbox
   -iorap_inode2filename
   -traced_probes # resolve inodes for i/o tracing.
                  # only needs open and read, the rest is neverallow in
                  # traced_probes.te.
 } system_app_data_file:dir_file_class_set { create unlink open };
 neverallow {
   isolated_app
+  isolated_base_app
   untrusted_app_all # finer-grained rules for appdomain are listed below
   ephemeral_app
   priv_app
 } system_app_data_file:dir_file_class_set { create unlink open };
 
 #
 # Only these domains should transition to shell domain. This domain is
 # permissible for the "shell user". If you need a process to exec a shell
 # script with differing privilege, define a domain and set up a transition.
 #
diff --git a/public/hal_camera.te b/public/hal_camera.te
index 45fad56e7949d8b811ef1b6e0c6205979eb1385c..afa32661025c5afae165b16f0f503326cb4c6089 100644
--- a/public/hal_camera.te
+++ b/public/hal_camera.te
@@ -8,21 +8,21 @@ allow hal_camera device:dir r_dir_perms;
 allow hal_camera video_device:dir r_dir_perms;
 allow hal_camera video_device:chr_file rw_file_perms;
 allow hal_camera camera_device:chr_file rw_file_perms;
 allow hal_camera ion_device:chr_file rw_file_perms;
 allow hal_camera dmabuf_system_heap_device:chr_file r_file_perms;
 
 # Both the client and the server need to use the graphics allocator
 allow { hal_camera_client hal_camera_server } hal_graphics_allocator:fd use;
 
 # Allow hal_camera to use fd from app,gralloc,and ashmem HAL
-allow hal_camera { appdomain -isolated_app }:fd use;
+allow hal_camera { appdomain -isolated_app -isolated_base_app }:fd use;
 allow hal_camera surfaceflinger:fd use;
 allow hal_camera hal_allocator_server:fd use;
 
 # Needed to provide debug dump output via dumpsys' pipes.
 allow hal_camera shell:fd use;
 allow hal_camera shell:fifo_file write;
 
 ###
 ### neverallow rules
 ###
diff --git a/public/hal_drm.te b/public/hal_drm.te
index bb1bd91e67c6aeebdc9c62d565f27f89c83a6273..b7363db07e55629115e72b8731ffb7b0c227abfe 100644
--- a/public/hal_drm.te
+++ b/public/hal_drm.te
@@ -31,21 +31,21 @@ allow hal_drm hal_graphics_allocator:fd use;
 # Allow access to hidl_memory allocation service
 allow hal_drm hal_allocator_server:fd use;
 
 # Allow access to fds allocated by mediaserver
 allow hal_drm mediaserver:fd use;
 
 allow hal_drm sysfs:file r_file_perms;
 
 allow hal_drm tee_device:chr_file rw_file_perms;
 
-allow hal_drm_server { appdomain -isolated_app }:fd use;
+allow hal_drm_server { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # only allow unprivileged socket ioctl commands
 allowxperm hal_drm self:{ rawip_socket tcp_socket udp_socket }
   ioctl { unpriv_sock_ioctls unpriv_tty_ioctls };
 
 ###
 ### neverallow rules
 ###
 
 # hal_drm should never execute any executable without a
diff --git a/public/hal_omx.te b/public/hal_omx.te
index 8e74383d31b59239c297fb4bbf31c07a93cf4ea3..b4940f30b0daffcd6094d6eb73ac91c0953271c4 100644
--- a/public/hal_omx.te
+++ b/public/hal_omx.te
@@ -1,15 +1,15 @@
 # applies all permissions to hal_omx NOT hal_omx_server
 # since OMX must always be in its own process.
 
 binder_call(hal_omx_server, binderservicedomain)
-binder_call(hal_omx_server, { appdomain -isolated_app })
+binder_call(hal_omx_server, { appdomain -isolated_app -isolated_base_app })
 
 # Allow hal_omx_server access to composer sync fences
 allow hal_omx_server hal_graphics_composer:fd use;
 
 allow hal_omx_server ion_device:chr_file rw_file_perms;
 allow hal_omx_server hal_camera:fd use;
 
 crash_dump_fallback(hal_omx_server)
 
 # Recieve gralloc buffer FDs from bufferhubd. Note that hal_omx_server never
diff --git a/public/hal_sensors.te b/public/hal_sensors.te
index 06e76f1e17e171b969f97e94461944d6c1d09892..0405b6eab322037f70965156f083dfc038c44c8d 100644
--- a/public/hal_sensors.te
+++ b/public/hal_sensors.te
@@ -1,14 +1,14 @@
 # HwBinder IPC from client to server
 binder_call(hal_sensors_client, hal_sensors_server)
 
 hal_attribute_hwservice(hal_sensors, hal_sensors_hwservice)
 
 # Allow sensor hals to access ashmem memory allocated by apps
-allow hal_sensors { appdomain -isolated_app }:fd use;
+allow hal_sensors { appdomain -isolated_app -isolated_base_app }:fd use;
 
 # Allow sensor hals to access ashmem memory allocated by android.hidl.allocator
 # fd is passed in from framework sensorservice HAL.
 allow hal_sensors hal_allocator:fd use;
 
 # allow to run with real-time scheduling policy
 allow hal_sensors self:global_capability_class_set sys_nice;
diff --git a/public/isolated_base_app.te b/public/isolated_base_app.te
new file mode 100644
index 0000000000000000000000000000000000000000..86740d042480b7f0c165b0e6f41cd0f1edce0b0f
--- /dev/null
+++ b/public/isolated_base_app.te
@@ -0,0 +1,9 @@
+###
+### Services with isolatedProcess=true in their manifest.
+###
+### This file defines the rules for isolated apps. An "isolated
+### app" is an APP with UID between AID_ISOLATED_START (99000)
+### and AID_ISOLATED_END (99999).
+###
+
+type isolated_base_app, domain;

commit 0bbd93392fc894e2c6c38e55f011c04489685b92
Author: Renlord <me@renlord.com>
Date:   Tue 2020-02-25 22:12:12+1100

    remove base system app execmod
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/untrusted_base_app_25.te | 4 ----
 prebuilts/api/32.0/private/untrusted_base_app_27.te | 4 ----
 private/untrusted_base_app_25.te                    | 4 ----
 private/untrusted_base_app_27.te                    | 4 ----
 4 files changed, 16 deletions(-)

diff --git a/prebuilts/api/32.0/private/untrusted_base_app_25.te b/prebuilts/api/32.0/private/untrusted_base_app_25.te
index ef83692eaa06cf0e1a7a716f54349a058b2c304a..2f10ebcac798afaaebfeeda7f9ea3fbddfb19f81 100644
--- a/prebuilts/api/32.0/private/untrusted_base_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_base_app_25.te
@@ -19,24 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_base_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_27.te b/prebuilts/api/32.0/private/untrusted_base_app_27.te
index 273ee2491a2f65d5fd96503ac063116ad76c1bf9..b3cc763c966c94b43731e29bd4d5753bc1602175 100644
--- a/prebuilts/api/32.0/private/untrusted_base_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_base_app_27.te
@@ -8,24 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_base_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
diff --git a/private/untrusted_base_app_25.te b/private/untrusted_base_app_25.te
index ef83692eaa06cf0e1a7a716f54349a058b2c304a..2f10ebcac798afaaebfeeda7f9ea3fbddfb19f81 100644
--- a/private/untrusted_base_app_25.te
+++ b/private/untrusted_base_app_25.te
@@ -19,24 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_base_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
diff --git a/private/untrusted_base_app_27.te b/private/untrusted_base_app_27.te
index 273ee2491a2f65d5fd96503ac063116ad76c1bf9..b3cc763c966c94b43731e29bd4d5753bc1602175 100644
--- a/private/untrusted_base_app_27.te
+++ b/private/untrusted_base_app_27.te
@@ -8,24 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
-# https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
-allow untrusted_base_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
-
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_base_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 

commit d3399367dabf75a005c1edc1765e18314888ae21
Author: Renlord <me@renlord.com>
Date:   Tue 2020-02-25 22:17:45+1100

    remove base system app execmem
    
    GrapheneOS doesn't use the ART JIT compiler.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/ephemeral_app.te    | 3 +++
 prebuilts/api/32.0/private/isolated_app.te     | 3 +++
 prebuilts/api/32.0/private/untrusted_app.te    | 3 +++
 prebuilts/api/32.0/private/untrusted_app_25.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_27.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_29.te | 3 +++
 prebuilts/api/32.0/public/app.te               | 4 ----
 private/ephemeral_app.te                       | 3 +++
 private/isolated_app.te                        | 3 +++
 private/untrusted_app.te                       | 3 +++
 private/untrusted_app_25.te                    | 3 +++
 private/untrusted_app_27.te                    | 3 +++
 private/untrusted_app_29.te                    | 3 +++
 public/app.te                                  | 4 ----
 14 files changed, 36 insertions(+), 8 deletions(-)

diff --git a/prebuilts/api/32.0/private/ephemeral_app.te b/prebuilts/api/32.0/private/ephemeral_app.te
index e004891792232b5dc99dfc7a081bceea8591201f..c4db55a55ce4f8eb4b50a5dd97112e50c15e57d4 100644
--- a/prebuilts/api/32.0/private/ephemeral_app.te
+++ b/prebuilts/api/32.0/private/ephemeral_app.te
@@ -9,20 +9,23 @@
 ### applications may also opt-in to ephemeral to take advantage of the
 ### additional security features.
 ###
 ### PackageManager flags an app as ephemeral at install time.
 
 typeattribute ephemeral_app coredomain;
 
 net_domain(ephemeral_app)
 app_domain(ephemeral_app)
 
+allow ephemeral_app self:process execmem;
+auditallow ephemeral_app self:process execmem;
+
 # Allow ephemeral apps to read/write files in visible storage if provided fds
 allow ephemeral_app { sdcard_type media_rw_data_file }:file {read write getattr ioctl lock append};
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 allow ephemeral_app privapp_data_file:file { r_file_perms execute };
 allow ephemeral_app app_data_file:file     { r_file_perms execute };
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow ephemeral_app privapp_data_file:lnk_file r_file_perms;
diff --git a/prebuilts/api/32.0/private/isolated_app.te b/prebuilts/api/32.0/private/isolated_app.te
index 71749c00f6c992e8a14423e7a5e4019570d5ffbb..cffc1628b2a28a1ec0bdf3e9f5706430b73407e4 100644
--- a/prebuilts/api/32.0/private/isolated_app.te
+++ b/prebuilts/api/32.0/private/isolated_app.te
@@ -3,20 +3,23 @@
 ###
 ### This file defines the rules for isolated apps. An "isolated
 ### app" is an APP with UID between AID_ISOLATED_START (99000)
 ### and AID_ISOLATED_END (99999).
 ###
 
 typeattribute isolated_app coredomain;
 
 app_domain(isolated_app)
 
+allow isolated_app self:process execmem;
+auditallow isolated_app self:process execmem;
+
 # Access already open app data files received over Binder or local socket IPC.
 allow isolated_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
 
 # Allow access to network sockets received over IPC. New socket creation is not
 # permitted.
 allow isolated_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
 
 allow isolated_app activity_service:service_manager find;
 allow isolated_app display_service:service_manager find;
 allow isolated_app webviewupdate_service:service_manager find;
diff --git a/prebuilts/api/32.0/private/untrusted_app.te b/prebuilts/api/32.0/private/untrusted_app.te
index 6e7a99cd8c64bfd8bd076a5e5420a16e1bb1bb5b..44e9295df9de755a08b4b8957898878911cbe786 100644
--- a/prebuilts/api/32.0/private/untrusted_app.te
+++ b/prebuilts/api/32.0/private/untrusted_app.te
@@ -7,10 +7,13 @@
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
+
+allow untrusted_app self:process execmem;
+auditallow untrusted_app self:process execmem;
diff --git a/prebuilts/api/32.0/private/untrusted_app_25.te b/prebuilts/api/32.0/private/untrusted_app_25.te
index 41cabe878b07c7aa36bffdc85c15c095c6a1c859..fd7311bc8fee752251c5641ce4619abc1d8eb950 100644
--- a/prebuilts/api/32.0/private/untrusted_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_app_25.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_25 coredomain;
 
 app_domain(untrusted_app_25)
 untrusted_app_domain(untrusted_app_25)
 net_domain(untrusted_app_25)
 bluetooth_domain(untrusted_app_25)
 
+allow untrusted_app_25 self:process execmem;
+auditallow untrusted_app_25 self:process execmem;
+
 # b/35917228 - /proc/misc access
 # This will go away in a future Android release
 allow untrusted_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
diff --git a/prebuilts/api/32.0/private/untrusted_app_27.te b/prebuilts/api/32.0/private/untrusted_app_27.te
index 0993faa9bd6bbddbf53162d4f0fdf7d410b57b0a..a0e98b59f748ac6068cdbde5655f7106179da1b9 100644
--- a/prebuilts/api/32.0/private/untrusted_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_app_27.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_27 coredomain;
 
 app_domain(untrusted_app_27)
 untrusted_app_domain(untrusted_app_27)
 net_domain(untrusted_app_27)
 bluetooth_domain(untrusted_app_27)
 
+allow untrusted_app_27 self:process execmem;
+auditallow untrusted_app_27 self:process execmem;
+
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
diff --git a/prebuilts/api/32.0/private/untrusted_app_29.te b/prebuilts/api/32.0/private/untrusted_app_29.te
index c5652b16943f79016f596b403309bb8725114ec5..c66adfc6d1c220666c34446cfac70fb45cc31c58 100644
--- a/prebuilts/api/32.0/private/untrusted_app_29.te
+++ b/prebuilts/api/32.0/private/untrusted_app_29.te
@@ -8,13 +8,16 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
+allow untrusted_app_29 self:process execmem;
+auditallow untrusted_app_29 self:process execmem;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/public/app.te b/prebuilts/api/32.0/public/app.te
index 561ddba08d4e0e79106581285fe1733ed563d025..531547bef528d98b31c9b52eba949107132be43c 100644
--- a/prebuilts/api/32.0/public/app.te
+++ b/prebuilts/api/32.0/public/app.te
@@ -1,24 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-# WebView and other application-specific JIT compilers
-allow appdomain self:process execmem;
-auditallow appdomain self:process execmem;
-
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
diff --git a/private/ephemeral_app.te b/private/ephemeral_app.te
index e004891792232b5dc99dfc7a081bceea8591201f..c4db55a55ce4f8eb4b50a5dd97112e50c15e57d4 100644
--- a/private/ephemeral_app.te
+++ b/private/ephemeral_app.te
@@ -9,20 +9,23 @@
 ### applications may also opt-in to ephemeral to take advantage of the
 ### additional security features.
 ###
 ### PackageManager flags an app as ephemeral at install time.
 
 typeattribute ephemeral_app coredomain;
 
 net_domain(ephemeral_app)
 app_domain(ephemeral_app)
 
+allow ephemeral_app self:process execmem;
+auditallow ephemeral_app self:process execmem;
+
 # Allow ephemeral apps to read/write files in visible storage if provided fds
 allow ephemeral_app { sdcard_type media_rw_data_file }:file {read write getattr ioctl lock append};
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 allow ephemeral_app privapp_data_file:file { r_file_perms execute };
 allow ephemeral_app app_data_file:file     { r_file_perms execute };
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow ephemeral_app privapp_data_file:lnk_file r_file_perms;
diff --git a/private/isolated_app.te b/private/isolated_app.te
index 71749c00f6c992e8a14423e7a5e4019570d5ffbb..cffc1628b2a28a1ec0bdf3e9f5706430b73407e4 100644
--- a/private/isolated_app.te
+++ b/private/isolated_app.te
@@ -3,20 +3,23 @@
 ###
 ### This file defines the rules for isolated apps. An "isolated
 ### app" is an APP with UID between AID_ISOLATED_START (99000)
 ### and AID_ISOLATED_END (99999).
 ###
 
 typeattribute isolated_app coredomain;
 
 app_domain(isolated_app)
 
+allow isolated_app self:process execmem;
+auditallow isolated_app self:process execmem;
+
 # Access already open app data files received over Binder or local socket IPC.
 allow isolated_app { app_data_file privapp_data_file }:file { append read write getattr lock map };
 
 # Allow access to network sockets received over IPC. New socket creation is not
 # permitted.
 allow isolated_app { ephemeral_app priv_app untrusted_app_all }:{ tcp_socket udp_socket } { rw_socket_perms_no_ioctl };
 
 allow isolated_app activity_service:service_manager find;
 allow isolated_app display_service:service_manager find;
 allow isolated_app webviewupdate_service:service_manager find;
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 6e7a99cd8c64bfd8bd076a5e5420a16e1bb1bb5b..44e9295df9de755a08b4b8957898878911cbe786 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -7,10 +7,13 @@
 ### See public/untrusted_app.te for more information about which apps are
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
+
+allow untrusted_app self:process execmem;
+auditallow untrusted_app self:process execmem;
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index 41cabe878b07c7aa36bffdc85c15c095c6a1c859..fd7311bc8fee752251c5641ce4619abc1d8eb950 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_25 coredomain;
 
 app_domain(untrusted_app_25)
 untrusted_app_domain(untrusted_app_25)
 net_domain(untrusted_app_25)
 bluetooth_domain(untrusted_app_25)
 
+allow untrusted_app_25 self:process execmem;
+auditallow untrusted_app_25 self:process execmem;
+
 # b/35917228 - /proc/misc access
 # This will go away in a future Android release
 allow untrusted_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index 0993faa9bd6bbddbf53162d4f0fdf7d410b57b0a..a0e98b59f748ac6068cdbde5655f7106179da1b9 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -8,20 +8,23 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_27 coredomain;
 
 app_domain(untrusted_app_27)
 untrusted_app_domain(untrusted_app_27)
 net_domain(untrusted_app_27)
 bluetooth_domain(untrusted_app_27)
 
+allow untrusted_app_27 self:process execmem;
+auditallow untrusted_app_27 self:process execmem;
+
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
 # The ability to invoke dex2oat. Historically required by ART, now only
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index c5652b16943f79016f596b403309bb8725114ec5..c66adfc6d1c220666c34446cfac70fb45cc31c58 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -8,13 +8,16 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
+allow untrusted_app_29 self:process execmem;
+auditallow untrusted_app_29 self:process execmem;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/public/app.te b/public/app.te
index 561ddba08d4e0e79106581285fe1733ed563d025..531547bef528d98b31c9b52eba949107132be43c 100644
--- a/public/app.te
+++ b/public/app.te
@@ -1,24 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-# WebView and other application-specific JIT compilers
-allow appdomain self:process execmem;
-auditallow appdomain self:process execmem;
-
 allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.

commit 49fc8ad01d669cff9151d10e4a5a56c2e89619ee
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2020-02-25 20:12:32-0500

    remove base app app_data_file execute_no_trans
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/untrusted_base_app_25.te | 6 ------
 prebuilts/api/32.0/private/untrusted_base_app_27.te | 5 -----
 private/untrusted_base_app_25.te                    | 6 ------
 private/untrusted_base_app_27.te                    | 5 -----
 4 files changed, 22 deletions(-)

diff --git a/prebuilts/api/32.0/private/untrusted_base_app_25.te b/prebuilts/api/32.0/private/untrusted_base_app_25.te
index 2f10ebcac798afaaebfeeda7f9ea3fbddfb19f81..dd107ef5c1b8c4e68cd8184d8b17b4f484f79001 100644
--- a/prebuilts/api/32.0/private/untrusted_base_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_base_app_25.te
@@ -19,26 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
-# and 28 in untrusted_app_27.te.
-allow untrusted_base_app_25 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_25 ashmem_device:chr_file open;
 
diff --git a/prebuilts/api/32.0/private/untrusted_base_app_27.te b/prebuilts/api/32.0/private/untrusted_base_app_27.te
index b3cc763c966c94b43731e29bd4d5753bc1602175..c5135eb7a1eac5088d944066b16d54fab0f4fd0f 100644
--- a/prebuilts/api/32.0/private/untrusted_base_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_base_app_27.te
@@ -8,25 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi 26, 27, and 28.
-allow untrusted_base_app_27 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_27 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_base_app_25.te b/private/untrusted_base_app_25.te
index 2f10ebcac798afaaebfeeda7f9ea3fbddfb19f81..dd107ef5c1b8c4e68cd8184d8b17b4f484f79001 100644
--- a/private/untrusted_base_app_25.te
+++ b/private/untrusted_base_app_25.te
@@ -19,26 +19,20 @@ bluetooth_domain(untrusted_base_app_25)
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_misc:file r_file_perms;
 
 # Access to /proc/tty/drivers, to allow apps to determine if they
 # are running in an emulated environment.
 # b/33214085 b/33814662 b/33791054 b/33211769
 # https://github.com/strazzere/anti-emulator/blob/master/AntiEmulator/src/diff/strazzere/anti/emulator/FindEmulator.java
 # This will go away in a future Android release
 allow untrusted_base_app_25 proc_tty_drivers:file r_file_perms;
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi<=25. This is also allowed for targetAPIs 26, 27,
-# and 28 in untrusted_app_27.te.
-allow untrusted_base_app_25 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_25 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_25 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_base_app_27.te b/private/untrusted_base_app_27.te
index b3cc763c966c94b43731e29bd4d5753bc1602175..c5135eb7a1eac5088d944066b16d54fab0f4fd0f 100644
--- a/private/untrusted_base_app_27.te
+++ b/private/untrusted_base_app_27.te
@@ -8,25 +8,20 @@
 ### placed in this selinux domain.
 ###
 
 typeattribute untrusted_base_app_27 coredomain;
 
 app_domain(untrusted_base_app_27)
 untrusted_app_domain(untrusted_base_app_27)
 net_domain(untrusted_base_app_27)
 bluetooth_domain(untrusted_base_app_27)
 
-# The ability to call exec() on files in the apps home directories
-# for targetApi 26, 27, and 28.
-allow untrusted_base_app_27 app_data_file:file execute_no_trans;
-auditallow untrusted_base_app_27 app_data_file:file { execute execute_no_trans };
-
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_base_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_base_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_base_app_27 ashmem_device:chr_file open;
 

commit 38291eacb01f640bb309b3d45863b67f40fb92a7
Author: Renlord <me@renlord.com>
Date:   Tue 2020-02-25 22:30:48+1100

    remove base system app app_data_file execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/untrusted_app.te     | 7 +++++++
 prebuilts/api/32.0/private/untrusted_app_25.te  | 7 +++++++
 prebuilts/api/32.0/private/untrusted_app_27.te  | 7 +++++++
 prebuilts/api/32.0/private/untrusted_app_29.te  | 7 +++++++
 prebuilts/api/32.0/private/untrusted_app_all.te | 6 ------
 private/untrusted_app.te                        | 7 +++++++
 private/untrusted_app_25.te                     | 7 +++++++
 private/untrusted_app_27.te                     | 7 +++++++
 private/untrusted_app_29.te                     | 7 +++++++
 private/untrusted_app_all.te                    | 6 ------
 10 files changed, 56 insertions(+), 12 deletions(-)

diff --git a/prebuilts/api/32.0/private/untrusted_app.te b/prebuilts/api/32.0/private/untrusted_app.te
index 44e9295df9de755a08b4b8957898878911cbe786..112015c5a080496be6e9c6d09bec9c13e7fef09e 100644
--- a/prebuilts/api/32.0/private/untrusted_app.te
+++ b/prebuilts/api/32.0/private/untrusted_app.te
@@ -10,10 +10,17 @@
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
+
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=29.
+allow untrusted_app privapp_data_file:file { r_file_perms execute };
+allow untrusted_app app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app app_data_file:file execute;
diff --git a/prebuilts/api/32.0/private/untrusted_app_25.te b/prebuilts/api/32.0/private/untrusted_app_25.te
index fd7311bc8fee752251c5641ce4619abc1d8eb950..ea293e4c6101e6efe6c6c5ae065fad8827ba7598 100644
--- a/prebuilts/api/32.0/private/untrusted_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_app_25.te
@@ -32,20 +32,27 @@ allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_app_25 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=25.
+allow untrusted_app_25 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_25 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_25 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
diff --git a/prebuilts/api/32.0/private/untrusted_app_27.te b/prebuilts/api/32.0/private/untrusted_app_27.te
index a0e98b59f748ac6068cdbde5655f7106179da1b9..a9b2e35583ba8a986b7013acc5d1066faafb9e0b 100644
--- a/prebuilts/api/32.0/private/untrusted_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_app_27.te
@@ -20,20 +20,27 @@ auditallow untrusted_app_27 self:process execmem;
 
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_27 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_27 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_27 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
diff --git a/prebuilts/api/32.0/private/untrusted_app_29.te b/prebuilts/api/32.0/private/untrusted_app_29.te
index c66adfc6d1c220666c34446cfac70fb45cc31c58..215c69a9c9e05373de9891624d3fe62dab6bc611 100644
--- a/prebuilts/api/32.0/private/untrusted_app_29.te
+++ b/prebuilts/api/32.0/private/untrusted_app_29.te
@@ -11,13 +11,20 @@
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
 allow untrusted_app_29 self:process execmem;
 auditallow untrusted_app_29 self:process execmem;
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_29 app_data_file:file execute;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/prebuilts/api/32.0/private/untrusted_app_all.te b/prebuilts/api/32.0/private/untrusted_app_all.te
index 6064c1453994c2db28211905267017167a607f9c..14d881d00615a837a45ba1a89a5cb1b7247f499e 100644
--- a/prebuilts/api/32.0/private/untrusted_app_all.te
+++ b/prebuilts/api/32.0/private/untrusted_app_all.te
@@ -14,26 +14,20 @@
 ### attribute is assigned to all non-system apps as well as to any system apps
 ### that are not signed by the platform key.  To move
 ### a system app into a specific domain, add a signer entry for it to
 ### mac_permissions.xml and assign it one of the pre-existing seinfo values
 ### or define and use a new seinfo value in both mac_permissions.xml and
 ### seapp_contexts.
 ###
 ### Note that rules that should apply to all untrusted apps must be in app.te or also
 ### added to ephemeral_app.te.
 
-# Some apps ship with shared libraries and binaries that they write out
-# to their sandbox directory and then execute.
-allow untrusted_app_all privapp_data_file:file { r_file_perms execute };
-allow untrusted_app_all app_data_file:file     { r_file_perms execute };
-auditallow untrusted_app_all app_data_file:file execute;
-
 # Chrome Crashpad uses the the dynamic linker to load native executables
 # from an APK (b/112050209, crbug.com/928422)
 allow untrusted_app_all system_linker_exec:file execute_no_trans;
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow untrusted_app_all privapp_data_file:lnk_file r_file_perms;
 
 # Allow handling of less common filesystem objects
 allow untrusted_app_all app_data_file:{ lnk_file sock_file fifo_file } create_file_perms;
 
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 44e9295df9de755a08b4b8957898878911cbe786..112015c5a080496be6e9c6d09bec9c13e7fef09e 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -10,10 +10,17 @@
 
 typeattribute untrusted_app coredomain;
 
 app_domain(untrusted_app)
 untrusted_app_domain(untrusted_app)
 net_domain(untrusted_app)
 bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
+
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=29.
+allow untrusted_app privapp_data_file:file { r_file_perms execute };
+allow untrusted_app app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app app_data_file:file execute;
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index fd7311bc8fee752251c5641ce4619abc1d8eb950..ea293e4c6101e6efe6c6c5ae065fad8827ba7598 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -32,20 +32,27 @@ allow untrusted_app_25 proc_tty_drivers:file r_file_perms;
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_25 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi<=25. This is also allowed for targetAPIs 26, 27,
 # and 28 in untrusted_app_27.te.
 allow untrusted_app_25 app_data_file:file execute_no_trans;
 auditallow untrusted_app_25 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=25.
+allow untrusted_app_25 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_25 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_25 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_25 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index a0e98b59f748ac6068cdbde5655f7106179da1b9..a9b2e35583ba8a986b7013acc5d1066faafb9e0b 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -20,20 +20,27 @@ auditallow untrusted_app_27 self:process execmem;
 
 # Text relocation support for API < 23. This is now disallowed for targetSdkVersion>=Q.
 # https://android.googlesource.com/platform/bionic/+/master/android-changes-for-ndk-developers.md#text-relocations-enforced-for-api-level-23
 allow untrusted_app_27 { apk_data_file app_data_file asec_public_file }:file execmod;
 
 # The ability to call exec() on files in the apps home directories
 # for targetApi 26, 27, and 28.
 allow untrusted_app_27 app_data_file:file execute_no_trans;
 auditallow untrusted_app_27 app_data_file:file { execute execute_no_trans };
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_27 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_27 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_27 app_data_file:file execute;
+
 # The ability to invoke dex2oat. Historically required by ART, now only
 # allowed for targetApi<=28 for compat reasons.
 allow untrusted_app_27 dex2oat_exec:file rx_file_perms;
 userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 
 # The ability to talk to /dev/ashmem directly. targetApi>=29 must use
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index c66adfc6d1c220666c34446cfac70fb45cc31c58..215c69a9c9e05373de9891624d3fe62dab6bc611 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -11,13 +11,20 @@
 typeattribute untrusted_app_29 coredomain;
 
 app_domain(untrusted_app_29)
 untrusted_app_domain(untrusted_app_29)
 net_domain(untrusted_app_29)
 bluetooth_domain(untrusted_app_29)
 
 allow untrusted_app_29 self:process execmem;
 auditallow untrusted_app_29 self:process execmem;
 
+# Some apps ship with shared libraries and binaries that they write out
+# to their sandbox directory and then execute.
+# This is allowed for non-base system apps targetAPI <=27.
+allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
+allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
+auditallow untrusted_app_29 app_data_file:file execute;
+
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
diff --git a/private/untrusted_app_all.te b/private/untrusted_app_all.te
index 6064c1453994c2db28211905267017167a607f9c..14d881d00615a837a45ba1a89a5cb1b7247f499e 100644
--- a/private/untrusted_app_all.te
+++ b/private/untrusted_app_all.te
@@ -14,26 +14,20 @@
 ### attribute is assigned to all non-system apps as well as to any system apps
 ### that are not signed by the platform key.  To move
 ### a system app into a specific domain, add a signer entry for it to
 ### mac_permissions.xml and assign it one of the pre-existing seinfo values
 ### or define and use a new seinfo value in both mac_permissions.xml and
 ### seapp_contexts.
 ###
 ### Note that rules that should apply to all untrusted apps must be in app.te or also
 ### added to ephemeral_app.te.
 
-# Some apps ship with shared libraries and binaries that they write out
-# to their sandbox directory and then execute.
-allow untrusted_app_all privapp_data_file:file { r_file_perms execute };
-allow untrusted_app_all app_data_file:file     { r_file_perms execute };
-auditallow untrusted_app_all app_data_file:file execute;
-
 # Chrome Crashpad uses the the dynamic linker to load native executables
 # from an APK (b/112050209, crbug.com/928422)
 allow untrusted_app_all system_linker_exec:file execute_no_trans;
 
 # Follow priv-app symlinks. This is used for dynamite functionality.
 allow untrusted_app_all privapp_data_file:lnk_file r_file_perms;
 
 # Allow handling of less common filesystem objects
 allow untrusted_app_all app_data_file:{ lnk_file sock_file fifo_file } create_file_perms;
 

commit 1f2a0c7d9951caca9cd4aa9359df73477e88cba7
Author: Renlord <me@renlord.com>
Date:   Wed 2020-02-26 10:23:23+1100

    remove base system app ashmem execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/ephemeral_app.te    | 3 +++
 prebuilts/api/32.0/private/isolated_app.te     | 3 +++
 prebuilts/api/32.0/private/untrusted_app.te    | 3 +++
 prebuilts/api/32.0/private/untrusted_app_25.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_27.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_29.te | 3 +++
 prebuilts/api/32.0/public/app.te               | 3 ---
 private/ephemeral_app.te                       | 3 +++
 private/isolated_app.te                        | 3 +++
 private/untrusted_app.te                       | 3 +++
 private/untrusted_app_25.te                    | 3 +++
 private/untrusted_app_27.te                    | 3 +++
 private/untrusted_app_29.te                    | 3 +++
 public/app.te                                  | 3 ---
 14 files changed, 36 insertions(+), 6 deletions(-)

diff --git a/prebuilts/api/32.0/private/ephemeral_app.te b/prebuilts/api/32.0/private/ephemeral_app.te
index c4db55a55ce4f8eb4b50a5dd97112e50c15e57d4..76fdec9956d2984c41fa687fbe6617b01ac9a620 100644
--- a/prebuilts/api/32.0/private/ephemeral_app.te
+++ b/prebuilts/api/32.0/private/ephemeral_app.te
@@ -56,20 +56,23 @@ perfetto_producer(ephemeral_app)
 can_profile_heap(ephemeral_app)
 can_profile_perf(ephemeral_app)
 
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file rw_file_perms;
 
+allow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/prebuilts/api/32.0/private/isolated_app.te b/prebuilts/api/32.0/private/isolated_app.te
index cffc1628b2a28a1ec0bdf3e9f5706430b73407e4..3da789eb4d7c842f3bcae4a0df4b2b9d963accfe 100644
--- a/prebuilts/api/32.0/private/isolated_app.te
+++ b/prebuilts/api/32.0/private/isolated_app.te
@@ -63,20 +63,23 @@ dontaudit isolated_app shell_data_file:dir search;
 
 # Write app-specific trace data to the Perfetto traced damon. This requires
 # connecting to its producer socket and obtaining a (per-process) tmpfs fd.
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
+allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/prebuilts/api/32.0/private/untrusted_app.te b/prebuilts/api/32.0/private/untrusted_app.te
index 112015c5a080496be6e9c6d09bec9c13e7fef09e..6e75a408746604cf6f6e1f8a811f524130b57de5 100644
--- a/prebuilts/api/32.0/private/untrusted_app.te
+++ b/prebuilts/api/32.0/private/untrusted_app.te
@@ -17,10 +17,13 @@ bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
+
+allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/prebuilts/api/32.0/private/untrusted_app_25.te b/prebuilts/api/32.0/private/untrusted_app_25.te
index ea293e4c6101e6efe6c6c5ae065fad8827ba7598..9dd1196b1a1b69838942cb1cc672dbd328a98148 100644
--- a/prebuilts/api/32.0/private/untrusted_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_app_25.te
@@ -55,10 +55,13 @@ userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/prebuilts/api/32.0/private/untrusted_app_27.te b/prebuilts/api/32.0/private/untrusted_app_27.te
index a9b2e35583ba8a986b7013acc5d1066faafb9e0b..920515d1c151860c66fee3a193bfb6c59d85f196 100644
--- a/prebuilts/api/32.0/private/untrusted_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_app_27.te
@@ -43,10 +43,13 @@ userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/prebuilts/api/32.0/private/untrusted_app_29.te b/prebuilts/api/32.0/private/untrusted_app_29.te
index 215c69a9c9e05373de9891624d3fe62dab6bc611..8cd04e9a0058827ecb6f62984ca2f83d7cdbc95a 100644
--- a/prebuilts/api/32.0/private/untrusted_app_29.te
+++ b/prebuilts/api/32.0/private/untrusted_app_29.te
@@ -21,10 +21,13 @@ auditallow untrusted_app_29 self:process execmem;
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=27.
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/prebuilts/api/32.0/public/app.te b/prebuilts/api/32.0/public/app.te
index 531547bef528d98b31c9b52eba949107132be43c..ef39e7acfa3467141545c6a7e84edab4467deb4f 100644
--- a/prebuilts/api/32.0/public/app.te
+++ b/prebuilts/api/32.0/public/app.te
@@ -1,23 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 
diff --git a/private/ephemeral_app.te b/private/ephemeral_app.te
index c4db55a55ce4f8eb4b50a5dd97112e50c15e57d4..76fdec9956d2984c41fa687fbe6617b01ac9a620 100644
--- a/private/ephemeral_app.te
+++ b/private/ephemeral_app.te
@@ -56,20 +56,23 @@ perfetto_producer(ephemeral_app)
 can_profile_heap(ephemeral_app)
 can_profile_perf(ephemeral_app)
 
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file rw_file_perms;
 
+allow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/private/isolated_app.te b/private/isolated_app.te
index cffc1628b2a28a1ec0bdf3e9f5706430b73407e4..3da789eb4d7c842f3bcae4a0df4b2b9d963accfe 100644
--- a/private/isolated_app.te
+++ b/private/isolated_app.te
@@ -63,20 +63,23 @@ dontaudit isolated_app shell_data_file:dir search;
 
 # Write app-specific trace data to the Perfetto traced damon. This requires
 # connecting to its producer socket and obtaining a (per-process) tmpfs fd.
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
+allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 112015c5a080496be6e9c6d09bec9c13e7fef09e..6e75a408746604cf6f6e1f8a811f524130b57de5 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -17,10 +17,13 @@ bluetooth_domain(untrusted_app)
 
 allow untrusted_app self:process execmem;
 auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
+
+allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index ea293e4c6101e6efe6c6c5ae065fad8827ba7598..9dd1196b1a1b69838942cb1cc672dbd328a98148 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -55,10 +55,13 @@ userdebug_or_eng(`auditallow untrusted_app_25 dex2oat_exec:file rx_file_perms;')
 # ASharedMemory instead.
 allow untrusted_app_25 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_25 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index a9b2e35583ba8a986b7013acc5d1066faafb9e0b..920515d1c151860c66fee3a193bfb6c59d85f196 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -43,10 +43,13 @@ userdebug_or_eng(`auditallow untrusted_app_27 dex2oat_exec:file rx_file_perms;')
 # ASharedMemory instead.
 allow untrusted_app_27 ashmem_device:chr_file rw_file_perms;
 auditallow untrusted_app_27 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index 215c69a9c9e05373de9891624d3fe62dab6bc611..8cd04e9a0058827ecb6f62984ca2f83d7cdbc95a 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -21,10 +21,13 @@ auditallow untrusted_app_29 self:process execmem;
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=27.
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
+
+allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
diff --git a/public/app.te b/public/app.te
index 531547bef528d98b31c9b52eba949107132be43c..ef39e7acfa3467141545c6a7e84edab4467deb4f 100644
--- a/public/app.te
+++ b/public/app.te
@@ -1,23 +1,20 @@
 ###
 ### Domain for all zygote spawned apps
 ###
 ### This file is the base policy for all zygote spawned apps.
 ### Other policy files, such as isolated_app.te, untrusted_app.te, etc
 ### extend from this policy. Only policies which should apply to ALL
 ### zygote spawned apps should be added here.
 ###
 type appdomain_tmpfs, file_type;
 
-allow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-auditallow appdomain { ashmem_device ashmem_libcutils_device }:chr_file execute;
-
 # Receive and use open file descriptors inherited from zygote.
 allow appdomain zygote:fd use;
 
 # Receive and use open file descriptors inherited from app zygote.
 allow appdomain app_zygote:fd use;
 
 # gdbserver for ndk-gdb reads the zygote.
 # valgrind needs mmap exec for zygote
 allow appdomain zygote_exec:file rx_file_perms;
 

commit e02121f3eb0393cc66fbf9ec5424b1dffa3f7f72
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2021-03-15 12:14:36-0400

    auditallow app tmpfs execute
---
 prebuilts/api/32.0/public/te_macros | 1 +
 public/te_macros                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/public/te_macros b/prebuilts/api/32.0/public/te_macros
index 7dc5062c55759c26c6be52188022c809b63b5410..e20cced1587ccc197cbc13c18161a11d2daa2598 100644
--- a/prebuilts/api/32.0/public/te_macros
+++ b/prebuilts/api/32.0/public/te_macros
@@ -180,20 +180,21 @@ neverallow $1 ~$1_userfaultfd:anon_inode *;
 
 #####################################
 # app_domain(domain)
 # Allow a base set of permissions required for all apps.
 define(`app_domain', `
 typeattribute $1 appdomain;
 # Label tmpfs objects for all apps.
 type_transition $1 tmpfs:file appdomain_tmpfs;
 userfaultfd_use($1)
 allow $1 appdomain_tmpfs:file { execute getattr map read write };
+auditallow $1 appdomain_tmpfs:file execute;
 neverallow { $1 -runas_app -shell -simpleperf } { domain -$1 }:file no_rw_file_perms;
 neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_perms;
 # The Android security model guarantees the confidentiality and integrity
 # of application data and execution state. Ptrace bypasses those
 # confidentiality guarantees. Disallow ptrace access from system components to
 # apps. crash_dump is excluded, as it needs ptrace access to produce stack
 # traces. runas_app is excluded, as it operates only on debuggable apps.
 # simpleperf is excluded, as it operates only on debuggable or profileable
 # apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
 # live lock conditions.
diff --git a/public/te_macros b/public/te_macros
index 7dc5062c55759c26c6be52188022c809b63b5410..e20cced1587ccc197cbc13c18161a11d2daa2598 100644
--- a/public/te_macros
+++ b/public/te_macros
@@ -180,20 +180,21 @@ neverallow $1 ~$1_userfaultfd:anon_inode *;
 
 #####################################
 # app_domain(domain)
 # Allow a base set of permissions required for all apps.
 define(`app_domain', `
 typeattribute $1 appdomain;
 # Label tmpfs objects for all apps.
 type_transition $1 tmpfs:file appdomain_tmpfs;
 userfaultfd_use($1)
 allow $1 appdomain_tmpfs:file { execute getattr map read write };
+auditallow $1 appdomain_tmpfs:file execute;
 neverallow { $1 -runas_app -shell -simpleperf } { domain -$1 }:file no_rw_file_perms;
 neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_perms;
 # The Android security model guarantees the confidentiality and integrity
 # of application data and execution state. Ptrace bypasses those
 # confidentiality guarantees. Disallow ptrace access from system components to
 # apps. crash_dump is excluded, as it needs ptrace access to produce stack
 # traces. runas_app is excluded, as it operates only on debuggable apps.
 # simpleperf is excluded, as it operates only on debuggable or profileable
 # apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
 # live lock conditions.

commit 04cca9823bb0f8f267417387b668d43045e777c7
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Mon 2021-03-15 12:34:49-0400

    remove base system app tmpfs execute
---
 prebuilts/api/32.0/private/ephemeral_app.te    | 3 +++
 prebuilts/api/32.0/private/isolated_app.te     | 3 +++
 prebuilts/api/32.0/private/untrusted_app.te    | 3 +++
 prebuilts/api/32.0/private/untrusted_app_25.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_27.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_29.te | 3 +++
 prebuilts/api/32.0/public/te_macros            | 3 +--
 private/ephemeral_app.te                       | 3 +++
 private/isolated_app.te                        | 3 +++
 private/untrusted_app.te                       | 3 +++
 private/untrusted_app_25.te                    | 3 +++
 private/untrusted_app_27.te                    | 3 +++
 private/untrusted_app_29.te                    | 3 +++
 public/te_macros                               | 3 +--
 14 files changed, 38 insertions(+), 4 deletions(-)

diff --git a/prebuilts/api/32.0/private/ephemeral_app.te b/prebuilts/api/32.0/private/ephemeral_app.te
index 76fdec9956d2984c41fa687fbe6617b01ac9a620..bd8225247f7f2b62a45632f294f2ef3afb9109a0 100644
--- a/prebuilts/api/32.0/private/ephemeral_app.te
+++ b/prebuilts/api/32.0/private/ephemeral_app.te
@@ -59,20 +59,23 @@ can_profile_perf(ephemeral_app)
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file rw_file_perms;
 
 allow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
+allow ephemeral_app appdomain_tmpfs:file execute;
+auditallow ephemeral_app appdomain_tmpfs:file execute;
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/prebuilts/api/32.0/private/isolated_app.te b/prebuilts/api/32.0/private/isolated_app.te
index 3da789eb4d7c842f3bcae4a0df4b2b9d963accfe..c287f4f1fe2fc1a1a982750decf29ad75fcfd553 100644
--- a/prebuilts/api/32.0/private/isolated_app.te
+++ b/prebuilts/api/32.0/private/isolated_app.te
@@ -66,20 +66,23 @@ dontaudit isolated_app shell_data_file:dir search;
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
 allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
+allow isolated_app appdomain_tmpfs:file execute;
+auditallow isolated_app appdomain_tmpfs:file execute;
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/prebuilts/api/32.0/private/untrusted_app.te b/prebuilts/api/32.0/private/untrusted_app.te
index 6e75a408746604cf6f6e1f8a811f524130b57de5..6789215f7587eed1f4e53322555a06aef3454a49 100644
--- a/prebuilts/api/32.0/private/untrusted_app.te
+++ b/prebuilts/api/32.0/private/untrusted_app.te
@@ -20,10 +20,13 @@ auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
 
 allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app appdomain_tmpfs:file execute;
+auditallow untrusted_app appdomain_tmpfs:file execute;
diff --git a/prebuilts/api/32.0/private/untrusted_app_25.te b/prebuilts/api/32.0/private/untrusted_app_25.te
index 9dd1196b1a1b69838942cb1cc672dbd328a98148..a402b72ea00332d90128c6b7d2ce7b46824b0907 100644
--- a/prebuilts/api/32.0/private/untrusted_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_app_25.te
@@ -58,10 +58,13 @@ auditallow untrusted_app_25 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_25 appdomain_tmpfs:file execute;
+auditallow untrusted_app_25 appdomain_tmpfs:file execute;
diff --git a/prebuilts/api/32.0/private/untrusted_app_27.te b/prebuilts/api/32.0/private/untrusted_app_27.te
index 920515d1c151860c66fee3a193bfb6c59d85f196..b541a9f0d6cb83b5fe757f36656ce497f89a69e6 100644
--- a/prebuilts/api/32.0/private/untrusted_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_app_27.te
@@ -46,10 +46,13 @@ auditallow untrusted_app_27 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_27 appdomain_tmpfs:file execute;
+auditallow untrusted_app_27 appdomain_tmpfs:file execute;
diff --git a/prebuilts/api/32.0/private/untrusted_app_29.te b/prebuilts/api/32.0/private/untrusted_app_29.te
index 8cd04e9a0058827ecb6f62984ca2f83d7cdbc95a..906a4c1d8e3a4465411adf1d534a93f9b2e695a8 100644
--- a/prebuilts/api/32.0/private/untrusted_app_29.te
+++ b/prebuilts/api/32.0/private/untrusted_app_29.te
@@ -24,10 +24,13 @@ auditallow untrusted_app_29 self:process execmem;
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_29 appdomain_tmpfs:file execute;
+auditallow untrusted_app_29 appdomain_tmpfs:file execute;
diff --git a/prebuilts/api/32.0/public/te_macros b/prebuilts/api/32.0/public/te_macros
index e20cced1587ccc197cbc13c18161a11d2daa2598..ca7f61d7cd2c5c732e7783db72316b67cbd5973f 100644
--- a/prebuilts/api/32.0/public/te_macros
+++ b/prebuilts/api/32.0/public/te_macros
@@ -179,22 +179,21 @@ neverallow $1 ~$1_userfaultfd:anon_inode *;
 ')
 
 #####################################
 # app_domain(domain)
 # Allow a base set of permissions required for all apps.
 define(`app_domain', `
 typeattribute $1 appdomain;
 # Label tmpfs objects for all apps.
 type_transition $1 tmpfs:file appdomain_tmpfs;
 userfaultfd_use($1)
-allow $1 appdomain_tmpfs:file { execute getattr map read write };
-auditallow $1 appdomain_tmpfs:file execute;
+allow $1 appdomain_tmpfs:file { getattr map read write };
 neverallow { $1 -runas_app -shell -simpleperf } { domain -$1 }:file no_rw_file_perms;
 neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_perms;
 # The Android security model guarantees the confidentiality and integrity
 # of application data and execution state. Ptrace bypasses those
 # confidentiality guarantees. Disallow ptrace access from system components to
 # apps. crash_dump is excluded, as it needs ptrace access to produce stack
 # traces. runas_app is excluded, as it operates only on debuggable apps.
 # simpleperf is excluded, as it operates only on debuggable or profileable
 # apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
 # live lock conditions.
diff --git a/private/ephemeral_app.te b/private/ephemeral_app.te
index 76fdec9956d2984c41fa687fbe6617b01ac9a620..bd8225247f7f2b62a45632f294f2ef3afb9109a0 100644
--- a/private/ephemeral_app.te
+++ b/private/ephemeral_app.te
@@ -59,20 +59,23 @@ can_profile_perf(ephemeral_app)
 # allow ephemeral apps to use UDP sockets provided by the system server but not
 # modify them other than to connect
 allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file rw_file_perms;
 
 allow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
+allow ephemeral_app appdomain_tmpfs:file execute;
+auditallow ephemeral_app appdomain_tmpfs:file execute;
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/private/isolated_app.te b/private/isolated_app.te
index 3da789eb4d7c842f3bcae4a0df4b2b9d963accfe..c287f4f1fe2fc1a1a982750decf29ad75fcfd553 100644
--- a/private/isolated_app.te
+++ b/private/isolated_app.te
@@ -66,20 +66,23 @@ dontaudit isolated_app shell_data_file:dir search;
 perfetto_producer(isolated_app)
 
 # Allow profiling if the main app has been marked as profileable or
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
 allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
+allow isolated_app appdomain_tmpfs:file execute;
+auditallow isolated_app appdomain_tmpfs:file execute;
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 6e75a408746604cf6f6e1f8a811f524130b57de5..6789215f7587eed1f4e53322555a06aef3454a49 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -20,10 +20,13 @@ auditallow untrusted_app self:process execmem;
 
 # Some apps ship with shared libraries and binaries that they write out
 # to their sandbox directory and then execute.
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
 
 allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app appdomain_tmpfs:file execute;
+auditallow untrusted_app appdomain_tmpfs:file execute;
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index 9dd1196b1a1b69838942cb1cc672dbd328a98148..a402b72ea00332d90128c6b7d2ce7b46824b0907 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -58,10 +58,13 @@ auditallow untrusted_app_25 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_25 appdomain_tmpfs:file execute;
+auditallow untrusted_app_25 appdomain_tmpfs:file execute;
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index 920515d1c151860c66fee3a193bfb6c59d85f196..b541a9f0d6cb83b5fe757f36656ce497f89a69e6 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -46,10 +46,13 @@ auditallow untrusted_app_27 ashmem_device:chr_file open;
 
 # Read /mnt/sdcard symlink.
 allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_27 appdomain_tmpfs:file execute;
+auditallow untrusted_app_27 appdomain_tmpfs:file execute;
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index 8cd04e9a0058827ecb6f62984ca2f83d7cdbc95a..906a4c1d8e3a4465411adf1d534a93f9b2e695a8 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -24,10 +24,13 @@ auditallow untrusted_app_29 self:process execmem;
 allow untrusted_app_29 privapp_data_file:file { r_file_perms execute };
 allow untrusted_app_29 app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
+
+allow untrusted_app_29 appdomain_tmpfs:file execute;
+auditallow untrusted_app_29 appdomain_tmpfs:file execute;
diff --git a/public/te_macros b/public/te_macros
index e20cced1587ccc197cbc13c18161a11d2daa2598..ca7f61d7cd2c5c732e7783db72316b67cbd5973f 100644
--- a/public/te_macros
+++ b/public/te_macros
@@ -179,22 +179,21 @@ neverallow $1 ~$1_userfaultfd:anon_inode *;
 ')
 
 #####################################
 # app_domain(domain)
 # Allow a base set of permissions required for all apps.
 define(`app_domain', `
 typeattribute $1 appdomain;
 # Label tmpfs objects for all apps.
 type_transition $1 tmpfs:file appdomain_tmpfs;
 userfaultfd_use($1)
-allow $1 appdomain_tmpfs:file { execute getattr map read write };
-auditallow $1 appdomain_tmpfs:file execute;
+allow $1 appdomain_tmpfs:file { getattr map read write };
 neverallow { $1 -runas_app -shell -simpleperf } { domain -$1 }:file no_rw_file_perms;
 neverallow { appdomain -runas_app -shell -simpleperf -$1 } $1:file no_rw_file_perms;
 # The Android security model guarantees the confidentiality and integrity
 # of application data and execution state. Ptrace bypasses those
 # confidentiality guarantees. Disallow ptrace access from system components to
 # apps. crash_dump is excluded, as it needs ptrace access to produce stack
 # traces. runas_app is excluded, as it operates only on debuggable apps.
 # simpleperf is excluded, as it operates only on debuggable or profileable
 # apps. llkd is excluded, as it needs ptrace access to inspect stack traces for
 # live lock conditions.

commit a893abb1edba356ca346736252cded517cde61ab
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Sat 2020-02-29 11:03:35-0500

    auditallow apk_data_file execute
    
    For libraries, apps should be migrating to the more modern approach of
    storing them in the apk uncompressed and mapping them directly from it.
    
    This is the most modern approach available for executables and is better
    than using app data, but ideally it wouldn't be done. For now, audit use
    of `execute_no_trans` anyway while this is given more thought.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/public/app.te | 1 +
 public/app.te                    | 1 +
 2 files changed, 2 insertions(+)

diff --git a/prebuilts/api/32.0/public/app.te b/prebuilts/api/32.0/public/app.te
index ef39e7acfa3467141545c6a7e84edab4467deb4f..21650e1ae868a2980b94def4f27da95e6a9133a3 100644
--- a/prebuilts/api/32.0/public/app.te
+++ b/prebuilts/api/32.0/public/app.te
@@ -277,20 +277,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
 allow appdomain apk_data_file:file rx_file_perms;
+auditallow appdomain apk_data_file:file { execute execute_no_trans };
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
diff --git a/public/app.te b/public/app.te
index ef39e7acfa3467141545c6a7e84edab4467deb4f..21650e1ae868a2980b94def4f27da95e6a9133a3 100644
--- a/public/app.te
+++ b/public/app.te
@@ -277,20 +277,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
 allow appdomain apk_data_file:file rx_file_perms;
+auditallow appdomain apk_data_file:file { execute execute_no_trans };
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;

commit dc522f976db7b6080fd4c20e6d967b404ea266f7
Author: Renlord <me@renlord.com>
Date:   Thu 2020-02-27 20:37:55+1100

    remove base system app apk_data_file execute
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/ephemeral_app.te    | 3 +++
 prebuilts/api/32.0/private/isolated_app.te     | 3 +++
 prebuilts/api/32.0/private/untrusted_app.te    | 3 +++
 prebuilts/api/32.0/private/untrusted_app_25.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_27.te | 3 +++
 prebuilts/api/32.0/private/untrusted_app_29.te | 3 +++
 prebuilts/api/32.0/public/app.te               | 3 +--
 private/ephemeral_app.te                       | 3 +++
 private/isolated_app.te                        | 3 +++
 private/untrusted_app.te                       | 3 +++
 private/untrusted_app_25.te                    | 3 +++
 private/untrusted_app_27.te                    | 3 +++
 private/untrusted_app_29.te                    | 3 +++
 public/app.te                                  | 3 +--
 14 files changed, 38 insertions(+), 4 deletions(-)

diff --git a/prebuilts/api/32.0/private/ephemeral_app.te b/prebuilts/api/32.0/private/ephemeral_app.te
index bd8225247f7f2b62a45632f294f2ef3afb9109a0..39576e02edb2c289bc70c62cb107cbdb36e5cea2 100644
--- a/prebuilts/api/32.0/private/ephemeral_app.te
+++ b/prebuilts/api/32.0/private/ephemeral_app.te
@@ -62,20 +62,23 @@ allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file rw_file_perms;
 
 allow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow ephemeral_app appdomain_tmpfs:file execute;
 auditallow ephemeral_app appdomain_tmpfs:file execute;
 
+allow ephemeral_app apk_data_file:file { execute execute_no_trans };
+auditallow ephemeral_app apk_data_file:file { execute execute_no_trans };
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/prebuilts/api/32.0/private/isolated_app.te b/prebuilts/api/32.0/private/isolated_app.te
index c287f4f1fe2fc1a1a982750decf29ad75fcfd553..e7fbdedc99962a49c7dd787bfe26c972da614026 100644
--- a/prebuilts/api/32.0/private/isolated_app.te
+++ b/prebuilts/api/32.0/private/isolated_app.te
@@ -69,20 +69,23 @@ perfetto_producer(isolated_app)
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
 allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow isolated_app appdomain_tmpfs:file execute;
 auditallow isolated_app appdomain_tmpfs:file execute;
 
+allow isolated_app apk_data_file:file { execute execute_no_trans };
+auditallow isolated_app apk_data_file:file { execute execute_no_trans };
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/prebuilts/api/32.0/private/untrusted_app.te b/prebuilts/api/32.0/private/untrusted_app.te
index 6789215f7587eed1f4e53322555a06aef3454a49..4662b8fc743c2f1936c4146f3bca152ca6dbe757 100644
--- a/prebuilts/api/32.0/private/untrusted_app.te
+++ b/prebuilts/api/32.0/private/untrusted_app.te
@@ -23,10 +23,13 @@ auditallow untrusted_app self:process execmem;
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
 
 allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app appdomain_tmpfs:file execute;
 auditallow untrusted_app appdomain_tmpfs:file execute;
+
+allow untrusted_app apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/32.0/private/untrusted_app_25.te b/prebuilts/api/32.0/private/untrusted_app_25.te
index a402b72ea00332d90128c6b7d2ce7b46824b0907..5cc71a3bba854e0f48b3d03c58813b368fe79bdb 100644
--- a/prebuilts/api/32.0/private/untrusted_app_25.te
+++ b/prebuilts/api/32.0/private/untrusted_app_25.te
@@ -61,10 +61,13 @@ allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app_25 appdomain_tmpfs:file execute;
 auditallow untrusted_app_25 appdomain_tmpfs:file execute;
+
+allow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/32.0/private/untrusted_app_27.te b/prebuilts/api/32.0/private/untrusted_app_27.te
index b541a9f0d6cb83b5fe757f36656ce497f89a69e6..44f96abd63f6f37936c2d7cac9e0de049164b128 100644
--- a/prebuilts/api/32.0/private/untrusted_app_27.te
+++ b/prebuilts/api/32.0/private/untrusted_app_27.te
@@ -49,10 +49,13 @@ allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app_27 appdomain_tmpfs:file execute;
 auditallow untrusted_app_27 appdomain_tmpfs:file execute;
+
+allow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/32.0/private/untrusted_app_29.te b/prebuilts/api/32.0/private/untrusted_app_29.te
index 906a4c1d8e3a4465411adf1d534a93f9b2e695a8..6a3904e49b91720eec0ce5e8e8575dcc2d6b6012 100644
--- a/prebuilts/api/32.0/private/untrusted_app_29.te
+++ b/prebuilts/api/32.0/private/untrusted_app_29.te
@@ -27,10 +27,13 @@ auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app_29 appdomain_tmpfs:file execute;
 auditallow untrusted_app_29 appdomain_tmpfs:file execute;
+
+allow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
diff --git a/prebuilts/api/32.0/public/app.te b/prebuilts/api/32.0/public/app.te
index 21650e1ae868a2980b94def4f27da95e6a9133a3..d5fb12604fa44e5504d382836f5a0fa3f7453756 100644
--- a/prebuilts/api/32.0/public/app.te
+++ b/prebuilts/api/32.0/public/app.te
@@ -276,22 +276,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
-allow appdomain apk_data_file:file rx_file_perms;
-auditallow appdomain apk_data_file:file { execute execute_no_trans };
+allow appdomain apk_data_file:file r_file_perms;
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;
diff --git a/private/ephemeral_app.te b/private/ephemeral_app.te
index bd8225247f7f2b62a45632f294f2ef3afb9109a0..39576e02edb2c289bc70c62cb107cbdb36e5cea2 100644
--- a/private/ephemeral_app.te
+++ b/private/ephemeral_app.te
@@ -62,20 +62,23 @@ allow ephemeral_app system_server:udp_socket {
         connect getattr read recvfrom sendto write getopt setopt };
 
 allow ephemeral_app ashmem_device:chr_file rw_file_perms;
 
 allow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow ephemeral_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow ephemeral_app appdomain_tmpfs:file execute;
 auditallow ephemeral_app appdomain_tmpfs:file execute;
 
+allow ephemeral_app apk_data_file:file { execute execute_no_trans };
+auditallow ephemeral_app apk_data_file:file { execute execute_no_trans };
+
 ###
 ### neverallow rules
 ###
 
 neverallow ephemeral_app { app_data_file privapp_data_file }:file execute_no_trans;
 
 # Receive or send uevent messages.
 neverallow ephemeral_app domain:netlink_kobject_uevent_socket *;
 
 # Receive or send generic netlink messages
diff --git a/private/isolated_app.te b/private/isolated_app.te
index c287f4f1fe2fc1a1a982750decf29ad75fcfd553..e7fbdedc99962a49c7dd787bfe26c972da614026 100644
--- a/private/isolated_app.te
+++ b/private/isolated_app.te
@@ -69,20 +69,23 @@ perfetto_producer(isolated_app)
 # debuggable.
 can_profile_heap(isolated_app)
 can_profile_perf(isolated_app)
 
 allow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow isolated_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow isolated_app appdomain_tmpfs:file execute;
 auditallow isolated_app appdomain_tmpfs:file execute;
 
+allow isolated_app apk_data_file:file { execute execute_no_trans };
+auditallow isolated_app apk_data_file:file { execute execute_no_trans };
+
 #####
 ##### Neverallow
 #####
 
 # Isolated apps should not directly open app data files themselves.
 neverallow isolated_app { app_data_file privapp_data_file }:file open;
 
 # Only allow appending to /data/anr/traces.txt (b/27853304, b/18340553)
 # TODO: are there situations where isolated_apps write to this file?
 # TODO: should we tighten these restrictions further?
diff --git a/private/untrusted_app.te b/private/untrusted_app.te
index 6789215f7587eed1f4e53322555a06aef3454a49..4662b8fc743c2f1936c4146f3bca152ca6dbe757 100644
--- a/private/untrusted_app.te
+++ b/private/untrusted_app.te
@@ -23,10 +23,13 @@ auditallow untrusted_app self:process execmem;
 # This is allowed for non-base system apps targetAPI <=29.
 allow untrusted_app privapp_data_file:file { r_file_perms execute };
 allow untrusted_app app_data_file:file     { r_file_perms execute };
 auditallow untrusted_app app_data_file:file execute;
 
 allow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app appdomain_tmpfs:file execute;
 auditallow untrusted_app appdomain_tmpfs:file execute;
+
+allow untrusted_app apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app apk_data_file:file { execute execute_no_trans };
diff --git a/private/untrusted_app_25.te b/private/untrusted_app_25.te
index a402b72ea00332d90128c6b7d2ce7b46824b0907..5cc71a3bba854e0f48b3d03c58813b368fe79bdb 100644
--- a/private/untrusted_app_25.te
+++ b/private/untrusted_app_25.te
@@ -61,10 +61,13 @@ allow untrusted_app_25 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_25 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_25 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app_25 appdomain_tmpfs:file execute;
 auditallow untrusted_app_25 appdomain_tmpfs:file execute;
+
+allow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_25 apk_data_file:file { execute execute_no_trans };
diff --git a/private/untrusted_app_27.te b/private/untrusted_app_27.te
index b541a9f0d6cb83b5fe757f36656ce497f89a69e6..44f96abd63f6f37936c2d7cac9e0de049164b128 100644
--- a/private/untrusted_app_27.te
+++ b/private/untrusted_app_27.te
@@ -49,10 +49,13 @@ allow untrusted_app_27 mnt_sdcard_file:lnk_file r_file_perms;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_27 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_27 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app_27 appdomain_tmpfs:file execute;
 auditallow untrusted_app_27 appdomain_tmpfs:file execute;
+
+allow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_27 apk_data_file:file { execute execute_no_trans };
diff --git a/private/untrusted_app_29.te b/private/untrusted_app_29.te
index 906a4c1d8e3a4465411adf1d534a93f9b2e695a8..6a3904e49b91720eec0ce5e8e8575dcc2d6b6012 100644
--- a/private/untrusted_app_29.te
+++ b/private/untrusted_app_29.te
@@ -27,10 +27,13 @@ auditallow untrusted_app_29 app_data_file:file execute;
 
 # allow binding to netlink route sockets and sending RTM_GETLINK messages.
 allow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 auditallow untrusted_app_29 self:netlink_route_socket { bind nlmsg_readpriv };
 
 allow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 auditallow untrusted_app_29 { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 allow untrusted_app_29 appdomain_tmpfs:file execute;
 auditallow untrusted_app_29 appdomain_tmpfs:file execute;
+
+allow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
+auditallow untrusted_app_29 apk_data_file:file { execute execute_no_trans };
diff --git a/public/app.te b/public/app.te
index 21650e1ae868a2980b94def4f27da95e6a9133a3..d5fb12604fa44e5504d382836f5a0fa3f7453756 100644
--- a/public/app.te
+++ b/public/app.te
@@ -276,22 +276,21 @@ allow { appdomain -isolated_app -isolated_base_app -ephemeral_app } usbaccessory
 # For art.
 allow appdomain dalvikcache_data_file:file execute;
 allow appdomain dalvikcache_data_file:lnk_file r_file_perms;
 
 # Allow any app to read shared RELRO files.
 allow appdomain shared_relro_file:dir search;
 allow appdomain shared_relro_file:file r_file_perms;
 
 # Allow apps to read/execute installed binaries
 allow appdomain apk_data_file:dir r_dir_perms;
-allow appdomain apk_data_file:file rx_file_perms;
-auditallow appdomain apk_data_file:file { execute execute_no_trans };
+allow appdomain apk_data_file:file r_file_perms;
 
 # /data/resource-cache
 allow appdomain resourcecache_data_file:file r_file_perms;
 allow appdomain resourcecache_data_file:dir r_dir_perms;
 
 # logd access
 read_logd(appdomain)
 control_logd({ appdomain -ephemeral_app })
 # application inherit logd write socket (urge is to deprecate this long term)
 allow appdomain zygote:unix_dgram_socket write;

commit e3a7636b9d6740e140c492f265dcd157a20066c8
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Tue 2020-02-25 06:41:22-0500

    remove zygote execmem
    
    GrapheneOS doesn't use the ART JIT compiler.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/app_zygote.te     | 3 ---
 prebuilts/api/32.0/private/webview_zygote.te | 3 ---
 prebuilts/api/32.0/private/zygote.te         | 1 -
 private/app_zygote.te                        | 3 ---
 private/webview_zygote.te                    | 3 ---
 private/zygote.te                            | 1 -
 6 files changed, 14 deletions(-)

diff --git a/prebuilts/api/32.0/private/app_zygote.te b/prebuilts/api/32.0/private/app_zygote.te
index e671a99216698750dd3c1f5f3bc37b82b54fae09..6b8bb6330bc810bdba84597bc23df4d471007ac9 100644
--- a/prebuilts/api/32.0/private/app_zygote.te
+++ b/prebuilts/api/32.0/private/app_zygote.te
@@ -11,23 +11,20 @@ tmpfs_domain(app_zygote);
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
 allow app_zygote isolated_base_app:process dyntransition;
 
-# For JIT
-allow app_zygote self:process execmem;
-
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
diff --git a/prebuilts/api/32.0/private/webview_zygote.te b/prebuilts/api/32.0/private/webview_zygote.te
index 7dcfb5385c84c40e9047f28938963ad9ef8c43e9..81a1c2aa659aafd4b369c41d203d7c8003ced854 100644
--- a/prebuilts/api/32.0/private/webview_zygote.te
+++ b/prebuilts/api/32.0/private/webview_zygote.te
@@ -29,23 +29,20 @@ allow webview_zygote self:global_capability_class_set setpcap;
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
 allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:file { r_file_perms execute };
 allow webview_zygote apex_module_data_file:dir search;
 
-# Allow webview_zygote to create JIT memory.
-allow webview_zygote self:process execmem;
-
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
diff --git a/prebuilts/api/32.0/private/zygote.te b/prebuilts/api/32.0/private/zygote.te
index 743647ec7a1c3b13a3178351ceb5a09bd0d17d24..af16e661f6a887f506aba13d4aef0c4e1fd1ed7c 100644
--- a/prebuilts/api/32.0/private/zygote.te
+++ b/prebuilts/api/32.0/private/zygote.te
@@ -90,21 +90,20 @@ allow zygote tmpfs:lnk_file create;
 allow zygote mirror_data_file:dir r_dir_perms;
 
 # Get inode of directories for app data isolation
 allow zygote {
   app_data_file_type
   system_data_file
   mnt_expand_file
 }:dir getattr;
 
 # Allow zygote to create JIT memory.
-allow zygote self:process execmem;
 allow zygote zygote_tmpfs:file execute;
 allow zygote ashmem_libcutils_device:chr_file execute;
 
 # Execute idmap and dex2oat within zygote's own domain.
 # TODO:  Should either of these be transitioned to the same domain
 # used by installd or stay in-domain for zygote?
 allow zygote idmap_exec:file rx_file_perms;
 allow zygote dex2oat_exec:file rx_file_perms;
 
 # Allow apps access to /vendor/overlay
diff --git a/private/app_zygote.te b/private/app_zygote.te
index e671a99216698750dd3c1f5f3bc37b82b54fae09..6b8bb6330bc810bdba84597bc23df4d471007ac9 100644
--- a/private/app_zygote.te
+++ b/private/app_zygote.te
@@ -11,23 +11,20 @@ tmpfs_domain(app_zygote);
 # Set the UID/GID of the process.
 # This will be further limited to a range of isolated UIDs with seccomp.
 allow app_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow app_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to isolated app domain.
 allow app_zygote self:process setcurrent;
 allow app_zygote isolated_app:process dyntransition;
 allow app_zygote isolated_base_app:process dyntransition;
 
-# For JIT
-allow app_zygote self:process execmem;
-
 # Allow app_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow app_zygote debugfs_trace_marker:file getattr;
 
 # get system_server process group
 allow app_zygote system_server:process getpgid;
 
 # Interaction between the app_zygote and its children.
 allow app_zygote isolated_app:process setpgid;
diff --git a/private/webview_zygote.te b/private/webview_zygote.te
index 7dcfb5385c84c40e9047f28938963ad9ef8c43e9..81a1c2aa659aafd4b369c41d203d7c8003ced854 100644
--- a/private/webview_zygote.te
+++ b/private/webview_zygote.te
@@ -29,23 +29,20 @@ allow webview_zygote self:global_capability_class_set setpcap;
 allow webview_zygote self:process setcurrent;
 allow webview_zygote isolated_app:process dyntransition;
 allow webview_zygote isolated_base_app:process dyntransition;
 
 # For art.
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:dir r_dir_perms;
 allow webview_zygote dalvikcache_data_file:lnk_file r_file_perms;
 allow webview_zygote { apex_art_data_file dalvikcache_data_file }:file { r_file_perms execute };
 allow webview_zygote apex_module_data_file:dir search;
 
-# Allow webview_zygote to create JIT memory.
-allow webview_zygote self:process execmem;
-
 # Allow webview_zygote to stat the files that it opens. It must
 # be able to inspect them so that it can reopen them on fork
 # if necessary: b/30963384.
 allow webview_zygote debugfs_trace_marker:file getattr;
 
 # Allow webview_zygote to manage the pgroup of its children.
 allow webview_zygote system_server:process getpgid;
 
 # Interaction between the webview_zygote and its children.
 allow webview_zygote isolated_app:process setpgid;
diff --git a/private/zygote.te b/private/zygote.te
index 743647ec7a1c3b13a3178351ceb5a09bd0d17d24..af16e661f6a887f506aba13d4aef0c4e1fd1ed7c 100644
--- a/private/zygote.te
+++ b/private/zygote.te
@@ -90,21 +90,20 @@ allow zygote tmpfs:lnk_file create;
 allow zygote mirror_data_file:dir r_dir_perms;
 
 # Get inode of directories for app data isolation
 allow zygote {
   app_data_file_type
   system_data_file
   mnt_expand_file
 }:dir getattr;
 
 # Allow zygote to create JIT memory.
-allow zygote self:process execmem;
 allow zygote zygote_tmpfs:file execute;
 allow zygote ashmem_libcutils_device:chr_file execute;
 
 # Execute idmap and dex2oat within zygote's own domain.
 # TODO:  Should either of these be transitioned to the same domain
 # used by installd or stay in-domain for zygote?
 allow zygote idmap_exec:file rx_file_perms;
 allow zygote dex2oat_exec:file rx_file_perms;
 
 # Allow apps access to /vendor/overlay

commit 6e4c68b78f48c1b2424d10f98c8da4a59f39de3f
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Wed 2020-02-26 18:29:13-0500

    remove zygote access to apk_data_file
    
    GrapheneOS doesn't use out-of-band updates for base system apps (with a
    few exceptions) or APEX, so the zygote should never require this access.
    
    GrapheneOS also uses exec-based app spawning so it doesn't benefit from
    preloading in the standard code path.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/app_zygote.te     | 5 -----
 prebuilts/api/32.0/private/webview_zygote.te | 5 -----
 private/app_zygote.te                        | 5 -----
 private/webview_zygote.te                    | 5 -----
 4 files changed, 20 deletions(-)

diff --git a/prebuilts/api/32.0/private/app_zygote.te b/prebuilts/api/32.0/private/app_zygote.te
index 6b8bb6330bc810bdba84597bc23df4d471007ac9..819ddc8f5e249bff19d1e192b2b8fd7047e0beac 100644
--- a/prebuilts/api/32.0/private/app_zygote.te
+++ b/prebuilts/api/32.0/private/app_zygote.te
@@ -53,25 +53,20 @@ allow app_zygote zygote:process sigchld;
 
 # For ART (read /data/dalvik-cache).
 r_dir_file(app_zygote, dalvikcache_data_file);
 allow app_zygote dalvikcache_data_file:file execute;
 
 # Read /data/misc/apexdata/ to (get to com.android.art/dalvik-cache).
 allow app_zygote apex_module_data_file:dir search;
 # For ART APEX (read /data/misc/apexdata/com.android.art/dalvik-cache).
 r_dir_file(app_zygote, apex_art_data_file)
 
-# Allow reading/executing installed binaries to enable preloading
-# application data
-allow app_zygote apk_data_file:dir r_dir_perms;
-allow app_zygote apk_data_file:file { r_file_perms execute };
-
 # /oem accesses.
 allow app_zygote oemfs:dir search;
 
 # Allow app_zygote access to /vendor/overlay
 r_dir_file(app_zygote, vendor_overlay_file)
 
 allow app_zygote system_data_file:lnk_file r_file_perms;
 allow app_zygote system_data_file:file { getattr read map };
 
 # Send unsolicited message to system_server
diff --git a/prebuilts/api/32.0/private/webview_zygote.te b/prebuilts/api/32.0/private/webview_zygote.te
index 81a1c2aa659aafd4b369c41d203d7c8003ced854..61594080a219149da2845e75051e4715b1b7ed9c 100644
--- a/prebuilts/api/32.0/private/webview_zygote.te
+++ b/prebuilts/api/32.0/private/webview_zygote.te
@@ -5,25 +5,20 @@ typeattribute webview_zygote coredomain;
 
 # The webview_zygote needs to be able to transition domains.
 typeattribute webview_zygote mlstrustedsubject;
 
 # Allow access to temporary files, which is normally permitted through
 # a domain macro.
 tmpfs_domain(webview_zygote);
 
 userfaultfd_use(webview_zygote)
 
-# Allow reading/executing installed binaries to enable preloading the
-# installed WebView implementation.
-allow webview_zygote apk_data_file:dir r_dir_perms;
-allow webview_zygote apk_data_file:file { r_file_perms execute };
-
 # Access to the WebView relro file.
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;
diff --git a/private/app_zygote.te b/private/app_zygote.te
index 6b8bb6330bc810bdba84597bc23df4d471007ac9..819ddc8f5e249bff19d1e192b2b8fd7047e0beac 100644
--- a/private/app_zygote.te
+++ b/private/app_zygote.te
@@ -53,25 +53,20 @@ allow app_zygote zygote:process sigchld;
 
 # For ART (read /data/dalvik-cache).
 r_dir_file(app_zygote, dalvikcache_data_file);
 allow app_zygote dalvikcache_data_file:file execute;
 
 # Read /data/misc/apexdata/ to (get to com.android.art/dalvik-cache).
 allow app_zygote apex_module_data_file:dir search;
 # For ART APEX (read /data/misc/apexdata/com.android.art/dalvik-cache).
 r_dir_file(app_zygote, apex_art_data_file)
 
-# Allow reading/executing installed binaries to enable preloading
-# application data
-allow app_zygote apk_data_file:dir r_dir_perms;
-allow app_zygote apk_data_file:file { r_file_perms execute };
-
 # /oem accesses.
 allow app_zygote oemfs:dir search;
 
 # Allow app_zygote access to /vendor/overlay
 r_dir_file(app_zygote, vendor_overlay_file)
 
 allow app_zygote system_data_file:lnk_file r_file_perms;
 allow app_zygote system_data_file:file { getattr read map };
 
 # Send unsolicited message to system_server
diff --git a/private/webview_zygote.te b/private/webview_zygote.te
index 81a1c2aa659aafd4b369c41d203d7c8003ced854..61594080a219149da2845e75051e4715b1b7ed9c 100644
--- a/private/webview_zygote.te
+++ b/private/webview_zygote.te
@@ -5,25 +5,20 @@ typeattribute webview_zygote coredomain;
 
 # The webview_zygote needs to be able to transition domains.
 typeattribute webview_zygote mlstrustedsubject;
 
 # Allow access to temporary files, which is normally permitted through
 # a domain macro.
 tmpfs_domain(webview_zygote);
 
 userfaultfd_use(webview_zygote)
 
-# Allow reading/executing installed binaries to enable preloading the
-# installed WebView implementation.
-allow webview_zygote apk_data_file:dir r_dir_perms;
-allow webview_zygote apk_data_file:file { r_file_perms execute };
-
 # Access to the WebView relro file.
 allow webview_zygote shared_relro_file:dir search;
 allow webview_zygote shared_relro_file:file r_file_perms;
 
 # Set the UID/GID of the process.
 allow webview_zygote self:global_capability_class_set { setgid setuid };
 # Drop capabilities from bounding set.
 allow webview_zygote self:global_capability_class_set setpcap;
 # Switch SELinux context to app domains.
 allow webview_zygote self:process setcurrent;

commit fd5a6246d2bbea1b15109ab6688009d2bee1243b (HEAD, tag: SP2A.220305.012.2022030801, m/master, grapheneos/12.1)
Author: Daniel Micay <danielmicay@gmail.com>
Date:   Wed 2020-02-26 06:19:11-0500

    remove system_server_startup domain
    
    APEX isn't used for out-of-band updates by GrapheneOS, so this extra
    attack surface is not required.
    
    Signed-off-by: anupritaisno1 <www.anuprita804@gmail.com>
---
 prebuilts/api/32.0/private/domain.te               |  1 -
 prebuilts/api/32.0/private/seapp_contexts          |  2 +-
 prebuilts/api/32.0/private/system_server.te        |  5 -----
 .../32.0/private/system_server_startup.te (gone)   | 24 ----------------------
 prebuilts/api/32.0/private/zygote.te               |  6 +++---
 private/domain.te                                  |  1 -
 private/seapp_contexts                             |  2 +-
 private/system_server.te                           |  5 -----
 private/system_server_startup.te (gone)            | 24 ----------------------
 private/zygote.te                                  |  6 +++---
 10 files changed, 8 insertions(+), 68 deletions(-)

diff --git a/prebuilts/api/32.0/private/domain.te b/prebuilts/api/32.0/private/domain.te
index d4ca398de20fcec0a9aaf0515449ad1486d1ec5d..ca9a67a7bd88e5f3976559ad7494b7ed44c3a82e 100644
--- a/prebuilts/api/32.0/private/domain.te
+++ b/prebuilts/api/32.0/private/domain.te
@@ -226,21 +226,20 @@ neverallow {
 # we want to avoid. See
 # https://bugs.chromium.org/p/project-zero/issues/detail?id=955 for example.
 #
 neverallow {
     domain
     -appdomain
     with_asan(`-asan_extract')
     -iorap_prefetcherd
     -shell
     userdebug_or_eng(`-su')
-    -system_server_startup # for memfd backed executable regions
     -app_zygote
     -webview_zygote
     -zygote
     userdebug_or_eng(`-mediaextractor')
     userdebug_or_eng(`-mediaswcodec')
 } {
     file_type
     -system_file_type
     -system_lib_file
     -system_linker_exec
diff --git a/prebuilts/api/32.0/private/seapp_contexts b/prebuilts/api/32.0/private/seapp_contexts
index 3982c1e8543f594f7a09791ff11051de9e60151e..9e3b78e8bb30863a5c72cec2d7860199cc1e2221 100644
--- a/prebuilts/api/32.0/private/seapp_contexts
+++ b/prebuilts/api/32.0/private/seapp_contexts
@@ -133,21 +133,21 @@ neverallow user=((?!_isolated).)* domain=isolated_base_app
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
 neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
-isSystemServer=true domain=system_server_startup
+isSystemServer=true domain=system_server
 
 user=_app seinfo=base isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
diff --git a/prebuilts/api/32.0/private/system_server.te b/prebuilts/api/32.0/private/system_server.te
index 82b2a1f0669eb59e455478f09ac31efba171f9fa..4d34d9d3629d66959256d1ff59dff69360fdc99f 100644
--- a/prebuilts/api/32.0/private/system_server.te
+++ b/prebuilts/api/32.0/private/system_server.te
@@ -1248,25 +1248,20 @@ neverallow system_server { dev_type -frp_block_device }:blk_file no_rw_file_perm
 # rendering via SwiftShader, which requires JIT support. These builds are
 # never shipped to users.
 ifelse(target_requires_insecure_execmem_for_swiftshader, `true',
   `allow system_server self:process execmem;',
   `neverallow system_server self:process execmem;')
 neverallow system_server { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # TODO: deal with tmpfs_domain pub/priv split properly
 neverallow system_server system_server_tmpfs:file execute;
 
-# Resources handed off by system_server_startup
-allow system_server system_server_startup:fd use;
-allow system_server system_server_startup_tmpfs:file { read write map };
-allow system_server system_server_startup:unix_dgram_socket write;
-
 # Allow system server to communicate to apexd
 allow system_server apex_service:service_manager find;
 allow system_server apexd:binder call;
 
 # Allow system server to scan /apex for flattened APEXes
 allow system_server apex_mnt_dir:dir r_dir_perms;
 
 # Allow system server to read /apex/apex-info-list.xml
 allow system_server apex_info_file:file r_file_perms;
 
diff --git a/prebuilts/api/32.0/private/system_server_startup.te b/prebuilts/api/32.0/private/system_server_startup.te
deleted file mode 100644
index 064e0383c41002f3c8cbca91e5255bd0ff568427..0000000000000000000000000000000000000000
--- a/prebuilts/api/32.0/private/system_server_startup.te
+++ /dev/null
@@ -1,24 +0,0 @@
-type system_server_startup, domain, coredomain;
-type system_server_startup_tmpfs, file_type;
-
-tmpfs_domain(system_server_startup)
-
-# Create JIT memory
-allow system_server_startup self:process execmem;
-allow system_server_startup system_server_startup_tmpfs:file { execute read write open map };
-
-# Allow to pick up integrity-checked artifacts from the ART APEX dalvik cache.
-allow system_server_startup apex_art_data_file:dir r_dir_perms;
-allow system_server_startup apex_art_data_file:file { r_file_perms execute };
-
-# Allow system_server_startup to run setcon() and enter the
-# system_server domain
-allow system_server_startup self:process setcurrent;
-allow system_server_startup system_server:process dyntransition;
-
-# Child of the zygote.
-allow system_server_startup zygote:process sigchld;
-
-# Allow query ART device config properties
-get_prop(system_server_startup, device_config_runtime_native_boot_prop)
-get_prop(system_server_startup, device_config_runtime_native_prop)
diff --git a/prebuilts/api/32.0/private/zygote.te b/prebuilts/api/32.0/private/zygote.te
index af16e661f6a887f506aba13d4aef0c4e1fd1ed7c..02aaa7f47659bcbf49045377d8b48d58ebc69b45 100644
--- a/prebuilts/api/32.0/private/zygote.te
+++ b/prebuilts/api/32.0/private/zygote.te
@@ -8,21 +8,21 @@ tmpfs_domain(zygote)
 read_runtime_log_tags(zygote)
 
 # Override DAC on files and switch uid/gid.
 allow zygote self:global_capability_class_set { dac_override dac_read_search setgid setuid fowner chown };
 
 # Drop capabilities from bounding set.
 allow zygote self:global_capability_class_set setpcap;
 
 # Switch SELinux context to app domains.
 allow zygote self:process setcurrent;
-allow zygote system_server_startup:process dyntransition;
+allow zygote system_server:process dyntransition;
 allow zygote appdomain:process dyntransition;
 allow zygote webview_zygote:process dyntransition;
 allow zygote app_zygote:process dyntransition;
 
 # Allow zygote to read app /proc/pid dirs (b/10455872).
 allow zygote appdomain:dir { getattr search };
 allow zygote appdomain:file { r_file_perms };
 
 userfaultfd_use(zygote)
 
@@ -230,25 +230,25 @@ allow zygote apex_info_file:file r_file_perms;
 
 ###
 ### neverallow rules
 ###
 
 # Ensure that all types assigned to app processes are included
 # in the appdomain attribute, so that all allow and neverallow rules
 # written on appdomain are applied to all app processes.
 # This is achieved by ensuring that it is impossible for zygote to
 # setcon (dyntransition) to any types other than those associated
-# with appdomain plus system_server_startup, webview_zygote and
+# with appdomain plus system_server, webview_zygote and
 # app_zygote.
 neverallow zygote ~{
   appdomain
-  system_server_startup
+  system_server
   webview_zygote
   app_zygote
 }:process dyntransition;
 
 # Zygote should never execute anything from /data except for
 # /data/dalvik-cache files or files generated during on-device
 # signing under /data/misc/apexdata/com.android.art/.
 neverallow zygote {
   data_file_type
   -apex_art_data_file # map PROT_EXEC
diff --git a/private/domain.te b/private/domain.te
index d4ca398de20fcec0a9aaf0515449ad1486d1ec5d..ca9a67a7bd88e5f3976559ad7494b7ed44c3a82e 100644
--- a/private/domain.te
+++ b/private/domain.te
@@ -226,21 +226,20 @@ neverallow {
 # we want to avoid. See
 # https://bugs.chromium.org/p/project-zero/issues/detail?id=955 for example.
 #
 neverallow {
     domain
     -appdomain
     with_asan(`-asan_extract')
     -iorap_prefetcherd
     -shell
     userdebug_or_eng(`-su')
-    -system_server_startup # for memfd backed executable regions
     -app_zygote
     -webview_zygote
     -zygote
     userdebug_or_eng(`-mediaextractor')
     userdebug_or_eng(`-mediaswcodec')
 } {
     file_type
     -system_file_type
     -system_lib_file
     -system_linker_exec
diff --git a/private/seapp_contexts b/private/seapp_contexts
index 3982c1e8543f594f7a09791ff11051de9e60151e..9e3b78e8bb30863a5c72cec2d7860199cc1e2221 100644
--- a/private/seapp_contexts
+++ b/private/seapp_contexts
@@ -133,21 +133,21 @@ neverallow user=((?!_isolated).)* domain=isolated_base_app
 # uid's can be in shell domain
 neverallow user=shell domain=((?!shell).)*
 
 # only the package named com.android.shell can run in the shell domain
 neverallow domain=shell name=((?!com\.android\.shell).)*
 neverallow user=shell name=((?!com\.android\.shell).)*
 
 # Ephemeral Apps must run in the ephemeral_app domain
 neverallow isEphemeralApp=true domain=((?!ephemeral_app).)*
 
-isSystemServer=true domain=system_server_startup
+isSystemServer=true domain=system_server
 
 user=_app seinfo=base isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.traceur domain=traceur_app type=app_data_file levelFrom=all
 user=_app seinfo=base isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=_app isPrivApp=true name=com.android.remoteprovisioner domain=remote_prov_app type=app_data_file levelFrom=all
 user=system seinfo=platform domain=system_app type=system_app_data_file
 user=bluetooth seinfo=platform domain=bluetooth type=bluetooth_data_file
 user=network_stack seinfo=network_stack domain=network_stack type=radio_data_file
 user=nfc seinfo=platform domain=nfc type=nfc_data_file
 user=secure_element seinfo=platform domain=secure_element levelFrom=all
diff --git a/private/system_server.te b/private/system_server.te
index 82b2a1f0669eb59e455478f09ac31efba171f9fa..4d34d9d3629d66959256d1ff59dff69360fdc99f 100644
--- a/private/system_server.te
+++ b/private/system_server.te
@@ -1248,25 +1248,20 @@ neverallow system_server { dev_type -frp_block_device }:blk_file no_rw_file_perm
 # rendering via SwiftShader, which requires JIT support. These builds are
 # never shipped to users.
 ifelse(target_requires_insecure_execmem_for_swiftshader, `true',
   `allow system_server self:process execmem;',
   `neverallow system_server self:process execmem;')
 neverallow system_server { ashmem_device ashmem_libcutils_device }:chr_file execute;
 
 # TODO: deal with tmpfs_domain pub/priv split properly
 neverallow system_server system_server_tmpfs:file execute;
 
-# Resources handed off by system_server_startup
-allow system_server system_server_startup:fd use;
-allow system_server system_server_startup_tmpfs:file { read write map };
-allow system_server system_server_startup:unix_dgram_socket write;
-
 # Allow system server to communicate to apexd
 allow system_server apex_service:service_manager find;
 allow system_server apexd:binder call;
 
 # Allow system server to scan /apex for flattened APEXes
 allow system_server apex_mnt_dir:dir r_dir_perms;
 
 # Allow system server to read /apex/apex-info-list.xml
 allow system_server apex_info_file:file r_file_perms;
 
diff --git a/private/system_server_startup.te b/private/system_server_startup.te
deleted file mode 100644
index 064e0383c41002f3c8cbca91e5255bd0ff568427..0000000000000000000000000000000000000000
--- a/private/system_server_startup.te
+++ /dev/null
@@ -1,24 +0,0 @@
-type system_server_startup, domain, coredomain;
-type system_server_startup_tmpfs, file_type;
-
-tmpfs_domain(system_server_startup)
-
-# Create JIT memory
-allow system_server_startup self:process execmem;
-allow system_server_startup system_server_startup_tmpfs:file { execute read write open map };
-
-# Allow to pick up integrity-checked artifacts from the ART APEX dalvik cache.
-allow system_server_startup apex_art_data_file:dir r_dir_perms;
-allow system_server_startup apex_art_data_file:file { r_file_perms execute };
-
-# Allow system_server_startup to run setcon() and enter the
-# system_server domain
-allow system_server_startup self:process setcurrent;
-allow system_server_startup system_server:process dyntransition;
-
-# Child of the zygote.
-allow system_server_startup zygote:process sigchld;
-
-# Allow query ART device config properties
-get_prop(system_server_startup, device_config_runtime_native_boot_prop)
-get_prop(system_server_startup, device_config_runtime_native_prop)
diff --git a/private/zygote.te b/private/zygote.te
index af16e661f6a887f506aba13d4aef0c4e1fd1ed7c..02aaa7f47659bcbf49045377d8b48d58ebc69b45 100644
--- a/private/zygote.te
+++ b/private/zygote.te
@@ -8,21 +8,21 @@ tmpfs_domain(zygote)
 read_runtime_log_tags(zygote)
 
 # Override DAC on files and switch uid/gid.
 allow zygote self:global_capability_class_set { dac_override dac_read_search setgid setuid fowner chown };
 
 # Drop capabilities from bounding set.
 allow zygote self:global_capability_class_set setpcap;
 
 # Switch SELinux context to app domains.
 allow zygote self:process setcurrent;
-allow zygote system_server_startup:process dyntransition;
+allow zygote system_server:process dyntransition;
 allow zygote appdomain:process dyntransition;
 allow zygote webview_zygote:process dyntransition;
 allow zygote app_zygote:process dyntransition;
 
 # Allow zygote to read app /proc/pid dirs (b/10455872).
 allow zygote appdomain:dir { getattr search };
 allow zygote appdomain:file { r_file_perms };
 
 userfaultfd_use(zygote)
 
@@ -230,25 +230,25 @@ allow zygote apex_info_file:file r_file_perms;
 
 ###
 ### neverallow rules
 ###
 
 # Ensure that all types assigned to app processes are included
 # in the appdomain attribute, so that all allow and neverallow rules
 # written on appdomain are applied to all app processes.
 # This is achieved by ensuring that it is impossible for zygote to
 # setcon (dyntransition) to any types other than those associated
-# with appdomain plus system_server_startup, webview_zygote and
+# with appdomain plus system_server, webview_zygote and
 # app_zygote.
 neverallow zygote ~{
   appdomain
-  system_server_startup
+  system_server
   webview_zygote
   app_zygote
 }:process dyntransition;
 
 # Zygote should never execute anything from /data except for
 # /data/dalvik-cache files or files generated during on-device
 # signing under /data/misc/apexdata/com.android.art/.
 neverallow zygote {
   data_file_type
   -apex_art_data_file # map PROT_EXEC
